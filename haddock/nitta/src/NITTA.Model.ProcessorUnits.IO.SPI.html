<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="annot"><span class="hs-comment">{- |
Module      : NITTA.Model.ProcessorUnits.IO.SPI
Description :
Copyright   : (c) Aleksandr Penskoi, 2019
License     : BSD3
Maintainer  : aleksandr.penskoi@gmail.com
Stability   : experimental
-}</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Model.ProcessorUnits.IO.SPI</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier">SPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#anySPI"><span class="hs-identifier">anySPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Ports"><span class="hs-identifier">Ports</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier">IOPorts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#spiMasterPorts"><span class="hs-identifier">spiMasterPorts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#spiSlavePorts"><span class="hs-identifier">spiSlavePorts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String.Interpolate</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Functions.html"><span class="hs-identifier">NITTA.Intermediate.Functions</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html"><span class="hs-identifier">NITTA.Intermediate.Types</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.html"><span class="hs-identifier">NITTA.Model.Problems</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html"><span class="hs-identifier">NITTA.Model.ProcessorUnits.IO.SimpleIO</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html"><span class="hs-identifier">NITTA.Model.ProcessorUnits.Types</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html"><span class="hs-identifier">NITTA.Model.Time</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Project.html"><span class="hs-identifier">NITTA.Project</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Utils.html"><span class="hs-identifier">NITTA.Utils</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">data</span><span> </span><span id="SPIinterface"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIinterface"><span class="hs-identifier hs-var">SPIinterface</span></a></span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIOInterface"><span class="hs-identifier hs-type">SimpleIOInterface</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIinterface"><span class="hs-identifier hs-type">SPIinterface</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">type</span><span> </span><span id="SPI"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-var">SPI</span></a></span></span><span> </span><span id="local-6989586621680430745"><span class="annot"><a href="#local-6989586621680430745"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680430746"><span class="annot"><a href="#local-6989586621680430746"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680430747"><span class="annot"><a href="#local-6989586621680430747"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIO"><span class="hs-identifier hs-type">SimpleIO</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIinterface"><span class="hs-identifier hs-type">SPIinterface</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430745"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430746"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430747"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span id="local-6989586621680430484"><span id="local-6989586621680430486"><span id="local-6989586621680430487"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#anySPI"><span class="hs-identifier hs-type">anySPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430484"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430486"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430487"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430484"><span class="hs-identifier hs-type">t</span></a></span></span></span></span><span>
</span><span id="line-48"></span><span id="anySPI"><span class="annot"><span class="annottext">anySPI :: forall t v x. Time t =&gt; Int -&gt; Maybe Int -&gt; SPI v x t
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#anySPI"><span class="hs-identifier hs-var hs-var">anySPI</span></a></span></span><span> </span><span id="local-6989586621680430752"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680430752"><span class="hs-identifier hs-var">bounceFilter</span></a></span></span><span> </span><span id="local-6989586621680430753"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621680430753"><span class="hs-identifier hs-var">bufferSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIO"><span class="hs-identifier hs-type">SimpleIO</span></a></span><span>
</span><span id="line-50"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Int
bounceFilter :: Int
bounceFilter :: Int
</span><a href="#local-6989586621680430752"><span class="hs-identifier hs-var hs-var">bounceFilter</span></a></span><span>
</span><span id="line-51"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Int
bufferSize :: Maybe Int
bufferSize :: Maybe Int
</span><a href="#local-6989586621680430753"><span class="hs-identifier hs-var hs-var">bufferSize</span></a></span><span>
</span><span id="line-52"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">receiveQueue :: [Q v x]
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#receiveQueue"><span class="hs-identifier hs-var">receiveQueue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-53"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">receiveN :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#receiveN"><span class="hs-identifier hs-var">receiveN</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-54"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">isReceiveOver :: Bool
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#isReceiveOver"><span class="hs-identifier hs-var">isReceiveOver</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-55"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sendQueue :: [Q v x]
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#sendQueue"><span class="hs-identifier hs-var">sendQueue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-56"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sendN :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#sendN"><span class="hs-identifier hs-var">sendN</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-57"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">process_ :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#process_"><span class="hs-identifier hs-var">process_</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-58"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680430518"><span id="local-6989586621680430519"><span id="local-6989586621680430520"><span id="local-6989586621680430767"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOConnected"><span class="hs-identifier hs-type">IOConnected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430518"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430519"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430520"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-keyword">data</span><span> </span><span id="IOPorts"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier hs-var">IOPorts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430518"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430519"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430520"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="SPIMaster"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-var">SPIMaster</span></a></span></span><span>
</span><span id="line-63"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="master_mosi"><span class="annot"><span class="annottext">forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_mosi"><span class="hs-identifier hs-var hs-var">master_mosi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-64"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="master_miso"><span class="annot"><span class="annottext">forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_miso"><span class="hs-identifier hs-var hs-var">master_miso</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-65"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="master_sclk"><span class="annot"><span class="annottext">forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_sclk"><span class="hs-identifier hs-var hs-var">master_sclk</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-66"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="master_cs"><span class="annot"><span class="annottext">forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_cs"><span class="hs-identifier hs-var hs-var">master_cs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-67"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-68"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="SPISlave"><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-var">SPISlave</span></a></span></span><span>
</span><span id="line-69"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="slave_mosi"><span class="annot"><span class="annottext">forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_mosi"><span class="hs-identifier hs-var hs-var">slave_mosi</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-70"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="slave_miso"><span class="annot"><span class="annottext">forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_miso"><span class="hs-identifier hs-var hs-var">slave_miso</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-71"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="slave_sclk"><span class="annot"><span class="annottext">forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_sclk"><span class="hs-identifier hs-var hs-var">slave_sclk</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-72"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="slave_cs"><span class="annot"><span class="annottext">forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_cs"><span class="hs-identifier hs-var hs-var">slave_cs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-73"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680430782"><span id="local-6989586621680430797"><span id="local-6989586621680430801"><span class="annot"><span class="annottext">Int -&gt; IOPorts (SPI v x t) -&gt; ShowS
[IOPorts (SPI v x t)] -&gt; ShowS
IOPorts (SPI v x t) -&gt; String
(Int -&gt; IOPorts (SPI v x t) -&gt; ShowS)
-&gt; (IOPorts (SPI v x t) -&gt; String)
-&gt; ([IOPorts (SPI v x t)] -&gt; ShowS)
-&gt; Show (IOPorts (SPI v x t))
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v x t. Int -&gt; IOPorts (SPI v x t) -&gt; ShowS
forall v x t. [IOPorts (SPI v x t)] -&gt; ShowS
forall v x t. IOPorts (SPI v x t) -&gt; String
$cshowsPrec :: forall v x t. Int -&gt; IOPorts (SPI v x t) -&gt; ShowS
showsPrec :: Int -&gt; IOPorts (SPI v x t) -&gt; ShowS
$cshow :: forall v x t. IOPorts (SPI v x t) -&gt; String
show :: IOPorts (SPI v x t) -&gt; String
$cshowList :: forall v x t. [IOPorts (SPI v x t)] -&gt; ShowS
showList :: [IOPorts (SPI v x t)] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621680430807"><span class="annot"><span class="annottext">inputPorts :: IOPorts (SPI v x t) -&gt; Set InputPortTag
</span><a href="#local-6989586621680430807"><span class="hs-identifier hs-var hs-var hs-var hs-var">inputPorts</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span id="local-6989586621680430809"><span id="local-6989586621680430810"><span id="local-6989586621680430811"><span id="local-6989586621680430812"><span class="annot"><span class="annottext">OutputPortTag
InputPortTag
slave_mosi :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_miso :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
slave_sclk :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_cs :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_mosi :: InputPortTag
slave_miso :: OutputPortTag
slave_sclk :: InputPortTag
slave_cs :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_mosi"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InputPortTag] -&gt; Set InputPortTag
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">InputPortTag
</span><a href="#local-6989586621680430809"><span class="hs-identifier hs-var">slave_mosi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InputPortTag
</span><a href="#local-6989586621680430811"><span class="hs-identifier hs-var">slave_sclk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InputPortTag
</span><a href="#local-6989586621680430812"><span class="hs-identifier hs-var">slave_cs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#inputPorts"><span class="hs-identifier hs-var">inputPorts</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span id="local-6989586621680430814"><span id="local-6989586621680430815"><span id="local-6989586621680430816"><span id="local-6989586621680430817"><span class="annot"><span class="annottext">OutputPortTag
InputPortTag
master_mosi :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_miso :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
master_sclk :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_cs :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_mosi :: OutputPortTag
master_miso :: InputPortTag
master_sclk :: OutputPortTag
master_cs :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_mosi"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InputPortTag] -&gt; Set InputPortTag
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">InputPortTag
</span><a href="#local-6989586621680430815"><span class="hs-identifier hs-var">master_miso</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621680430821"><span class="annot"><span class="annottext">outputPorts :: IOPorts (SPI v x t) -&gt; Set OutputPortTag
</span><a href="#local-6989586621680430821"><span class="hs-identifier hs-var hs-var hs-var hs-var">outputPorts</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span id="local-6989586621680430823"><span id="local-6989586621680430824"><span id="local-6989586621680430825"><span id="local-6989586621680430826"><span class="annot"><span class="annottext">OutputPortTag
InputPortTag
slave_mosi :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_miso :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
slave_sclk :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_cs :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_mosi :: InputPortTag
slave_miso :: OutputPortTag
slave_sclk :: InputPortTag
slave_cs :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_mosi"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OutputPortTag] -&gt; Set OutputPortTag
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">OutputPortTag
</span><a href="#local-6989586621680430824"><span class="hs-identifier hs-var">slave_miso</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#outputPorts"><span class="hs-identifier hs-var">outputPorts</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span id="local-6989586621680430827"><span id="local-6989586621680430828"><span id="local-6989586621680430829"><span id="local-6989586621680430830"><span class="annot"><span class="annottext">OutputPortTag
InputPortTag
master_mosi :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_miso :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
master_sclk :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_cs :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_mosi :: OutputPortTag
master_miso :: InputPortTag
master_sclk :: OutputPortTag
master_cs :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_mosi"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[OutputPortTag] -&gt; Set OutputPortTag
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">OutputPortTag
</span><a href="#local-6989586621680430827"><span class="hs-identifier hs-var">master_mosi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutputPortTag
</span><a href="#local-6989586621680430829"><span class="hs-identifier hs-var">master_sclk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OutputPortTag
</span><a href="#local-6989586621680430830"><span class="hs-identifier hs-var">master_cs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span id="spiMasterPorts"><span class="annot"><span class="annottext">spiMasterPorts :: Text -&gt; IOPorts (SPI v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#spiMasterPorts"><span class="hs-identifier hs-var hs-var">spiMasterPorts</span></a></span></span><span> </span><span id="local-6989586621680430841"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430841"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span>
</span><span id="line-84"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">master_mosi :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_mosi"><span class="hs-identifier hs-var">master_mosi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-var">OutputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; OutputPortTag) -&gt; Text -&gt; OutputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430841"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_mosi&quot;</span></span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">master_miso :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_miso"><span class="hs-identifier hs-var">master_miso</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-var">InputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InputPortTag) -&gt; Text -&gt; InputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430841"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_miso&quot;</span></span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">master_sclk :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_sclk"><span class="hs-identifier hs-var">master_sclk</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-var">OutputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; OutputPortTag) -&gt; Text -&gt; OutputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430841"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_sclk&quot;</span></span><span>
</span><span id="line-87"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">master_cs :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_cs"><span class="hs-identifier hs-var">master_cs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-var">OutputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; OutputPortTag) -&gt; Text -&gt; OutputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430841"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_cs&quot;</span></span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="spiSlavePorts"><span class="annot"><span class="annottext">spiSlavePorts :: Text -&gt; IOPorts (SPI v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#spiSlavePorts"><span class="hs-identifier hs-var hs-var">spiSlavePorts</span></a></span></span><span> </span><span id="local-6989586621680430852"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430852"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slave_mosi :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_mosi"><span class="hs-identifier hs-var">slave_mosi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-var">InputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InputPortTag) -&gt; Text -&gt; InputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430852"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_mosi&quot;</span></span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slave_miso :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_miso"><span class="hs-identifier hs-var">slave_miso</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-var">OutputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; OutputPortTag) -&gt; Text -&gt; OutputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430852"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_miso&quot;</span></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slave_sclk :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_sclk"><span class="hs-identifier hs-var">slave_sclk</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-var">InputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InputPortTag) -&gt; Text -&gt; InputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430852"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_sclk&quot;</span></span><span>
</span><span id="line-95"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slave_cs :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_cs"><span class="hs-identifier hs-var">slave_cs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-var">InputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; InputPortTag) -&gt; Text -&gt; InputPortTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430852"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_cs&quot;</span></span><span>
</span><span id="line-96"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680430573"><span id="local-6989586621680430574"><span id="local-6989586621680430575"><span class="annot"><a href="NITTA.Model.Time.html#Time"><span class="hs-identifier hs-type">Time</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430573"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430574"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430575"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430573"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>    </span><span id="local-6989586621680430860"><span class="annot"><span class="annottext">def :: SPI v x t
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int -&gt; SPI v x t
forall t v x. Time t =&gt; Int -&gt; Maybe Int -&gt; SPI v x t
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#anySPI"><span class="hs-identifier hs-var">anySPI</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; SPI v x t) -&gt; Maybe Int -&gt; SPI v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680430586"><span id="local-6989586621680430587"><span id="local-6989586621680430588"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680430586"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430586"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430587"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430588"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#TargetSystemComponent"><span class="hs-identifier hs-type">TargetSystemComponent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430586"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430587"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430588"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-102"></span><span>    </span><span id="local-6989586621680430873"><span class="annot"><span class="annottext">moduleName :: Text -&gt; SPI v x t -&gt; Text
</span><a href="#local-6989586621680430873"><span class="hs-identifier hs-var hs-var hs-var hs-var">moduleName</span></a></span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SPI v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pu_spi&quot;</span></span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621680430875"><span class="annot"><span class="annottext">hardware :: Text -&gt; SPI v x t -&gt; Implementation
</span><a href="#local-6989586621680430875"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardware</span></a></span></span><span> </span><span id="local-6989586621680430877"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430877"><span class="hs-identifier hs-var">_tag</span></a></span></span><span> </span><span id="local-6989586621680430878"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680430878"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><span class="annottext">Maybe String -&gt; [Implementation] -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Aggregate"><span class="hs-identifier hs-var">Aggregate</span></a></span><span>
</span><span id="line-105"></span><span>            </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-106"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/pu_slave_spi_driver.v&quot;</span></span><span>
</span><span id="line-107"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/spi_slave_driver.v&quot;</span></span><span>
</span><span id="line-108"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/i2n_splitter.v&quot;</span></span><span>
</span><span id="line-109"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/buffer.v&quot;</span></span><span>
</span><span id="line-110"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/bounce_filter.v&quot;</span></span><span>
</span><span id="line-111"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/spi_master_driver.v&quot;</span></span><span>
</span><span id="line-112"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/n2i_splitter.v&quot;</span></span><span>
</span><span id="line-113"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/pu_slave_spi.v&quot;</span></span><span>
</span><span id="line-114"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spi/pu_master_spi.v&quot;</span></span><span>
</span><span id="line-115"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621680430885"><span class="annot"><span class="annottext">software :: Text -&gt; SPI v x t -&gt; Implementation
</span><a href="#local-6989586621680430885"><span class="hs-identifier hs-var hs-var hs-var hs-var">software</span></a></span></span><span> </span><span id="local-6989586621680430887"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430887"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680430888"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680430888"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; SPI v x t -&gt; Text -&gt; Implementation
forall i v x t.
(VarValTime v x t, SimpleIOInterface i, ToJSON v) =&gt;
Text -&gt; SimpleIO i v x t -&gt; Text -&gt; Implementation
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#protocolDescription"><span class="hs-identifier hs-var">protocolDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680430887"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680430888"><span class="hs-identifier hs-var">pu</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SPI Processor Unit&quot;</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621680431009"><span class="annot"><span class="annottext">hardwareInstance :: Text -&gt; SPI v x t -&gt; UnitEnv (SPI v x t) -&gt; Verilog
</span><a href="#local-6989586621680431009"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardwareInstance</span></a></span></span><span>
</span><span id="line-120"></span><span>        </span><span id="local-6989586621680431011"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431011"><span class="hs-identifier hs-var">tag</span></a></span></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIO"><span class="hs-identifier hs-type">SimpleIO</span></a></span><span class="hs-special">{</span><span id="local-6989586621680431012"><span class="annot"><span class="annottext">Int
bounceFilter :: forall i v x t. SimpleIO i v x t -&gt; Int
bounceFilter :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#bounceFilter"><span class="hs-identifier hs-var hs-var">bounceFilter</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431013"><span class="annot"><span class="annottext">Int
sendN :: forall i v x t. SimpleIO i v x t -&gt; Int
sendN :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#sendN"><span class="hs-identifier hs-var hs-var">sendN</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431014"><span class="annot"><span class="annottext">Int
receiveN :: forall i v x t. SimpleIO i v x t -&gt; Int
receiveN :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#receiveN"><span class="hs-identifier hs-var hs-var">receiveN</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><a href="NITTA.Project.Types.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-123"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680431016"><span class="annot"><span class="annottext">Text
sigClk :: Text
sigClk :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680431016"><span class="hs-identifier hs-var hs-var">sigClk</span></a></span></span><span>
</span><span id="line-124"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431018"><span class="annot"><span class="annottext">Text
sigRst :: Text
sigRst :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680431018"><span class="hs-identifier hs-var hs-var">sigRst</span></a></span></span><span>
</span><span id="line-125"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431020"><span class="annot"><span class="annottext">Text
sigCycleBegin :: Text
sigCycleBegin :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680431020"><span class="hs-identifier hs-var hs-var">sigCycleBegin</span></a></span></span><span>
</span><span id="line-126"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431022"><span class="annot"><span class="annottext">Text
sigInCycle :: Text
sigInCycle :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680431022"><span class="hs-identifier hs-var hs-var">sigInCycle</span></a></span></span><span>
</span><span id="line-127"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431024"><span class="annot"><span class="annottext">Text
sigCycleEnd :: Text
sigCycleEnd :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680431024"><span class="hs-identifier hs-var hs-var">sigCycleEnd</span></a></span></span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">valueIn :: forall m. UnitEnv m -&gt; Maybe (Text, Text)
</span><a href="NITTA.Project.Types.html#valueIn"><span class="hs-identifier hs-var">valueIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680431027"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431027"><span class="hs-identifier hs-var">dataIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431028"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431028"><span class="hs-identifier hs-var">attrIn</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">valueOut :: forall m. UnitEnv m -&gt; Maybe (Text, Text)
</span><a href="NITTA.Project.Types.html#valueOut"><span class="hs-identifier hs-var">valueOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680431030"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431030"><span class="hs-identifier hs-var">dataOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431031"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431031"><span class="hs-identifier hs-var">attrOut</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctrlPorts :: forall m. UnitEnv m -&gt; Maybe (Ports m)
</span><a href="NITTA.Project.Types.html#ctrlPorts"><span class="hs-identifier hs-var">ctrlPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIOPorts"><span class="hs-identifier hs-type">SimpleIOPorts</span></a></span><span class="hs-special">{</span><span id="local-6989586621680431034"><span id="local-6989586621680431035"><span id="local-6989586621680431036"><span class="annot"><span class="annottext">String
SignalTag
wr :: SignalTag
oe :: SignalTag
stop :: String
stop :: forall i v x t. Ports (SimpleIO i v x t) -&gt; String
oe :: forall i v x t. Ports (SimpleIO i v x t) -&gt; SignalTag
wr :: forall i v x t. Ports (SimpleIO i v x t) -&gt; SignalTag
</span><a href="#local-6989586621680431034"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ioPorts :: forall m. UnitEnv m -&gt; Maybe (IOPorts m)
</span><a href="NITTA.Project.Types.html#ioPorts"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680431041"><span class="annot"><span class="annottext">IOPorts (SPI v x t)
</span><a href="#local-6989586621680431041"><span class="hs-identifier hs-var">ioPorts</span></a></span></span><span>
</span><span id="line-132"></span><span>            </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>            </span><span class="annot"><span class="">[__i|
                #{ module_ ioPorts } \#
                        ( .DATA_WIDTH( #{ dataWidth (def :: x) } )
                        , .ATTR_WIDTH( #{ attrWidth (def :: x) } )
                        , .BOUNCE_FILTER( #{ show bounceFilter } )
                        , .DISABLED( #{ if sendN == 0 &amp;&amp; receiveN == 0 then (1 :: Int) else 0 } )
                        ) #{ tag }
                    ( .clk( #{ sigClk } )
                    , .rst( #{ sigRst } )
                    , .flag_stop( #{ stop } )
                    , .signal_cycle_begin( #{ sigCycleBegin } )
                    , .signal_in_cycle( #{ sigInCycle  } )
                    , .signal_cycle_end( #{ sigCycleEnd } )
                    , .signal_oe( #{ oe } )
                    , .signal_wr( #{ wr } )
                    , .data_in( #{ dataIn } ), .attr_in( #{ attrIn } )
                    , .data_out( #{ dataOut } ), .attr_out( #{ attrOut } )
                    #{ nest 4 $ extIO ioPorts  }
                    );
            |]</span></span><span>
</span><span id="line-153"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-154"></span><span>                </span><span id="local-6989586621680431043"><span class="annot"><span class="annottext">module_ :: IOPorts (SPI v x t) -&gt; Verilog
</span><a href="#local-6989586621680431043"><span class="hs-identifier hs-var hs-var">module_</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><span class="hs-string">&quot;pu_slave_spi&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Utils.html#Verilog"><span class="hs-identifier hs-type">Verilog</span></a></span><span>
</span><span id="line-155"></span><span>                </span><span class="annot"><a href="#local-6989586621680431043"><span class="hs-identifier hs-var">module_</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><span class="hs-string">&quot;pu_master_spi&quot;</span></span><span>
</span><span id="line-156"></span><span>                </span><span id="local-6989586621680431044"><span class="annot"><span class="annottext">extIO :: IOPorts (SPI v x t) -&gt; Verilog
</span><a href="#local-6989586621680431044"><span class="hs-identifier hs-var hs-var">extIO</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span id="local-6989586621680431110"><span id="local-6989586621680431111"><span id="local-6989586621680431112"><span id="local-6989586621680431113"><span class="annot"><span class="annottext">OutputPortTag
InputPortTag
slave_mosi :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_miso :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
slave_sclk :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_cs :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_mosi :: InputPortTag
slave_miso :: OutputPortTag
slave_sclk :: InputPortTag
slave_cs :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_mosi"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-157"></span><span>                    </span><span class="annot"><span class="">[__i|
                        , .mosi( #{ slave_mosi } )
                        , .miso( #{ slave_miso } )
                        , .sclk( #{ slave_sclk } )
                        , .cs( #{ slave_cs } )
                    |]</span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-163"></span><span>                        </span><span class="annot"><a href="NITTA.Utils.html#Verilog"><span class="hs-identifier hs-type">Verilog</span></a></span><span>
</span><span id="line-164"></span><span>                </span><span class="annot"><a href="#local-6989586621680431044"><span class="hs-identifier hs-var">extIO</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span id="local-6989586621680431115"><span id="local-6989586621680431116"><span id="local-6989586621680431117"><span id="local-6989586621680431118"><span class="annot"><span class="annottext">OutputPortTag
InputPortTag
master_mosi :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_miso :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
master_sclk :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_cs :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_mosi :: OutputPortTag
master_miso :: InputPortTag
master_sclk :: OutputPortTag
master_cs :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_mosi"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-165"></span><span>                    </span><span class="annot"><span class="">[__i|
                        , .mosi( #{ master_mosi } )
                        , .miso( #{ master_miso } )
                        , .sclk( #{ master_sclk } )
                        , .cs( #{ master_cs } )
                    |]</span></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="NITTA.Project.Types.html#hardwareInstance"><span class="hs-identifier hs-var">hardwareInstance</span></a></span><span> </span><span id="local-6989586621680431120"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431120"><span class="hs-identifier hs-var">_title</span></a></span></span><span> </span><span id="local-6989586621680431121"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680431121"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span id="local-6989586621680431122"><span class="annot"><span class="annottext">UnitEnv (SPI v x t)
</span><a href="#local-6989586621680431122"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Verilog
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680430655"><span id="local-6989586621680430656"><span id="local-6989586621680430657"><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430655"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430656"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430657"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Project.TestBench.html#IOTestBench"><span class="hs-identifier hs-type">IOTestBench</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430655"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430656"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430657"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680430655"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680430656"><span class="hs-identifier hs-type">x</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621680431149"><span class="annot"><span class="annottext">testEnvironmentInitFlag :: Text -&gt; SPI v x t -&gt; Maybe Text
</span><a href="#local-6989586621680431149"><span class="hs-identifier hs-var hs-var hs-var hs-var">testEnvironmentInitFlag</span></a></span></span><span> </span><span id="local-6989586621680431151"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431151"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680431152"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680431152"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text) -&gt; Text -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431151"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_env_init_flag&quot;</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621680431782"><span class="annot"><span class="annottext">testEnvironment :: Text
-&gt; SPI v x t
-&gt; UnitEnv (SPI v x t)
-&gt; TestEnvironment v x
-&gt; Maybe Verilog
</span><a href="#local-6989586621680431782"><span class="hs-identifier hs-var hs-var hs-var hs-var">testEnvironment</span></a></span></span><span>
</span><span id="line-177"></span><span>        </span><span id="local-6989586621680431784"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431784"><span class="hs-identifier hs-var">tag</span></a></span></span><span>
</span><span id="line-178"></span><span>        </span><span id="local-6989586621680431785"><span class="annot"><span class="annottext">sio :: SPI v x t
</span><a href="#local-6989586621680431785"><span class="hs-identifier hs-var">sio</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIO"><span class="hs-identifier hs-type">SimpleIO</span></a></span><span class="hs-special">{</span><span id="local-6989586621680431786"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
process_ :: forall i v x t. SimpleIO i v x t -&gt; Process t (StepInfo v x t)
process_ :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#process_"><span class="hs-identifier hs-var hs-var">process_</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431787"><span class="annot"><span class="annottext">Int
bounceFilter :: forall i v x t. SimpleIO i v x t -&gt; Int
bounceFilter :: Int
</span><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#bounceFilter"><span class="hs-identifier hs-var hs-var">bounceFilter</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-179"></span><span>        </span><span class="annot"><a href="NITTA.Project.Types.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span>
</span><span id="line-180"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680431788"><span class="annot"><span class="annottext">Text
sigClk :: forall m. UnitEnv m -&gt; Text
sigClk :: Text
</span><a href="NITTA.Project.Types.html#sigClk"><span class="hs-identifier hs-var hs-var">sigClk</span></a></span></span><span>
</span><span id="line-181"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431789"><span class="annot"><span class="annottext">Text
sigRst :: forall m. UnitEnv m -&gt; Text
sigRst :: Text
</span><a href="NITTA.Project.Types.html#sigRst"><span class="hs-identifier hs-var hs-var">sigRst</span></a></span></span><span>
</span><span id="line-182"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctrlPorts :: forall m. UnitEnv m -&gt; Maybe (Ports m)
</span><a href="NITTA.Project.Types.html#ctrlPorts"><span class="hs-identifier hs-var">ctrlPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SimpleIO.html#SimpleIOPorts"><span class="hs-identifier hs-type">SimpleIOPorts</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ioPorts :: forall m. UnitEnv m -&gt; Maybe (IOPorts m)
</span><a href="NITTA.Project.Types.html#ioPorts"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680431790"><span class="annot"><span class="annottext">IOPorts (SPI v x t)
</span><a href="#local-6989586621680431790"><span class="hs-identifier hs-var">ioPorts</span></a></span></span><span>
</span><span id="line-184"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><a href="NITTA.Project.TestBench.html#TestEnvironment"><span class="hs-identifier hs-type">TestEnvironment</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">teCntx :: forall v x. TestEnvironment v x -&gt; Cntx v x
</span><a href="NITTA.Project.TestBench.html#teCntx"><span class="hs-identifier hs-var">teCntx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680431793"><span class="annot"><span class="annottext">cntx :: Cntx v x
</span><a href="#local-6989586621680431793"><span class="hs-identifier hs-var">cntx</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Intermediate.Types.html#Cntx"><span class="hs-identifier hs-type">Cntx</span></a></span><span class="hs-special">{</span><span id="local-6989586621680431795"><span class="annot"><span class="annottext">Int
cntxCycleNumber :: Int
cntxCycleNumber :: forall v x. Cntx v x -&gt; Int
</span><a href="#local-6989586621680431795"><span class="hs-identifier hs-var hs-var">cntxCycleNumber</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431797"><span class="annot"><span class="annottext">[CycleCntx v x]
cntxProcess :: [CycleCntx v x]
cntxProcess :: forall v x. Cntx v x -&gt; [CycleCntx v x]
</span><a href="#local-6989586621680431797"><span class="hs-identifier hs-var hs-var">cntxProcess</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680431799"><span class="annot"><span class="annottext">Int
teComputationDuration :: Int
teComputationDuration :: forall v x. TestEnvironment v x -&gt; Int
</span><a href="#local-6989586621680431799"><span class="hs-identifier hs-var hs-var">teComputationDuration</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680431801"><span class="annot"><span class="annottext">receivedVariablesSeq :: [v]
</span><a href="#local-6989586621680431801"><span class="hs-identifier hs-var hs-var">receivedVariablesSeq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>                    </span><span class="annot"><span class="annottext">(F v x -&gt; Maybe v) -&gt; [F v x] -&gt; [v]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-188"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680431802"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680431802"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">F v x -&gt; Maybe (Receive v x)
forall (f :: * -&gt; * -&gt; *) v x.
(Typeable f, Typeable v, Typeable x) =&gt;
F v x -&gt; Maybe (f v x)
</span><a href="NITTA.Intermediate.Types.html#castF"><span class="hs-identifier hs-var">castF</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680431802"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-189"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="NITTA.Intermediate.Functions.html#Receive"><span class="hs-identifier hs-type">Receive</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">v -&gt; Maybe v
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(v -&gt; Maybe v) -&gt; v -&gt; Maybe v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; v
forall {c}. Set c -&gt; c
</span><a href="NITTA.Utils.Base.html#oneOf"><span class="hs-identifier hs-var">oneOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; v) -&gt; Set v -&gt; v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680431802"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-190"></span><span>                            </span><span class="annot"><span class="annottext">Maybe (Receive v x)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe v
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-191"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>                        </span><span class="annot"><span class="annottext">([F v x] -&gt; [v]) -&gt; [F v x] -&gt; [v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; [F v x]
forall a f. WithFunctions a f =&gt; a -&gt; [f]
</span><a href="NITTA.Intermediate.Types.html#functions"><span class="hs-identifier hs-var">functions</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680431786"><span class="hs-identifier hs-var">process_</span></a></span><span>
</span><span id="line-193"></span><span>                </span><span id="local-6989586621680431808"><span class="annot"><span class="annottext">receivedVarsValues :: [Map v x]
</span><a href="#local-6989586621680431808"><span class="hs-identifier hs-var hs-var">receivedVarsValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Map v x] -&gt; [Map v x]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431795"><span class="hs-identifier hs-var">cntxCycleNumber</span></a></span><span> </span><span class="annot"><span class="annottext">([Map v x] -&gt; [Map v x]) -&gt; [Map v x] -&gt; [Map v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Cntx v x -&gt; [Map v x]
forall v x. Ord v =&gt; Cntx v x -&gt; [Map v x]
</span><a href="NITTA.Intermediate.Types.html#cntxReceivedBySlice"><span class="hs-identifier hs-var">cntxReceivedBySlice</span></a></span><span> </span><span class="annot"><span class="annottext">Cntx v x
</span><a href="#local-6989586621680431793"><span class="hs-identifier hs-var">cntx</span></a></span><span>
</span><span id="line-194"></span><span>                </span><span id="local-6989586621680431811"><span class="annot"><span class="annottext">sendedVariableSeq :: [v]
</span><a href="#local-6989586621680431811"><span class="hs-identifier hs-var hs-var">sendedVariableSeq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-195"></span><span>                    </span><span class="annot"><span class="annottext">(EndpointRole v -&gt; Maybe v) -&gt; [EndpointRole v] -&gt; [v]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-196"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-197"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Problems.Endpoint.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span id="local-6989586621680431813"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431813"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">v -&gt; Maybe v
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431813"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-198"></span><span>                            </span><span class="annot"><span class="annottext">EndpointRole v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe v
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-199"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>                        </span><span class="annot"><span class="annottext">([EndpointRole v] -&gt; [v]) -&gt; [EndpointRole v] -&gt; [v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; [EndpointRole v]
forall {b} {v} {x} {t}.
Ord b =&gt;
Process b (StepInfo v x t) -&gt; [EndpointRole v]
</span><a href="NITTA.Utils.html#getEndpoints"><span class="hs-identifier hs-var">getEndpoints</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680431786"><span class="hs-identifier hs-var">process_</span></a></span><span>
</span><span id="line-201"></span><span>                </span><span id="local-6989586621680431815"><span class="annot"><span class="annottext">sendedVarsValues :: [HashMap v x]
</span><a href="#local-6989586621680431815"><span class="hs-identifier hs-var hs-var">sendedVarsValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [HashMap v x] -&gt; [HashMap v x]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431795"><span class="hs-identifier hs-var">cntxCycleNumber</span></a></span><span> </span><span class="annot"><span class="annottext">([HashMap v x] -&gt; [HashMap v x]) -&gt; [HashMap v x] -&gt; [HashMap v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CycleCntx v x -&gt; HashMap v x) -&gt; [CycleCntx v x] -&gt; [HashMap v x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CycleCntx v x -&gt; HashMap v x
forall v x. CycleCntx v x -&gt; HashMap v x
</span><a href="NITTA.Intermediate.Types.html#cycleCntx"><span class="hs-identifier hs-var">cycleCntx</span></a></span><span> </span><span class="annot"><span class="annottext">[CycleCntx v x]
</span><a href="#local-6989586621680431797"><span class="hs-identifier hs-var">cntxProcess</span></a></span><span>
</span><span id="line-202"></span><span>                </span><span id="local-6989586621680431817"><span class="annot"><span class="annottext">wordWidth :: Int
</span><a href="#local-6989586621680431817"><span class="hs-identifier hs-var hs-var">wordWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">x -&gt; Int
forall x. Val x =&gt; x -&gt; Int
</span><a href="NITTA.Intermediate.Value.html#dataWidth"><span class="hs-identifier hs-var">dataWidth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680430656"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                </span><span id="local-6989586621680431818"><span class="annot"><span class="annottext">frameWordCount :: Int
</span><a href="#local-6989586621680431818"><span class="hs-identifier hs-var hs-var">frameWordCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[v] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680431801"><span class="hs-identifier hs-var">receivedVariablesSeq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[v] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680431811"><span class="hs-identifier hs-var">sendedVariableSeq</span></a></span><span>
</span><span id="line-204"></span><span>                </span><span id="local-6989586621680431821"><span class="annot"><span class="annottext">frameWidth :: Int
</span><a href="#local-6989586621680431821"><span class="hs-identifier hs-var hs-var">frameWidth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431818"><span class="hs-identifier hs-var">frameWordCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431817"><span class="hs-identifier hs-var">wordWidth</span></a></span><span>
</span><span id="line-205"></span><span>                </span><span id="local-6989586621680431823"><span class="annot"><span class="annottext">timeLag :: Int
</span><a href="#local-6989586621680431823"><span class="hs-identifier hs-var hs-var">timeLag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-206"></span><span>                </span><span id="local-6989586621680431824"><span class="annot"><span class="annottext">sendingDuration :: Int
</span><a href="#local-6989586621680431824"><span class="hs-identifier hs-var hs-var">sendingDuration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span>
</span><span id="line-208"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431799"><span class="hs-identifier hs-var">teComputationDuration</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431821"><span class="hs-identifier hs-var">frameWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431787"><span class="hs-identifier hs-var">bounceFilter</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>                </span><span id="local-6989586621680431826"><span class="annot"><span class="annottext">toVerilogLiteral :: [x] -&gt; Doc Any
</span><a href="#local-6989586621680431826"><span class="hs-identifier hs-var hs-var">toVerilogLiteral</span></a></span></span><span> </span><span id="local-6989586621680431827"><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680431827"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-212"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680431828"><span class="annot"><span class="annottext">xs' :: [Doc Any]
</span><a href="#local-6989586621680431828"><span class="hs-identifier hs-var hs-var">xs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(x -&gt; Doc Any) -&gt; [x] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">x -&gt; Doc Any
</span><a href="#local-6989586621680431829"><span class="hs-identifier hs-var">toVerilogLiteral'</span></a></span><span> </span><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680431827"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-213"></span><span>                        </span><span id="local-6989586621680431830"><span class="annot"><span class="annottext">placeholder :: [Doc Any]
</span><a href="#local-6989586621680431830"><span class="hs-identifier hs-var hs-var">placeholder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc Any -&gt; [Doc Any]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431818"><span class="hs-identifier hs-var">frameWordCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">[x] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[x]
</span><a href="#local-6989586621680431827"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="">[i|#{ wordWidth }'d00|]</span></span><span>
</span><span id="line-214"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Doc Any] -&gt; Doc Any
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">hsep</span></span><span> </span><span class="annot"><span class="annottext">([Doc Any] -&gt; Doc Any) -&gt; [Doc Any] -&gt; Doc Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; [Doc Any] -&gt; [Doc Any]
forall ann. Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
</span><span class="hs-identifier hs-var">punctuate</span></span><span> </span><span class="annot"><span class="annottext">Doc Any
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Doc Any]
</span><a href="#local-6989586621680431828"><span class="hs-identifier hs-var">xs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc Any] -&gt; [Doc Any] -&gt; [Doc Any]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Doc Any]
</span><a href="#local-6989586621680431830"><span class="hs-identifier hs-var">placeholder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>                </span><span id="local-6989586621680431829"><span class="annot"><span class="annottext">toVerilogLiteral' :: x -&gt; Doc Any
</span><a href="#local-6989586621680431829"><span class="hs-identifier hs-var hs-var">toVerilogLiteral'</span></a></span></span><span> </span><span id="local-6989586621680431835"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680431835"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-216"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">x -&gt; x
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680431835"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">x -&gt; x -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680431835"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[i|-#{ wordWidth }'sd#{ dataLiteral (-x) }|]</span></span><span>
</span><span id="line-217"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[i|#{ wordWidth }'sd#{ dataLiteral x }|]</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>                </span><span id="local-6989586621680431841"><span class="annot"><span class="annottext">disable :: Verilog
</span><a href="#local-6989586621680431841"><span class="hs-identifier hs-var hs-var">disable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>                    </span><span class="annot"><span class="">[__i|
                        initial begin
                            @(negedge #{ sigRst });
                            #{ envInitFlagName } &lt;= 1;
                        end
                    |]</span></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>                </span><span id="local-6989586621680431842"><span class="annot"><span class="annottext">envInitFlagName :: Text
</span><a href="#local-6989586621680431842"><span class="hs-identifier hs-var hs-var">envInitFlagName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-228"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SPI: testEnvironment: internal error&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-229"></span><span>                        </span><span class="annot"><span class="annottext">Text -&gt; SPI v x t -&gt; Maybe Text
forall pu v x. IOTestBench pu v x =&gt; Text -&gt; pu -&gt; Maybe Text
</span><a href="NITTA.Project.TestBench.html#testEnvironmentInitFlag"><span class="hs-identifier hs-var">testEnvironmentInitFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431784"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680431785"><span class="hs-identifier hs-var">sio</span></a></span><span>
</span><span id="line-230"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IOPorts (SPI v x t)
</span><a href="#local-6989586621680431790"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-231"></span><span>                    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPISlave"><span class="hs-identifier hs-type">SPISlave</span></a></span><span class="hs-special">{</span><span id="local-6989586621680431844"><span id="local-6989586621680431845"><span id="local-6989586621680431846"><span id="local-6989586621680431847"><span class="annot"><span class="annottext">OutputPortTag
InputPortTag
slave_mosi :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_miso :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
slave_sclk :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_cs :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
slave_mosi :: InputPortTag
slave_miso :: OutputPortTag
slave_sclk :: InputPortTag
slave_cs :: InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#slave_mosi"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680431848"><span class="annot"><span class="annottext">receiveCycle :: Map v x -&gt; Doc Any
</span><a href="#local-6989586621680431848"><span class="hs-identifier hs-var hs-var">receiveCycle</span></a></span></span><span> </span><span id="local-6989586621680431849"><span class="annot"><span class="annottext">Map v x
</span><a href="#local-6989586621680431849"><span class="hs-identifier hs-var">transmit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680431850"><span class="annot"><span class="annottext">xs :: [x]
</span><a href="#local-6989586621680431850"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; x) -&gt; [v] -&gt; [x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680431851"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431851"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x -&gt; x
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">(Maybe x -&gt; x) -&gt; Maybe x -&gt; x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map v x
</span><a href="#local-6989586621680431849"><span class="hs-identifier hs-var">transmit</span></a></span><span> </span><span class="annot"><span class="annottext">Map v x -&gt; v -&gt; Maybe x
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431851"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680431801"><span class="hs-identifier hs-var">receivedVariablesSeq</span></a></span><span>
</span><span id="line-234"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[__i|
                                        $display( &quot;set data for sending #{ viaShow xs } by #{ tag }_io_test_input&quot; );
                                        #{ tag }_io_test_input = { #{ toVerilogLiteral xs } }; // #{ viaShow xs }
                                        #{ tag }_io_test_start_transaction = 1;                           @(posedge #{ sigClk });
                                        #{ tag }_io_test_start_transaction = 0;                           @(posedge #{ sigClk });
                                        repeat( #{ sendingDuration } ) @(posedge #{ sigClk });

                                    |]</span></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>                            </span><span id="local-6989586621680431855"><span class="annot"><span class="annottext">sendingAssert :: HashMap v x -&gt; Doc Any
</span><a href="#local-6989586621680431855"><span class="hs-identifier hs-var hs-var">sendingAssert</span></a></span></span><span> </span><span id="local-6989586621680431856"><span class="annot"><span class="annottext">HashMap v x
</span><a href="#local-6989586621680431856"><span class="hs-identifier hs-var">transmit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680431857"><span class="annot"><span class="annottext">xs :: [x]
</span><a href="#local-6989586621680431857"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; x) -&gt; [v] -&gt; [x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680431858"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431858"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x -&gt; x
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">(Maybe x -&gt; x) -&gt; Maybe x -&gt; x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; HashMap v x -&gt; Maybe x
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431858"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap v x
</span><a href="#local-6989586621680431856"><span class="hs-identifier hs-var">transmit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680431811"><span class="hs-identifier hs-var">sendedVariableSeq</span></a></span><span>
</span><span id="line-245"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[__i|
                                        @(posedge #{ tag }_io_test_start_transaction);
                                            $write( &quot;#{ tag }_io_test_output actual: %H except: %H ({ #{ toVerilogLiteral xs } })&quot;,
                                                #{ tag }_io_test_output, { #{ toVerilogLiteral xs } } );
                                            if ( #{ tag }_io_test_output != { #{ toVerilogLiteral xs } } ) $display(&quot;\t\tFAIL&quot;);
                                            else $display();

                                    |]</span></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>                            </span><span id="local-6989586621680431861"><span class="annot"><span class="annottext">endDeviceInstance :: Verilog
</span><a href="#local-6989586621680431861"><span class="hs-identifier hs-var hs-var">endDeviceInstance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    /*
                                    #{ pretty sio }
                                    */
                                    reg #{ tag }_io_test_start_transaction;
                                    reg  [#{ frameWidth }-1:0] #{ tag }_io_test_input;
                                    wire #{ tag }_io_test_ready;
                                    wire [#{ frameWidth }-1:0] #{ tag }_io_test_output;
                                    initial #{ envInitFlagName } &lt;= 0; // should be defined on the testbench level.
                                    spi_master_driver \#
                                            ( .DATA_WIDTH( #{ frameWidth } )
                                            , .SCLK_HALFPERIOD( 1 )
                                            ) #{ tag }_io_test
                                        ( .clk( #{ sigClk } )
                                        , .rst( #{ sigRst } )
                                        , .start_transaction( #{ tag }_io_test_start_transaction )
                                        , .data_in( #{ tag }_io_test_input )
                                        , .data_out( #{ tag }_io_test_output )
                                        , .ready( #{ tag }_io_test_ready )
                                        , .mosi( #{ slave_mosi } )
                                        , .miso( #{ slave_miso } )
                                        , .sclk( #{ slave_sclk } )
                                        , .cs( #{ slave_cs } )
                                        );
                                    initial #{ tag }_io_test.inner.shiftreg &lt;= 0;
                                |]</span></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>                            </span><span id="local-6989586621680431864"><span class="annot"><span class="annottext">envDeviceControl :: Verilog
</span><a href="#local-6989586621680431864"><span class="hs-identifier hs-var hs-var">envDeviceControl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    initial begin
                                        #{ tag }_io_test_start_transaction &lt;= 0;
                                        #{ tag }_io_test_input &lt;= 0;
                                        @(negedge #{ sigRst });
                                        repeat(#{ timeLag }) @(posedge #{ sigClk });

                                        #{ nest 4 $ vsep $ map receiveCycle receivedVarsValues }
                                        repeat ( 5 ) begin
                                            #{ nest 8 $ receiveCycle def }
                                        end

                                        // $finish; // DON'T DO THAT (with this line test can pass without data checking)
                                    end
                                |]</span></span><span>
</span><span id="line-298"></span><span>                            </span><span id="local-6989586621680431867"><span class="annot"><span class="annottext">envDeviceCheck :: Verilog
</span><a href="#local-6989586621680431867"><span class="hs-identifier hs-var hs-var">envDeviceCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-299"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    initial begin
                                        @(negedge #{ sigRst });
                                        repeat ( OUTPUT_LATENCY ) @(posedge #{ tag }_io_test_start_transaction); // latency

                                        #{ nest 4 $ vsep $ map sendingAssert sendedVarsValues }
                                        forever begin
                                            @(posedge spi_io_test_start_transaction);
                                            $display( &quot;#{ tag }_io_test_output actual: %H&quot;, #{ tag }_io_test_output );
                                        end
                                    end
                                |]</span></span><span>
</span><span id="line-311"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- FIXME: do not check output signals when we drop data</span><span>
</span><span id="line-312"></span><span>                            </span><span class="annot"><span class="annottext">Verilog -&gt; Maybe Verilog
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-313"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    ////////////////////////////////////////
                                    // SPI test environment
                                    localparam NITTA_LATENCY = 1;
                                    localparam OUTPUT_LATENCY = 3;

                                    // SPI device in test environment
                                    #{ endDeviceInstance :: Verilog }

                                    // SPI device in test environment control
                                    #{ if frameWordCount == 0 then disable else envDeviceControl }

                                    // SPI device in test environment check
                                    #{ if frameWordCount == 0 then disable else envDeviceCheck }

                                    // SPI environment initialization flag set
                                    initial begin
                                        repeat ( NITTA_LATENCY ) @(posedge spi_io_test_start_transaction);
                                        spi_env_init_flag &lt;= 1;
                                    end
                                |]</span></span><span>
</span><span id="line-334"></span><span>                    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPIMaster"><span class="hs-identifier hs-type">SPIMaster</span></a></span><span class="hs-special">{</span><span id="local-6989586621680431870"><span id="local-6989586621680431871"><span id="local-6989586621680431872"><span id="local-6989586621680431873"><span class="annot"><span class="annottext">OutputPortTag
InputPortTag
master_mosi :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_miso :: forall v x t. IOPorts (SPI v x t) -&gt; InputPortTag
master_sclk :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_cs :: forall v x t. IOPorts (SPI v x t) -&gt; OutputPortTag
master_mosi :: OutputPortTag
master_miso :: InputPortTag
master_sclk :: OutputPortTag
master_cs :: OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#master_mosi"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680431874"><span class="annot"><span class="annottext">receiveCycle :: Map v x -&gt; Doc Any
</span><a href="#local-6989586621680431874"><span class="hs-identifier hs-var hs-var">receiveCycle</span></a></span></span><span> </span><span id="local-6989586621680431875"><span class="annot"><span class="annottext">Map v x
</span><a href="#local-6989586621680431875"><span class="hs-identifier hs-var">transmit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680431876"><span class="annot"><span class="annottext">xs :: [x]
</span><a href="#local-6989586621680431876"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; x) -&gt; [v] -&gt; [x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680431877"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431877"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x -&gt; x
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">(Maybe x -&gt; x) -&gt; Maybe x -&gt; x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map v x
</span><a href="#local-6989586621680431875"><span class="hs-identifier hs-var">transmit</span></a></span><span> </span><span class="annot"><span class="annottext">Map v x -&gt; v -&gt; Maybe x
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431877"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680431801"><span class="hs-identifier hs-var">receivedVariablesSeq</span></a></span><span>
</span><span id="line-337"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[__i|
                                        #{ tag }_io_test_input = { #{ toVerilogLiteral xs } }; // #{ xs }
                                        @(posedge #{ tag }_io_test_ready);
                                    |]</span></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>                            </span><span id="local-6989586621680431879"><span class="annot"><span class="annottext">sendingAssert :: HashMap v x -&gt; Doc Any
</span><a href="#local-6989586621680431879"><span class="hs-identifier hs-var hs-var">sendingAssert</span></a></span></span><span> </span><span id="local-6989586621680431880"><span class="annot"><span class="annottext">HashMap v x
</span><a href="#local-6989586621680431880"><span class="hs-identifier hs-var">transmit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-343"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680431881"><span class="annot"><span class="annottext">xs :: [x]
</span><a href="#local-6989586621680431881"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; x) -&gt; [v] -&gt; [x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680431882"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431882"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; Maybe x -&gt; x
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">x
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">(Maybe x -&gt; x) -&gt; Maybe x -&gt; x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; HashMap v x -&gt; Maybe x
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680431882"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap v x
</span><a href="#local-6989586621680431880"><span class="hs-identifier hs-var">transmit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680431811"><span class="hs-identifier hs-var">sendedVariableSeq</span></a></span><span>
</span><span id="line-344"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[__i|
                                        @(posedge #{ tag }_io_test_ready);
                                            $display( &quot;#{ tag }_io_test_output except: %H ({ #{ toVerilogLiteral xs } })&quot;, { #{ toVerilogLiteral xs } } );
                                            $display( &quot;#{ tag }_io_test_output actual: %H&quot;, #{ tag }_io_test_output );
                                            if ( #{ tag }_io_test_output !=  { #{ toVerilogLiteral xs } } )
                                                $display(&quot;                       FAIL&quot;);
                                            $display();
                                    |]</span></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>                            </span><span id="local-6989586621680431884"><span class="annot"><span class="annottext">envInstance :: Verilog
</span><a href="#local-6989586621680431884"><span class="hs-identifier hs-var hs-var">envInstance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    /*
                                    #{ pretty sio }
                                    */
                                    reg #{ tag }_io_test_start_transaction;
                                    reg  [#{ frameWidth }-1:0] #{ tag }_io_test_input;
                                    wire #{ tag }_io_test_ready;
                                    wire [#{ frameWidth }-1:0] #{ tag }_io_test_output;
                                    initial #{ envInitFlagName } &lt;= 0; // should be defined on the testbench level.
                                    spi_slave_driver \#
                                            ( .DATA_WIDTH( #{ frameWidth } )
                                            ) #{ tag }_io_test_slave
                                        ( .clk( #{ sigClk } )
                                        , .rst( #{ sigRst } )
                                        , .data_in( #{ tag }_io_test_input )
                                        , .data_out( #{ tag }_io_test_output )
                                        , .ready( #{ tag }_io_test_ready )
                                        , .mosi( #{ master_mosi } )
                                        , .miso( #{ master_miso } )
                                        , .sclk( #{ master_sclk } )
                                        , .cs( #{ master_cs } )
                                        );
                                |]</span></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>                            </span><span id="local-6989586621680431886"><span class="annot"><span class="annottext">interactions :: Verilog
</span><a href="#local-6989586621680431886"><span class="hs-identifier hs-var hs-var">interactions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>                                </span><span class="annot"><span class="">[__i|
                                    // SPI Input signal generation
                                    initial begin
                                        @(negedge #{ sigRst });
                                        #{ nest 4 $ receiveCycle $ head receivedVarsValues }
                                        #{ envInitFlagName } &lt;= 1;

                                        #{ nest 4 $ vsep $ map receiveCycle $ tail receivedVarsValues }
                                        repeat(70) @(posedge #{ sigClk });
                                        // $finish; // DON'T DO THAT (with this line test can pass without data checking)
                                    end

                                    // SPI Output signal checking
                                    initial begin
                                        @(negedge #{ sigRst });
                                        repeat(2) @(posedge #{ tag }_io_test_ready);
                                        #{ nest 4 $ vsep $ map sendingAssert sendedVarsValues }
                                    end
                                |]</span></span><span>
</span><span id="line-398"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; Maybe Verilog
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Verilog
</span><a href="#local-6989586621680431884"><span class="hs-identifier hs-var">envInstance</span></a></span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; Verilog -&gt; Verilog
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Verilog
forall ann. Doc ann
</span><span class="hs-identifier hs-var">line</span></span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; Verilog -&gt; Verilog
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Verilog
forall ann. Doc ann
</span><span class="hs-identifier hs-var">line</span></span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; Verilog -&gt; Verilog
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680431818"><span class="hs-identifier hs-var">frameWordCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><a href="#local-6989586621680431841"><span class="hs-identifier hs-var">disable</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><a href="#local-6989586621680431886"><span class="hs-identifier hs-var">interactions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>    </span><span class="annot"><a href="NITTA.Project.TestBench.html#testEnvironment"><span class="hs-identifier hs-var">testEnvironment</span></a></span><span> </span><span id="local-6989586621680431891"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680431891"><span class="hs-identifier hs-var">_title</span></a></span></span><span> </span><span id="local-6989586621680431892"><span class="annot"><span class="annottext">SPI v x t
</span><a href="#local-6989586621680431892"><span class="hs-identifier hs-var">_pu</span></a></span></span><span> </span><span id="local-6989586621680431893"><span class="annot"><span class="annottext">UnitEnv (SPI v x t)
</span><a href="#local-6989586621680431893"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span id="local-6989586621680431894"><span class="annot"><span class="annottext">TestEnvironment v x
</span><a href="#local-6989586621680431894"><span class="hs-identifier hs-var">_tEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe Verilog
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-400"></span></pre></body></html>
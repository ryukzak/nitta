<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NoMonomorphismRestriction #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{- |
Module      : NITTA.Frontends.XMILE.Frontend
Description : XMILE frontend prototype
Copyright   : (c) Artur Gogiyan, 2022
License     : BSD3
Maintainer  : artur.gogiyan@gmail.com
Stability   : experimental
-}</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Frontends.XMILE.Frontend</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#translateXMILE"><span class="hs-identifier">translateXMILE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="NITTA.Frontends.Common.html#FrontendResult"><span class="hs-identifier">FrontendResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="NITTA.Frontends.Common.html#TraceVar"><span class="hs-identifier">TraceVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Frontends.Common.html"><span class="hs-identifier">NITTA.Frontends.Common</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Frontends.XMILE.DocumentParser.html"><span class="hs-identifier">NITTA.Frontends.XMILE.DocumentParser</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">XMILE</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Frontends.XMILE.MathParser.html"><span class="hs-identifier">NITTA.Frontends.XMILE.MathParser</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.DataFlow.html"><span class="hs-identifier">NITTA.Intermediate.DataFlow</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Functions.html"><span class="hs-identifier">NITTA.Intermediate.Functions</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Utils.Base.html"><span class="hs-identifier">NITTA.Utils.Base</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">data</span><span> </span><span id="XMILEAlgBuilder"><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-var">XMILEAlgBuilder</span></a></span></span><span> </span><span id="local-6989586621680246723"><span class="annot"><a href="#local-6989586621680246723"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680246722"><span class="annot"><a href="#local-6989586621680246722"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="XMILEAlgBuilder"><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-var">XMILEAlgBuilder</span></a></span></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="algDataFlowGraph"><span class="annot"><span class="annottext">forall v x. XMILEAlgBuilder v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var hs-var">algDataFlowGraph</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Intermediate.DataFlow.html#DataFlowGraph"><span class="hs-identifier hs-type">DataFlowGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680246723"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680246722"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="algTraceVars"><span class="annot"><span class="annottext">forall v x. XMILEAlgBuilder v x -&gt; [TraceVar]
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algTraceVars"><span class="hs-identifier hs-var hs-var">algTraceVars</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.Frontends.Common.html#TraceVar"><span class="hs-identifier hs-type">TraceVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="algUsagesCount"><span class="annot"><span class="annottext">forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algUsagesCount"><span class="hs-identifier hs-var hs-var">algUsagesCount</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="algDefaultValues"><span class="annot"><span class="annottext">forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Double
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDefaultValues"><span class="hs-identifier hs-var hs-var">algDefaultValues</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="algNextFreeNameIndex"><span class="annot"><span class="annottext">forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algNextFreeNameIndex"><span class="hs-identifier hs-var hs-var">algNextFreeNameIndex</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="algNextArgIndex"><span class="annot"><span class="annottext">forall v x. XMILEAlgBuilder v x -&gt; Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algNextArgIndex"><span class="hs-identifier hs-var hs-var">algNextArgIndex</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680246479"><span id="local-6989586621680246481"><span id="local-6989586621680246498"><span class="annot"><span class="annottext">Int -&gt; XMILEAlgBuilder v x -&gt; ShowS
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall v x. Int -&gt; XMILEAlgBuilder v x -&gt; ShowS
forall v x. [XMILEAlgBuilder v x] -&gt; ShowS
forall v x. XMILEAlgBuilder v x -&gt; String
showList :: [XMILEAlgBuilder v x] -&gt; ShowS
$cshowList :: forall v x. [XMILEAlgBuilder v x] -&gt; ShowS
show :: XMILEAlgBuilder v x -&gt; String
$cshow :: forall v x. XMILEAlgBuilder v x -&gt; String
showsPrec :: Int -&gt; XMILEAlgBuilder v x -&gt; ShowS
$cshowsPrec :: forall v x. Int -&gt; XMILEAlgBuilder v x -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span id="deltaTimeVarName"><span class="annot"><span class="annottext">deltaTimeVarName :: Text
</span><a href="NITTA.Frontends.XMILE.Frontend.html#deltaTimeVarName"><span class="hs-identifier hs-var hs-var">deltaTimeVarName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;time_delta&quot;</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span id="translateXMILE"><span class="annot"><span class="annottext">translateXMILE :: Text -&gt; FrontendResult v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#translateXMILE"><span class="hs-identifier hs-var hs-var">translateXMILE</span></a></span></span><span> </span><span id="local-6989586621680246441"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246441"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680246440"><span class="annot"><span class="annottext">xmContent :: Content
</span><a href="#local-6989586621680246440"><span class="hs-identifier hs-var hs-var">xmContent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Content
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#parseDocument"><span class="hs-identifier hs-var">XMILE.parseDocument</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246441"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-47"></span><span>        </span><span id="local-6989586621680246423"><span class="annot"><span class="annottext">builder :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680246423"><span class="hs-identifier hs-var hs-var">builder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {v} {x}.
(Hashable v, Suffix v, ToString v, IsString v, Val x, Typeable v,
 Ord v) =&gt;
Content -&gt; XMILEAlgBuilder v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#processXMILEGraph"><span class="hs-identifier hs-var">processXMILEGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246440"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-48"></span><span>        </span><span id="local-6989586621680246408"><span class="annot"><span class="annottext">frTrace :: [TraceVar]
</span><a href="#local-6989586621680246408"><span class="hs-identifier hs-var hs-var">frTrace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XMILEAlgBuilder Text Int -&gt; [TraceVar]
</span><a href="#local-6989586621680246407"><span class="hs-identifier hs-var">algTraceVars'</span></a></span><span> </span><span class="annot"><span class="annottext">forall {v} {x}.
(Hashable v, Suffix v, ToString v, IsString v, Val x, Typeable v,
 Ord v) =&gt;
XMILEAlgBuilder v x
</span><a href="#local-6989586621680246423"><span class="hs-identifier hs-var">builder</span></a></span><span>
</span><span id="line-49"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="NITTA.Frontends.Common.html#FrontendResult"><span class="hs-identifier hs-type">FrontendResult</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">frDataFlow :: DataFlowGraph v x
</span><a href="NITTA.Frontends.Common.html#frDataFlow"><span class="hs-identifier hs-var">frDataFlow</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v x. XMILEAlgBuilder v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="annot"><span class="annottext">forall {v} {x}.
(Hashable v, Suffix v, ToString v, IsString v, Val x, Typeable v,
 Ord v) =&gt;
XMILEAlgBuilder v x
</span><a href="#local-6989586621680246423"><span class="hs-identifier hs-var">builder</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TraceVar]
frTrace :: [TraceVar]
frTrace :: [TraceVar]
</span><a href="NITTA.Frontends.Common.html#frTrace"><span class="hs-identifier hs-var hs-var">frTrace</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">frPrettyLog :: [HashMap v x] -&gt; [HashMap String String]
</span><a href="NITTA.Frontends.Common.html#frPrettyLog"><span class="hs-identifier hs-var">frPrettyLog</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {t} {v} {a}.
(Real t, Show t, PrintfType v, PrintfArg t, ToString a) =&gt;
[TraceVar] -&gt; [HashMap a t] -&gt; [HashMap String v]
</span><a href="NITTA.Frontends.Common.html#prettyLog"><span class="hs-identifier hs-var">prettyLog</span></a></span><span> </span><span class="annot"><span class="annottext">[TraceVar]
</span><a href="#local-6989586621680246408"><span class="hs-identifier hs-var">frTrace</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><a href="#local-6989586621680246407"><span class="hs-identifier hs-type">algTraceVars'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.Frontends.Common.html#TraceVar"><span class="hs-identifier hs-type">TraceVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-52"></span><span>        </span><span id="local-6989586621680246407"><span class="annot"><span class="annottext">algTraceVars' :: XMILEAlgBuilder Text Int -&gt; [TraceVar]
</span><a href="#local-6989586621680246407"><span class="hs-identifier hs-var hs-var">algTraceVars'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v x. XMILEAlgBuilder v x -&gt; [TraceVar]
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algTraceVars"><span class="hs-identifier hs-var">algTraceVars</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span id="processXMILEGraph"><span class="annot"><span class="annottext">processXMILEGraph :: Content -&gt; XMILEAlgBuilder v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#processXMILEGraph"><span class="hs-identifier hs-var hs-var">processXMILEGraph</span></a></span></span><span> </span><span id="local-6989586621680246380"><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246380"><span class="hs-identifier hs-var">xmContent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="annot"><span class="annottext">forall {v} {x}. XMILEAlgBuilder v x
</span><a href="#local-6989586621680246377"><span class="hs-identifier hs-var">emptyBuilder</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Content -&gt; m ()
</span><a href="NITTA.Frontends.XMILE.Frontend.html#getDefaultValuesAndUsages"><span class="hs-identifier hs-var">getDefaultValuesAndUsages</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246380"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) m, Hashable v, Suffix v,
 ToString v, IsString v, Val x, Typeable v, Ord v) =&gt;
Content -&gt; m ()
</span><a href="NITTA.Frontends.XMILE.Frontend.html#createDataFlowGraph"><span class="hs-identifier hs-var">createDataFlowGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246380"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>        </span><span id="local-6989586621680246377"><span class="annot"><span class="annottext">emptyBuilder :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680246377"><span class="hs-identifier hs-var hs-var">emptyBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-59"></span><span>            </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span>
</span><span id="line-60"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v x. [DataFlowGraph v x] -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#DFCluster"><span class="hs-identifier hs-var">DFCluster</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-61"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">algTraceVars :: [TraceVar]
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algTraceVars"><span class="hs-identifier hs-var">algTraceVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-62"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">algNextFreeNameIndex :: HashMap Text Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algNextFreeNameIndex"><span class="hs-identifier hs-var">algNextFreeNameIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-63"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">algDefaultValues :: HashMap Text Double
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDefaultValues"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-64"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">algUsagesCount :: HashMap Text Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algUsagesCount"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-65"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">algNextArgIndex :: Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algNextArgIndex"><span class="hs-identifier hs-var">algNextArgIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-66"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span id="createDataFlowGraph"><span class="annot"><span class="annottext">createDataFlowGraph :: Content -&gt; m ()
</span><a href="NITTA.Frontends.XMILE.Frontend.html#createDataFlowGraph"><span class="hs-identifier hs-var hs-var">createDataFlowGraph</span></a></span></span><span> </span><span id="local-6989586621680246312"><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246312"><span class="hs-identifier hs-var">xmContent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-70"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680246310"><span class="annot"><span class="annottext">st :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680246310"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680246309"><span class="annot"><span class="annottext">HashMap Text Int
algUsagesCount :: HashMap Text Int
algUsagesCount :: forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Int
</span><a href="#local-6989586621680246309"><span class="hs-identifier hs-var hs-var">algUsagesCount</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-71"></span><span>            </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680246310"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algNextFreeNameIndex :: HashMap Text Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algNextFreeNameIndex"><span class="hs-identifier hs-var">algNextFreeNameIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680246307"><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680246307"><span class="hs-identifier hs-var">hm</span></a></span></span><span> </span><span id="local-6989586621680246306"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246306"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246306"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680246307"><span class="hs-identifier hs-var">hm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HM.keys</span></span><span> </span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680246309"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-72"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Ord v) =&gt;
Stock -&gt; m ()
</span><a href="#local-6989586621680246302"><span class="hs-identifier hs-var">processStock</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; [Stock]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcStocks"><span class="hs-identifier hs-var">xcStocks</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246312"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Ord v) =&gt;
Aux -&gt; m ()
</span><a href="#local-6989586621680246300"><span class="hs-identifier hs-var">processAux</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; [Aux]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcAuxs"><span class="hs-identifier hs-var">xcAuxs</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246312"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) f, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Ord v) =&gt;
Flow -&gt; f ()
</span><a href="#local-6989586621680246298"><span class="hs-identifier hs-var">processFlow</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; [Flow]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcFlows"><span class="hs-identifier hs-var">xcFlows</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246312"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Ord v) =&gt;
m ()
</span><a href="#local-6989586621680246296"><span class="hs-identifier hs-var">addTimeIncrement</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-78"></span><span>        </span><span id="local-6989586621680246296"><span class="annot"><span class="annottext">addTimeIncrement :: m ()
</span><a href="#local-6989586621680246296"><span class="hs-identifier hs-var hs-var">addTimeIncrement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-79"></span><span>            </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-80"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680246266"><span class="annot"><span class="annottext">st :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680246266"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680246265"><span class="annot"><span class="annottext">HashMap Text Int
algUsagesCount :: HashMap Text Int
algUsagesCount :: forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Int
</span><a href="#local-6989586621680246265"><span class="hs-identifier hs-var hs-var">algUsagesCount</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>                    </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680246266"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-82"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">algUsagesCount :: HashMap Text Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algUsagesCount"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-83"></span><span>                            </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span>
</span><span id="line-84"></span><span>                                </span><span class="annot"><span class="annottext">Text
</span><a href="NITTA.Frontends.XMILE.Frontend.html#deltaTimeVarName"><span class="hs-identifier hs-var">deltaTimeVarName</span></a></span><span>
</span><span id="line-85"></span><span>                                </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680246265"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k, HasCallStack) =&gt;
HashMap k v -&gt; k -&gt; v
</span><span class="hs-operator hs-var">HM.!</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="NITTA.Frontends.XMILE.Frontend.html#deltaTimeVarName"><span class="hs-identifier hs-var">deltaTimeVarName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>                                </span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680246265"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span>
</span><span id="line-87"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-88"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>            </span><span id="local-6989586621680246262"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246262"><span class="hs-identifier hs-var">dtUniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="NITTA.Frontends.XMILE.Frontend.html#deltaTimeVarName"><span class="hs-identifier hs-var">deltaTimeVarName</span></a></span><span>
</span><span id="line-90"></span><span>            </span><span id="local-6989586621680246260"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680246260"><span class="hs-identifier hs-var">dtAllGraphNodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m [Text]
</span><a href="#local-6989586621680246259"><span class="hs-identifier hs-var">getAllOutGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="NITTA.Frontends.XMILE.Frontend.html#deltaTimeVarName"><span class="hs-identifier hs-var">deltaTimeVarName</span></a></span><span>
</span><span id="line-91"></span><span>            </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680246258"><span class="annot"><span class="annottext">DataFlowGraph v x
algDataFlowGraph :: DataFlowGraph v x
algDataFlowGraph :: forall v x. XMILEAlgBuilder v x -&gt; DataFlowGraph v x
</span><a href="#local-6989586621680246258"><span class="hs-identifier hs-var hs-var">algDataFlowGraph</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-92"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680246256"><span class="annot"><span class="annottext">dt :: Double
</span><a href="#local-6989586621680246256"><span class="hs-identifier hs-var hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimSpec -&gt; Double
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xssDt"><span class="hs-identifier hs-var">xssDt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; SimSpec
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcSimSpecs"><span class="hs-identifier hs-var">xcSimSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246312"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-93"></span><span>                </span><span id="local-6989586621680246253"><span class="annot"><span class="annottext">startTime :: Double
</span><a href="#local-6989586621680246253"><span class="hs-identifier hs-var hs-var">startTime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimSpec -&gt; Double
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xssStart"><span class="hs-identifier hs-var">xssStart</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; SimSpec
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcSimSpecs"><span class="hs-identifier hs-var">xcSimSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246312"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-94"></span><span>                </span><span id="local-6989586621680246228"><span class="annot"><span class="annottext">graph :: DataFlowGraph v x
</span><a href="#local-6989586621680246228"><span class="hs-identifier hs-var hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-95"></span><span>                    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">L.foldl'</span></span><span>
</span><span id="line-96"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>                        </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680246258"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span>
</span><span id="line-98"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; x -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#constant"><span class="hs-identifier hs-var">F.constant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680246256"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680246260"><span class="hs-identifier hs-var">dtAllGraphNodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; x -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#loop"><span class="hs-identifier hs-var">F.loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680246253"><span class="hs-identifier hs-var">startTime</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;time_inc&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;time&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-100"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#add"><span class="hs-identifier hs-var">F.add</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;time&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246262"><span class="hs-identifier hs-var">dtUniqueName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;time_inc&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-101"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>            </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-103"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680246219"><span class="annot"><span class="annottext">st :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680246219"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680246218"><span class="annot"><span class="annottext">[TraceVar]
algTraceVars :: [TraceVar]
algTraceVars :: forall v x. XMILEAlgBuilder v x -&gt; [TraceVar]
</span><a href="#local-6989586621680246218"><span class="hs-identifier hs-var hs-var">algTraceVars</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-104"></span><span>                    </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680246219"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-105"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680246228"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-106"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">algTraceVars :: [TraceVar]
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algTraceVars"><span class="hs-identifier hs-var">algTraceVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Frontends.Common.html#TraceVar"><span class="hs-identifier hs-type">TraceVar</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tvFmt :: Maybe Text
</span><a href="NITTA.Frontends.Common.html#tvFmt"><span class="hs-identifier hs-var">tvFmt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tvVar :: Text
</span><a href="NITTA.Frontends.Common.html#tvVar"><span class="hs-identifier hs-var">tvVar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;time&quot;</span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[TraceVar]
</span><a href="#local-6989586621680246218"><span class="hs-identifier hs-var">algTraceVars</span></a></span><span>
</span><span id="line-107"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-108"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>        </span><span id="local-6989586621680246302"><span class="annot"><span class="annottext">processStock :: Stock -&gt; m ()
</span><a href="#local-6989586621680246302"><span class="hs-identifier hs-var hs-var">processStock</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Frontends.XMILE.DocumentParser.html#Stock"><span class="hs-identifier hs-type">XMILE.Stock</span></a></span><span class="hs-special">{</span><span id="local-6989586621680246102"><span class="annot"><span class="annottext">Text
xsName :: Stock -&gt; Text
xsName :: Text
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xsName"><span class="hs-identifier hs-var hs-var">xsName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680246100"><span class="annot"><span class="annottext">Maybe Text
xsOutflow :: Stock -&gt; Maybe Text
xsOutflow :: Maybe Text
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xsOutflow"><span class="hs-identifier hs-var hs-var">xsOutflow</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680246098"><span class="annot"><span class="annottext">Maybe Text
xsInflow :: Stock -&gt; Maybe Text
xsInflow :: Maybe Text
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xsInflow"><span class="hs-identifier hs-var hs-var">xsInflow</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>            </span><span id="local-6989586621680246096"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680246096"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m [Text]
</span><a href="#local-6989586621680246259"><span class="hs-identifier hs-var">getAllOutGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246102"><span class="hs-identifier hs-var">xsName</span></a></span><span>
</span><span id="line-112"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680246100"><span class="hs-identifier hs-var">xsOutflow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680246098"><span class="hs-identifier hs-var">xsInflow</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-113"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-114"></span><span>                    </span><span id="local-6989586621680246095"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246095"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246102"><span class="hs-identifier hs-var">xsName</span></a></span><span>
</span><span id="line-115"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Ord v) =&gt;
Text -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621680246094"><span class="hs-identifier hs-var">addStockLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246095"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680246096"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-116"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680246093"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246093"><span class="hs-identifier hs-var">inflow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-117"></span><span>                    </span><span id="local-6989586621680246092"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246092"><span class="hs-identifier hs-var">stockUniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246102"><span class="hs-identifier hs-var">xsName</span></a></span><span>
</span><span id="line-118"></span><span>                    </span><span id="local-6989586621680246091"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246091"><span class="hs-identifier hs-var">tmpName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x} {t} {t} {a}.
(MonadState (XMILEAlgBuilder v x) m, Hashable v, Suffix v,
 ToString v, Val x, IsString v, IsString t, IsString t, IsString a,
 Typeable v, Ord v) =&gt;
Text -&gt; (t -&gt; t -&gt; [a] -&gt; F v x) -&gt; Text -&gt; Text -&gt; m Text
</span><a href="#local-6989586621680246090"><span class="hs-identifier hs-var">processStockFlow</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246093"><span class="hs-identifier hs-var">inflow</span></a></span><span> </span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#add"><span class="hs-identifier hs-var">F.add</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246092"><span class="hs-identifier hs-var">stockUniqueName</span></a></span><span>
</span><span id="line-119"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Ord v) =&gt;
Text -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621680246094"><span class="hs-identifier hs-var">addStockLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246091"><span class="hs-identifier hs-var">tmpName</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680246096"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-120"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680246089"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246089"><span class="hs-identifier hs-var">outflow</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span>                    </span><span id="local-6989586621680246088"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246088"><span class="hs-identifier hs-var">stockUniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246102"><span class="hs-identifier hs-var">xsName</span></a></span><span>
</span><span id="line-122"></span><span>                    </span><span id="local-6989586621680246087"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246087"><span class="hs-identifier hs-var">tmpName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x} {t} {t} {a}.
(MonadState (XMILEAlgBuilder v x) m, Hashable v, Suffix v,
 ToString v, Val x, IsString v, IsString t, IsString t, IsString a,
 Typeable v, Ord v) =&gt;
Text -&gt; (t -&gt; t -&gt; [a] -&gt; F v x) -&gt; Text -&gt; Text -&gt; m Text
</span><a href="#local-6989586621680246090"><span class="hs-identifier hs-var">processStockFlow</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246089"><span class="hs-identifier hs-var">outflow</span></a></span><span> </span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#sub"><span class="hs-identifier hs-var">F.sub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Out&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246088"><span class="hs-identifier hs-var">stockUniqueName</span></a></span><span>
</span><span id="line-123"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Ord v) =&gt;
Text -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621680246094"><span class="hs-identifier hs-var">addStockLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246087"><span class="hs-identifier hs-var">tmpName</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680246096"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-124"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680246085"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246085"><span class="hs-identifier hs-var">outflow</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680246084"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246084"><span class="hs-identifier hs-var">inflow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>                    </span><span id="local-6989586621680246083"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246083"><span class="hs-identifier hs-var">stockUniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246102"><span class="hs-identifier hs-var">xsName</span></a></span><span>
</span><span id="line-126"></span><span>                    </span><span id="local-6989586621680246082"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246082"><span class="hs-identifier hs-var">tmpNameOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x} {t} {t} {a}.
(MonadState (XMILEAlgBuilder v x) m, Hashable v, Suffix v,
 ToString v, Val x, IsString v, IsString t, IsString t, IsString a,
 Typeable v, Ord v) =&gt;
Text -&gt; (t -&gt; t -&gt; [a] -&gt; F v x) -&gt; Text -&gt; Text -&gt; m Text
</span><a href="#local-6989586621680246090"><span class="hs-identifier hs-var">processStockFlow</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246085"><span class="hs-identifier hs-var">outflow</span></a></span><span> </span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#sub"><span class="hs-identifier hs-var">F.sub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Out&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246083"><span class="hs-identifier hs-var">stockUniqueName</span></a></span><span>
</span><span id="line-127"></span><span>                    </span><span id="local-6989586621680246081"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246081"><span class="hs-identifier hs-var">tmpNameIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x} {t} {t} {a}.
(MonadState (XMILEAlgBuilder v x) m, Hashable v, Suffix v,
 ToString v, Val x, IsString v, IsString t, IsString t, IsString a,
 Typeable v, Ord v) =&gt;
Text -&gt; (t -&gt; t -&gt; [a] -&gt; F v x) -&gt; Text -&gt; Text -&gt; m Text
</span><a href="#local-6989586621680246090"><span class="hs-identifier hs-var">processStockFlow</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246084"><span class="hs-identifier hs-var">inflow</span></a></span><span> </span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#add"><span class="hs-identifier hs-var">F.add</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246082"><span class="hs-identifier hs-var">tmpNameOut</span></a></span><span>
</span><span id="line-128"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Ord v) =&gt;
Text -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621680246094"><span class="hs-identifier hs-var">addStockLoop</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246081"><span class="hs-identifier hs-var">tmpNameIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680246096"><span class="hs-identifier hs-var">outputs</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>                </span><span id="local-6989586621680246090"><span class="annot"><span class="annottext">processStockFlow :: Text -&gt; (t -&gt; t -&gt; [a] -&gt; F v x) -&gt; Text -&gt; Text -&gt; m Text
</span><a href="#local-6989586621680246090"><span class="hs-identifier hs-var hs-var">processStockFlow</span></a></span></span><span> </span><span id="local-6989586621680246049"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246049"><span class="hs-identifier hs-var">flowName</span></a></span></span><span> </span><span id="local-6989586621680246048"><span class="annot"><span class="annottext">t -&gt; t -&gt; [a] -&gt; F v x
</span><a href="#local-6989586621680246048"><span class="hs-identifier hs-var">func</span></a></span></span><span> </span><span id="local-6989586621680246047"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246047"><span class="hs-identifier hs-var">ending</span></a></span></span><span> </span><span id="local-6989586621680246046"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246046"><span class="hs-identifier hs-var">stockName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680246041"><span class="annot"><span class="annottext">tmpName :: Text
</span><a href="#local-6989586621680246041"><span class="hs-identifier hs-var hs-var">tmpName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246102"><span class="hs-identifier hs-var">xsName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246047"><span class="hs-identifier hs-var">ending</span></a></span><span>
</span><span id="line-132"></span><span>                        </span><span id="local-6989586621680246040"><span class="annot"><span class="annottext">dt :: Double
</span><a href="#local-6989586621680246040"><span class="hs-identifier hs-var hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimSpec -&gt; Double
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xssDt"><span class="hs-identifier hs-var">xssDt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; SimSpec
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcSimSpecs"><span class="hs-identifier hs-var">xcSimSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680246312"><span class="hs-identifier hs-var">xmContent</span></a></span><span>
</span><span id="line-133"></span><span>                    </span><span id="local-6989586621680246039"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246039"><span class="hs-identifier hs-var">flowUniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x} {a}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Num a, Ord v, Eq a) =&gt;
a -&gt; m Text
</span><a href="#local-6989586621680246038"><span class="hs-identifier hs-var">skaleToDeltaTime</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680246040"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-134"></span><span>                    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-135"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680246037"><span class="annot"><span class="annottext">st :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680246037"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680246036"><span class="annot"><span class="annottext">DataFlowGraph v x
algDataFlowGraph :: DataFlowGraph v x
algDataFlowGraph :: forall v x. XMILEAlgBuilder v x -&gt; DataFlowGraph v x
</span><a href="#local-6989586621680246036"><span class="hs-identifier hs-var hs-var">algDataFlowGraph</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-136"></span><span>                            </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680246037"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-137"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>                                    </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span>
</span><span id="line-139"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; t -&gt; [a] -&gt; F v x
</span><a href="#local-6989586621680246048"><span class="hs-identifier hs-var">func</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246046"><span class="hs-identifier hs-var">stockName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246039"><span class="hs-identifier hs-var">flowUniqueName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246041"><span class="hs-identifier hs-var">tmpName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>                                        </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680246036"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span>
</span><span id="line-141"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-142"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246041"><span class="hs-identifier hs-var">tmpName</span></a></span><span>
</span><span id="line-144"></span><span>                    </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>                        </span><span id="local-6989586621680246038"><span class="annot"><span class="annottext">skaleToDeltaTime :: a -&gt; m Text
</span><a href="#local-6989586621680246038"><span class="hs-identifier hs-var hs-var">skaleToDeltaTime</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246049"><span class="hs-identifier hs-var">flowName</span></a></span><span>
</span><span id="line-146"></span><span>                        </span><span class="annot"><a href="#local-6989586621680246038"><span class="hs-identifier hs-var">skaleToDeltaTime</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-147"></span><span>                            </span><span id="local-6989586621680246003"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246003"><span class="hs-identifier hs-var">flowUniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246049"><span class="hs-identifier hs-var">flowName</span></a></span><span>
</span><span id="line-148"></span><span>                            </span><span id="local-6989586621680246002"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246002"><span class="hs-identifier hs-var">dtUniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="NITTA.Frontends.XMILE.Frontend.html#deltaTimeVarName"><span class="hs-identifier hs-var">deltaTimeVarName</span></a></span><span>
</span><span id="line-149"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680245995"><span class="annot"><span class="annottext">skaledFlowName :: Text
</span><a href="#local-6989586621680245995"><span class="hs-identifier hs-var hs-var">skaledFlowName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246046"><span class="hs-identifier hs-var">stockName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246049"><span class="hs-identifier hs-var">flowName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246047"><span class="hs-identifier hs-var">ending</span></a></span><span>
</span><span id="line-150"></span><span>                            </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-151"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680245994"><span class="annot"><span class="annottext">st :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680245994"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245993"><span class="annot"><span class="annottext">DataFlowGraph v x
algDataFlowGraph :: DataFlowGraph v x
algDataFlowGraph :: forall v x. XMILEAlgBuilder v x -&gt; DataFlowGraph v x
</span><a href="#local-6989586621680245993"><span class="hs-identifier hs-var hs-var">algDataFlowGraph</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>                                    </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245994"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-153"></span><span>                                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>                                            </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span>
</span><span id="line-155"></span><span>                                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#multiply"><span class="hs-identifier hs-var">F.multiply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246002"><span class="hs-identifier hs-var">dtUniqueName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246003"><span class="hs-identifier hs-var">flowUniqueName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245995"><span class="hs-identifier hs-var">skaledFlowName</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>                                                </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680245993"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span>
</span><span id="line-157"></span><span>                                        </span><span class="hs-special">}</span><span>
</span><span id="line-158"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>                            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245995"><span class="hs-identifier hs-var">skaledFlowName</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>                </span><span id="local-6989586621680246094"><span class="annot"><span class="annottext">addStockLoop :: Text -&gt; [Text] -&gt; m ()
</span><a href="#local-6989586621680246094"><span class="hs-identifier hs-var hs-var">addStockLoop</span></a></span></span><span> </span><span id="local-6989586621680245966"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245966"><span class="hs-identifier hs-var">stockName</span></a></span></span><span> </span><span id="local-6989586621680245965"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680245965"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680245962"><span class="annot"><span class="annottext">traceVarName :: TraceVar
</span><a href="#local-6989586621680245962"><span class="hs-identifier hs-var hs-var">traceVarName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Frontends.Common.html#TraceVar"><span class="hs-identifier hs-type">TraceVar</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tvFmt :: Maybe Text
</span><a href="NITTA.Frontends.Common.html#tvFmt"><span class="hs-identifier hs-var">tvFmt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tvVar :: Text
</span><a href="NITTA.Frontends.Common.html#tvVar"><span class="hs-identifier hs-var">tvVar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'#'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680245965"><span class="hs-identifier hs-var">outputs</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>                    </span><span id="local-6989586621680245958"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680245958"><span class="hs-identifier hs-var">defaultValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Double
</span><a href="#local-6989586621680245957"><span class="hs-identifier hs-var">getDefaultValue</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680246102"><span class="hs-identifier hs-var">xsName</span></a></span><span>
</span><span id="line-164"></span><span>                    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-165"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680245956"><span class="annot"><span class="annottext">st :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680245956"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245955"><span class="annot"><span class="annottext">DataFlowGraph v x
algDataFlowGraph :: DataFlowGraph v x
algDataFlowGraph :: forall v x. XMILEAlgBuilder v x -&gt; DataFlowGraph v x
</span><a href="#local-6989586621680245955"><span class="hs-identifier hs-var hs-var">algDataFlowGraph</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245954"><span class="annot"><span class="annottext">[TraceVar]
algTraceVars :: [TraceVar]
algTraceVars :: forall v x. XMILEAlgBuilder v x -&gt; [TraceVar]
</span><a href="#local-6989586621680245954"><span class="hs-identifier hs-var hs-var">algTraceVars</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>                            </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245956"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-167"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>                                    </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span>
</span><span id="line-169"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; x -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#loop"><span class="hs-identifier hs-var">F.loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680245958"><span class="hs-identifier hs-var">defaultValue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245966"><span class="hs-identifier hs-var">stockName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680245965"><span class="hs-identifier hs-var">outputs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>                                        </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680245955"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span>
</span><span id="line-171"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">algTraceVars :: [TraceVar]
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algTraceVars"><span class="hs-identifier hs-var">algTraceVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TraceVar
</span><a href="#local-6989586621680245962"><span class="hs-identifier hs-var">traceVarName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[TraceVar]
</span><a href="#local-6989586621680245954"><span class="hs-identifier hs-var">algTraceVars</span></a></span><span>
</span><span id="line-172"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-173"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span>        </span><span id="local-6989586621680246300"><span class="annot"><span class="annottext">processAux :: Aux -&gt; m ()
</span><a href="#local-6989586621680246300"><span class="hs-identifier hs-var hs-var">processAux</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Frontends.XMILE.DocumentParser.html#Aux"><span class="hs-identifier hs-type">XMILE.Aux</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245919"><span class="annot"><span class="annottext">Text
xaName :: Aux -&gt; Text
xaName :: Text
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xaName"><span class="hs-identifier hs-var hs-var">xaName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245917"><span class="annot"><span class="annottext">XMExpr
xaEquation :: Aux -&gt; XMExpr
xaEquation :: XMExpr
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xaEquation"><span class="hs-identifier hs-var hs-var">xaEquation</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245917"><span class="hs-identifier hs-var">xaEquation</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>                </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Frontends.XMILE.MathParser.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span id="local-6989586621680245914"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680245914"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>                    </span><span id="local-6989586621680245913"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680245913"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m [Text]
</span><a href="#local-6989586621680246259"><span class="hs-identifier hs-var">getAllOutGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245919"><span class="hs-identifier hs-var">xaName</span></a></span><span>
</span><span id="line-179"></span><span>                    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-180"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680245912"><span class="annot"><span class="annottext">st :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680245912"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245911"><span class="annot"><span class="annottext">DataFlowGraph v x
algDataFlowGraph :: DataFlowGraph v x
algDataFlowGraph :: forall v x. XMILEAlgBuilder v x -&gt; DataFlowGraph v x
</span><a href="#local-6989586621680245911"><span class="hs-identifier hs-var hs-var">algDataFlowGraph</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-181"></span><span>                            </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245912"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-182"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>                                    </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span>
</span><span id="line-184"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; x -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#constant"><span class="hs-identifier hs-var">F.constant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Read a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680245914"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680245913"><span class="hs-identifier hs-var">outputs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>                                        </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680245911"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span>
</span><span id="line-186"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>                </span><span id="local-6989586621680245910"><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245910"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;non supported equation part: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245910"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span>        </span><span id="local-6989586621680246298"><span class="annot"><span class="annottext">processFlow :: Flow -&gt; f ()
</span><a href="#local-6989586621680246298"><span class="hs-identifier hs-var hs-var">processFlow</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Frontends.XMILE.DocumentParser.html#Flow"><span class="hs-identifier hs-type">XMILE.Flow</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245883"><span class="annot"><span class="annottext">Text
xfName :: Flow -&gt; Text
xfName :: Text
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xfName"><span class="hs-identifier hs-var hs-var">xfName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245881"><span class="annot"><span class="annottext">XMExpr
xfEquation :: Flow -&gt; XMExpr
xfEquation :: XMExpr
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xfEquation"><span class="hs-identifier hs-var hs-var">xfEquation</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-191"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x} {a}.
(MonadState (XMILEAlgBuilder v x) m, IsString v, ToString v,
 Suffix v, Hashable v, Val x, Typeable v, Show a, Num a, Ord v) =&gt;
XMExpr -&gt; a -&gt; Bool -&gt; m (Text, a)
</span><a href="#local-6989586621680245878"><span class="hs-identifier hs-var">processFlowEquation</span></a></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245881"><span class="hs-identifier hs-var">xfEquation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>                </span><span id="local-6989586621680245878"><span class="annot"><span class="annottext">processFlowEquation :: XMExpr -&gt; a -&gt; Bool -&gt; m (Text, a)
</span><a href="#local-6989586621680245878"><span class="hs-identifier hs-var hs-var">processFlowEquation</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Frontends.XMILE.MathParser.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680245818"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245818"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680245817"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245817"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>                    </span><span id="local-6989586621680245816"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245816"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var">getUniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245818"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-195"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245816"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245817"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>                </span><span class="annot"><a href="#local-6989586621680245878"><span class="hs-identifier hs-var">processFlowEquation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Frontends.XMILE.MathParser.html#Duo"><span class="hs-identifier hs-type">Duo</span></a></span><span> </span><span id="local-6989586621680245814"><span class="annot"><span class="annottext">XMDuop
</span><a href="#local-6989586621680245814"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621680245813"><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245813"><span class="hs-identifier hs-var">leftExpr</span></a></span></span><span> </span><span id="local-6989586621680245812"><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245812"><span class="hs-identifier hs-var">rightExpr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680245811"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245811"><span class="hs-identifier hs-var">tempNameIndex</span></a></span></span><span> </span><span id="local-6989586621680245810"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680245810"><span class="hs-identifier hs-var">isTopLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-197"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680245809"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245809"><span class="hs-identifier hs-var">leftNameText</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245808"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245808"><span class="hs-identifier hs-var">tempNameIndex'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">XMExpr -&gt; a -&gt; Bool -&gt; m (Text, a)
</span><a href="#local-6989586621680245878"><span class="hs-identifier hs-var">processFlowEquation</span></a></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245813"><span class="hs-identifier hs-var">leftExpr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245811"><span class="hs-identifier hs-var">tempNameIndex</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-198"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621680245807"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245807"><span class="hs-identifier hs-var">rightNameText</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245806"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245806"><span class="hs-identifier hs-var">tempNameIndex''</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">XMExpr -&gt; a -&gt; Bool -&gt; m (Text, a)
</span><a href="#local-6989586621680245878"><span class="hs-identifier hs-var">processFlowEquation</span></a></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245812"><span class="hs-identifier hs-var">rightExpr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245808"><span class="hs-identifier hs-var">tempNameIndex'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-199"></span><span>                    </span><span id="local-6989586621680245805"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680245805"><span class="hs-identifier hs-var">tmpNameText</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {v} {x} {m :: * -&gt; *} {a}.
(MonadState (XMILEAlgBuilder v x) m, Show a) =&gt;
a -&gt; Text -&gt; Bool -&gt; m [Text]
</span><a href="#local-6989586621680245804"><span class="hs-identifier hs-var">getTempName</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245806"><span class="hs-identifier hs-var">tempNameIndex''</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245883"><span class="hs-identifier hs-var">xfName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680245810"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span>
</span><span id="line-200"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680245801"><span class="annot"><span class="annottext">leftName :: a
</span><a href="#local-6989586621680245801"><span class="hs-identifier hs-var hs-var">leftName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245809"><span class="hs-identifier hs-var">leftNameText</span></a></span><span>
</span><span id="line-201"></span><span>                        </span><span id="local-6989586621680245798"><span class="annot"><span class="annottext">rightName :: a
</span><a href="#local-6989586621680245798"><span class="hs-identifier hs-var hs-var">rightName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245807"><span class="hs-identifier hs-var">rightNameText</span></a></span><span>
</span><span id="line-202"></span><span>                        </span><span id="local-6989586621680245795"><span class="annot"><span class="annottext">tmpName :: [b]
</span><a href="#local-6989586621680245795"><span class="hs-identifier hs-var hs-var">tmpName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680245805"><span class="hs-identifier hs-var">tmpNameText</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>                    </span><span id="local-6989586621680245794"><span class="annot"><span class="annottext">st :: XMILEAlgBuilder v x
</span><a href="#local-6989586621680245794"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algDataFlowGraph :: forall v x. XMILEAlgBuilder v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680245793"><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680245793"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-205"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">XMDuop
</span><a href="#local-6989586621680245814"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-206"></span><span>                        </span><span class="annot"><span class="annottext">XMDuop
</span><a href="NITTA.Frontends.XMILE.MathParser.html#Add"><span class="hs-identifier hs-var">Add</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245794"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#add"><span class="hs-identifier hs-var">F.add</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="#local-6989586621680245801"><span class="hs-identifier hs-var">leftName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="#local-6989586621680245798"><span class="hs-identifier hs-var">rightName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b}. IsString b =&gt; [b]
</span><a href="#local-6989586621680245795"><span class="hs-identifier hs-var">tmpName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680245793"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-207"></span><span>                        </span><span class="annot"><span class="annottext">XMDuop
</span><a href="NITTA.Frontends.XMILE.MathParser.html#Sub"><span class="hs-identifier hs-var">Sub</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245794"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#sub"><span class="hs-identifier hs-var">F.sub</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="#local-6989586621680245801"><span class="hs-identifier hs-var">leftName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="#local-6989586621680245798"><span class="hs-identifier hs-var">rightName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b}. IsString b =&gt; [b]
</span><a href="#local-6989586621680245795"><span class="hs-identifier hs-var">tmpName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680245793"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>                        </span><span class="annot"><span class="annottext">XMDuop
</span><a href="NITTA.Frontends.XMILE.MathParser.html#Mul"><span class="hs-identifier hs-var">Mul</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245794"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#multiply"><span class="hs-identifier hs-var">F.multiply</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="#local-6989586621680245801"><span class="hs-identifier hs-var">leftName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="#local-6989586621680245798"><span class="hs-identifier hs-var">rightName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b}. IsString b =&gt; [b]
</span><a href="#local-6989586621680245795"><span class="hs-identifier hs-var">tmpName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680245793"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>                        </span><span class="annot"><span class="annottext">XMDuop
</span><a href="NITTA.Frontends.XMILE.MathParser.html#Div"><span class="hs-identifier hs-var">Div</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245794"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDataFlowGraph"><span class="hs-identifier hs-var">algDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {v} {x}. F v x -&gt; DataFlowGraph v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Intermediate.DataFlow.html#addFuncToDataFlowGraph"><span class="hs-identifier hs-var">addFuncToDataFlowGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; v -&gt; v -&gt; [v] -&gt; [v] -&gt; F v x
</span><a href="NITTA.Intermediate.Functions.html#division"><span class="hs-identifier hs-var">F.division</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="#local-6989586621680245801"><span class="hs-identifier hs-var">leftName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="#local-6989586621680245798"><span class="hs-identifier hs-var">rightName</span></a></span><span> </span><span class="annot"><span class="annottext">forall {b}. IsString b =&gt; [b]
</span><a href="#local-6989586621680245795"><span class="hs-identifier hs-var">tmpName</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680245793"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-210"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">forall {b}. IsString b =&gt; [b]
</span><a href="#local-6989586621680245795"><span class="hs-identifier hs-var">tmpName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245806"><span class="hs-identifier hs-var">tempNameIndex''</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>                    </span><span class="hs-keyword">where</span><span>
</span><span id="line-212"></span><span>                        </span><span id="local-6989586621680245804"><span class="annot"><span class="annottext">getTempName :: a -&gt; Text -&gt; Bool -&gt; m [Text]
</span><a href="#local-6989586621680245804"><span class="hs-identifier hs-var hs-var">getTempName</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680245777"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245777"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m [Text]
</span><a href="#local-6989586621680246259"><span class="hs-identifier hs-var">getAllOutGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245777"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-213"></span><span>                        </span><span class="annot"><a href="#local-6989586621680245804"><span class="hs-identifier hs-var">getTempName</span></a></span><span> </span><span id="local-6989586621680245776"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245776"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span id="local-6989586621680245775"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245775"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. Show a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#showText"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245776"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245775"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>                </span><span class="annot"><a href="#local-6989586621680245878"><span class="hs-identifier hs-var">processFlowEquation</span></a></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621680246261"><span class="annot"><span class="annottext">getUniqueName :: Text -&gt; m Text
</span><a href="#local-6989586621680246261"><span class="hs-identifier hs-var hs-var">getUniqueName</span></a></span></span><span> </span><span id="local-6989586621680245758"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245758"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>            </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245757"><span class="annot"><span class="annottext">HashMap Text Int
algNextFreeNameIndex :: HashMap Text Int
algNextFreeNameIndex :: forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Int
</span><a href="#local-6989586621680245757"><span class="hs-identifier hs-var hs-var">algNextFreeNameIndex</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-218"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680245749"><span class="annot"><span class="annottext">index :: Int
</span><a href="#local-6989586621680245749"><span class="hs-identifier hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;name not found : &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245758"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245758"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680245757"><span class="hs-identifier hs-var">algNextFreeNameIndex</span></a></span><span>
</span><span id="line-219"></span><span>            </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680245747"><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245747"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245747"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algNextFreeNameIndex :: HashMap Text Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algNextFreeNameIndex"><span class="hs-identifier hs-var">algNextFreeNameIndex</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245758"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680245749"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680245757"><span class="hs-identifier hs-var">algNextFreeNameIndex</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. (Semigroup a, IsString a, Show a) =&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621680245746"><span class="hs-identifier hs-var">getGraphName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245758"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680245749"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span>        </span><span id="local-6989586621680246259"><span class="annot"><span class="annottext">getAllOutGraphNodes :: Text -&gt; m [Text]
</span><a href="#local-6989586621680246259"><span class="hs-identifier hs-var hs-var">getAllOutGraphNodes</span></a></span></span><span> </span><span id="local-6989586621680245734"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245734"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>            </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245733"><span class="annot"><span class="annottext">HashMap Text Int
algUsagesCount :: HashMap Text Int
algUsagesCount :: forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Int
</span><a href="#local-6989586621680245733"><span class="hs-identifier hs-var hs-var">algUsagesCount</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680245725"><span class="annot"><span class="annottext">usages :: Int
</span><a href="#local-6989586621680245725"><span class="hs-identifier hs-var hs-var">usages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;name not found : &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245734"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245734"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680245733"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680245724"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680245724"><span class="hs-identifier hs-var">num</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall {a} {a}. (Semigroup a, IsString a, Show a) =&gt; a -&gt; a -&gt; a
</span><a href="#local-6989586621680245746"><span class="hs-identifier hs-var">getGraphName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245734"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680245724"><span class="hs-identifier hs-var">num</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680245725"><span class="hs-identifier hs-var">usages</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span>        </span><span id="local-6989586621680245957"><span class="annot"><span class="annottext">getDefaultValue :: Text -&gt; m Double
</span><a href="#local-6989586621680245957"><span class="hs-identifier hs-var hs-var">getDefaultValue</span></a></span></span><span> </span><span id="local-6989586621680245711"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245711"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>            </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245710"><span class="annot"><span class="annottext">HashMap Text Double
algDefaultValues :: HashMap Text Double
algDefaultValues :: forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Double
</span><a href="#local-6989586621680245710"><span class="hs-identifier hs-var hs-var">algDefaultValues</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-229"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;name not found :&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245711"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245711"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Double
</span><a href="#local-6989586621680245710"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>        </span><span id="local-6989586621680245746"><span class="annot"><span class="annottext">getGraphName :: a -&gt; a -&gt; a
</span><a href="#local-6989586621680245746"><span class="hs-identifier hs-var hs-var">getGraphName</span></a></span></span><span> </span><span id="local-6989586621680245700"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245700"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680245699"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245699"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245700"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680245699"><span class="hs-identifier hs-var">index</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span id="getDefaultValuesAndUsages"><span class="annot"><span class="annottext">getDefaultValuesAndUsages :: Content -&gt; m ()
</span><a href="NITTA.Frontends.XMILE.Frontend.html#getDefaultValuesAndUsages"><span class="hs-identifier hs-var hs-var">getDefaultValuesAndUsages</span></a></span></span><span> </span><span id="local-6989586621680245693"><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680245693"><span class="hs-identifier hs-var">algBuilder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Stock -&gt; m ()
</span><a href="#local-6989586621680245692"><span class="hs-identifier hs-var">processStock</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; [Stock]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcStocks"><span class="hs-identifier hs-var">xcStocks</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680245693"><span class="hs-identifier hs-var">algBuilder</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-236"></span><span>        </span><span id="local-6989586621680245676"><span class="annot"><span class="annottext">nameToEquationMap :: HashMap Text XMExpr
</span><a href="#local-6989586621680245676"><span class="hs-identifier hs-var hs-var">nameToEquationMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="annot"><span class="annottext">forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} {v} {m :: * -&gt; *}.
(MonadState (HashMap k v) m, Hashable k) =&gt;
(k, v) -&gt; m ()
</span><a href="#local-6989586621680245675"><span class="hs-identifier hs-var">addToMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680245673"><span class="annot"><span class="annottext">Aux
</span><a href="#local-6989586621680245673"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Aux -&gt; Text
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xaName"><span class="hs-identifier hs-var">xaName</span></a></span><span> </span><span class="annot"><span class="annottext">Aux
</span><a href="#local-6989586621680245673"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Aux -&gt; XMExpr
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xaEquation"><span class="hs-identifier hs-var">xaEquation</span></a></span><span> </span><span class="annot"><span class="annottext">Aux
</span><a href="#local-6989586621680245673"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Content -&gt; [Aux]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcAuxs"><span class="hs-identifier hs-var">xcAuxs</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680245693"><span class="hs-identifier hs-var">algBuilder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} {v} {m :: * -&gt; *}.
(MonadState (HashMap k v) m, Hashable k) =&gt;
(k, v) -&gt; m ()
</span><a href="#local-6989586621680245675"><span class="hs-identifier hs-var">addToMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680245672"><span class="annot"><span class="annottext">Flow
</span><a href="#local-6989586621680245672"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Flow -&gt; Text
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xfName"><span class="hs-identifier hs-var">xfName</span></a></span><span> </span><span class="annot"><span class="annottext">Flow
</span><a href="#local-6989586621680245672"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Flow -&gt; XMExpr
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xfEquation"><span class="hs-identifier hs-var">xfEquation</span></a></span><span> </span><span class="annot"><span class="annottext">Flow
</span><a href="#local-6989586621680245672"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Content -&gt; [Flow]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcFlows"><span class="hs-identifier hs-var">xcFlows</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680245693"><span class="hs-identifier hs-var">algBuilder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} {v} {m :: * -&gt; *}.
(MonadState (HashMap k v) m, Hashable k) =&gt;
(k, v) -&gt; m ()
</span><a href="#local-6989586621680245675"><span class="hs-identifier hs-var">addToMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680245671"><span class="annot"><span class="annottext">Stock
</span><a href="#local-6989586621680245671"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stock -&gt; Text
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xsName"><span class="hs-identifier hs-var">xsName</span></a></span><span> </span><span class="annot"><span class="annottext">Stock
</span><a href="#local-6989586621680245671"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Stock -&gt; XMExpr
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xsEquation"><span class="hs-identifier hs-var">xsEquation</span></a></span><span> </span><span class="annot"><span class="annottext">Stock
</span><a href="#local-6989586621680245671"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Content -&gt; [Stock]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcStocks"><span class="hs-identifier hs-var">xcStocks</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680245693"><span class="hs-identifier hs-var">algBuilder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-241"></span><span>                </span><span id="local-6989586621680245675"><span class="annot"><span class="annottext">addToMap :: (k, v) -&gt; m ()
</span><a href="#local-6989586621680245675"><span class="hs-identifier hs-var hs-var">addToMap</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680245662"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680245662"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245661"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680245661"><span class="hs-identifier hs-var">eqn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680245660"><span class="annot"><span class="annottext">HashMap k v
</span><a href="#local-6989586621680245660"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680245662"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680245661"><span class="hs-identifier hs-var">eqn</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap k v
</span><a href="#local-6989586621680245660"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>        </span><span id="local-6989586621680245692"><span class="annot"><span class="annottext">processStock :: Stock -&gt; m ()
</span><a href="#local-6989586621680245692"><span class="hs-identifier hs-var hs-var">processStock</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Frontends.XMILE.DocumentParser.html#Stock"><span class="hs-identifier hs-type">XMILE.Stock</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245648"><span class="annot"><span class="annottext">XMExpr
xsEquation :: XMExpr
xsEquation :: Stock -&gt; XMExpr
</span><a href="#local-6989586621680245648"><span class="hs-identifier hs-var hs-var">xsEquation</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245647"><span class="annot"><span class="annottext">Text
xsName :: Text
xsName :: Stock -&gt; Text
</span><a href="#local-6989586621680245647"><span class="hs-identifier hs-var hs-var">xsName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245646"><span class="annot"><span class="annottext">Maybe Text
xsInflow :: Maybe Text
xsInflow :: Stock -&gt; Maybe Text
</span><a href="#local-6989586621680245646"><span class="hs-identifier hs-var hs-var">xsInflow</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680245645"><span class="annot"><span class="annottext">Maybe Text
xsOutflow :: Maybe Text
xsOutflow :: Stock -&gt; Maybe Text
</span><a href="#local-6989586621680245645"><span class="hs-identifier hs-var hs-var">xsOutflow</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>            </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245644"><span class="annot"><span class="annottext">HashMap Text Double
algDefaultValues :: HashMap Text Double
algDefaultValues :: forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Double
</span><a href="#local-6989586621680245644"><span class="hs-identifier hs-var hs-var">algDefaultValues</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-244"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680245643"><span class="annot"><span class="annottext">val :: Double
</span><a href="#local-6989586621680245643"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Text Double -&gt; XMExpr -&gt; Double
</span><a href="NITTA.Frontends.XMILE.MathParser.html#calculateDefaultValue"><span class="hs-identifier hs-var">calculateDefaultValue</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Double
</span><a href="#local-6989586621680245644"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245648"><span class="hs-identifier hs-var">xsEquation</span></a></span><span>
</span><span id="line-245"></span><span>            </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680245641"><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245641"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245641"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algDefaultValues :: HashMap Text Double
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDefaultValues"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245647"><span class="hs-identifier hs-var">xsName</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621680245643"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Double
</span><a href="#local-6989586621680245644"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>            </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Maybe Text -&gt; m ()
</span><a href="#local-6989586621680245640"><span class="hs-identifier hs-var">processFlow</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680245646"><span class="hs-identifier hs-var">xsInflow</span></a></span><span>
</span><span id="line-247"></span><span>            </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Maybe Text -&gt; m ()
</span><a href="#local-6989586621680245640"><span class="hs-identifier hs-var">processFlow</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680245645"><span class="hs-identifier hs-var">xsOutflow</span></a></span><span>
</span><span id="line-248"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>                </span><span id="local-6989586621680245640"><span class="annot"><span class="annottext">processFlow :: Maybe Text -&gt; m ()
</span><a href="#local-6989586621680245640"><span class="hs-identifier hs-var hs-var">processFlow</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>                </span><span class="annot"><a href="#local-6989586621680245640"><span class="hs-identifier hs-var">processFlow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680245627"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245627"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m ()
</span><a href="#local-6989586621680245626"><span class="hs-identifier hs-var">addUsages</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245627"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-252"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m ()
</span><a href="#local-6989586621680245626"><span class="hs-identifier hs-var">addUsages</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245647"><span class="hs-identifier hs-var">xsName</span></a></span><span>
</span><span id="line-253"></span><span>                    </span><span class="annot"><span class="annottext">forall {a} {m :: * -&gt; *} {v} {x}.
(Eq a, Num a, MonadState (XMILEAlgBuilder v x) m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621680245625"><span class="hs-identifier hs-var">addDtUsagesIfNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SimSpec -&gt; Double
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xssDt"><span class="hs-identifier hs-var">xssDt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; SimSpec
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcSimSpecs"><span class="hs-identifier hs-var">xcSimSpecs</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680245693"><span class="hs-identifier hs-var">algBuilder</span></a></span><span>
</span><span id="line-254"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
XMExpr -&gt; m ()
</span><a href="#local-6989586621680245624"><span class="hs-identifier hs-var">processEquation</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Flow -&gt; XMExpr
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xfEquation"><span class="hs-identifier hs-var">xfEquation</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Flow
</span><a href="#local-6989586621680245623"><span class="hs-identifier hs-var">findFlow</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245627"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-255"></span><span>                    </span><span class="hs-keyword">where</span><span>
</span><span id="line-256"></span><span>                        </span><span id="local-6989586621680245625"><span class="annot"><span class="annottext">addDtUsagesIfNeeded :: a -&gt; m ()
</span><a href="#local-6989586621680245625"><span class="hs-identifier hs-var hs-var">addDtUsagesIfNeeded</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>                        </span><span class="annot"><a href="#local-6989586621680245625"><span class="hs-identifier hs-var">addDtUsagesIfNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m ()
</span><a href="#local-6989586621680245626"><span class="hs-identifier hs-var">addUsages</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="NITTA.Frontends.XMILE.Frontend.html#deltaTimeVarName"><span class="hs-identifier hs-var">deltaTimeVarName</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>                </span><span id="local-6989586621680245623"><span class="annot"><span class="annottext">findFlow :: Text -&gt; Flow
</span><a href="#local-6989586621680245623"><span class="hs-identifier hs-var hs-var">findFlow</span></a></span></span><span> </span><span id="local-6989586621680245603"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245603"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>                    </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span>
</span><span id="line-261"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot find expected flow flow with name &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245603"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Content -&gt; [Flow]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcFlows"><span class="hs-identifier hs-var">xcFlows</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680245693"><span class="hs-identifier hs-var">algBuilder</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">L.find</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><a href="NITTA.Frontends.XMILE.DocumentParser.html#Flow"><span class="hs-identifier hs-type">XMILE.Flow</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245601"><span class="annot"><span class="annottext">Text
xfName :: Text
xfName :: Flow -&gt; Text
</span><a href="#local-6989586621680245601"><span class="hs-identifier hs-var hs-var">xfName</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245601"><span class="hs-identifier hs-var">xfName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245603"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Content -&gt; [Flow]
</span><a href="NITTA.Frontends.XMILE.DocumentParser.html#xcFlows"><span class="hs-identifier hs-var">xcFlows</span></a></span><span> </span><span class="annot"><span class="annottext">Content
</span><a href="#local-6989586621680245693"><span class="hs-identifier hs-var">algBuilder</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>                </span><span id="local-6989586621680245624"><span class="annot"><span class="annottext">processEquation :: XMExpr -&gt; m ()
</span><a href="#local-6989586621680245624"><span class="hs-identifier hs-var hs-var">processEquation</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Frontends.XMILE.MathParser.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                </span><span class="annot"><a href="#local-6989586621680245624"><span class="hs-identifier hs-var">processEquation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Frontends.XMILE.MathParser.html#Duo"><span class="hs-identifier hs-type">Duo</span></a></span><span> </span><span class="annot"><span class="annottext">XMDuop
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680245593"><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245593"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621680245592"><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245592"><span class="hs-identifier hs-var">expl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-266"></span><span>                    </span><span class="annot"><span class="annottext">XMExpr -&gt; m ()
</span><a href="#local-6989586621680245624"><span class="hs-identifier hs-var">processEquation</span></a></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245593"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-267"></span><span>                    </span><span class="annot"><span class="annottext">XMExpr -&gt; m ()
</span><a href="#local-6989586621680245624"><span class="hs-identifier hs-var">processEquation</span></a></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245592"><span class="hs-identifier hs-var">expl</span></a></span><span>
</span><span id="line-268"></span><span>                </span><span class="annot"><a href="#local-6989586621680245624"><span class="hs-identifier hs-var">processEquation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Frontends.XMILE.MathParser.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680245591"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245591"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
Text -&gt; m ()
</span><a href="#local-6989586621680245626"><span class="hs-identifier hs-var">addUsages</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245591"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-270"></span><span>                    </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x}.
MonadState (XMILEAlgBuilder v x) m =&gt;
String -&gt; HashMap Text XMExpr -&gt; m ()
</span><a href="NITTA.Frontends.XMILE.Frontend.html#addDefaultValueIfNeeded"><span class="hs-identifier hs-var">addDefaultValueIfNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245591"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text XMExpr
</span><a href="#local-6989586621680245676"><span class="hs-identifier hs-var">nameToEquationMap</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>                </span><span id="local-6989586621680245626"><span class="annot"><span class="annottext">addUsages :: Text -&gt; m ()
</span><a href="#local-6989586621680245626"><span class="hs-identifier hs-var hs-var">addUsages</span></a></span></span><span> </span><span id="local-6989586621680245582"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245582"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-273"></span><span>                    </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245581"><span class="annot"><span class="annottext">HashMap Text Int
algUsagesCount :: HashMap Text Int
algUsagesCount :: forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Int
</span><a href="#local-6989586621680245581"><span class="hs-identifier hs-var hs-var">algUsagesCount</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-274"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680245575"><span class="annot"><span class="annottext">val :: Int
</span><a href="#local-6989586621680245575"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245582"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680245581"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span>
</span><span id="line-275"></span><span>                    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680245573"><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245573"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245573"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">algUsagesCount :: HashMap Text Int
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algUsagesCount"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680245582"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680245575"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Int
</span><a href="#local-6989586621680245581"><span class="hs-identifier hs-var">algUsagesCount</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span id="addDefaultValueIfNeeded"><span class="annot"><span class="annottext">addDefaultValueIfNeeded :: String -&gt; HashMap Text XMExpr -&gt; m ()
</span><a href="NITTA.Frontends.XMILE.Frontend.html#addDefaultValueIfNeeded"><span class="hs-identifier hs-var hs-var">addDefaultValueIfNeeded</span></a></span></span><span> </span><span id="local-6989586621680245553"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245553"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680245552"><span class="annot"><span class="annottext">HashMap Text XMExpr
</span><a href="#local-6989586621680245552"><span class="hs-identifier hs-var">nameToEquationMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="NITTA.Frontends.XMILE.Frontend.html#XMILEAlgBuilder"><span class="hs-identifier hs-type">XMILEAlgBuilder</span></a></span><span class="hs-special">{</span><span id="local-6989586621680245551"><span class="annot"><span class="annottext">HashMap Text Double
algDefaultValues :: HashMap Text Double
algDefaultValues :: forall v x. XMILEAlgBuilder v x -&gt; HashMap Text Double
</span><a href="#local-6989586621680245551"><span class="hs-identifier hs-var hs-var">algDefaultValues</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245553"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap Text Double
</span><a href="#local-6989586621680245551"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><span class="annottext">Maybe Double
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245553"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap Text XMExpr
</span><a href="#local-6989586621680245552"><span class="hs-identifier hs-var">nameToEquationMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-283"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680245550"><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245550"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>                    </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span>
</span><span id="line-285"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680245549"><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245549"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-286"></span><span>                            </span><span class="annot"><span class="annottext">XMILEAlgBuilder v x
</span><a href="#local-6989586621680245549"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-287"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">algDefaultValues :: HashMap Text Double
</span><a href="NITTA.Frontends.XMILE.Frontend.html#algDefaultValues"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>                                    </span><span class="annot"><span class="annottext">forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span>
</span><span id="line-289"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245553"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap Text Double -&gt; XMExpr -&gt; Double
</span><a href="NITTA.Frontends.XMILE.MathParser.html#calculateDefaultValue"><span class="hs-identifier hs-var">calculateDefaultValue</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Double
</span><a href="#local-6989586621680245551"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span> </span><span class="annot"><span class="annottext">XMExpr
</span><a href="#local-6989586621680245550"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>                                        </span><span class="annot"><span class="annottext">HashMap Text Double
</span><a href="#local-6989586621680245551"><span class="hs-identifier hs-var">algDefaultValues</span></a></span><span>
</span><span id="line-292"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-293"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>                </span><span class="annot"><span class="annottext">Maybe XMExpr
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;equation for name &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680245553"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; not found.&quot;</span></span><span>
</span><span id="line-295"></span></pre></body></html>
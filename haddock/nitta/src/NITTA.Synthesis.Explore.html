<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NoMonomorphismRestriction #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">{- |
Module      : NITTA.Synthesis.Explore
Description : Explore synthesis tree
Copyright   : (c) Aleksandr Penskoi, 2021
License     : BSD3
Maintainer  : aleksandr.penskoi@gmail.com
Stability   : experimental
-}</span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Synthesis.Explore</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.Explore.html#synthesisTreeRootIO"><span class="hs-identifier">synthesisTreeRootIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.Explore.html#getTreeIO"><span class="hs-identifier">getTreeIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.Explore.html#getTreePathIO"><span class="hs-identifier">getTreePathIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.Explore.html#subForestIO"><span class="hs-identifier">subForestIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.Explore.html#positiveSubForestIO"><span class="hs-identifier">positiveSubForestIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">trace</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Analysis.html"><span class="hs-identifier">NITTA.Intermediate.Analysis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Intermediate.Analysis.html#buildProcessWaves"><span class="hs-identifier">buildProcessWaves</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Analysis.html#estimateVarWaves"><span class="hs-identifier">estimateVarWaves</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html"><span class="hs-identifier">NITTA.Intermediate.Types</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html"><span class="hs-identifier">NITTA.Model.Networks.Bus</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Allocation.html"><span class="hs-identifier">NITTA.Model.Problems.Allocation</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Bind.html"><span class="hs-identifier">NITTA.Model.Problems.Bind</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Dataflow.html"><span class="hs-identifier">NITTA.Model.Problems.Dataflow</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.html"><span class="hs-identifier">NITTA.Model.Problems.Refactor</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.TargetSystem.html"><span class="hs-identifier">NITTA.Model.TargetSystem</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html"><span class="hs-identifier">NITTA.Synthesis.MlBackend.Client</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.ServerInstance.html"><span class="hs-identifier">NITTA.Synthesis.MlBackend.ServerInstance</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html"><span class="hs-identifier">NITTA.Synthesis.Types</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.UIBackend.Types.html"><span class="hs-identifier">NITTA.UIBackend.Types</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.UIBackend.ViewHelper.html"><span class="hs-identifier">NITTA.UIBackend.ViewHelper</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Utils.html"><span class="hs-identifier">NITTA.Utils</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Simple</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Log.Logger</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- | Make synthesis tree</span><span>
</span><span id="line-50"></span><span id="synthesisTreeRootIO"><span class="annot"><span class="annottext">synthesisTreeRootIO :: TargetSystem (BusNetwork tag v x t) tag v x t
-&gt; IO
     (Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Explore.html#synthesisTreeRootIO"><span class="hs-identifier hs-var hs-var">synthesisTreeRootIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall {tag} {x} {t} {v}.
(UnitTag tag, Val x, Bounded t, Hashable v, Suffix v, Show t,
 Default t, Integral t, Typeable t, Typeable v, Ord v, ToString v,
 IsString v) =&gt;
TargetSystem (BusNetwork tag v x t) tag v x t
-&gt; STM
     (Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Explore.html#rootSynthesisTreeSTM"><span class="hs-identifier hs-var">rootSynthesisTreeSTM</span></a></span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span id="rootSynthesisTreeSTM"><span class="annot"><span class="annottext">rootSynthesisTreeSTM :: TargetSystem (BusNetwork tag v x t) tag v x t
-&gt; STM
     (Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Explore.html#rootSynthesisTreeSTM"><span class="hs-identifier hs-var hs-var">rootSynthesisTreeSTM</span></a></span></span><span> </span><span id="local-6989586621680393841"><span class="annot"><span class="annottext">TargetSystem (BusNetwork tag v x t) tag v x t
</span><a href="#local-6989586621680393841"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-53"></span><span>    </span><span id="local-6989586621680393840"><span class="annot"><span class="annottext">TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393840"><span class="hs-identifier hs-var">sSubForestVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM (TMVar a)
</span><span class="hs-identifier hs-var">newEmptyTMVar</span></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680393838"><span class="annot"><span class="annottext">sState :: SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393838"><span class="hs-identifier hs-var hs-var">sState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {k} {x} {t} {a}.
(UnitTag k, Val x, Bounded t, Hashable a, Suffix a, Show t,
 Default t, Integral t, Ord a, Typeable t, Typeable a, ToString a,
 IsString a) =&gt;
Maybe (Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
-&gt; TargetSystem (BusNetwork k a x t) k a x t
-&gt; SynthesisState
     (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="NITTA.Synthesis.Explore.html#nodeCtx"><span class="hs-identifier hs-var">nodeCtx</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork tag v x t) tag v x t
</span><a href="#local-6989586621680393841"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-56"></span><span>        </span><span class="annot"><a href="NITTA.Synthesis.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span>
</span><span id="line-57"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sID :: Sid
</span><a href="NITTA.Synthesis.Types.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-58"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
sState :: SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
sState :: SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="NITTA.Synthesis.Types.html#sState"><span class="hs-identifier hs-var hs-var">sState</span></a></span><span>
</span><span id="line-59"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sDecision :: SynthesisDecision
  (SynthesisState
     (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
  (TargetSystem (BusNetwork tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Types.html#sDecision"><span class="hs-identifier hs-var">sDecision</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ctx m. SynthesisDecision ctx m
</span><a href="NITTA.Synthesis.Types.html#Root"><span class="hs-identifier hs-var">Root</span></a></span><span>
</span><span id="line-60"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
sSubForestVar :: TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
sSubForestVar :: TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Types.html#sSubForestVar"><span class="hs-identifier hs-var hs-var">sSubForestVar</span></a></span><span>
</span><span id="line-61"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">isLeaf :: Bool
</span><a href="NITTA.Synthesis.Types.html#isLeaf"><span class="hs-identifier hs-var">isLeaf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m} {tag} {v} {x} {t}. SynthesisState m tag v x t -&gt; Bool
</span><a href="NITTA.Synthesis.Explore.html#isLeaf%27"><span class="hs-identifier hs-var">isLeaf'</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393838"><span class="hs-identifier hs-var">sState</span></a></span><span>
</span><span id="line-62"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">isComplete :: Bool
</span><a href="NITTA.Synthesis.Types.html#isComplete"><span class="hs-identifier hs-var">isComplete</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {u} {v} {x} {t} {tag} {tag} {v} {x} {t}.
ProcessorUnit u v x t =&gt;
SynthesisState (TargetSystem u tag v x t) tag v x t -&gt; Bool
</span><a href="NITTA.Synthesis.Explore.html#isComplete%27"><span class="hs-identifier hs-var">isComplete'</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393838"><span class="hs-identifier hs-var">sState</span></a></span><span>
</span><span id="line-63"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | Get specific by @nId@ node from a synthesis tree.</span><span>
</span><span id="line-66"></span><span id="getTreeIO"><span class="annot"><span class="annottext">getTreeIO :: BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; Sid
-&gt; IO
     (Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Explore.html#getTreeIO"><span class="hs-identifier hs-var hs-var">getTreeIO</span></a></span></span><span> </span><span id="local-6989586621680393779"><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393779"><span class="hs-identifier hs-var">_ctx</span></a></span></span><span> </span><span id="local-6989586621680393778"><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393778"><span class="hs-identifier hs-var">tree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-type">Sid</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393778"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-67"></span><span class="annot"><a href="NITTA.Synthesis.Explore.html#getTreeIO"><span class="hs-identifier hs-var">getTreeIO</span></a></span><span> </span><span id="local-6989586621680393776"><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393776"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621680393775"><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393775"><span class="hs-identifier hs-var">tree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-type">Sid</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680393774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680393774"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680393773"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680393773"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621680393772"><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393772"><span class="hs-identifier hs-var">subForest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {tag} {v} {x} {t} {tag} {v} {x} {t}.
(UnitTag tag, Hashable v, Suffix v, Val x, Bounded t, ToJSONKey v,
 ToJSON v, ToJSON t, ToJSON tag, Show t, Default t, Integral t,
 Typeable v, Typeable t, Ord v, ToString v, IsString v) =&gt;
BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; IO
     [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#subForestIO"><span class="hs-identifier hs-var">subForestIO</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393776"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393775"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680393774"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393772"><span class="hs-identifier hs-var">subForest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;getTreeIO - wrong Sid&quot;</span></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; Sid
-&gt; IO
     (Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Explore.html#getTreeIO"><span class="hs-identifier hs-var">getTreeIO</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393776"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393772"><span class="hs-identifier hs-var">subForest</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680393774"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Sid
</span><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-var">Sid</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680393773"><span class="hs-identifier hs-var">is</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- | Get list of all nodes from root to selected.</span><span>
</span><span id="line-73"></span><span id="getTreePathIO"><span class="annot"><span class="annottext">getTreePathIO :: BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; Sid
-&gt; IO
     [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#getTreePathIO"><span class="hs-identifier hs-var hs-var">getTreePathIO</span></a></span></span><span> </span><span id="local-6989586621680393729"><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393729"><span class="hs-identifier hs-var">_ctx</span></a></span></span><span> </span><span id="local-6989586621680393728"><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393728"><span class="hs-identifier hs-var">_tree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-type">Sid</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-74"></span><span class="annot"><a href="NITTA.Synthesis.Explore.html#getTreePathIO"><span class="hs-identifier hs-var">getTreePathIO</span></a></span><span> </span><span id="local-6989586621680393727"><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393727"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621680393726"><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393726"><span class="hs-identifier hs-var">tree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-type">Sid</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680393725"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680393725"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680393724"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680393724"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621680393723"><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393723"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {tag} {v} {x} {t} {tag} {v} {x} {t}.
(UnitTag tag, Hashable v, Suffix v, Val x, Bounded t, ToJSONKey v,
 Show t, Default t, Integral t, ToJSON v, ToJSON t, ToJSON tag,
 Typeable v, Typeable t, Ord v, ToString v, IsString v) =&gt;
BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; Sid
-&gt; IO
     (Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Explore.html#getTreeIO"><span class="hs-identifier hs-var">getTreeIO</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393727"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393726"><span class="hs-identifier hs-var">tree</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Sid
</span><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-var">Sid</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680393725"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621680393722"><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393722"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; Sid
-&gt; IO
     [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#getTreePathIO"><span class="hs-identifier hs-var">getTreePathIO</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393727"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393723"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Sid
</span><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-var">Sid</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621680393724"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393723"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393722"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">{- | Get all available edges for the node. Edges calculated only for the first
call.
-}</span><span>
</span><span id="line-82"></span><span id="subForestIO"><span class="annot"><span class="annottext">subForestIO :: BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; IO
     [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#subForestIO"><span class="hs-identifier hs-var hs-var">subForestIO</span></a></span></span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="NITTA.UIBackend.Types.html#BackendCtx"><span class="hs-identifier hs-type">BackendCtx</span></a></span><span class="hs-special">{</span><span id="local-6989586621680393633"><span class="annot"><span class="annottext">[Text]
nodeScores :: forall tag v x t. BackendCtx tag v x t -&gt; [Text]
nodeScores :: [Text]
</span><a href="NITTA.UIBackend.Types.html#nodeScores"><span class="hs-identifier hs-var hs-var">nodeScores</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680393631"><span class="annot"><span class="annottext">IO MlBackendServer
mlBackendGetter :: forall tag v x t. BackendCtx tag v x t -&gt; IO MlBackendServer
mlBackendGetter :: IO MlBackendServer
</span><a href="NITTA.UIBackend.Types.html#mlBackendGetter"><span class="hs-identifier hs-var hs-var">mlBackendGetter</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621680393629"><span class="annot"><span class="annottext">tree :: Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393629"><span class="hs-identifier hs-var">tree</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span class="hs-special">{</span><span id="local-6989586621680393628"><span class="annot"><span class="annottext">TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
sSubForestVar :: TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
sSubForestVar :: forall m tag v x t. Tree m tag v x t -&gt; TMVar [Tree m tag v x t]
</span><a href="#local-6989586621680393628"><span class="hs-identifier hs-var hs-var">sSubForestVar</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680393627"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680393627"><span class="hs-identifier hs-var">firstTime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680393626"><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393626"><span class="hs-identifier hs-var">subForest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-86"></span><span>            </span><span class="annot"><span class="annottext">forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-87"></span><span>                </span><span class="annot"><span class="annottext">forall a. TMVar a -&gt; STM (Maybe a)
</span><span class="hs-identifier hs-var">tryReadTMVar</span></span><span> </span><span class="annot"><span class="annottext">TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393628"><span class="hs-identifier hs-var">sSubForestVar</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-88"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680393624"><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393624"><span class="hs-identifier hs-var">subForest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393624"><span class="hs-identifier hs-var">subForest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>                    </span><span class="annot"><span class="annottext">Maybe
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>                        </span><span id="local-6989586621680393623"><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393623"><span class="hs-identifier hs-var">subForest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {tag} {x} {t} {v}.
(UnitTag tag, Val x, Bounded t, Hashable v, Suffix v, ToString v,
 Show t, Default t, Integral t, Typeable t, Typeable v, Ord v,
 IsString v) =&gt;
Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; STM
     [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#exploreSubForestVar"><span class="hs-identifier hs-var">exploreSubForestVar</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393629"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-91"></span><span>                        </span><span class="annot"><span class="annottext">forall a. TMVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">putTMVar</span></span><span> </span><span class="annot"><span class="annottext">TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393628"><span class="hs-identifier hs-var">sSubForestVar</span></a></span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393623"><span class="hs-identifier hs-var">subForest</span></a></span><span>
</span><span id="line-92"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393623"><span class="hs-identifier hs-var">subForest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680393627"><span class="hs-identifier hs-var">firstTime</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {m} {tag} {v} {x} {t}. Tree m tag v x t -&gt; IO ()
</span><a href="#local-6989586621680393620"><span class="hs-identifier hs-var">traceProcessedNode</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393629"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span>        </span><span class="hs-comment">-- FIXME: ML scores are evaluated here every time subForestIO is called. how to cache it like the default score? IO in STM isn't possible.</span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-comment">-- also it looks inelegant, is there a way to refactor it?</span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680393619"><span class="annot"><span class="annottext">modelNames :: [Text]
</span><a href="#local-6989586621680393619"><span class="hs-identifier hs-var hs-var">modelNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">T.stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="NITTA.Synthesis.Types.html#mlScoreKeyPrefix"><span class="hs-identifier hs-var">mlScoreKeyPrefix</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680393633"><span class="hs-identifier hs-var">nodeScores</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-keyword">if</span><span>
</span><span id="line-100"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393626"><span class="hs-identifier hs-var">subForest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393626"><span class="hs-identifier hs-var">subForest</span></a></span><span>
</span><span id="line-101"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680393633"><span class="hs-identifier hs-var">nodeScores</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393626"><span class="hs-identifier hs-var">subForest</span></a></span><span>
</span><span id="line-102"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680393619"><span class="hs-identifier hs-var">modelNames</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393626"><span class="hs-identifier hs-var">subForest</span></a></span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-104"></span><span>                </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.ServerInstance.html#MlBackendServer"><span class="hs-identifier hs-type">MlBackendServer</span></a></span><span class="hs-special">{</span><span id="local-6989586621680393613"><span class="annot"><span class="annottext">Maybe Text
baseUrl :: MlBackendServer -&gt; Maybe Text
baseUrl :: Maybe Text
</span><a href="NITTA.Synthesis.MlBackend.ServerInstance.html#baseUrl"><span class="hs-identifier hs-var hs-var">baseUrl</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO MlBackendServer
</span><a href="#local-6989586621680393631"><span class="hs-identifier hs-var">mlBackendGetter</span></a></span><span>
</span><span id="line-105"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680393613"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-106"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393626"><span class="hs-identifier hs-var">subForest</span></a></span><span>
</span><span id="line-107"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680393611"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393611"><span class="hs-identifier hs-var">mlBackendBaseUrl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>                        </span><span class="hs-comment">-- (addMlScoreToSubforestSkipErrorsIO subForestAccum modelName) gets called for each modelName</span><span>
</span><span id="line-109"></span><span>                        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {m} {tag} {v} {x} {t} {tag} {v} {x} {t} {a}.
(Viewable (Tree m tag v x t) (NodeView tag v x t), IsString v,
 Suffix v, Hashable v, Val x, Bounded t, ToJSONKey v, ToString v,
 ToString a, Typeable v, Typeable t, Show t, Default t, Integral t,
 Ord v, ToJSON v, ToJSON t, ToJSON tag) =&gt;
a -&gt; [Tree m tag v x t] -&gt; Text -&gt; IO [Tree m tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#addMlScoreToSubforestSkipErrorsIO"><span class="hs-identifier hs-var">addMlScoreToSubforestSkipErrorsIO</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393611"><span class="hs-identifier hs-var">mlBackendBaseUrl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393626"><span class="hs-identifier hs-var">subForest</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680393619"><span class="hs-identifier hs-var">modelNames</span></a></span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>            </span><span id="local-6989586621680393620"><span class="annot"><span class="annottext">traceProcessedNode :: Tree m tag v x t -&gt; IO ()
</span><a href="#local-6989586621680393620"><span class="hs-identifier hs-var hs-var">traceProcessedNode</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span class="hs-special">{</span><span id="local-6989586621680393594"><span class="annot"><span class="annottext">Sid
sID :: Sid
sID :: forall m tag v x t. Tree m tag v x t -&gt; Sid
</span><a href="#local-6989586621680393594"><span class="hs-identifier hs-var hs-var">sID</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680393593"><span class="annot"><span class="annottext">SynthesisDecision (SynthesisState m tag v x t) m
sDecision :: SynthesisDecision (SynthesisState m tag v x t) m
sDecision :: forall m tag v x t.
Tree m tag v x t
-&gt; SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="#local-6989586621680393593"><span class="hs-identifier hs-var hs-var">sDecision</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>                </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">debugM</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;NITTA.Synthesis&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-113"></span><span>                    </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;explore: &quot;</span></span><span>
</span><span id="line-114"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Sid
</span><a href="#local-6989586621680393594"><span class="hs-identifier hs-var">sID</span></a></span><span>
</span><span id="line-115"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; score: &quot;</span></span><span>
</span><span id="line-116"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="#local-6989586621680393593"><span class="hs-identifier hs-var">sDecision</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-117"></span><span>                                </span><span class="annot"><a href="NITTA.Synthesis.Types.html#SynthesisDecision"><span class="hs-identifier hs-type">SynthesisDecision</span></a></span><span class="hs-special">{</span><span id="local-6989586621680393578"><span class="annot"><span class="annottext">Map Text Float
scores :: forall ctx m. SynthesisDecision ctx m -&gt; Map Text Float
scores :: Map Text Float
</span><a href="NITTA.Synthesis.Types.html#scores"><span class="hs-identifier hs-var hs-var">scores</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Map Text Float
</span><a href="#local-6989586621680393578"><span class="hs-identifier hs-var">scores</span></a></span><span>
</span><span id="line-118"></span><span>                                </span><span class="annot"><span class="annottext">SynthesisDecision (SynthesisState m tag v x t) m
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-119"></span><span>                           </span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; decision: &quot;</span></span><span>
</span><span id="line-121"></span><span>                        </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="#local-6989586621680393593"><span class="hs-identifier hs-var">sDecision</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-122"></span><span>                                </span><span class="annot"><a href="NITTA.Synthesis.Types.html#SynthesisDecision"><span class="hs-identifier hs-type">SynthesisDecision</span></a></span><span class="hs-special">{</span><span id="local-6989586621680393570"><span class="annot"><span class="annottext">d
decision :: ()
decision :: d
</span><a href="NITTA.Synthesis.Types.html#decision"><span class="hs-identifier hs-var hs-var">decision</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621680393570"><span class="hs-identifier hs-var">decision</span></a></span><span>
</span><span id="line-123"></span><span>                                </span><span class="annot"><span class="annottext">SynthesisDecision (SynthesisState m tag v x t) m
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;-&quot;</span></span><span>
</span><span id="line-124"></span><span>                           </span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span id="addMlScoreToSubforestSkipErrorsIO"><span class="annot"><span class="annottext">addMlScoreToSubforestSkipErrorsIO :: a -&gt; [Tree m tag v x t] -&gt; Text -&gt; IO [Tree m tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#addMlScoreToSubforestSkipErrorsIO"><span class="hs-identifier hs-var hs-var">addMlScoreToSubforestSkipErrorsIO</span></a></span></span><span> </span><span id="local-6989586621680393515"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680393515"><span class="hs-identifier hs-var">mlBackendBaseUrl</span></a></span></span><span> </span><span id="local-6989586621680393514"><span class="annot"><span class="annottext">[Tree m tag v x t]
</span><a href="#local-6989586621680393514"><span class="hs-identifier hs-var">subForest</span></a></span></span><span> </span><span id="local-6989586621680393513"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393513"><span class="hs-identifier hs-var">modelName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><span class="annottext">forall {m} {tag} {v} {x} {t} {tag} {v} {x} {t} {m :: * -&gt; *} {a}.
(Viewable (Tree m tag v x t) (NodeView tag v x t), IsString v,
 Suffix v, Hashable v, Val x, Bounded t, ToJSONKey v, MonadThrow m,
 ToString v, ToString a, MonadIO m, Typeable v, Typeable t, Show t,
 Default t, Integral t, Ord v, ToJSON v, ToJSON t, ToJSON tag) =&gt;
a -&gt; [Tree m tag v x t] -&gt; Text -&gt; m [Tree m tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#addMlScoreToSubforestIO"><span class="hs-identifier hs-var">addMlScoreToSubforestIO</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680393515"><span class="hs-identifier hs-var">mlBackendBaseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">[Tree m tag v x t]
</span><a href="#local-6989586621680393514"><span class="hs-identifier hs-var">subForest</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393513"><span class="hs-identifier hs-var">modelName</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680393510"><span class="annot"><span class="annottext">JSONException
</span><a href="#local-6989586621680393510"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-129"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; IO ()
</span><span class="hs-identifier hs-var">errorM</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;NITTA.Synthesis&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-130"></span><span>                </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ML backend error: &quot;</span></span><span>
</span><span id="line-131"></span><span>                    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">JSONException
</span><a href="#local-6989586621680393510"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">JSONConversionException</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680393507"><span class="annot"><span class="annottext">Response Value
</span><a href="#local-6989586621680393507"><span class="hs-identifier hs-var">resp</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Response Value
</span><a href="#local-6989586621680393507"><span class="hs-identifier hs-var">resp</span></a></span><span>
</span><span id="line-133"></span><span>                            </span><span class="annot"><span class="annottext">JSONException
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">JSONException
</span><a href="#local-6989586621680393510"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-134"></span><span>                       </span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">[Tree m tag v x t]
</span><a href="#local-6989586621680393514"><span class="hs-identifier hs-var">subForest</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span id="addMlScoreToSubforestIO"><span class="annot"><span class="annottext">addMlScoreToSubforestIO :: a -&gt; [Tree m tag v x t] -&gt; Text -&gt; m [Tree m tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#addMlScoreToSubforestIO"><span class="hs-identifier hs-var hs-var">addMlScoreToSubforestIO</span></a></span></span><span> </span><span id="local-6989586621680393456"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680393456"><span class="hs-identifier hs-var">mlBackendBaseUrl</span></a></span></span><span> </span><span id="local-6989586621680393455"><span class="annot"><span class="annottext">[Tree m tag v x t]
</span><a href="#local-6989586621680393455"><span class="hs-identifier hs-var">subForest</span></a></span></span><span> </span><span id="local-6989586621680393454"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393454"><span class="hs-identifier hs-var">modelName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680393453"><span class="annot"><span class="annottext">input :: ScoringInput tag v x t
</span><a href="#local-6989586621680393453"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringInput"><span class="hs-identifier hs-type">ScoringInput</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">scoringTarget :: ScoringTarget
</span><a href="NITTA.Synthesis.MlBackend.Client.html#scoringTarget"><span class="hs-identifier hs-var">scoringTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScoringTarget
</span><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTargetAll"><span class="hs-identifier hs-var">ScoringTargetAll</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nodes :: [NodeView tag v x t]
</span><a href="NITTA.Synthesis.MlBackend.Client.html#nodes"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall t v. Viewable t v =&gt; t -&gt; v
</span><a href="NITTA.UIBackend.ViewHelperCls.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Tree m tag v x t
</span><a href="#local-6989586621680393447"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680393447"><span class="annot"><span class="annottext">Tree m tag v x t
</span><a href="#local-6989586621680393447"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Tree m tag v x t]
</span><a href="#local-6989586621680393455"><span class="hs-identifier hs-var">subForest</span></a></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621680393446"><span class="annot"><span class="annottext">[[Float]]
</span><a href="#local-6989586621680393446"><span class="hs-identifier hs-var">allInputsScores</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {v} {x} {t} {a} {tag}.
(IsString v, Suffix v, Hashable v, Val x, Bounded t, ToJSONKey v,
 MonadThrow m, ToString v, ToString a, MonadIO m, Typeable v,
 Typeable t, Show t, Default t, Integral t, Ord v, ToJSON v,
 ToJSON t, ToJSON tag) =&gt;
Text -&gt; a -&gt; [ScoringInput tag v x t] -&gt; m [[Float]]
</span><a href="NITTA.Synthesis.MlBackend.Client.html#predictScoresIO"><span class="hs-identifier hs-var">predictScoresIO</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393454"><span class="hs-identifier hs-var">modelName</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680393456"><span class="hs-identifier hs-var">mlBackendBaseUrl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ScoringInput tag v x t
</span><a href="#local-6989586621680393453"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- +20 shifts &quot;useless node&quot; threshold, since model outputs negative values much more often</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-comment">-- FIXME: make models' output consist of mostly &gt;0 values and treat 0 as a &quot;useless node&quot; threshold? training data changes required</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680393444"><span class="annot"><span class="annottext">mlScores :: [Float]
</span><a href="#local-6989586621680393444"><span class="hs-identifier hs-var hs-var">mlScores</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">20</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[[Float]]
</span><a href="#local-6989586621680393446"><span class="hs-identifier hs-var">allInputsScores</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span id="local-6989586621680393441"><span class="annot"><span class="annottext">scoreKey :: Text
</span><a href="#local-6989586621680393441"><span class="hs-identifier hs-var hs-var">scoreKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; a
</span><a href="NITTA.Synthesis.Types.html#mlScoreKeyPrefix"><span class="hs-identifier hs-var">mlScoreKeyPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393454"><span class="hs-identifier hs-var">modelName</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {m} {tag} {v} {x} {t}.
Text -&gt; (Tree m tag v x t, Float) -&gt; Tree m tag v x t
</span><a href="NITTA.Synthesis.Explore.html#addNewScoreToSubforest"><span class="hs-identifier hs-var">addNewScoreToSubforest</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393441"><span class="hs-identifier hs-var">scoreKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Tree m tag v x t]
</span><a href="#local-6989586621680393455"><span class="hs-identifier hs-var">subForest</span></a></span><span> </span><span class="annot"><span class="annottext">[Float]
</span><a href="#local-6989586621680393444"><span class="hs-identifier hs-var">mlScores</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span id="addNewScoreToSubforest"><span class="annot"><span class="annottext">addNewScoreToSubforest :: Text -&gt; (Tree m tag v x t, Float) -&gt; Tree m tag v x t
</span><a href="NITTA.Synthesis.Explore.html#addNewScoreToSubforest"><span class="hs-identifier hs-var hs-var">addNewScoreToSubforest</span></a></span></span><span> </span><span id="local-6989586621680393436"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393436"><span class="hs-identifier hs-var">scoreKey</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680393435"><span class="annot"><span class="annottext">node :: Tree m tag v x t
</span><a href="#local-6989586621680393435"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">sDecision :: forall m tag v x t.
Tree m tag v x t
-&gt; SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="NITTA.Synthesis.Types.html#sDecision"><span class="hs-identifier hs-var">sDecision</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680393434"><span class="annot"><span class="annottext">sDes :: SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="#local-6989586621680393434"><span class="hs-identifier hs-var">sDes</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Synthesis.Types.html#SynthesisDecision"><span class="hs-identifier hs-type">SynthesisDecision</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">scores :: forall ctx m. SynthesisDecision ctx m -&gt; Map Text Float
</span><a href="NITTA.Synthesis.Types.html#scores"><span class="hs-identifier hs-var">scores</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680393426"><span class="annot"><span class="annottext">Map Text Float
</span><a href="#local-6989586621680393426"><span class="hs-identifier hs-var">origScores</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680393425"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621680393425"><span class="hs-identifier hs-var">newScore</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">Tree m tag v x t
</span><a href="#local-6989586621680393435"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">sDecision :: SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="NITTA.Synthesis.Types.html#sDecision"><span class="hs-identifier hs-var">sDecision</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="#local-6989586621680393434"><span class="hs-identifier hs-var">sDes</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">scores :: Map Text Float
</span><a href="NITTA.Synthesis.Types.html#scores"><span class="hs-identifier hs-var">scores</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393436"><span class="hs-identifier hs-var">scoreKey</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621680393425"><span class="hs-identifier hs-var">newScore</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Float
</span><a href="#local-6989586621680393426"><span class="hs-identifier hs-var">origScores</span></a></span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span class="annot"><a href="NITTA.Synthesis.Explore.html#addNewScoreToSubforest"><span class="hs-identifier hs-var">addNewScoreToSubforest</span></a></span><span> </span><span id="local-6989586621680393423"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393423"><span class="hs-identifier hs-var">scoreKey</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680393422"><span class="annot"><span class="annottext">node :: Tree m tag v x t
</span><a href="#local-6989586621680393422"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">sDecision :: forall m tag v x t.
Tree m tag v x t
-&gt; SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="NITTA.Synthesis.Types.html#sDecision"><span class="hs-identifier hs-var">sDecision</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="NITTA.Synthesis.Types.html#Root"><span class="hs-identifier hs-var">Root</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><span class="annottext">forall a. [Char] -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;adding new score to Root, shouldn't happen, scoreKey: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall {a}. IsString a =&gt; Text -&gt; a
</span><a href="NITTA.Utils.Base.html#fromText"><span class="hs-identifier hs-var">fromText</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680393423"><span class="hs-identifier hs-var">scoreKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tree m tag v x t
</span><a href="#local-6989586621680393422"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-comment">{- | For synthesis method is more usefull, because throw away all useless trees in
subForest (objective function value less than zero).
-}</span><span>
</span><span id="line-158"></span><span id="positiveSubForestIO"><span class="annot"><span class="annottext">positiveSubForestIO :: BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; IO
     [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#positiveSubForestIO"><span class="hs-identifier hs-var hs-var">positiveSubForestIO</span></a></span></span><span> </span><span id="local-6989586621680393381"><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393381"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span id="local-6989586621680393380"><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393380"><span class="hs-identifier hs-var">tree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall ctx m. SynthesisDecision ctx m -&gt; Float
</span><a href="NITTA.Synthesis.Types.html#defScore"><span class="hs-identifier hs-var">defScore</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall m tag v x t.
Tree m tag v x t
-&gt; SynthesisDecision (SynthesisState m tag v x t) m
</span><a href="NITTA.Synthesis.Types.html#sDecision"><span class="hs-identifier hs-var">sDecision</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall {tag} {v} {x} {t} {tag} {v} {x} {t}.
(UnitTag tag, Hashable v, Suffix v, Val x, Bounded t, ToJSONKey v,
 ToJSON v, ToJSON t, ToJSON tag, Show t, Default t, Integral t,
 Typeable v, Typeable t, Ord v, ToString v, IsString v) =&gt;
BackendCtx tag v x t
-&gt; Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; IO
     [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#subForestIO"><span class="hs-identifier hs-var">subForestIO</span></a></span><span> </span><span class="annot"><span class="annottext">BackendCtx tag v x t
</span><a href="#local-6989586621680393381"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393380"><span class="hs-identifier hs-var">tree</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span id="isLeaf%27"><span class="annot"><span class="annottext">isLeaf' :: SynthesisState m tag v x t -&gt; Bool
</span><a href="NITTA.Synthesis.Explore.html#isLeaf%27"><span class="hs-identifier hs-var hs-var">isLeaf'</span></a></span></span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.Types.html#SynthesisState"><span class="hs-identifier hs-type">SynthesisState</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sAllocationOptions :: forall m tag v x t. SynthesisState m tag v x t -&gt; [Allocation tag]
</span><a href="NITTA.Synthesis.Types.html#sAllocationOptions"><span class="hs-identifier hs-var">sAllocationOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sBindOptions :: forall m tag v x t. SynthesisState m tag v x t -&gt; [Bind tag v x]
</span><a href="NITTA.Synthesis.Types.html#sBindOptions"><span class="hs-identifier hs-var">sBindOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sDataflowOptions :: forall m tag v x t.
SynthesisState m tag v x t -&gt; [DataflowSt tag v (TimeConstraint t)]
</span><a href="NITTA.Synthesis.Types.html#sDataflowOptions"><span class="hs-identifier hs-var">sDataflowOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sBreakLoopOptions :: forall m tag v x t. SynthesisState m tag v x t -&gt; [BreakLoop v x]
</span><a href="NITTA.Synthesis.Types.html#sBreakLoopOptions"><span class="hs-identifier hs-var">sBreakLoopOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sResolveDeadlockOptions :: forall m tag v x t.
SynthesisState m tag v x t -&gt; [ResolveDeadlock v x]
</span><a href="NITTA.Synthesis.Types.html#sResolveDeadlockOptions"><span class="hs-identifier hs-var">sResolveDeadlockOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-167"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sOptimizeAccumOptions :: forall m tag v x t.
SynthesisState m tag v x t -&gt; [OptimizeAccum v x]
</span><a href="NITTA.Synthesis.Types.html#sOptimizeAccumOptions"><span class="hs-identifier hs-var">sOptimizeAccumOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sOptimizeLogicalUnitOptions :: forall m tag v x t.
SynthesisState m tag v x t -&gt; [OptimizeLogicalUnit v x]
</span><a href="NITTA.Synthesis.Types.html#sOptimizeLogicalUnitOptions"><span class="hs-identifier hs-var">sOptimizeLogicalUnitOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sConstantFoldingOptions :: forall m tag v x t.
SynthesisState m tag v x t -&gt; [ConstantFolding v x]
</span><a href="NITTA.Synthesis.Types.html#sConstantFoldingOptions"><span class="hs-identifier hs-var">sConstantFoldingOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-171"></span><span class="annot"><a href="NITTA.Synthesis.Explore.html#isLeaf%27"><span class="hs-identifier hs-var">isLeaf'</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState m tag v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span id="isComplete%27"><span class="annot"><span class="annottext">isComplete' :: SynthesisState (TargetSystem u tag v x t) tag v x t -&gt; Bool
</span><a href="NITTA.Synthesis.Explore.html#isComplete%27"><span class="hs-identifier hs-var hs-var">isComplete'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u v x t tag.
ProcessorUnit u v x t =&gt;
TargetSystem u tag v x t -&gt; Bool
</span><a href="NITTA.Model.TargetSystem.html#isSynthesisComplete"><span class="hs-identifier hs-var">isSynthesisComplete</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall m tag v x t. SynthesisState m tag v x t -&gt; m
</span><a href="NITTA.Synthesis.Types.html#sTarget"><span class="hs-identifier hs-var">sTarget</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- * Internal</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span id="exploreSubForestVar"><span class="annot"><span class="annottext">exploreSubForestVar :: Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
-&gt; STM
     [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="NITTA.Synthesis.Explore.html#exploreSubForestVar"><span class="hs-identifier hs-var hs-var">exploreSubForestVar</span></a></span></span><span> </span><span id="local-6989586621680393137"><span class="annot"><span class="annottext">parent :: Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span class="hs-special">{</span><span id="local-6989586621680393136"><span class="annot"><span class="annottext">Sid
sID :: Sid
sID :: forall m tag v x t. Tree m tag v x t -&gt; Sid
</span><a href="#local-6989586621680393136"><span class="hs-identifier hs-var hs-var">sID</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680393135"><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
sState :: SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
sState :: forall m tag v x t. Tree m tag v x t -&gt; SynthesisState m tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var hs-var">sState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680393134"><span class="annot"><span class="annottext">edges :: [(SynthesisDecision
    (SynthesisState
       (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
    (TargetSystem (BusNetwork tag v x t) tag v x t),
  SynthesisState
    (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)]
</span><a href="#local-6989586621680393134"><span class="hs-identifier hs-var hs-var">edges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>            </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-180"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {ctx} {m} {o} {d} {p} {k} {a} {x} {t}.
(SynthesisDecisionCls ctx m o d p,
 SynthesisDecisionCls
   (SynthesisState
      (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
   (TargetSystem (BusNetwork k a x t) k a x t)
   o
   d
   p,
 Viewable d DecisionView, UnitTag k, Val x, Bounded t, Hashable a,
 Suffix a, Show d, Show t, Default t, Integral t, ToJSON p,
 Typeable p, Typeable t, Typeable a, Ord a, ToString a,
 IsString a) =&gt;
Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var">decisionAndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t. SynthesisState m tag v x t -&gt; [Allocation tag]
</span><a href="NITTA.Synthesis.Types.html#sAllocationOptions"><span class="hs-identifier hs-var">sAllocationOptions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var">sState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>                    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {ctx} {m} {o} {d} {p} {k} {a} {x} {t}.
(SynthesisDecisionCls ctx m o d p,
 SynthesisDecisionCls
   (SynthesisState
      (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
   (TargetSystem (BusNetwork k a x t) k a x t)
   o
   d
   p,
 Viewable d DecisionView, UnitTag k, Val x, Bounded t, Hashable a,
 Suffix a, Show d, Show t, Default t, Integral t, ToJSON p,
 Typeable p, Typeable t, Typeable a, Ord a, ToString a,
 IsString a) =&gt;
Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var">decisionAndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t. SynthesisState m tag v x t -&gt; [Bind tag v x]
</span><a href="NITTA.Synthesis.Types.html#sBindOptions"><span class="hs-identifier hs-var">sBindOptions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var">sState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>                    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {ctx} {m} {o} {d} {p} {k} {a} {x} {t}.
(SynthesisDecisionCls ctx m o d p,
 SynthesisDecisionCls
   (SynthesisState
      (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
   (TargetSystem (BusNetwork k a x t) k a x t)
   o
   d
   p,
 Viewable d DecisionView, UnitTag k, Val x, Bounded t, Hashable a,
 Suffix a, Show d, Show t, Default t, Integral t, ToJSON p,
 Typeable p, Typeable t, Typeable a, Ord a, ToString a,
 IsString a) =&gt;
Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var">decisionAndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t.
SynthesisState m tag v x t -&gt; [DataflowSt tag v (TimeConstraint t)]
</span><a href="NITTA.Synthesis.Types.html#sDataflowOptions"><span class="hs-identifier hs-var">sDataflowOptions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var">sState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>                    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {ctx} {m} {o} {d} {p} {k} {a} {x} {t}.
(SynthesisDecisionCls ctx m o d p,
 SynthesisDecisionCls
   (SynthesisState
      (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
   (TargetSystem (BusNetwork k a x t) k a x t)
   o
   d
   p,
 Viewable d DecisionView, UnitTag k, Val x, Bounded t, Hashable a,
 Suffix a, Show d, Show t, Default t, Integral t, ToJSON p,
 Typeable p, Typeable t, Typeable a, Ord a, ToString a,
 IsString a) =&gt;
Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var">decisionAndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t. SynthesisState m tag v x t -&gt; [BreakLoop v x]
</span><a href="NITTA.Synthesis.Types.html#sBreakLoopOptions"><span class="hs-identifier hs-var">sBreakLoopOptions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var">sState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>                    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {ctx} {m} {o} {d} {p} {k} {a} {x} {t}.
(SynthesisDecisionCls ctx m o d p,
 SynthesisDecisionCls
   (SynthesisState
      (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
   (TargetSystem (BusNetwork k a x t) k a x t)
   o
   d
   p,
 Viewable d DecisionView, UnitTag k, Val x, Bounded t, Hashable a,
 Suffix a, Show d, Show t, Default t, Integral t, ToJSON p,
 Typeable p, Typeable t, Typeable a, Ord a, ToString a,
 IsString a) =&gt;
Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var">decisionAndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t.
SynthesisState m tag v x t -&gt; [ResolveDeadlock v x]
</span><a href="NITTA.Synthesis.Types.html#sResolveDeadlockOptions"><span class="hs-identifier hs-var">sResolveDeadlockOptions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var">sState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>                    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {ctx} {m} {o} {d} {p} {k} {a} {x} {t}.
(SynthesisDecisionCls ctx m o d p,
 SynthesisDecisionCls
   (SynthesisState
      (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
   (TargetSystem (BusNetwork k a x t) k a x t)
   o
   d
   p,
 Viewable d DecisionView, UnitTag k, Val x, Bounded t, Hashable a,
 Suffix a, Show d, Show t, Default t, Integral t, ToJSON p,
 Typeable p, Typeable t, Typeable a, Ord a, ToString a,
 IsString a) =&gt;
Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var">decisionAndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t.
SynthesisState m tag v x t -&gt; [OptimizeAccum v x]
</span><a href="NITTA.Synthesis.Types.html#sOptimizeAccumOptions"><span class="hs-identifier hs-var">sOptimizeAccumOptions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var">sState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>                    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {ctx} {m} {o} {d} {p} {k} {a} {x} {t}.
(SynthesisDecisionCls ctx m o d p,
 SynthesisDecisionCls
   (SynthesisState
      (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
   (TargetSystem (BusNetwork k a x t) k a x t)
   o
   d
   p,
 Viewable d DecisionView, UnitTag k, Val x, Bounded t, Hashable a,
 Suffix a, Show d, Show t, Default t, Integral t, ToJSON p,
 Typeable p, Typeable t, Typeable a, Ord a, ToString a,
 IsString a) =&gt;
Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var">decisionAndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t.
SynthesisState m tag v x t -&gt; [OptimizeLogicalUnit v x]
</span><a href="NITTA.Synthesis.Types.html#sOptimizeLogicalUnitOptions"><span class="hs-identifier hs-var">sOptimizeLogicalUnitOptions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var">sState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>                    </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {ctx} {m} {o} {d} {p} {k} {a} {x} {t}.
(SynthesisDecisionCls ctx m o d p,
 SynthesisDecisionCls
   (SynthesisState
      (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
   (TargetSystem (BusNetwork k a x t) k a x t)
   o
   d
   p,
 Viewable d DecisionView, UnitTag k, Val x, Bounded t, Hashable a,
 Suffix a, Show d, Show t, Default t, Integral t, ToJSON p,
 Typeable p, Typeable t, Typeable a, Ord a, ToString a,
 IsString a) =&gt;
Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var">decisionAndContext</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393137"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t.
SynthesisState m tag v x t -&gt; [ConstantFolding v x]
</span><a href="NITTA.Synthesis.Types.html#sConstantFoldingOptions"><span class="hs-identifier hs-var">sConstantFoldingOptions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393135"><span class="hs-identifier hs-var">sState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(SynthesisDecision
    (SynthesisState
       (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
    (TargetSystem (BusNetwork tag v x t) tag v x t),
  SynthesisState
    (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)]
</span><a href="#local-6989586621680393134"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680393131"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680393131"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680393130"><span class="annot"><span class="annottext">SynthesisDecision
  (SynthesisState
     (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
  (TargetSystem (BusNetwork tag v x t) tag v x t)
</span><a href="#local-6989586621680393130"><span class="hs-identifier hs-var">desc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680393129"><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393129"><span class="hs-identifier hs-var">ctx'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>            </span><span id="local-6989586621680393128"><span class="annot"><span class="annottext">TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393128"><span class="hs-identifier hs-var">sSubForestVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. STM (TMVar a)
</span><span class="hs-identifier hs-var">newEmptyTMVar</span></span><span>
</span><span id="line-191"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-192"></span><span>                </span><span class="annot"><a href="NITTA.Synthesis.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span>
</span><span id="line-193"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sID :: Sid
</span><a href="NITTA.Synthesis.Types.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sid
</span><a href="#local-6989586621680393136"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Sid
</span><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-var">Sid</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680393131"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-194"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sState :: SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="NITTA.Synthesis.Types.html#sState"><span class="hs-identifier hs-var">sState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393129"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-195"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sDecision :: SynthesisDecision
  (SynthesisState
     (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
  (TargetSystem (BusNetwork tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Types.html#sDecision"><span class="hs-identifier hs-var">sDecision</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SynthesisDecision
  (SynthesisState
     (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
  (TargetSystem (BusNetwork tag v x t) tag v x t)
</span><a href="#local-6989586621680393130"><span class="hs-identifier hs-var">desc</span></a></span><span>
</span><span id="line-196"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
sSubForestVar :: TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
sSubForestVar :: TMVar
  [Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t]
</span><a href="#local-6989586621680393128"><span class="hs-identifier hs-var hs-var">sSubForestVar</span></a></span><span>
</span><span id="line-197"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">isLeaf :: Bool
</span><a href="NITTA.Synthesis.Types.html#isLeaf"><span class="hs-identifier hs-var">isLeaf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {m} {tag} {v} {x} {t}. SynthesisState m tag v x t -&gt; Bool
</span><a href="NITTA.Synthesis.Explore.html#isLeaf%27"><span class="hs-identifier hs-var">isLeaf'</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393129"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-198"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">isComplete :: Bool
</span><a href="NITTA.Synthesis.Types.html#isComplete"><span class="hs-identifier hs-var">isComplete</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {u} {v} {x} {t} {tag} {tag} {v} {x} {t}.
ProcessorUnit u v x t =&gt;
SynthesisState (TargetSystem u tag v x t) tag v x t -&gt; Bool
</span><a href="NITTA.Synthesis.Explore.html#isComplete%27"><span class="hs-identifier hs-var">isComplete'</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState
  (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t
</span><a href="#local-6989586621680393129"><span class="hs-identifier hs-var">ctx'</span></a></span><span>
</span><span id="line-199"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span id="decisionAndContext"><span class="annot"><span class="annottext">decisionAndContext :: Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
-&gt; o
-&gt; [(SynthesisDecision ctx m,
     SynthesisState
       (TargetSystem (BusNetwork k a x t) k a x t) k a x t)]
</span><a href="NITTA.Synthesis.Explore.html#decisionAndContext"><span class="hs-identifier hs-var hs-var">decisionAndContext</span></a></span></span><span> </span><span id="local-6989586621680393086"><span class="annot"><span class="annottext">parent :: Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="#local-6989586621680393086"><span class="hs-identifier hs-var">parent</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Synthesis.Types.html#Tree"><span class="hs-identifier hs-type">Tree</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">sState :: forall m tag v x t. Tree m tag v x t -&gt; SynthesisState m tag v x t
</span><a href="NITTA.Synthesis.Types.html#sState"><span class="hs-identifier hs-var">sState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680393085"><span class="annot"><span class="annottext">SynthesisState (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="#local-6989586621680393085"><span class="hs-identifier hs-var">ctx</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680393084"><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621680393084"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall p ctx m o d.
(Typeable p, SynthesisDecisionCls ctx m o d p, Show d, ToJSON p,
 Viewable d DecisionView) =&gt;
o -&gt; d -&gt; p -&gt; Map Text Float -&gt; SynthesisDecision ctx m
</span><a href="NITTA.Synthesis.Types.html#SynthesisDecision"><span class="hs-identifier hs-var">SynthesisDecision</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621680393084"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621680393083"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680393082"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Float
</span><a href="#local-6989586621680393081"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall {k} {x} {t} {a}.
(UnitTag k, Val x, Bounded t, Hashable a, Suffix a, Show t,
 Default t, Integral t, Ord a, Typeable t, Typeable a, ToString a,
 IsString a) =&gt;
Maybe (Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
-&gt; TargetSystem (BusNetwork k a x t) k a x t
-&gt; SynthesisState
     (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="NITTA.Synthesis.Explore.html#nodeCtx"><span class="hs-identifier hs-var">nodeCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="#local-6989586621680393086"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680393080"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680393083"><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621680393083"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680393080"><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680393080"><span class="hs-identifier hs-var">model</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall ctx m o d p.
SynthesisDecisionCls ctx m o d p =&gt;
ctx -&gt; o -&gt; [(d, m)]
</span><a href="NITTA.Synthesis.Types.html#decisions"><span class="hs-identifier hs-var">decisions</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="#local-6989586621680393085"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621680393084"><span class="hs-identifier hs-var">o</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680393082"><span class="annot"><span class="annottext">p :: p
</span><a href="#local-6989586621680393082"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ctx m o d p.
SynthesisDecisionCls ctx m o d p =&gt;
ctx -&gt; o -&gt; d -&gt; p
</span><a href="NITTA.Synthesis.Types.html#parameters"><span class="hs-identifier hs-var">parameters</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="#local-6989586621680393085"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621680393084"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621680393083"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-205"></span><span>          </span><span id="local-6989586621680393081"><span class="annot"><span class="annottext">e :: Map Text Float
</span><a href="#local-6989586621680393081"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.singleton</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;default&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall ctx m o d p.
SynthesisDecisionCls ctx m o d p =&gt;
ctx -&gt; o -&gt; d -&gt; p -&gt; Float
</span><a href="NITTA.Synthesis.Types.html#estimate"><span class="hs-identifier hs-var">estimate</span></a></span><span> </span><span class="annot"><span class="annottext">SynthesisState (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="#local-6989586621680393085"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621680393084"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621680393083"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621680393082"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span id="nodeCtx"><span class="annot"><span class="annottext">nodeCtx :: Maybe (Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
-&gt; TargetSystem (BusNetwork k a x t) k a x t
-&gt; SynthesisState
     (TargetSystem (BusNetwork k a x t) k a x t) k a x t
</span><a href="NITTA.Synthesis.Explore.html#nodeCtx"><span class="hs-identifier hs-var hs-var">nodeCtx</span></a></span></span><span> </span><span id="local-6989586621680392969"><span class="annot"><span class="annottext">Maybe (Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
</span><a href="#local-6989586621680392969"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621680392968"><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680392967"><span class="annot"><span class="annottext">sBindOptions :: [Bind k a x]
</span><a href="#local-6989586621680392967"><span class="hs-identifier hs-var hs-var">sBindOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u tag v x. BindProblem u tag v x =&gt; u -&gt; [Bind tag v x]
</span><a href="NITTA.Model.Problems.Bind.html#bindOptions"><span class="hs-identifier hs-var">bindOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-210"></span><span>        </span><span id="local-6989586621680392965"><span class="annot"><span class="annottext">sDataflowOptions :: [DataflowSt k a (TimeConstraint t)]
</span><a href="#local-6989586621680392965"><span class="hs-identifier hs-var hs-var">sDataflowOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u tag v t.
DataflowProblem u tag v t =&gt;
u -&gt; [DataflowSt tag v (TimeConstraint t)]
</span><a href="NITTA.Model.Problems.Dataflow.html#dataflowOptions"><span class="hs-identifier hs-var">dataflowOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span id="local-6989586621680392963"><span class="annot"><span class="annottext">fs :: [F a x]
</span><a href="#local-6989586621680392963"><span class="hs-identifier hs-var hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a f. WithFunctions a f =&gt; a -&gt; [f]
</span><a href="NITTA.Intermediate.Types.html#functions"><span class="hs-identifier hs-var">functions</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall u tag v x t. TargetSystem u tag v x t -&gt; DataFlowGraph v x
</span><a href="NITTA.Model.TargetSystem.html#mDataFlowGraph"><span class="hs-identifier hs-var">mDataFlowGraph</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span id="local-6989586621680392960"><span class="annot"><span class="annottext">processWaves :: [ProcessWave a x]
</span><a href="#local-6989586621680392960"><span class="hs-identifier hs-var hs-var">processWaves</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v x. (Var v, Val x) =&gt; [v] -&gt; [F v x] -&gt; [ProcessWave v x]
</span><a href="NITTA.Intermediate.Analysis.html#buildProcessWaves"><span class="hs-identifier hs-var">buildProcessWaves</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[F a x]
</span><a href="#local-6989586621680392963"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-213"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html#SynthesisState"><span class="hs-identifier hs-type">SynthesisState</span></a></span><span>
</span><span id="line-214"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sTarget :: TargetSystem (BusNetwork k a x t) k a x t
</span><a href="NITTA.Synthesis.Types.html#sTarget"><span class="hs-identifier hs-var">sTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-215"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sParent :: Maybe (Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
</span><a href="NITTA.Synthesis.Types.html#sParent"><span class="hs-identifier hs-var">sParent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Tree (TargetSystem (BusNetwork k a x t) k a x t) k a x t)
</span><a href="#local-6989586621680392969"><span class="hs-identifier hs-var">parent</span></a></span><span>
</span><span id="line-216"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sAllocationOptions :: [Allocation k]
</span><a href="NITTA.Synthesis.Types.html#sAllocationOptions"><span class="hs-identifier hs-var">sAllocationOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u tag. AllocationProblem u tag =&gt; u -&gt; [Allocation tag]
</span><a href="NITTA.Model.Problems.Allocation.html#allocationOptions"><span class="hs-identifier hs-var">allocationOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-217"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Bind k a x]
sBindOptions :: [Bind k a x]
sBindOptions :: [Bind k a x]
</span><a href="#local-6989586621680392967"><span class="hs-identifier hs-var hs-var">sBindOptions</span></a></span><span>
</span><span id="line-218"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DataflowSt k a (TimeConstraint t)]
sDataflowOptions :: [DataflowSt k a (TimeConstraint t)]
sDataflowOptions :: [DataflowSt k a (TimeConstraint t)]
</span><a href="#local-6989586621680392965"><span class="hs-identifier hs-var hs-var">sDataflowOptions</span></a></span><span>
</span><span id="line-219"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sResolveDeadlockOptions :: [ResolveDeadlock a x]
</span><a href="NITTA.Synthesis.Types.html#sResolveDeadlockOptions"><span class="hs-identifier hs-var">sResolveDeadlockOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u v x.
ResolveDeadlockProblem u v x =&gt;
u -&gt; [ResolveDeadlock v x]
</span><a href="NITTA.Model.Problems.Refactor.ResolveDeadlock.html#resolveDeadlockOptions"><span class="hs-identifier hs-var">resolveDeadlockOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-220"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sBreakLoopOptions :: [BreakLoop a x]
</span><a href="NITTA.Synthesis.Types.html#sBreakLoopOptions"><span class="hs-identifier hs-var">sBreakLoopOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u v x. BreakLoopProblem u v x =&gt; u -&gt; [BreakLoop v x]
</span><a href="NITTA.Model.Problems.Refactor.BreakLoop.html#breakLoopOptions"><span class="hs-identifier hs-var">breakLoopOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-221"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sConstantFoldingOptions :: [ConstantFolding a x]
</span><a href="NITTA.Synthesis.Types.html#sConstantFoldingOptions"><span class="hs-identifier hs-var">sConstantFoldingOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u v x.
ConstantFoldingProblem u v x =&gt;
u -&gt; [ConstantFolding v x]
</span><a href="NITTA.Model.Problems.Refactor.ConstantFolding.html#constantFoldingOptions"><span class="hs-identifier hs-var">constantFoldingOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sOptimizeAccumOptions :: [OptimizeAccum a x]
</span><a href="NITTA.Synthesis.Types.html#sOptimizeAccumOptions"><span class="hs-identifier hs-var">sOptimizeAccumOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u v x.
OptimizeAccumProblem u v x =&gt;
u -&gt; [OptimizeAccum v x]
</span><a href="NITTA.Model.Problems.Refactor.OptimizeAccum.html#optimizeAccumOptions"><span class="hs-identifier hs-var">optimizeAccumOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sOptimizeLogicalUnitOptions :: [OptimizeLogicalUnit a x]
</span><a href="NITTA.Synthesis.Types.html#sOptimizeLogicalUnitOptions"><span class="hs-identifier hs-var">sOptimizeLogicalUnitOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u v x.
OptimizeLogicalUnitProblem u v x =&gt;
u -&gt; [OptimizeLogicalUnit v x]
</span><a href="NITTA.Model.Problems.Refactor.OptimizeLogicalUnit.html#optimizeLogicalUnitOptions"><span class="hs-identifier hs-var">optimizeLogicalUnitOptions</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bindingAlternative :: Map (F a x) [k]
</span><a href="NITTA.Synthesis.Types.html#bindingAlternative"><span class="hs-identifier hs-var">bindingAlternative</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>                </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span>
</span><span id="line-226"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680392950"><span class="annot"><span class="annottext">Map (F a x) [k]
</span><a href="#local-6989586621680392950"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621680392949"><span class="annot"><span class="annottext">Bind k a x
</span><a href="#local-6989586621680392949"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bind k a x
</span><a href="#local-6989586621680392949"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-227"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Problems.Bind.html#SingleBind"><span class="hs-identifier hs-type">SingleBind</span></a></span><span> </span><span id="local-6989586621680392947"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680392947"><span class="hs-identifier hs-var">uTag</span></a></span></span><span> </span><span id="local-6989586621680392946"><span class="annot"><span class="annottext">F a x
</span><a href="#local-6989586621680392946"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.alter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680392947"><span class="hs-identifier hs-var">uTag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680392947"><span class="hs-identifier hs-var">uTag</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">F a x
</span><a href="#local-6989586621680392946"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Map (F a x) [k]
</span><a href="#local-6989586621680392950"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-228"></span><span>                        </span><span class="annot"><span class="annottext">Bind k a x
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (F a x) [k]
</span><a href="#local-6989586621680392950"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-229"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>                    </span><span class="annot"><span class="annottext">forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-231"></span><span>                    </span><span class="annot"><span class="annottext">[Bind k a x]
</span><a href="#local-6989586621680392967"><span class="hs-identifier hs-var">sBindOptions</span></a></span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">possibleDeadlockBinds :: Set (F a x)
</span><a href="NITTA.Synthesis.Types.html#possibleDeadlockBinds"><span class="hs-identifier hs-var">possibleDeadlockBinds</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>                </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span>
</span><span id="line-234"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">F a x
</span><a href="#local-6989586621680392940"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-235"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Problems.Bind.html#SingleBind"><span class="hs-identifier hs-type">SingleBind</span></a></span><span> </span><span id="local-6989586621680392939"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680392939"><span class="hs-identifier hs-var">uTag</span></a></span></span><span> </span><span id="local-6989586621680392940"><span class="annot"><span class="annottext">F a x
</span><a href="#local-6989586621680392940"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Bind k a x]
</span><a href="#local-6989586621680392967"><span class="hs-identifier hs-var">sBindOptions</span></a></span><span>
</span><span id="line-236"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#Lock"><span class="hs-identifier hs-type">Lock</span></a></span><span class="hs-special">{</span><span id="local-6989586621680392937"><span class="annot"><span class="annottext">a
lockBy :: forall v. Lock v -&gt; v
lockBy :: a
</span><a href="NITTA.Intermediate.Types.html#lockBy"><span class="hs-identifier hs-var hs-var">lockBy</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall x v. Locks x v =&gt; x -&gt; [Lock v]
</span><a href="NITTA.Intermediate.Types.html#locks"><span class="hs-identifier hs-var">locks</span></a></span><span> </span><span class="annot"><span class="annottext">F a x
</span><a href="#local-6989586621680392940"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-237"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680392937"><span class="hs-identifier hs-var">lockBy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} {v} {x} {t}. Ord k =&gt; k -&gt; BusNetwork k v x t -&gt; [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#boundFunctions"><span class="hs-identifier hs-var">boundFunctions</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680392939"><span class="hs-identifier hs-var">uTag</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall u tag v x t. TargetSystem u tag v x t -&gt; u
</span><a href="NITTA.Model.TargetSystem.html#mUnit"><span class="hs-identifier hs-var">mUnit</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bindWaves :: Map a Int
</span><a href="NITTA.Synthesis.Types.html#bindWaves"><span class="hs-identifier hs-var">bindWaves</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v x a. (Var v, Val x, Num a) =&gt; [v] -&gt; [F v x] -&gt; Map v a
</span><a href="NITTA.Intermediate.Analysis.html#estimateVarWaves"><span class="hs-identifier hs-var">estimateVarWaves</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.elems</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall u tag v x t. TargetSystem u tag v x t -&gt; u
</span><a href="NITTA.Model.TargetSystem.html#mUnit"><span class="hs-identifier hs-var">mUnit</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">S.\\</span></span><span> </span><span class="annot"><span class="annottext">forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">[Bind k a x]
</span><a href="#local-6989586621680392967"><span class="hs-identifier hs-var">sBindOptions</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[F a x]
</span><a href="#local-6989586621680392963"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ProcessWave a x]
processWaves :: [ProcessWave a x]
processWaves :: [ProcessWave a x]
</span><a href="NITTA.Synthesis.Types.html#processWaves"><span class="hs-identifier hs-var hs-var">processWaves</span></a></span><span>
</span><span id="line-241"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">numberOfProcessWaves :: Int
</span><a href="NITTA.Synthesis.Types.html#numberOfProcessWaves"><span class="hs-identifier hs-var">numberOfProcessWaves</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[ProcessWave a x]
</span><a href="#local-6989586621680392960"><span class="hs-identifier hs-var">processWaves</span></a></span><span>
</span><span id="line-242"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">numberOfDataflowOptions :: Int
</span><a href="NITTA.Synthesis.Types.html#numberOfDataflowOptions"><span class="hs-identifier hs-var">numberOfDataflowOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[DataflowSt k a (TimeConstraint t)]
</span><a href="#local-6989586621680392965"><span class="hs-identifier hs-var">sDataflowOptions</span></a></span><span>
</span><span id="line-243"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">transferableVars :: Set a
</span><a href="NITTA.Synthesis.Types.html#transferableVars"><span class="hs-identifier hs-var">transferableVars</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">S.unions</span></span><span>
</span><span id="line-245"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt a (TimeConstraint t)
</span><a href="#local-6989586621680392921"><span class="hs-identifier hs-var">ep</span></a></span><span>
</span><span id="line-246"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Problems.Dataflow.html#DataflowSt"><span class="hs-identifier hs-type">DataflowSt</span></a></span><span> </span><span class="annot"><span class="annottext">(k, EndpointSt a (TimeConstraint t))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680392919"><span class="annot"><span class="annottext">[(k, EndpointSt a (TimeConstraint t))]
</span><a href="#local-6989586621680392919"><span class="hs-identifier hs-var">targets</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[DataflowSt k a (TimeConstraint t)]
</span><a href="#local-6989586621680392965"><span class="hs-identifier hs-var">sDataflowOptions</span></a></span><span>
</span><span id="line-247"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680392921"><span class="annot"><span class="annottext">EndpointSt a (TimeConstraint t)
</span><a href="#local-6989586621680392921"><span class="hs-identifier hs-var">ep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(k, EndpointSt a (TimeConstraint t))]
</span><a href="#local-6989586621680392919"><span class="hs-identifier hs-var">targets</span></a></span><span>
</span><span id="line-248"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unitWorkloadInFunction :: Map k Int
</span><a href="NITTA.Synthesis.Types.html#unitWorkloadInFunction"><span class="hs-identifier hs-var">unitWorkloadInFunction</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-251"></span><span>                    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680392916"><span class="annot"><span class="annottext">Map k [F a x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map k [F a x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680392914"><span class="annot"><span class="annottext">Map k (PU a x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map k (PU a x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u tag v x t. TargetSystem u tag v x t -&gt; u
</span><a href="NITTA.Model.TargetSystem.html#mUnit"><span class="hs-identifier hs-var">mUnit</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSystem (BusNetwork k a x t) k a x t
</span><a href="#local-6989586621680392968"><span class="hs-identifier hs-var">nModel</span></a></span><span>
</span><span id="line-252"></span><span>                 </span><span class="hs-keyword">in</span><span>
</span><span id="line-253"></span><span>                    </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-254"></span><span>                        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-255"></span><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680392911"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680392911"><span class="hs-identifier hs-var">uTag</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680392911"><span class="hs-identifier hs-var">uTag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map k [F a x]
</span><a href="#local-6989586621680392916"><span class="hs-identifier hs-var">bnBound</span></a></span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680392911"><span class="hs-identifier hs-var">uTag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>                        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">Map k (PU a x t)
</span><a href="#local-6989586621680392914"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-257"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-258"></span></pre></body></html>
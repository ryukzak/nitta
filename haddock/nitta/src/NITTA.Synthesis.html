<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">{- |
Module      : NITTA.Synthesis
Description : Entry point for synthesis process and target system generation.
Copyright   : (c) Aleksandr Penskoi, 2021
License     : BSD3
Maintainer  : aleksandr.penskoi@gmail.com
Stability   : experimental

TargetSynthesis is an entry point for synthesis process. TargetSynthesis flow shown on fig.

@
====================================================================================================================
                                                                                                             Prepare
NITTA.Synthesis:TargetSynthesis                                                                     NITTA.Project...
    # tName                                                                              NITTA.Frontends
    # tMicroArch -----------------------------\
    # tSourceCode -+                          |     /--+-- mkModelWithOneNetwork
                   |                          |     |  |
                   *&lt;-translate               |     |  |
                   |                          |     |  v      NITTA.Model:TargetSystem----------\
    # tDFG &lt;-------+                          +--------*--------&gt; # mUnit         |             |    NITTA.Model...
        |                                        |                                |             |     /-----------\
        |                                        v                                |             |     |  Target   |
        +----------------------------------------*-----------&gt; # mDataFlowGraph   |             \-----+  System   |
                                                                                  |                   | Imitation |
    # tReceivedValues                                                             |                   |   Model   |
    # tVerbose                                                                    |                   \-----------/
    # tSynthesisMethod ----------------------------------\                        |
                                                         |                        |
                                                         |                        |
===================================================================================================================
                                                         |                        |               Synthesis process
        NITTA.Synthesis.Types:Tree                       |                        |           NITTA.Synthesis.Types
            # sID                                        |                        |          NITTA.Synthesis.Method
            # sState &lt;------------------------------------------------------------+
            # sDecision                                  |
                # option                                 |
                # decision                               *&lt;-- search for best synthesis path
                # metrics                                |
                # score                                  v
            # sSubForestVar -------------------------&gt;// * // -----\
                                                                   |
                                                                   v
                                                            NITTA.Synthesis.Types:Tree
                                                                # sState
                                                                    # sTarget
                                       /------------------------------- # mUnit
                                       |        /---------------------- # mDataFlowGraph
                                       |        |                   # ...
                                       |        |               # ...
                                       |        |
===================================================================================================================
                                       |        |                                         Target project generation
NITTA.Project.Types:Project            |        |                                                 NITTA.Project....
 |      # pName &lt;--------- $tName      |        |
 |      # pLibPath                     |        +&lt;----- $tReceivedValues
 |      # pTargetProjectPath           |        |
 |      # pModel&lt;----------------------/        *&lt;----- functional simulation (FIXME)
 |                                              |
 |      # pTestCntx &lt;---------------------------/
 |
 |
 *&lt;---------- $writeProject
 |                # TargetSystem
 |                    # hardware
 |                    # software
 |                # TestBench
 |                # Templates
 |
 \---&gt; filesystem
@
-}</span><span>
</span><span id="line-75"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Synthesis</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Explore.html"><span class="hs-identifier">NITTA.Synthesis.Explore</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Method.html"><span class="hs-identifier">NITTA.Synthesis.Method</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Steps.html"><span class="hs-identifier">NITTA.Synthesis.Steps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html"><span class="hs-identifier">NITTA.Synthesis.Types</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.html#mkModelWithOneNetwork"><span class="hs-identifier">mkModelWithOneNetwork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier">TargetSynthesis</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.html#runTargetSynthesis"><span class="hs-identifier">runTargetSynthesis</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.html#synthesizeTargetSystem"><span class="hs-identifier">synthesizeTargetSystem</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">D</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Frontends.html"><span class="hs-identifier">NITTA.Frontends</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.DataFlow.html"><span class="hs-identifier">NITTA.Intermediate.DataFlow</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Simulation.html"><span class="hs-identifier">NITTA.Intermediate.Simulation</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html"><span class="hs-identifier">NITTA.Intermediate.Types</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html"><span class="hs-identifier">NITTA.Model.Networks.Bus</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html"><span class="hs-identifier">NITTA.Model.ProcessorUnits.Types</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.TargetSystem.html"><span class="hs-identifier">NITTA.Model.TargetSystem</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html"><span class="hs-identifier">NITTA.Model.Time</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Project.html"><span class="hs-identifier">NITTA.Project</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Project.Types.html#Project"><span class="hs-identifier">Project</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Project.Template.html#collectNittaPath"><span class="hs-identifier">collectNittaPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#defProjectTemplates"><span class="hs-identifier">defProjectTemplates</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Project.html#runTestbench"><span class="hs-identifier">runTestbench</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Project.html#writeProject"><span class="hs-identifier">writeProject</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Explore.html"><span class="hs-identifier">NITTA.Synthesis.Explore</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Method.html"><span class="hs-identifier">NITTA.Synthesis.Method</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Steps.html"><span class="hs-identifier">NITTA.Synthesis.Steps</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html"><span class="hs-identifier">NITTA.Synthesis.Types</span></a></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Directory</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Log.Logger</span></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">{- | Description of synthesis task. Applicable for target system synthesis and
testing purpose.
-}</span><span>
</span><span id="line-110"></span><span class="hs-keyword">data</span><span> </span><span id="TargetSynthesis"><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-var">TargetSynthesis</span></a></span></span><span> </span><span id="local-6989586621680425625"><span class="annot"><a href="#local-6989586621680425625"><span class="hs-identifier hs-type">tag</span></a></span></span><span> </span><span id="local-6989586621680425624"><span class="annot"><a href="#local-6989586621680425624"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680425623"><span class="annot"><a href="#local-6989586621680425623"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680425622"><span class="annot"><a href="#local-6989586621680425622"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TargetSynthesis"><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-var">TargetSynthesis</span></a></span></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="tName"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; String
</span><a href="NITTA.Synthesis.html#tName"><span class="hs-identifier hs-var hs-var">tName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- ^ target name, used for top level module name and project path</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tMicroArch"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; BusNetwork tag v x t
</span><a href="NITTA.Synthesis.html#tMicroArch"><span class="hs-identifier hs-var hs-var">tMicroArch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425625"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425624"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425623"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425622"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">-- ^ composition of processor units, IO ports and its interconnect</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tSourceCode"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; Maybe Text
</span><a href="NITTA.Synthesis.html#tSourceCode"><span class="hs-identifier hs-var hs-var">tSourceCode</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-comment">-- ^ optional application source code (lua)</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tDFG"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; DataFlowGraph v x
</span><a href="NITTA.Synthesis.html#tDFG"><span class="hs-identifier hs-var hs-var">tDFG</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Intermediate.DataFlow.html#DataFlowGraph"><span class="hs-identifier hs-type">DataFlowGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425624"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425623"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">{- ^ algorithm in intermediate data flow graph representation (if
    tSourceCode present will be overwritten)
    -}</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tReceivedValues"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; [(v, [x])]
</span><a href="NITTA.Synthesis.html#tReceivedValues"><span class="hs-identifier hs-var hs-var">tReceivedValues</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680425624"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680425623"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">-- ^ values from input interface for testing purpose</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tSynthesisMethod"><span class="annot"><span class="annottext">forall tag v x t.
TargetSynthesis tag v x t -&gt; SynthesisMethod tag v x t
</span><a href="NITTA.Synthesis.html#tSynthesisMethod"><span class="hs-identifier hs-var hs-var">tSynthesisMethod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html#SynthesisMethod"><span class="hs-identifier hs-type">SynthesisMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425625"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425624"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425623"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425622"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-comment">-- ^ synthesis method</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tLibPath"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; String
</span><a href="NITTA.Synthesis.html#tLibPath"><span class="hs-identifier hs-var hs-var">tLibPath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">-- ^ IP-core library directory</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tPath"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; String
</span><a href="NITTA.Synthesis.html#tPath"><span class="hs-identifier hs-var hs-var">tPath</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-comment">-- ^ output directory, where CAD create project directory with 'tName' name</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tTemplates"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; [String]
</span><a href="NITTA.Synthesis.html#tTemplates"><span class="hs-identifier hs-var hs-var">tTemplates</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">]</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tSimulationCycleN"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; Int
</span><a href="NITTA.Synthesis.html#tSimulationCycleN"><span class="hs-identifier hs-var hs-var">tSimulationCycleN</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-comment">-- ^ number of simulation and testbench cycles</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="tSourceCodeType"><span class="annot"><span class="annottext">forall tag v x t. TargetSynthesis tag v x t -&gt; FrontendType
</span><a href="NITTA.Synthesis.html#tSourceCodeType"><span class="hs-identifier hs-var hs-var">tSourceCodeType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Frontends.html#FrontendType"><span class="hs-identifier hs-type">FrontendType</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">-- ^ source code format type</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680425562"><span id="local-6989586621680425563"><span id="local-6989586621680425564"><span id="local-6989586621680425565"><span class="annot"><a href="NITTA.Synthesis.Types.html#SynthesisMethodConstraints"><span class="hs-identifier hs-type">SynthesisMethodConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425565"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425564"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425563"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425562"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-type">TargetSynthesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425565"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425564"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425563"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425562"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621680425321"><span class="annot"><span class="annottext">def :: TargetSynthesis tag v x t
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>        </span><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-type">TargetSynthesis</span></a></span><span>
</span><span id="line-139"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tName :: String
</span><a href="NITTA.Synthesis.html#tName"><span class="hs-identifier hs-var">tName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-140"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tMicroArch :: BusNetwork tag v x t
</span><a href="NITTA.Synthesis.html#tMicroArch"><span class="hs-identifier hs-var">tMicroArch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tSourceCode :: Maybe Text
</span><a href="NITTA.Synthesis.html#tSourceCode"><span class="hs-identifier hs-var">tSourceCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-142"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tDFG :: DataFlowGraph v x
</span><a href="NITTA.Synthesis.html#tDFG"><span class="hs-identifier hs-var">tDFG</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-143"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tReceivedValues :: [(v, [x])]
</span><a href="NITTA.Synthesis.html#tReceivedValues"><span class="hs-identifier hs-var">tReceivedValues</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tSynthesisMethod :: SynthesisMethod tag v x t
</span><a href="NITTA.Synthesis.html#tSynthesisMethod"><span class="hs-identifier hs-var">tSynthesisMethod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tag v x t.
SynthesisMethodConstraints tag v x t =&gt;
BackendCtx tag v x t -&gt; SynthesisMethod tag v x t
</span><a href="NITTA.Synthesis.Method.html#stateOfTheArtSynthesisIO"><span class="hs-identifier hs-var">stateOfTheArtSynthesisIO</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tLibPath :: String
</span><a href="NITTA.Synthesis.html#tLibPath"><span class="hs-identifier hs-var">tLibPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hdl&quot;</span></span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tTemplates :: [String]
</span><a href="NITTA.Synthesis.html#tTemplates"><span class="hs-identifier hs-var">tTemplates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="NITTA.Project.Types.html#defProjectTemplates"><span class="hs-identifier hs-var">defProjectTemplates</span></a></span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tPath :: String
</span><a href="NITTA.Synthesis.html#tPath"><span class="hs-identifier hs-var">tPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">joinPath</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;gen&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tSimulationCycleN :: Int
</span><a href="NITTA.Synthesis.html#tSimulationCycleN"><span class="hs-identifier hs-var">tSimulationCycleN</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-149"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tSourceCodeType :: FrontendType
</span><a href="NITTA.Synthesis.html#tSourceCodeType"><span class="hs-identifier hs-var">tSourceCodeType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FrontendType
</span><a href="NITTA.Frontends.html#Lua"><span class="hs-identifier hs-var">Lua</span></a></span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680425309"><span id="local-6989586621680425536"><span id="local-6989586621680425537"><span id="local-6989586621680425538"><span id="local-6989586621680425539"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425539"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425538"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425537"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425536"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#ProcessorUnit"><span class="hs-identifier hs-type">ProcessorUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-type">TargetSynthesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425539"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425538"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425537"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425536"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680425538"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425537"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425536"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621680425305"><span class="annot"><span class="annottext">tryBind :: F v x
-&gt; TargetSynthesis tag v x t
-&gt; Either String (TargetSynthesis tag v x t)
</span><a href="NITTA.Model.ProcessorUnits.Types.html#tryBind"><span class="hs-identifier hs-var hs-var hs-var hs-var">tryBind</span></a></span></span><span> </span><span class="annot"><span class="annottext">F v x
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TargetSynthesis tag v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Not Implemented&quot;</span></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621680425300"><span class="annot"><span class="annottext">process :: TargetSynthesis tag v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.Types.html#process"><span class="hs-identifier hs-var hs-var hs-var hs-var">process</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-type">TargetSynthesis</span></a></span><span class="hs-special">{</span><span id="local-6989586621680425298"><span class="annot"><span class="annottext">BusNetwork tag v x t
tMicroArch :: BusNetwork tag v x t
tMicroArch :: forall tag v x t. TargetSynthesis tag v x t -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680425298"><span class="hs-identifier hs-var hs-var">tMicroArch</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u v x t.
ProcessorUnit u v x t =&gt;
u -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.Types.html#process"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680425298"><span class="hs-identifier hs-var">tMicroArch</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span id="local-6989586621680425296"><span class="annot"><span class="annottext">parallelismType :: TargetSynthesis tag v x t -&gt; ParallelismType
</span><a href="NITTA.Model.ProcessorUnits.Types.html#parallelismType"><span class="hs-identifier hs-var hs-var hs-var hs-var">parallelismType</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-type">TargetSynthesis</span></a></span><span class="hs-special">{</span><span id="local-6989586621680425294"><span class="annot"><span class="annottext">BusNetwork tag v x t
tMicroArch :: BusNetwork tag v x t
tMicroArch :: forall tag v x t. TargetSynthesis tag v x t -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680425294"><span class="hs-identifier hs-var hs-var">tMicroArch</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall u v x t. ProcessorUnit u v x t =&gt; u -&gt; ParallelismType
</span><a href="NITTA.Model.ProcessorUnits.Types.html#parallelismType"><span class="hs-identifier hs-var">parallelismType</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680425294"><span class="hs-identifier hs-var">tMicroArch</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span id="runTargetSynthesis"><span class="annot"><span class="annottext">runTargetSynthesis :: TargetSynthesis tag v1 p t
-&gt; IO (Either String (TestbenchReport v1 p))
</span><a href="NITTA.Synthesis.html#runTargetSynthesis"><span class="hs-identifier hs-var hs-var">runTargetSynthesis</span></a></span></span><span> </span><span id="local-6989586621680425223"><span class="annot"><span class="annottext">TargetSynthesis tag v1 p t
</span><a href="#local-6989586621680425223"><span class="hs-identifier hs-var">leaf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680425222"><span class="annot"><span class="annottext">DefTree tag v1 p t
</span><a href="#local-6989586621680425222"><span class="hs-identifier hs-var">_root</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425221"><span class="annot"><span class="annottext">Either String (Project (BusNetwork tag v1 p t) v1 p)
</span><a href="#local-6989586621680425221"><span class="hs-identifier hs-var">prj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tag v x t.
(UnitTag tag, VarValTime v x t) =&gt;
TargetSynthesis tag v x t
-&gt; IO
     (DefTree tag v x t,
      Either String (Project (BusNetwork tag v x t) v x))
</span><a href="NITTA.Synthesis.html#synthesizeTargetSystem"><span class="hs-identifier hs-var">synthesizeTargetSystem</span></a></span><span> </span><span class="annot"><span class="annottext">TargetSynthesis tag v1 p t
</span><a href="#local-6989586621680425223"><span class="hs-identifier hs-var">leaf</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">forall {u} {a} {v1} {x1} {t} {v2} {p} {x2}.
(WithFunctions u a, ProcessorUnit u v1 x1 t, Hashable v2,
 IsString v2, DefaultX u p, Val p, Show a, Read x2,
 TargetSystemComponent u, Testable u v2 x2) =&gt;
Project u v2 x2 -&gt; IO (TestbenchReport v2 x2)
</span><a href="NITTA.Project.html#runTestbench"><span class="hs-identifier hs-var">runTestbench</span></a></span><span> </span><span class="annot"><span class="annottext">Either String (Project (BusNetwork tag v1 p t) v1 p)
</span><a href="#local-6989586621680425221"><span class="hs-identifier hs-var">prj</span></a></span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span id="local-6989586621680425487"><span id="local-6989586621680425488"><span id="local-6989586621680425489"><span id="local-6989586621680425490"><span class="annot"><a href="NITTA.Synthesis.html#synthesizeTargetSystem"><span class="hs-identifier hs-type">synthesizeTargetSystem</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425490"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425489"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425488"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425487"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-type">TargetSynthesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425490"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425489"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425488"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425487"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span>
</span><span id="line-165"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html#DefTree"><span class="hs-identifier hs-type">DefTree</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425490"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425489"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425488"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425487"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-167"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-168"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Project.Types.html#Project"><span class="hs-identifier hs-type">Project</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425490"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425489"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425488"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425487"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680425489"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680425488"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-170"></span><span id="synthesizeTargetSystem"><span class="annot"><span class="annottext">synthesizeTargetSystem :: forall tag v x t.
(UnitTag tag, VarValTime v x t) =&gt;
TargetSynthesis tag v x t
-&gt; IO
     (DefTree tag v x t,
      Either String (Project (BusNetwork tag v x t) v x))
</span><a href="NITTA.Synthesis.html#synthesizeTargetSystem"><span class="hs-identifier hs-var hs-var">synthesizeTargetSystem</span></a></span></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.html#TargetSynthesis"><span class="hs-identifier hs-type">TargetSynthesis</span></a></span><span>
</span><span id="line-172"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680425159"><span class="annot"><span class="annottext">String
tName :: String
tName :: forall tag v x t. TargetSynthesis tag v x t -&gt; String
</span><a href="#local-6989586621680425159"><span class="hs-identifier hs-var hs-var">tName</span></a></span></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425158"><span class="annot"><span class="annottext">BusNetwork tag v x t
tMicroArch :: BusNetwork tag v x t
tMicroArch :: forall tag v x t. TargetSynthesis tag v x t -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680425158"><span class="hs-identifier hs-var hs-var">tMicroArch</span></a></span></span><span>
</span><span id="line-174"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425157"><span class="annot"><span class="annottext">Maybe Text
tSourceCode :: Maybe Text
tSourceCode :: forall tag v x t. TargetSynthesis tag v x t -&gt; Maybe Text
</span><a href="#local-6989586621680425157"><span class="hs-identifier hs-var hs-var">tSourceCode</span></a></span></span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425156"><span class="annot"><span class="annottext">DataFlowGraph v x
tDFG :: DataFlowGraph v x
tDFG :: forall tag v x t. TargetSynthesis tag v x t -&gt; DataFlowGraph v x
</span><a href="#local-6989586621680425156"><span class="hs-identifier hs-var hs-var">tDFG</span></a></span></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425155"><span class="annot"><span class="annottext">[(v, [x])]
tReceivedValues :: [(v, [x])]
tReceivedValues :: forall tag v x t. TargetSynthesis tag v x t -&gt; [(v, [x])]
</span><a href="#local-6989586621680425155"><span class="hs-identifier hs-var hs-var">tReceivedValues</span></a></span></span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425154"><span class="annot"><span class="annottext">SynthesisMethod tag v x t
tSynthesisMethod :: SynthesisMethod tag v x t
tSynthesisMethod :: forall tag v x t.
TargetSynthesis tag v x t -&gt; SynthesisMethod tag v x t
</span><a href="#local-6989586621680425154"><span class="hs-identifier hs-var hs-var">tSynthesisMethod</span></a></span></span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425153"><span class="annot"><span class="annottext">String
tLibPath :: String
tLibPath :: forall tag v x t. TargetSynthesis tag v x t -&gt; String
</span><a href="#local-6989586621680425153"><span class="hs-identifier hs-var hs-var">tLibPath</span></a></span></span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425152"><span class="annot"><span class="annottext">String
tPath :: String
tPath :: forall tag v x t. TargetSynthesis tag v x t -&gt; String
</span><a href="#local-6989586621680425152"><span class="hs-identifier hs-var hs-var">tPath</span></a></span></span><span>
</span><span id="line-180"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425151"><span class="annot"><span class="annottext">[String]
tTemplates :: [String]
tTemplates :: forall tag v x t. TargetSynthesis tag v x t -&gt; [String]
</span><a href="#local-6989586621680425151"><span class="hs-identifier hs-var hs-var">tTemplates</span></a></span></span><span>
</span><span id="line-181"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425150"><span class="annot"><span class="annottext">Int
tSimulationCycleN :: Int
tSimulationCycleN :: forall tag v x t. TargetSynthesis tag v x t -&gt; Int
</span><a href="#local-6989586621680425150"><span class="hs-identifier hs-var hs-var">tSimulationCycleN</span></a></span></span><span>
</span><span id="line-182"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680425149"><span class="annot"><span class="annottext">FrontendType
tSourceCodeType :: FrontendType
tSourceCodeType :: forall tag v x t. TargetSynthesis tag v x t -&gt; FrontendType
</span><a href="#local-6989586621680425149"><span class="hs-identifier hs-var hs-var">tSourceCodeType</span></a></span></span><span>
</span><span id="line-183"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-comment">-- TODO: check that tName is a valid verilog module name</span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425159"><span class="hs-identifier hs-var">tName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TargetSynthesis name contain wrong symbols&quot;</span></span><span>
</span><span id="line-186"></span><span>        </span><span id="local-6989586621680425147"><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680425147"><span class="hs-identifier hs-var">tDFG'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680425156"><span class="hs-identifier hs-var">tDFG</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall {v} {x}.
(IsString v, ToString v, Suffix v, Hashable v, Val x, Typeable v,
 Ord v) =&gt;
Text -&gt; IO (DataFlowGraph v x)
</span><a href="#local-6989586621680425145"><span class="hs-identifier hs-var">translateToIntermediate</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621680425157"><span class="hs-identifier hs-var">tSourceCode</span></a></span><span>
</span><span id="line-187"></span><span>        </span><span id="local-6989586621680425144"><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425144"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {tag} {x} {t} {v}.
(UnitTag tag, Val x, Bounded t, Hashable v, Suffix v, Show t,
 Default t, Integral t, Typeable t, Typeable v, Ord v, ToString v,
 IsString v) =&gt;
TargetSystem (BusNetwork tag v x t) tag v x t
-&gt; IO
     (Tree (TargetSystem (BusNetwork tag v x t) tag v x t) tag v x t)
</span><a href="NITTA.Synthesis.Explore.html#synthesisTreeRootIO"><span class="hs-identifier hs-var">synthesisTreeRootIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {u} {v} {x} {t} {tag} {t}.
ProcessorUnit u v x t =&gt;
u -&gt; DataFlowGraph v x -&gt; TargetSystem u tag v x t
</span><a href="NITTA.Synthesis.html#mkModelWithOneNetwork"><span class="hs-identifier hs-var">mkModelWithOneNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680425158"><span class="hs-identifier hs-var">tMicroArch</span></a></span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680425147"><span class="hs-identifier hs-var">tDFG'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>        </span><span id="local-6989586621680425142"><span class="annot"><span class="annottext">Either String (Project (BusNetwork tag v x t) v x)
</span><a href="#local-6989586621680425142"><span class="hs-identifier hs-var">prj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-189"></span><span>            </span><span class="annot"><span class="annottext">DefTree tag v x t -&gt; IO (Either String (DefTree tag v x t))
</span><a href="#local-6989586621680425141"><span class="hs-identifier hs-var">synthesise</span></a></span><span> </span><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425144"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-190"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680425140"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425140"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425140"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-191"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621680425139"><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425139"><span class="hs-identifier hs-var">leafNode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>                    </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall {tag} {t} {tag1} {t1} {tag2} {v2} {x2} {t2}.
(UnitTag tag, Bounded t, Show t, Default t, Integral t,
 Typeable t) =&gt;
Tree
  (TargetSystem (BusNetwork tag v x t) tag1 v x t1) tag2 v2 x2 t2
-&gt; IO (Project (BusNetwork tag v x t) v x)
</span><a href="#local-6989586621680425137"><span class="hs-identifier hs-var">writeProject'</span></a></span><span> </span><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425139"><span class="hs-identifier hs-var">leafNode</span></a></span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425144"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either String (Project (BusNetwork tag v x t) v x)
</span><a href="#local-6989586621680425142"><span class="hs-identifier hs-var">prj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>            </span><span id="local-6989586621680425145"><span class="annot"><span class="annottext">translateToIntermediate :: Text -&gt; IO (DataFlowGraph v x)
</span><a href="#local-6989586621680425145"><span class="hs-identifier hs-var hs-var">translateToIntermediate</span></a></span></span><span> </span><span id="local-6989586621680425126"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680425126"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">infoM</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NITTA&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Lua transpiler...&quot;</span></span><span>
</span><span id="line-197"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680425117"><span class="annot"><span class="annottext">tmp :: DataFlowGraph v x
</span><a href="#local-6989586621680425117"><span class="hs-identifier hs-var hs-var">tmp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v x. FrontendResult v x -&gt; DataFlowGraph v x
</span><a href="NITTA.Frontends.Common.html#frDataFlow"><span class="hs-identifier hs-var">frDataFlow</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {v} {x}.
(IsString v, ToString v, Suffix v, Hashable v, Val x, Typeable v,
 Ord v) =&gt;
FrontendType -&gt; Text -&gt; FrontendResult v x
</span><a href="NITTA.Frontends.html#translate"><span class="hs-identifier hs-var">translate</span></a></span><span> </span><span class="annot"><span class="annottext">FrontendType
</span><a href="#local-6989586621680425149"><span class="hs-identifier hs-var">tSourceCodeType</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680425126"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-198"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">noticeM</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NITTA&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Lua transpiler...ok&quot;</span></span><span>
</span><span id="line-199"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680425117"><span class="hs-identifier hs-var">tmp</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>            </span><span id="local-6989586621680425141"><span class="annot"><span class="annottext">synthesise :: DefTree tag v x t -&gt; IO (Either String (DefTree tag v x t))
</span><a href="#local-6989586621680425141"><span class="hs-identifier hs-var hs-var">synthesise</span></a></span></span><span> </span><span id="local-6989586621680425103"><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425103"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">infoM</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NITTA&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;synthesis process...&quot;</span></span><span>
</span><span id="line-203"></span><span>                </span><span id="local-6989586621680425102"><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425102"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SynthesisMethod tag v x t
</span><a href="#local-6989586621680425154"><span class="hs-identifier hs-var">tSynthesisMethod</span></a></span><span> </span><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425103"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-204"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall m tag v x t. Tree m tag v x t -&gt; Bool
</span><a href="NITTA.Synthesis.Types.html#isComplete"><span class="hs-identifier hs-var">isComplete</span></a></span><span> </span><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425102"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall m tag v x t. Tree m tag v x t -&gt; Bool
</span><a href="NITTA.Synthesis.Types.html#isLeaf"><span class="hs-identifier hs-var">isLeaf</span></a></span><span> </span><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425102"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-205"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-206"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">noticeM</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NITTA&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;synthesis process...ok&quot;</span></span><span>
</span><span id="line-207"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">DefTree tag v x t
</span><a href="#local-6989586621680425102"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-208"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680425099"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621680425099"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;synthesis process...fail; is not complete&quot;</span></span><span>
</span><span id="line-210"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">noticeM</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NITTA&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425099"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-211"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425099"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-212"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680425098"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621680425098"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;synthesis process...fail; is not leaf&quot;</span></span><span>
</span><span id="line-214"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">noticeM</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NITTA&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425098"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-215"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425098"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-216"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680425097"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621680425097"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;synthesis process...fail; is not complete; is not leaf&quot;</span></span><span>
</span><span id="line-218"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">noticeM</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NITTA&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425097"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-219"></span><span>                        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425097"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span>            </span><span id="local-6989586621680425137"><span class="annot"><span class="annottext">writeProject' :: Tree
  (TargetSystem (BusNetwork tag v x t) tag1 v x t1) tag2 v2 x2 t2
-&gt; IO (Project (BusNetwork tag v x t) v x)
</span><a href="#local-6989586621680425137"><span class="hs-identifier hs-var hs-var">writeProject'</span></a></span></span><span> </span><span id="local-6989586621680425056"><span class="annot"><span class="annottext">Tree
  (TargetSystem (BusNetwork tag v x t) tag1 v x t1) tag2 v2 x2 t2
</span><a href="#local-6989586621680425056"><span class="hs-identifier hs-var">leaf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>                </span><span id="local-6989586621680425055"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425055"><span class="hs-identifier hs-var">pInProjectNittaPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; IO (Either Text String)
</span><a href="NITTA.Project.Template.html#collectNittaPath"><span class="hs-identifier hs-var">collectNittaPath</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680425151"><span class="hs-identifier hs-var">tTemplates</span></a></span><span>
</span><span id="line-223"></span><span>                </span><span id="local-6989586621680425050"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425050"><span class="hs-identifier hs-var">pwd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getCurrentDirectory</span></span><span>
</span><span id="line-224"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680425036"><span class="annot"><span class="annottext">prj :: Project (BusNetwork tag v x t) v x
</span><a href="#local-6989586621680425036"><span class="hs-identifier hs-var hs-var">prj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>                        </span><span class="annot"><a href="NITTA.Project.Types.html#Project"><span class="hs-identifier hs-type">Project</span></a></span><span>
</span><span id="line-226"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">pName :: Text
</span><a href="NITTA.Project.Types.html#pName"><span class="hs-identifier hs-var">pName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425159"><span class="hs-identifier hs-var">tName</span></a></span><span>
</span><span id="line-227"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pLibPath :: String
</span><a href="NITTA.Project.Types.html#pLibPath"><span class="hs-identifier hs-var">pLibPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425153"><span class="hs-identifier hs-var">tLibPath</span></a></span><span>
</span><span id="line-228"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pTargetProjectPath :: String
</span><a href="NITTA.Project.Types.html#pTargetProjectPath"><span class="hs-identifier hs-var">pTargetProjectPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425152"><span class="hs-identifier hs-var">tPath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425159"><span class="hs-identifier hs-var">tName</span></a></span><span>
</span><span id="line-229"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pAbsTargetProjectPath :: String
</span><a href="NITTA.Project.Types.html#pAbsTargetProjectPath"><span class="hs-identifier hs-var">pAbsTargetProjectPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425050"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425152"><span class="hs-identifier hs-var">tPath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425159"><span class="hs-identifier hs-var">tName</span></a></span><span>
</span><span id="line-230"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
pInProjectNittaPath :: String
pInProjectNittaPath :: String
</span><a href="NITTA.Project.Types.html#pInProjectNittaPath"><span class="hs-identifier hs-var hs-var">pInProjectNittaPath</span></a></span><span>
</span><span id="line-231"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pAbsNittaPath :: String
</span><a href="NITTA.Project.Types.html#pAbsNittaPath"><span class="hs-identifier hs-var">pAbsNittaPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425050"><span class="hs-identifier hs-var">pwd</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425152"><span class="hs-identifier hs-var">tPath</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425159"><span class="hs-identifier hs-var">tName</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680425055"><span class="hs-identifier hs-var">pInProjectNittaPath</span></a></span><span>
</span><span id="line-232"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pUnit :: BusNetwork tag v x t
</span><a href="NITTA.Project.Types.html#pUnit"><span class="hs-identifier hs-var">pUnit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {c} {tag1} {v1} {x1} {t1} {tag2} {v2} {x2} {t2}.
Tree (TargetSystem c tag1 v1 x1 t1) tag2 v2 x2 t2 -&gt; c
</span><a href="NITTA.Synthesis.Types.html#targetUnit"><span class="hs-identifier hs-var">targetUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Tree
  (TargetSystem (BusNetwork tag v x t) tag1 v x t1) tag2 v2 x2 t2
</span><a href="#local-6989586621680425056"><span class="hs-identifier hs-var">leaf</span></a></span><span>
</span><span id="line-233"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pUnitEnv :: UnitEnv (BusNetwork tag v x t)
</span><a href="NITTA.Project.Types.html#pUnitEnv"><span class="hs-identifier hs-var">pUnitEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tag v x t.
BusNetwork tag v x t -&gt; UnitEnv (BusNetwork tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnEnv"><span class="hs-identifier hs-var">bnEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {c} {tag1} {v1} {x1} {t1} {tag2} {v2} {x2} {t2}.
Tree (TargetSystem c tag1 v1 x1 t1) tag2 v2 x2 t2 -&gt; c
</span><a href="NITTA.Synthesis.Types.html#targetUnit"><span class="hs-identifier hs-var">targetUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Tree
  (TargetSystem (BusNetwork tag v x t) tag1 v x t1) tag2 v2 x2 t2
</span><a href="#local-6989586621680425056"><span class="hs-identifier hs-var">leaf</span></a></span><span>
</span><span id="line-234"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- because application algorithm can be refactored we need to use</span><span>
</span><span id="line-235"></span><span>                              </span><span class="hs-comment">-- synthesised version</span><span>
</span><span id="line-236"></span><span>                              </span><span class="annot"><span class="annottext">pTestCntx :: Cntx v x
</span><a href="NITTA.Project.Types.html#pTestCntx"><span class="hs-identifier hs-var">pTestCntx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v x g.
(Var v, Val x, WithFunctions g (F v x)) =&gt;
Int -&gt; CycleCntx v x -&gt; [(v, [x])] -&gt; g -&gt; Cntx v x
</span><a href="NITTA.Intermediate.Simulation.html#simulateDataFlowGraph"><span class="hs-identifier hs-var">simulateDataFlowGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680425150"><span class="hs-identifier hs-var">tSimulationCycleN</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">[(v, [x])]
</span><a href="#local-6989586621680425155"><span class="hs-identifier hs-var">tReceivedValues</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {u} {tag1} {v1} {x1} {t1} {tag2} {v2} {x2} {t2}.
Tree (TargetSystem u tag1 v1 x1 t1) tag2 v2 x2 t2
-&gt; DataFlowGraph v1 x1
</span><a href="NITTA.Synthesis.Types.html#targetDFG"><span class="hs-identifier hs-var">targetDFG</span></a></span><span> </span><span class="annot"><span class="annottext">Tree
  (TargetSystem (BusNetwork tag v x t) tag1 v x t1) tag2 v2 x2 t2
</span><a href="#local-6989586621680425056"><span class="hs-identifier hs-var">leaf</span></a></span><span>
</span><span id="line-237"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pTemplates :: [String]
</span><a href="NITTA.Project.Types.html#pTemplates"><span class="hs-identifier hs-var">pTemplates</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621680425151"><span class="hs-identifier hs-var">tTemplates</span></a></span><span>
</span><span id="line-238"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-239"></span><span>                </span><span class="annot"><span class="annottext">forall {m} {v} {x}.
(TargetSystemComponent m, Testable m v x) =&gt;
Project m v x -&gt; IO ()
</span><a href="NITTA.Project.html#writeProject"><span class="hs-identifier hs-var">writeProject</span></a></span><span> </span><span class="annot"><span class="annottext">Project (BusNetwork tag v x t) v x
</span><a href="#local-6989586621680425036"><span class="hs-identifier hs-var">prj</span></a></span><span>
</span><span id="line-240"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Project (BusNetwork tag v x t) v x
</span><a href="#local-6989586621680425036"><span class="hs-identifier hs-var">prj</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">{- | Make a model of NITTA process with one network and a specific algorithm. All
functions are already bound to the network.
-}</span><span>
</span><span id="line-245"></span><span id="mkModelWithOneNetwork"><span class="annot"><span class="annottext">mkModelWithOneNetwork :: u -&gt; DataFlowGraph v x -&gt; TargetSystem u tag v x t
</span><a href="NITTA.Synthesis.html#mkModelWithOneNetwork"><span class="hs-identifier hs-var hs-var">mkModelWithOneNetwork</span></a></span></span><span> </span><span id="local-6989586621680425014"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680425014"><span class="hs-identifier hs-var">arch</span></a></span></span><span> </span><span id="local-6989586621680425013"><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680425013"><span class="hs-identifier hs-var">dfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="NITTA.Model.TargetSystem.html#TargetSystem"><span class="hs-identifier hs-type">TargetSystem</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mUnit :: u
</span><a href="NITTA.Model.TargetSystem.html#mUnit"><span class="hs-identifier hs-var">mUnit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">forall {u} {v} {x} {t}. ProcessorUnit u v x t =&gt; F v x -&gt; u -&gt; u
</span><a href="NITTA.Model.ProcessorUnits.Types.html#bind"><span class="hs-identifier hs-var">bind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680425014"><span class="hs-identifier hs-var">arch</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a f. WithFunctions a f =&gt; a -&gt; [f]
</span><a href="NITTA.Intermediate.Types.html#functions"><span class="hs-identifier hs-var">functions</span></a></span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680425013"><span class="hs-identifier hs-var">dfg</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mDataFlowGraph :: DataFlowGraph v x
</span><a href="NITTA.Model.TargetSystem.html#mDataFlowGraph"><span class="hs-identifier hs-var">mDataFlowGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataFlowGraph v x
</span><a href="#local-6989586621680425013"><span class="hs-identifier hs-var">dfg</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-250"></span></pre></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="annot"><span class="hs-comment">{- |
Module      : NITTA.Model.Networks.Bus
Description : Simple process unit network - pseudo bus.
Copyright   : (c) Aleksandr Penskoi, 2019
License     : BSD3
Maintainer  : aleksandr.penskoi@gmail.com
Stability   : experimental
-}</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Model.Networks.Bus</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier">BusNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Instruction"><span class="hs-identifier">Instruction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Ports"><span class="hs-identifier">Ports</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier">IOPorts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#boundFunctions"><span class="hs-identifier">boundFunctions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#controlSignalLiteral"><span class="hs-identifier">controlSignalLiteral</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#busNetwork"><span class="hs-identifier">busNetwork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Builder</span></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#modifyNetwork"><span class="hs-identifier">modifyNetwork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#defineNetwork"><span class="hs-identifier">defineNetwork</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#addCustom"><span class="hs-identifier">addCustom</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#add"><span class="hs-identifier">add</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#addPrototype"><span class="hs-identifier">addPrototype</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#addCustomPrototype"><span class="hs-identifier">addCustomPrototype</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String.Interpolate</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String.ToString</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html"><span class="hs-identifier">NITTA.Intermediate.Types</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html"><span class="hs-identifier">NITTA.Model.Networks.Types</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.html"><span class="hs-identifier">NITTA.Model.Problems</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html"><span class="hs-identifier">NITTA.Model.ProcessorUnits.IO.SPI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier">SPI</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html"><span class="hs-identifier">NITTA.Model.ProcessorUnits.Types</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html"><span class="hs-identifier">NITTA.Model.Time</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Project.TestBench.html"><span class="hs-identifier">NITTA.Project.TestBench</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html"><span class="hs-identifier">NITTA.Project.Types</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Project.VerilogSnippets.html"><span class="hs-identifier">NITTA.Project.VerilogSnippets</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Utils.html"><span class="hs-identifier">NITTA.Utils</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html"><span class="hs-identifier">NITTA.Utils.ProcessDescription</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.Interval.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">inf</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sup</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(...)</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.Interval.NonEmpty</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">I</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Regex</span></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span id="BusNetwork"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-var">BusNetwork</span></a></span></span><span> </span><span id="local-6989586621680444345"><span class="annot"><a href="#local-6989586621680444345"><span class="hs-identifier hs-type">tag</span></a></span></span><span> </span><span id="local-6989586621680444346"><span class="annot"><a href="#local-6989586621680444346"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680444347"><span class="annot"><a href="#local-6989586621680444347"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680444348"><span class="annot"><a href="#local-6989586621680444348"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BusNetwork"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-var">BusNetwork</span></a></span></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="bnName"><span class="annot"><span class="annottext">forall tag v x t. BusNetwork tag v x t -&gt; tag
</span><a href="NITTA.Model.Networks.Bus.html#bnName"><span class="hs-identifier hs-var hs-var">bnName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680444345"><span class="hs-identifier hs-type">tag</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="bnRemains"><span class="annot"><span class="annottext">forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444346"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444347"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ List of functions bound to network, but not bound to any process unit.</span></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="bnBound"><span class="annot"><span class="annottext">forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680444345"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444346"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444347"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Map process unit name to list of bound functions.</span></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="bnProcess"><span class="annot"><span class="annottext">forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444348"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#StepInfo"><span class="hs-identifier hs-type">StepInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444346"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444347"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444348"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Network process (bindings and transport instructions)</span></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="bnPus"><span class="annot"><span class="annottext">forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680444345"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PU"><span class="hs-identifier hs-type">PU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444346"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444347"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444348"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Map of process units.</span></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="bnSignalBusWidth"><span class="annot"><span class="annottext">forall tag v x t. BusNetwork tag v x t -&gt; Int
</span><a href="NITTA.Model.Networks.Bus.html#bnSignalBusWidth"><span class="hs-identifier hs-var hs-var">bnSignalBusWidth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Controll bus width.</span></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="ioSync"><span class="annot"><span class="annottext">forall tag v x t. BusNetwork tag v x t -&gt; IOSynchronization
</span><a href="NITTA.Model.Networks.Bus.html#ioSync"><span class="hs-identifier hs-var hs-var">ioSync</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#IOSynchronization"><span class="hs-identifier hs-type">IOSynchronization</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="bnEnv"><span class="annot"><span class="annottext">forall tag v x t.
BusNetwork tag v x t -&gt; UnitEnv (BusNetwork tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnEnv"><span class="hs-identifier hs-var hs-var">bnEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444345"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444346"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444347"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444348"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="bnPUPrototypes"><span class="annot"><span class="annottext">forall tag v x t.
BusNetwork tag v x t -&gt; Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPUPrototypes"><span class="hs-identifier hs-var hs-var">bnPUPrototypes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680444345"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUPrototype"><span class="hs-identifier hs-type">PUPrototype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444345"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444346"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444347"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444348"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Set of the PUs that could be added to the network during synthesis process</span></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span id="busNetwork"><span class="annot"><span class="annottext">busNetwork :: tag -&gt; IOSynchronization -&gt; BusNetwork tag v x t
</span><a href="NITTA.Model.Networks.Bus.html#busNetwork"><span class="hs-identifier hs-var hs-var">busNetwork</span></a></span></span><span> </span><span id="local-6989586621680445390"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445390"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621680445391"><span class="annot"><span class="annottext">IOSynchronization
</span><a href="#local-6989586621680445391"><span class="hs-identifier hs-var">iosync</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bnName :: tag
</span><a href="NITTA.Model.Networks.Bus.html#bnName"><span class="hs-identifier hs-var">bnName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445390"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-86"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-87"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bnBound :: Map tag [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var">bnBound</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map tag [F v x]
forall k a. Map k a
</span><span class="hs-identifier hs-var">M.empty</span></span><span>
</span><span id="line-88"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-89"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var">bnPus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-90"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bnSignalBusWidth :: Int
</span><a href="NITTA.Model.Networks.Bus.html#bnSignalBusWidth"><span class="hs-identifier hs-var">bnSignalBusWidth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-91"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ioSync :: IOSynchronization
</span><a href="NITTA.Model.Networks.Bus.html#ioSync"><span class="hs-identifier hs-var">ioSync</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="#local-6989586621680445391"><span class="hs-identifier hs-var">iosync</span></a></span><span>
</span><span id="line-92"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bnEnv :: UnitEnv (BusNetwork tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnEnv"><span class="hs-identifier hs-var">bnEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitEnv (BusNetwork tag v x t)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bnPUPrototypes :: Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPUPrototypes"><span class="hs-identifier hs-var">bnPUPrototypes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444412"><span id="local-6989586621680444413"><span id="local-6989586621680444414"><span id="local-6989586621680444415"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="#local-6989586621680444412"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621680444413"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444413"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444414"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444415"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444412"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621680445401"><span class="annot"><span class="annottext">def :: BusNetwork tag v x t
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tag -&gt; IOSynchronization -&gt; BusNetwork tag v x t
forall {t} {tag} {v} {x}.
Default t =&gt;
tag -&gt; IOSynchronization -&gt; BusNetwork tag v x t
</span><a href="NITTA.Model.Networks.Bus.html#busNetwork"><span class="hs-identifier hs-var">busNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><span class="hs-string">&quot;defaultBus&quot;</span></span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="NITTA.Model.Networks.Types.html#ASync"><span class="hs-identifier hs-var">ASync</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444425"><span id="local-6989586621680444426"><span id="local-6989586621680444427"><span id="local-6989586621680444428"><span class="annot"><a href="NITTA.Intermediate.Variable.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444425"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#Variables"><span class="hs-identifier hs-type">Variables</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444426"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444425"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444427"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444428"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444425"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-100"></span><span>    </span><span id="local-6989586621680445413"><span class="annot"><span class="annottext">variables :: BusNetwork tag v x t -&gt; Set v
</span><a href="#local-6989586621680445413"><span class="hs-identifier hs-var hs-var hs-var hs-var">variables</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445415"><span class="annot"><span class="annottext">Map tag [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map tag [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(F v x -&gt; Set v) -&gt; [F v x] -&gt; Set v
forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">([F v x] -&gt; Set v) -&gt; [F v x] -&gt; Set v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[F v x]] -&gt; [F v x]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[F v x]] -&gt; [F v x]) -&gt; [[F v x]] -&gt; [F v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x] -&gt; [[F v x]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x]
</span><a href="#local-6989586621680445415"><span class="hs-identifier hs-var">bnBound</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span id="boundFunctions"><span class="annot"><span class="annottext">boundFunctions :: k -&gt; BusNetwork k v x t -&gt; [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#boundFunctions"><span class="hs-identifier hs-var hs-var">boundFunctions</span></a></span></span><span> </span><span id="local-6989586621680445425"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680445425"><span class="hs-identifier hs-var">puTitle</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445426"><span class="annot"><span class="annottext">Map k [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map k [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680445425"><span class="hs-identifier hs-var">puTitle</span></a></span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k [F v x] -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-operator hs-var">`M.member`</span></span><span> </span><span class="annot"><span class="annottext">Map k [F v x]
</span><a href="#local-6989586621680445426"><span class="hs-identifier hs-var">bnBound</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map k [F v x]
</span><a href="#local-6989586621680445426"><span class="hs-identifier hs-var">bnBound</span></a></span><span> </span><span class="annot"><span class="annottext">Map k [F v x] -&gt; k -&gt; [F v x]
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680445425"><span class="hs-identifier hs-var">puTitle</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444462"><span id="local-6989586621680444463"><span id="local-6989586621680444464"><span id="local-6989586621680444465"><span id="local-6989586621680445433"><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="#local-6989586621680444462"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Value.html#DefaultX"><span class="hs-identifier hs-type">DefaultX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444463"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444464"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444462"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444465"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444462"><span class="hs-identifier hs-type">x</span></a></span></span></span></span></span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444473"><span id="local-6989586621680444474"><span id="local-6989586621680444475"><span id="local-6989586621680444476"><span class="annot"><a href="NITTA.Intermediate.Types.html#WithFunctions"><span class="hs-identifier hs-type">WithFunctions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444473"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444474"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444475"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444476"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444474"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444475"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621680445441"><span class="annot"><span class="annottext">functions :: BusNetwork tag v x t -&gt; [F v x]
</span><a href="#local-6989586621680445441"><span class="hs-identifier hs-var hs-var hs-var hs-var">functions</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445443"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445444"><span class="annot"><span class="annottext">Map tag [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map tag [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680445443"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x] -&gt; [F v x] -&gt; [F v x]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[F v x]] -&gt; [F v x]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map tag [F v x] -&gt; [[F v x]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x]
</span><a href="#local-6989586621680445444"><span class="hs-identifier hs-var">bnBound</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444492"><span id="local-6989586621680444493"><span id="local-6989586621680444494"><span id="local-6989586621680444495"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444492"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444493"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444494"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444495"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Dataflow.html#DataflowProblem"><span class="hs-identifier hs-type">DataflowProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444492"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444493"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444494"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444495"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444492"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444493"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444495"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621680445499"><span class="annot"><span class="annottext">dataflowOptions :: BusNetwork tag v x t -&gt; [DataflowSt tag v (TimeConstraint t)]
</span><a href="#local-6989586621680445499"><span class="hs-identifier hs-var hs-var hs-var hs-var">dataflowOptions</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445501"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445502"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680445503"><span class="annot"><span class="annottext">sources :: [(tag, EndpointSt v (TimeConstraint t))]
</span><a href="#local-6989586621680445503"><span class="hs-identifier hs-var hs-var">sources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-114"></span><span>                </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; [(tag, EndpointSt v (TimeConstraint t))])
-&gt; [(tag, PU v x t)] -&gt; [(tag, EndpointSt v (TimeConstraint t))]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-115"></span><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680445505"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445505"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445506"><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680445506"><span class="hs-identifier hs-var">pu</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EndpointSt v (TimeConstraint t)
 -&gt; (tag, EndpointSt v (TimeConstraint t)))
-&gt; [EndpointSt v (TimeConstraint t)]
-&gt; [(tag, EndpointSt v (TimeConstraint t))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680445507"><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445507"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445505"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445507"><span class="hs-identifier hs-var">ep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([EndpointSt v (TimeConstraint t)]
 -&gt; [(tag, EndpointSt v (TimeConstraint t))])
-&gt; [EndpointSt v (TimeConstraint t)]
-&gt; [(tag, EndpointSt v (TimeConstraint t))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EndpointSt v (TimeConstraint t) -&gt; Bool)
-&gt; [EndpointSt v (TimeConstraint t)]
-&gt; [EndpointSt v (TimeConstraint t)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t) -&gt; Bool
forall {v} {tp}. EndpointSt v tp -&gt; Bool
</span><a href="NITTA.Model.Problems.Endpoint.html#isSource"><span class="hs-identifier hs-var">isSource</span></a></span><span> </span><span class="annot"><span class="annottext">([EndpointSt v (TimeConstraint t)]
 -&gt; [EndpointSt v (TimeConstraint t)])
-&gt; [EndpointSt v (TimeConstraint t)]
-&gt; [EndpointSt v (TimeConstraint t)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; [EndpointSt v (TimeConstraint t)]
forall u v t.
EndpointProblem u v t =&gt;
u -&gt; [EndpointSt v (TimeConstraint t)]
</span><a href="NITTA.Model.Problems.Endpoint.html#endpointOptions"><span class="hs-identifier hs-var">endpointOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680445506"><span class="hs-identifier hs-var">pu</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>                    </span><span class="annot"><span class="annottext">([(tag, PU v x t)] -&gt; [(tag, EndpointSt v (TimeConstraint t))])
-&gt; [(tag, PU v x t)] -&gt; [(tag, EndpointSt v (TimeConstraint t))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680445501"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-117"></span><span>            </span><span id="local-6989586621680445511"><span class="annot"><span class="annottext">targets :: Map v (tag, EndpointSt v (TimeConstraint t))
</span><a href="#local-6989586621680445511"><span class="hs-identifier hs-var hs-var">targets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>                </span><span class="annot"><span class="annottext">[(v, (tag, EndpointSt v (TimeConstraint t)))]
-&gt; Map v (tag, EndpointSt v (TimeConstraint t))
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-119"></span><span>                    </span><span class="annot"><span class="annottext">([(v, (tag, EndpointSt v (TimeConstraint t)))]
 -&gt; Map v (tag, EndpointSt v (TimeConstraint t)))
-&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))]
-&gt; Map v (tag, EndpointSt v (TimeConstraint t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))])
-&gt; [(tag, PU v x t)]
-&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-120"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680445513"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445513"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445514"><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680445514"><span class="hs-identifier hs-var">pu</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>                            </span><span class="annot"><span class="annottext">(EndpointSt v (TimeConstraint t)
 -&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))])
-&gt; [EndpointSt v (TimeConstraint t)]
-&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680445515"><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445515"><span class="hs-identifier hs-var">ep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(v -&gt; (v, (tag, EndpointSt v (TimeConstraint t))))
-&gt; [v] -&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445513"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445515"><span class="hs-identifier hs-var">ep</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([v] -&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))])
-&gt; [v] -&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; [v]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.elems</span></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; [v]) -&gt; Set v -&gt; [v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t) -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445515"><span class="hs-identifier hs-var">ep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([EndpointSt v (TimeConstraint t)]
 -&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))])
-&gt; [EndpointSt v (TimeConstraint t)]
-&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-122"></span><span>                                </span><span class="annot"><span class="annottext">(EndpointSt v (TimeConstraint t) -&gt; Bool)
-&gt; [EndpointSt v (TimeConstraint t)]
-&gt; [EndpointSt v (TimeConstraint t)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t) -&gt; Bool
forall {v} {tp}. EndpointSt v tp -&gt; Bool
</span><a href="NITTA.Model.Problems.Endpoint.html#isTarget"><span class="hs-identifier hs-var">isTarget</span></a></span><span> </span><span class="annot"><span class="annottext">([EndpointSt v (TimeConstraint t)]
 -&gt; [EndpointSt v (TimeConstraint t)])
-&gt; [EndpointSt v (TimeConstraint t)]
-&gt; [EndpointSt v (TimeConstraint t)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-123"></span><span>                                    </span><span class="annot"><span class="annottext">PU v x t -&gt; [EndpointSt v (TimeConstraint t)]
forall u v t.
EndpointProblem u v t =&gt;
u -&gt; [EndpointSt v (TimeConstraint t)]
</span><a href="NITTA.Model.Problems.Endpoint.html#endpointOptions"><span class="hs-identifier hs-var">endpointOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680445514"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-124"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>                    </span><span class="annot"><span class="annottext">([(tag, PU v x t)]
 -&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))])
-&gt; [(tag, PU v x t)]
-&gt; [(v, (tag, EndpointSt v (TimeConstraint t)))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680445501"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-126"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(DataflowSt tag v (TimeConstraint t) -&gt; Bool)
-&gt; [DataflowSt tag v (TimeConstraint t)]
-&gt; [DataflowSt tag v (TimeConstraint t)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (DataflowSt tag v (TimeConstraint t) -&gt; Bool)
-&gt; DataflowSt tag v (TimeConstraint t)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(tag, EndpointSt v (TimeConstraint t))] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([(tag, EndpointSt v (TimeConstraint t))] -&gt; Bool)
-&gt; (DataflowSt tag v (TimeConstraint t)
    -&gt; [(tag, EndpointSt v (TimeConstraint t))])
-&gt; DataflowSt tag v (TimeConstraint t)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DataflowSt tag v (TimeConstraint t)
-&gt; [(tag, EndpointSt v (TimeConstraint t))]
forall tag v tp. DataflowSt tag v tp -&gt; [(tag, EndpointSt v tp)]
</span><a href="NITTA.Model.Problems.Dataflow.html#dfTargets"><span class="hs-identifier hs-var">dfTargets</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([DataflowSt tag v (TimeConstraint t)]
 -&gt; [DataflowSt tag v (TimeConstraint t)])
-&gt; [DataflowSt tag v (TimeConstraint t)]
-&gt; [DataflowSt tag v (TimeConstraint t)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-127"></span><span>                </span><span class="annot"><span class="annottext">((tag, EndpointSt v (TimeConstraint t))
 -&gt; [DataflowSt tag v (TimeConstraint t)])
-&gt; [(tag, EndpointSt v (TimeConstraint t))]
-&gt; [DataflowSt tag v (TimeConstraint t)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-128"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680445522"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445522"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445523"><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445523"><span class="hs-identifier hs-var">sEndpoint</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680445524"><span class="annot"><span class="annottext">dfSource :: (tag, EndpointSt v (TimeConstraint t))
</span><a href="#local-6989586621680445524"><span class="hs-identifier hs-var hs-var">dfSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445522"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t) -&gt; EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445525"><span class="hs-identifier hs-var">netConstrain</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445523"><span class="hs-identifier hs-var">sEndpoint</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>                            </span><span class="hs-comment">-- collsion example (can not be sended at the same time):</span><span>
</span><span id="line-131"></span><span>                            </span><span class="hs-comment">-- fram1</span><span>
</span><span id="line-132"></span><span>                            </span><span class="hs-comment">--   x1 -&gt; accum</span><span>
</span><span id="line-133"></span><span>                            </span><span class="hs-comment">--   x2 -&gt; accum</span><span>
</span><span id="line-134"></span><span>                            </span><span class="hs-special">(</span><span id="local-6989586621680445526"><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680445526"><span class="hs-identifier hs-var">hold</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445527"><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680445527"><span class="hs-identifier hs-var">sendWithColisions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>                                </span><span class="annot"><span class="annottext">(v -&gt; Bool) -&gt; [v] -&gt; ([v], [v])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">L.partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680445529"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445529"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (tag, EndpointSt v (TimeConstraint t)) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (tag, EndpointSt v (TimeConstraint t)) -&gt; Bool)
-&gt; Maybe (tag, EndpointSt v (TimeConstraint t)) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map v (tag, EndpointSt v (TimeConstraint t))
</span><a href="#local-6989586621680445511"><span class="hs-identifier hs-var">targets</span></a></span><span> </span><span class="annot"><span class="annottext">Map v (tag, EndpointSt v (TimeConstraint t))
-&gt; v -&gt; Maybe (tag, EndpointSt v (TimeConstraint t))
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445529"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([v] -&gt; ([v], [v])) -&gt; [v] -&gt; ([v], [v])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-136"></span><span>                                    </span><span class="annot"><span class="annottext">Set v -&gt; [v]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.elems</span></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; [v]) -&gt; Set v -&gt; [v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-137"></span><span>                                        </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t) -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445523"><span class="hs-identifier hs-var">sEndpoint</span></a></span><span>
</span><span id="line-138"></span><span>                            </span><span id="local-6989586621680445532"><span class="annot"><span class="annottext">sends :: [[v]]
</span><a href="#local-6989586621680445532"><span class="hs-identifier hs-var hs-var">sends</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>                                </span><span class="annot"><span class="annottext">[[v]] -&gt; [[v]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; [m a] -&gt; m [a]
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">([[v]] -&gt; [[v]]) -&gt; [[v]] -&gt; [[v]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-140"></span><span>                                    </span><span class="annot"><span class="annottext">Map tag [v] -&gt; [[v]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map tag [v] -&gt; [[v]]) -&gt; Map tag [v] -&gt; [[v]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-141"></span><span>                                        </span><span class="annot"><span class="annottext">(v -&gt; Map tag [v] -&gt; Map tag [v])
-&gt; Map tag [v] -&gt; [v] -&gt; Map tag [v]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span>
</span><span id="line-142"></span><span>                                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680445535"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445535"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe [v] -&gt; Maybe [v]) -&gt; tag -&gt; Map tag [v] -&gt; Map tag [v]
forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.alter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[v] -&gt; Maybe [v]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([v] -&gt; Maybe [v]) -&gt; (Maybe [v] -&gt; [v]) -&gt; Maybe [v] -&gt; Maybe [v]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[v] -&gt; ([v] -&gt; [v]) -&gt; Maybe [v] -&gt; [v]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445535"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445535"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; [v] -&gt; [v]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(tag, EndpointSt v (TimeConstraint t)) -&gt; tag
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((tag, EndpointSt v (TimeConstraint t)) -&gt; tag)
-&gt; (tag, EndpointSt v (TimeConstraint t)) -&gt; tag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map v (tag, EndpointSt v (TimeConstraint t))
</span><a href="#local-6989586621680445511"><span class="hs-identifier hs-var">targets</span></a></span><span> </span><span class="annot"><span class="annottext">Map v (tag, EndpointSt v (TimeConstraint t))
-&gt; v -&gt; (tag, EndpointSt v (TimeConstraint t))
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445535"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>                                            </span><span class="annot"><span class="annottext">Map tag [v]
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-144"></span><span>                                            </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680445527"><span class="hs-identifier hs-var">sendWithColisions</span></a></span><span>
</span><span id="line-145"></span><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">([v] -&gt; DataflowSt tag v (TimeConstraint t))
-&gt; [[v]] -&gt; [DataflowSt tag v (TimeConstraint t)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-146"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680445539"><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680445539"><span class="hs-identifier hs-var">send</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>                                    </span><span class="annot"><a href="NITTA.Model.Problems.Dataflow.html#DataflowSt"><span class="hs-identifier hs-type">DataflowSt</span></a></span><span>
</span><span id="line-148"></span><span>                                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">(tag, EndpointSt v (TimeConstraint t))
dfSource :: (tag, EndpointSt v (TimeConstraint t))
dfSource :: (tag, EndpointSt v (TimeConstraint t))
</span><a href="#local-6989586621680445524"><span class="hs-identifier hs-var hs-var">dfSource</span></a></span><span>
</span><span id="line-149"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dfTargets :: [(tag, EndpointSt v (TimeConstraint t))]
</span><a href="NITTA.Model.Problems.Dataflow.html#dfTargets"><span class="hs-identifier hs-var">dfTargets</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-150"></span><span>                                            </span><span class="annot"><span class="annottext">(v -&gt; Maybe (tag, EndpointSt v (TimeConstraint t)))
-&gt; [v] -&gt; [(tag, EndpointSt v (TimeConstraint t))]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-151"></span><span>                                                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680445543"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445543"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((tag, EndpointSt v (TimeConstraint t))
 -&gt; (tag, EndpointSt v (TimeConstraint t)))
-&gt; Maybe (tag, EndpointSt v (TimeConstraint t))
-&gt; Maybe (tag, EndpointSt v (TimeConstraint t))
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EndpointSt v (TimeConstraint t)
 -&gt; EndpointSt v (TimeConstraint t))
-&gt; (tag, EndpointSt v (TimeConstraint t))
-&gt; (tag, EndpointSt v (TimeConstraint t))
forall b c a. (b -&gt; c) -&gt; (a, b) -&gt; (a, c)
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t) -&gt; EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445525"><span class="hs-identifier hs-var">netConstrain</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map v (tag, EndpointSt v (TimeConstraint t))
</span><a href="#local-6989586621680445511"><span class="hs-identifier hs-var">targets</span></a></span><span> </span><span class="annot"><span class="annottext">Map v (tag, EndpointSt v (TimeConstraint t))
-&gt; v -&gt; Maybe (tag, EndpointSt v (TimeConstraint t))
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445543"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>                                                </span><span class="annot"><span class="annottext">([v] -&gt; [(tag, EndpointSt v (TimeConstraint t))])
-&gt; [v] -&gt; [(tag, EndpointSt v (TimeConstraint t))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680445539"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">[v] -&gt; [v] -&gt; [v]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[v]
</span><a href="#local-6989586621680445526"><span class="hs-identifier hs-var">hold</span></a></span><span>
</span><span id="line-153"></span><span>                                        </span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>                                </span><span class="annot"><span class="annottext">[[v]]
</span><a href="#local-6989586621680445532"><span class="hs-identifier hs-var">sends</span></a></span><span>
</span><span id="line-156"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>                    </span><span class="annot"><span class="annottext">[(tag, EndpointSt v (TimeConstraint t))]
</span><a href="#local-6989586621680445503"><span class="hs-identifier hs-var">sources</span></a></span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>            </span><span id="local-6989586621680445525"><span class="annot"><span class="annottext">netConstrain :: EndpointSt v (TimeConstraint t) -&gt; EndpointSt v (TimeConstraint t)
</span><a href="#local-6989586621680445525"><span class="hs-identifier hs-var hs-var">netConstrain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>                </span><span class="annot"><span class="annottext">(TimeConstraint t -&gt; TimeConstraint t)
-&gt; EndpointSt v (TimeConstraint t)
-&gt; EndpointSt v (TimeConstraint t)
forall {t} {tp} {v}. (t -&gt; tp) -&gt; EndpointSt v t -&gt; EndpointSt v tp
</span><a href="NITTA.Model.Problems.Endpoint.html#updAt"><span class="hs-identifier hs-var">updAt</span></a></span><span> </span><span class="annot"><span class="annottext">((TimeConstraint t -&gt; TimeConstraint t)
 -&gt; EndpointSt v (TimeConstraint t)
 -&gt; EndpointSt v (TimeConstraint t))
-&gt; (TimeConstraint t -&gt; TimeConstraint t)
-&gt; EndpointSt v (TimeConstraint t)
-&gt; EndpointSt v (TimeConstraint t)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680445546"><span class="annot"><span class="annottext">at :: TimeConstraint t
</span><a href="#local-6989586621680445546"><span class="hs-identifier hs-var">at</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Time.html#TimeConstraint"><span class="hs-identifier hs-type">TimeConstraint</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445548"><span class="annot"><span class="annottext">Interval t
tcAvailable :: Interval t
tcAvailable :: forall t. TimeConstraint t -&gt; Interval t
</span><a href="#local-6989586621680445548"><span class="hs-identifier hs-var hs-var">tcAvailable</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-161"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680445550"><span class="annot"><span class="annottext">a :: t
</span><a href="#local-6989586621680445550"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; t
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680445502"><span class="hs-identifier hs-var">bnProcess</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(t -&gt; t) -&gt; t -&gt; t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; t
forall a. Interval a -&gt; a
</span><span class="hs-identifier hs-var">inf</span></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680445548"><span class="hs-identifier hs-var">tcAvailable</span></a></span><span>
</span><span id="line-162"></span><span>                        </span><span id="local-6989586621680445553"><span class="annot"><span class="annottext">b :: t
</span><a href="#local-6989586621680445553"><span class="hs-identifier hs-var hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; t
forall a. Interval a -&gt; a
</span><span class="hs-identifier hs-var">sup</span></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680445548"><span class="hs-identifier hs-var">tcAvailable</span></a></span><span>
</span><span id="line-163"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TimeConstraint t
</span><a href="#local-6989586621680445546"><span class="hs-identifier hs-var">at</span></a></span><span class="hs-special">{</span><span class="annot"><a href="NITTA.Model.Time.html#tcAvailable"><span class="hs-identifier hs-var">tcAvailable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680445550"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">...</span></span><span> </span><span class="annot"><a href="#local-6989586621680445553"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621680445594"><span class="annot"><span class="annottext">dataflowDecision :: BusNetwork tag v x t
-&gt; DataflowSt tag v (Interval t) -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680445594"><span class="hs-identifier hs-var hs-var hs-var hs-var">dataflowDecision</span></a></span></span><span> </span><span id="local-6989586621680445596"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680445596"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445597"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445598"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Dataflow.html#DataflowSt"><span class="hs-identifier hs-type">DataflowSt</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">dfSource :: forall tag v tp. DataflowSt tag v tp -&gt; (tag, EndpointSt v tp)
</span><a href="NITTA.Model.Problems.Dataflow.html#dfSource"><span class="hs-identifier hs-var">dfSource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680445599"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445599"><span class="hs-identifier hs-var">srcTitle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445600"><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445600"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445601"><span class="annot"><span class="annottext">[(tag, EndpointSt v (Interval t))]
dfTargets :: forall tag v tp. DataflowSt tag v tp -&gt; [(tag, EndpointSt v tp)]
dfTargets :: [(tag, EndpointSt v (Interval t))]
</span><a href="NITTA.Model.Problems.Dataflow.html#dfTargets"><span class="hs-identifier hs-var hs-var">dfTargets</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; t
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680445597"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; t
forall a. Interval a -&gt; a
</span><span class="hs-identifier hs-var">inf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointSt v (Interval t) -&gt; Interval t
forall v tp. EndpointSt v tp -&gt; tp
</span><a href="NITTA.Model.Problems.Endpoint.html#epAt"><span class="hs-identifier hs-var">epAt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445600"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>            </span><span class="annot"><span class="annottext">[Char] -&gt; BusNetwork tag v x t
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; BusNetwork tag v x t) -&gt; [Char] -&gt; BusNetwork tag v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;BusNetwork wraping time! Time: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">t -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; t
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680445597"><span class="hs-identifier hs-var">bnProcess</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; Act start at: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445600"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680445606"><span class="annot"><span class="annottext">srcStart :: t
</span><a href="#local-6989586621680445606"><span class="hs-identifier hs-var hs-var">srcStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; t
forall a. Interval a -&gt; a
</span><span class="hs-identifier hs-var">inf</span></span><span> </span><span class="annot"><span class="annottext">(Interval t -&gt; t) -&gt; Interval t -&gt; t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t) -&gt; Interval t
forall v tp. EndpointSt v tp -&gt; tp
</span><a href="NITTA.Model.Problems.Endpoint.html#epAt"><span class="hs-identifier hs-var">epAt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445600"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-170"></span><span>                </span><span id="local-6989586621680445607"><span class="annot"><span class="annottext">srcDuration :: t
</span><a href="#local-6989586621680445607"><span class="hs-identifier hs-var hs-var">srcDuration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[t] -&gt; t
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">([t] -&gt; t) -&gt; [t] -&gt; t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, EndpointSt v (Interval t)) -&gt; t)
-&gt; [(tag, EndpointSt v (Interval t))] -&gt; [t]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><a href="NITTA.Model.Problems.Endpoint.html#EndpointSt"><span class="hs-identifier hs-type">EndpointSt</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445610"><span class="annot"><span class="annottext">Interval t
epAt :: forall v tp. EndpointSt v tp -&gt; tp
epAt :: Interval t
</span><a href="NITTA.Model.Problems.Endpoint.html#epAt"><span class="hs-identifier hs-var hs-var">epAt</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Interval t -&gt; t
forall a. Interval a -&gt; a
</span><span class="hs-identifier hs-var">inf</span></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680445610"><span class="hs-identifier hs-var">epAt</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680445606"><span class="hs-identifier hs-var">srcStart</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Interval t -&gt; t
forall a. Num a =&gt; Interval a -&gt; a
</span><span class="hs-identifier hs-var">I.width</span></span><span> </span><span class="annot"><span class="annottext">Interval t
</span><a href="#local-6989586621680445610"><span class="hs-identifier hs-var">epAt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EndpointSt v (Interval t) -&gt; t)
-&gt; ((tag, EndpointSt v (Interval t)) -&gt; EndpointSt v (Interval t))
-&gt; (tag, EndpointSt v (Interval t))
-&gt; t
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(tag, EndpointSt v (Interval t)) -&gt; EndpointSt v (Interval t)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(tag, EndpointSt v (Interval t))]
</span><a href="#local-6989586621680445601"><span class="hs-identifier hs-var">dfTargets</span></a></span><span>
</span><span id="line-171"></span><span>                </span><span id="local-6989586621680445614"><span class="annot"><span class="annottext">srcEnd :: t
</span><a href="#local-6989586621680445614"><span class="hs-identifier hs-var hs-var">srcEnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680445606"><span class="hs-identifier hs-var">srcStart</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680445607"><span class="hs-identifier hs-var">srcDuration</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>                </span><span id="local-6989586621680445615"><span class="annot"><span class="annottext">subDecisions :: [(tag, EndpointSt v (Interval t))]
</span><a href="#local-6989586621680445615"><span class="hs-identifier hs-var hs-var">subDecisions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445599"><span class="hs-identifier hs-var">srcTitle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EndpointRole v -&gt; Interval t -&gt; EndpointSt v (Interval t)
forall v tp. EndpointRole v -&gt; tp -&gt; EndpointSt v tp
</span><a href="NITTA.Model.Problems.Endpoint.html#EndpointSt"><span class="hs-identifier hs-var">EndpointSt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set v -&gt; EndpointRole v
forall v. Set v -&gt; EndpointRole v
</span><a href="NITTA.Model.Problems.Endpoint.html#Source"><span class="hs-identifier hs-var">Source</span></a></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; EndpointRole v) -&gt; Set v -&gt; EndpointRole v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, EndpointSt v (Interval t)) -&gt; Set v)
-&gt; [(tag, EndpointSt v (Interval t))] -&gt; Set v
forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointSt v (Interval t) -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">(EndpointSt v (Interval t) -&gt; Set v)
-&gt; ((tag, EndpointSt v (Interval t)) -&gt; EndpointSt v (Interval t))
-&gt; (tag, EndpointSt v (Interval t))
-&gt; Set v
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(tag, EndpointSt v (Interval t)) -&gt; EndpointSt v (Interval t)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(tag, EndpointSt v (Interval t))]
</span><a href="#local-6989586621680445601"><span class="hs-identifier hs-var">dfTargets</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EndpointSt v (Interval t) -&gt; Interval t
forall v tp. EndpointSt v tp -&gt; tp
</span><a href="NITTA.Model.Problems.Endpoint.html#epAt"><span class="hs-identifier hs-var">epAt</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445600"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(tag, EndpointSt v (Interval t))
-&gt; [(tag, EndpointSt v (Interval t))]
-&gt; [(tag, EndpointSt v (Interval t))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(tag, EndpointSt v (Interval t))]
</span><a href="#local-6989586621680445601"><span class="hs-identifier hs-var">dfTargets</span></a></span><span>
</span><span id="line-175"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680445596"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-176"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var">bnPus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldl</span></span><span> </span><span class="annot"><a href="#local-6989586621680445618"><span class="hs-identifier hs-type">applyDecision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445598"><span class="hs-identifier hs-type">bnPus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445615"><span class="hs-identifier hs-type">subDecisions</span></a></span><span>
</span><span id="line-177"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-type">execScheduleWithProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445596"><span class="hs-identifier hs-type">bn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445597"><span class="hs-identifier hs-type">bnProcess</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span>
</span><span id="line-179"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680445621"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445621"><span class="hs-identifier hs-var">targetTitle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445622"><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445622"><span class="hs-identifier hs-var">ep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-180"></span><span>                                </span><span class="annot"><span class="annottext">Interval t
-&gt; Instruction (BusNetwork tag v x t)
-&gt; StateT (Schedule (BusNetwork tag v x t) v x t) Identity [Int]
forall {m :: * -&gt; *} {pu} {v} {x} {t}.
(MonadState (Schedule pu v x t) m, Show (Instruction pu),
 Typeable pu, Num t) =&gt;
Interval t -&gt; Instruction pu -&gt; m [Int]
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleInstructionUnsafe"><span class="hs-identifier hs-var">scheduleInstructionUnsafe</span></a></span><span>
</span><span id="line-181"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680445606"><span class="hs-identifier hs-var">srcStart</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Interval t
forall a. Ord a =&gt; a -&gt; a -&gt; Interval a
</span><span class="hs-operator hs-var">...</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680445614"><span class="hs-identifier hs-var">srcEnd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; tag -&gt; tag -&gt; Instruction (BusNetwork tag v x t)
forall tag v x t.
v -&gt; tag -&gt; tag -&gt; Instruction (BusNetwork tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#Transport"><span class="hs-identifier hs-var">Transport</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set v -&gt; v
forall {c}. Set c -&gt; c
</span><a href="NITTA.Utils.Base.html#oneOf"><span class="hs-identifier hs-var">oneOf</span></a></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; v) -&gt; Set v -&gt; v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t) -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445622"><span class="hs-identifier hs-var">ep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445599"><span class="hs-identifier hs-var">srcTitle</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445621"><span class="hs-identifier hs-var">targetTitle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444492"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444493"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444494"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444495"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>                            </span><span class="annot"><a href="#local-6989586621680445601"><span class="hs-identifier hs-type">dfTargets</span></a></span><span>
</span><span id="line-185"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>            </span><span id="local-6989586621680445618"><span class="annot"><span class="annottext">applyDecision :: Map k a -&gt; (k, EndpointSt v (Interval t)) -&gt; Map k a
</span><a href="#local-6989586621680445618"><span class="hs-identifier hs-var hs-var">applyDecision</span></a></span></span><span> </span><span id="local-6989586621680445632"><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680445632"><span class="hs-identifier hs-var">pus</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680445633"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680445633"><span class="hs-identifier hs-var">trgTitle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445634"><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445634"><span class="hs-identifier hs-var">d'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; EndpointSt v (Interval t) -&gt; a
forall u v t.
EndpointProblem u v t =&gt;
u -&gt; EndpointSt v (Interval t) -&gt; u
</span><a href="NITTA.Model.Problems.Endpoint.html#endpointDecision"><span class="hs-operator hs-var">`endpointDecision`</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (Interval t)
</span><a href="#local-6989586621680445634"><span class="hs-identifier hs-var">d'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680445633"><span class="hs-identifier hs-var">trgTitle</span></a></span><span> </span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680445632"><span class="hs-identifier hs-var">pus</span></a></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444643"><span id="local-6989586621680444644"><span id="local-6989586621680444645"><span id="local-6989586621680444646"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444643"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444644"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444645"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444646"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#ProcessorUnit"><span class="hs-identifier hs-type">ProcessorUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444643"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444644"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444645"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444646"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444644"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444645"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444646"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621680445717"><span class="annot"><span class="annottext">tryBind :: F v x
-&gt; BusNetwork tag v x t -&gt; Either [Char] (BusNetwork tag v x t)
</span><a href="#local-6989586621680445717"><span class="hs-identifier hs-var hs-var hs-var hs-var">tryBind</span></a></span></span><span> </span><span id="local-6989586621680445719"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680445719"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680445720"><span class="annot"><span class="annottext">net :: BusNetwork tag v x t
</span><a href="#local-6989586621680445720"><span class="hs-identifier hs-var">net</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445721"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445722"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445723"><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
bnPUPrototypes :: forall tag v x t.
BusNetwork tag v x t -&gt; Map tag (PUPrototype tag v x t)
bnPUPrototypes :: Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPUPrototypes"><span class="hs-identifier hs-var hs-var">bnPUPrototypes</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(PU v x t -&gt; Bool) -&gt; [PU v x t] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">F v x -&gt; PU v x t -&gt; Bool
forall {b} {v} {x} {t}. ProcessorUnit b v x t =&gt; F v x -&gt; b -&gt; Bool
</span><a href="NITTA.Model.ProcessorUnits.Types.html#allowToProcess"><span class="hs-identifier hs-var">allowToProcess</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680445719"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [PU v x t]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680445722"><span class="hs-identifier hs-var">bnPus</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; Either [Char] (BusNetwork tag v x t)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680445720"><span class="hs-identifier hs-var">net</span></a></span><span class="hs-special">{</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680445719"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680445721"><span class="hs-identifier hs-type">bnRemains</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-comment">-- TODO:</span><span>
</span><span id="line-193"></span><span>        </span><span class="hs-comment">-- There are several issues that need to be addressed: see https://github.com/ryukzak/nitta/pull/195#discussion_r853486450</span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-comment">-- 1) Now the binding of functions to the network is hardcoded, that prevents use of an empty uarch at the start</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-comment">-- 2) If Allocation options are independent of the bnRemains, then they are present in all synthesis states, which means no leaves in the synthesis tree</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(PUPrototype tag v x t -&gt; Bool) -&gt; [PUPrototype tag v x t] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUPrototype"><span class="hs-identifier hs-type">PUPrototype</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445731"><span class="annot"><span class="annottext">pu
pProto :: pu
pProto :: ()
</span><a href="#local-6989586621680445731"><span class="hs-identifier hs-var hs-var">pProto</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">F v x -&gt; pu -&gt; Bool
forall {b} {v} {x} {t}. ProcessorUnit b v x t =&gt; F v x -&gt; b -&gt; Bool
</span><a href="NITTA.Model.ProcessorUnits.Types.html#allowToProcess"><span class="hs-identifier hs-var">allowToProcess</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680445719"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680445731"><span class="hs-identifier hs-var">pProto</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t) -&gt; [PUPrototype tag v x t]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
</span><a href="#local-6989586621680445723"><span class="hs-identifier hs-var">bnPUPrototypes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; Either [Char] (BusNetwork tag v x t)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680445720"><span class="hs-identifier hs-var">net</span></a></span><span class="hs-special">{</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680445719"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621680445721"><span class="hs-identifier hs-type">bnRemains</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#tryBind"><span class="hs-identifier hs-var">tryBind</span></a></span><span> </span><span id="local-6989586621680445733"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680445733"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445734"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Either [Char] (BusNetwork tag v x t)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="">[i|All sub process units reject the functional block: #{ f }; rejects: #{ rejects }|]</span></span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-200"></span><span>            </span><span id="local-6989586621680445736"><span class="annot"><span class="annottext">rejects :: Text
</span><a href="#local-6989586621680445736"><span class="hs-identifier hs-var hs-var">rejects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;; &quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; Text) -&gt; [(tag, PU v x t)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(tag, PU v x t) -&gt; Text
</span><a href="#local-6989586621680445743"><span class="hs-identifier hs-var">showReject</span></a></span><span> </span><span class="annot"><span class="annottext">([(tag, PU v x t)] -&gt; [Text]) -&gt; [(tag, PU v x t)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680445734"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-201"></span><span>            </span><span id="local-6989586621680445743"><span class="annot"><span class="annottext">showReject :: (tag, PU v x t) -&gt; Text
</span><a href="#local-6989586621680445743"><span class="hs-identifier hs-var hs-var">showReject</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680445744"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445744"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445745"><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680445745"><span class="hs-identifier hs-var">pu</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621680445746"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680445746"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">F v x -&gt; PU v x t -&gt; Either [Char] (PU v x t)
forall u v x t.
ProcessorUnit u v x t =&gt;
F v x -&gt; u -&gt; Either [Char] u
</span><a href="NITTA.Model.ProcessorUnits.Types.html#tryBind"><span class="hs-identifier hs-var">tryBind</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680445733"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680445745"><span class="hs-identifier hs-var">pu</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[i|[#{ toString tag }]: #{ err }&quot;|]</span></span><span>
</span><span id="line-202"></span><span>            </span><span class="annot"><a href="#local-6989586621680445743"><span class="hs-identifier hs-var">showReject</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680445749"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445749"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[i|[#{ toString tag }]: undefined&quot;|]</span></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621680445776"><span class="annot"><span class="annottext">process :: BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
</span><a href="#local-6989586621680445776"><span class="hs-identifier hs-var hs-var hs-var hs-var">process</span></a></span></span><span> </span><span id="local-6989586621680445778"><span class="annot"><span class="annottext">net :: BusNetwork tag v x t
</span><a href="#local-6989586621680445778"><span class="hs-identifier hs-var">net</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445779"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445780"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680445781"><span class="annot"><span class="annottext">v2transportStepKey :: Map v Int
</span><a href="#local-6989586621680445781"><span class="hs-identifier hs-var hs-var">v2transportStepKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-206"></span><span>                </span><span class="annot"><span class="annottext">[(v, Int)] -&gt; Map v Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-207"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445782"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680445783"><span class="hs-identifier hs-var">pID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680445784"><span class="annot"><span class="annottext">step :: Step t (StepInfo v x t)
</span><a href="#local-6989586621680445784"><span class="hs-identifier hs-var">step</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445783"><span class="annot"><span class="annottext">Int
pID :: Int
pID :: forall t i. Step t i -&gt; Int
</span><a href="#local-6989586621680445783"><span class="hs-identifier hs-var hs-var">pID</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445787"><span class="annot"><span class="annottext">StepInfo v x t
pDesc :: StepInfo v x t
pDesc :: forall t i. Step t i -&gt; i
</span><a href="#local-6989586621680445787"><span class="hs-identifier hs-var hs-var">pDesc</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t) -&gt; [Step t (StepInfo v x t)]
forall t i. Process t i -&gt; [Step t i]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#steps"><span class="hs-identifier hs-var">steps</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680445779"><span class="hs-identifier hs-var">bnProcess</span></a></span><span>
</span><span id="line-209"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Step t (StepInfo v x t) -&gt; Bool
forall {t1} {v} {x} {t2}. Step t1 (StepInfo v x t2) -&gt; Bool
</span><a href="NITTA.Utils.html#isInstruction"><span class="hs-identifier hs-var">isInstruction</span></a></span><span> </span><span class="annot"><span class="annottext">Step t (StepInfo v x t)
</span><a href="#local-6989586621680445784"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-210"></span><span>                    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445782"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445782"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StepInfo v x t
</span><a href="#local-6989586621680445787"><span class="hs-identifier hs-var">pDesc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-211"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InstructionStep"><span class="hs-identifier hs-type">InstructionStep</span></a></span><span> </span><span id="local-6989586621680445800"><span class="annot"><span class="annottext">Instruction pu
</span><a href="#local-6989586621680445800"><span class="hs-identifier hs-var">ins</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#Transport"><span class="hs-identifier hs-type">Transport</span></a></span><span> </span><span id="local-6989586621680445801"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445801"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="annot"><span class="annottext">tag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
-&gt; Instruction pu -&gt; Maybe (Instruction (BusNetwork tag v x t))
forall a pu.
(Typeable a, Typeable pu) =&gt;
pu -&gt; a -&gt; Maybe (Instruction pu)
</span><a href="NITTA.Utils.ProcessDescription.html#castInstruction"><span class="hs-identifier hs-var">castInstruction</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680445778"><span class="hs-identifier hs-var">net</span></a></span><span> </span><span class="annot"><span class="annottext">Instruction pu
</span><a href="#local-6989586621680445800"><span class="hs-identifier hs-var">ins</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445801"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>                        </span><span class="annot"><span class="annottext">StepInfo v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>            </span><span id="local-6989586621680445803"><span class="annot"><span class="annottext">wholeProcess :: Process t (StepInfo v x t)
</span><a href="#local-6989586621680445803"><span class="hs-identifier hs-var hs-var">wholeProcess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
-&gt; Process t (StepInfo v x t)
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
-&gt; Process t (StepInfo v x t)
forall {pu} {t} {v} {x} {a}.
pu
-&gt; Process t (StepInfo v x t)
-&gt; State (Schedule pu v x t) a
-&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-var">execScheduleWithProcess</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680445778"><span class="hs-identifier hs-var">net</span></a></span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680445779"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="annot"><span class="annottext">(State (Schedule (BusNetwork tag v x t) v x t) ()
 -&gt; Process t (StepInfo v x t))
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
-&gt; Process t (StepInfo v x t)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>                </span><span class="annot"><span class="annottext">((tag, PU v x t)
 -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; [(tag, PU v x t)]
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(tag
 -&gt; PU v x t -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; (tag, PU v x t)
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; PU v x t -&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall {m :: * -&gt; *} {tag} {u} {v} {x} {t} {pu}.
(UnitTag tag, ProcessorUnit u v x t,
 MonadState (Schedule pu v x t) m) =&gt;
tag -&gt; u -&gt; m ()
</span><a href="#local-6989586621680445805"><span class="hs-identifier hs-var">includeNestedProcess</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(tag, PU v x t)]
 -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; [(tag, PU v x t)]
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; tag) -&gt; [(tag, PU v x t)] -&gt; [(tag, PU v x t)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortOn</span></span><span> </span><span class="annot"><span class="annottext">(tag, PU v x t) -&gt; tag
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(tag, PU v x t)] -&gt; [(tag, PU v x t)])
-&gt; [(tag, PU v x t)] -&gt; [(tag, PU v x t)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680445780"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-216"></span><span>                </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445808"><span class="annot"><span class="annottext">[Step t (StepInfo v x t)]
steps :: forall t i. Process t i -&gt; [Step t i]
steps :: [Step t (StepInfo v x t)]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#steps"><span class="hs-identifier hs-var hs-var">steps</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">State
  (Schedule (BusNetwork tag v x t) v x t)
  (Process t (StepInfo v x t))
forall pu v x t.
State (Schedule pu v x t) (Process t (StepInfo v x t))
</span><a href="NITTA.Utils.ProcessDescription.html#getProcessSlice"><span class="hs-identifier hs-var">getProcessSlice</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>                </span><span class="hs-comment">-- Vertical relations between Transport and Endpoint</span><span>
</span><span id="line-219"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680445810"><span class="annot"><span class="annottext">enpointStepKeyVars :: [(Int, v)]
</span><a href="#local-6989586621680445810"><span class="hs-identifier hs-var hs-var">enpointStepKeyVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>                        </span><span class="annot"><span class="annottext">(Step t (StepInfo v x t) -&gt; [(Int, v)])
-&gt; [Step t (StepInfo v x t)] -&gt; [(Int, v)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-221"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445811"><span class="annot"><span class="annottext">Int
pID :: forall t i. Step t i -&gt; Int
pID :: Int
</span><a href="NITTA.Model.ProcessorUnits.Types.html#pID"><span class="hs-identifier hs-var hs-var">pID</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445812"><span class="annot"><span class="annottext">StepInfo v x t
pDesc :: forall t i. Step t i -&gt; i
pDesc :: StepInfo v x t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#pDesc"><span class="hs-identifier hs-var hs-var">pDesc</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>                                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StepInfo v x t
</span><a href="#local-6989586621680445812"><span class="hs-identifier hs-var">pDesc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-223"></span><span>                                    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#NestedStep"><span class="hs-identifier hs-type">NestedStep</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nStep :: forall t v x. StepInfo v x t -&gt; Step t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nStep"><span class="hs-identifier hs-var">nStep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">pDesc :: forall t i. Step t i -&gt; i
</span><a href="NITTA.Model.ProcessorUnits.Types.html#pDesc"><span class="hs-identifier hs-var">pDesc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#EndpointRoleStep"><span class="hs-identifier hs-type">EndpointRoleStep</span></a></span><span> </span><span id="local-6989586621680445819"><span class="annot"><span class="annottext">EndpointRole v
</span><a href="#local-6989586621680445819"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-224"></span><span>                                        </span><span class="annot"><span class="annottext">(v -&gt; (Int, v)) -&gt; [v] -&gt; [(Int, v)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680445811"><span class="hs-identifier hs-var">pID</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([v] -&gt; [(Int, v)]) -&gt; [v] -&gt; [(Int, v)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; [v]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.elems</span></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; [v]) -&gt; Set v -&gt; [v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EndpointRole v -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointRole v
</span><a href="#local-6989586621680445819"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-225"></span><span>                                    </span><span class="annot"><span class="annottext">StepInfo v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-226"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>                            </span><span class="annot"><span class="annottext">[Step t (StepInfo v x t)]
</span><a href="#local-6989586621680445808"><span class="hs-identifier hs-var">steps</span></a></span><span>
</span><span id="line-228"></span><span>                </span><span class="annot"><span class="annottext">((Int, v) -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; [(Int, v)] -&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span>
</span><span id="line-229"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680445820"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680445820"><span class="hs-identifier hs-var">epKey</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680445821"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445821"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-230"></span><span>                        </span><span class="annot"><span class="annottext">Bool
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445821"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; Map v Int -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-operator hs-var">`M.member`</span></span><span> </span><span class="annot"><span class="annottext">Map v Int
</span><a href="#local-6989586621680445781"><span class="hs-identifier hs-var">v2transportStepKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(State (Schedule (BusNetwork tag v x t) v x t) ()
 -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-231"></span><span>                            </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall {m :: * -&gt; *} {pu} {v} {x} {t}.
MonadState (Schedule pu v x t) m =&gt;
[Int] -&gt; [Int] -&gt; m ()
</span><a href="NITTA.Utils.ProcessDescription.html#establishVerticalRelations"><span class="hs-identifier hs-var">establishVerticalRelations</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map v Int
</span><a href="#local-6989586621680445781"><span class="hs-identifier hs-var">v2transportStepKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map v Int -&gt; v -&gt; Int
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445821"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680445820"><span class="hs-identifier hs-var">epKey</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-232"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>                    </span><span class="annot"><span class="annottext">[(Int, v)]
</span><a href="#local-6989586621680445810"><span class="hs-identifier hs-var">enpointStepKeyVars</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>                </span><span class="hs-comment">-- Vertical relations between FB and Transport</span><span>
</span><span id="line-236"></span><span>                </span><span class="annot"><span class="annottext">(Step t (StepInfo v x t)
 -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; [Step t (StepInfo v x t)]
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span>
</span><span id="line-237"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-238"></span><span>                        </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445823"><span class="annot"><span class="annottext">Int
pID :: forall t i. Step t i -&gt; Int
pID :: Int
</span><a href="NITTA.Model.ProcessorUnits.Types.html#pID"><span class="hs-identifier hs-var hs-var">pID</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pDesc :: forall t i. Step t i -&gt; i
</span><a href="NITTA.Model.ProcessorUnits.Types.html#pDesc"><span class="hs-identifier hs-var">pDesc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#NestedStep"><span class="hs-identifier hs-type">NestedStep</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">nStep :: forall t v x. StepInfo v x t -&gt; Step t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nStep"><span class="hs-identifier hs-var">nStep</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">pDesc :: forall t i. Step t i -&gt; i
</span><a href="NITTA.Model.ProcessorUnits.Types.html#pDesc"><span class="hs-identifier hs-var">pDesc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IntermediateStep"><span class="hs-identifier hs-type">IntermediateStep</span></a></span><span> </span><span id="local-6989586621680445834"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680445834"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>                            </span><span class="annot"><span class="annottext">(v -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; Set v -&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span>
</span><span id="line-240"></span><span>                                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680445835"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445835"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-241"></span><span>                                    </span><span class="annot"><span class="annottext">Bool
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445835"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; Map v Int -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-operator hs-var">`M.member`</span></span><span> </span><span class="annot"><span class="annottext">Map v Int
</span><a href="#local-6989586621680445781"><span class="hs-identifier hs-var">v2transportStepKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(State (Schedule (BusNetwork tag v x t) v x t) ()
 -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-242"></span><span>                                        </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall {m :: * -&gt; *} {pu} {v} {x} {t}.
MonadState (Schedule pu v x t) m =&gt;
[Int] -&gt; [Int] -&gt; m ()
</span><a href="NITTA.Utils.ProcessDescription.html#establishVerticalRelations"><span class="hs-identifier hs-var">establishVerticalRelations</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680445823"><span class="hs-identifier hs-var">pID</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map v Int
</span><a href="#local-6989586621680445781"><span class="hs-identifier hs-var">v2transportStepKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map v Int -&gt; v -&gt; Int
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680445835"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-243"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>                                </span><span class="annot"><span class="annottext">(Set v -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; Set v -&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680445834"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-245"></span><span>                        </span><span class="annot"><span class="annottext">Step t (StepInfo v x t)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Bus: process: insternal error&quot;</span></span><span>
</span><span id="line-246"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>                    </span><span class="annot"><span class="annottext">([Step t (StepInfo v x t)]
 -&gt; State (Schedule (BusNetwork tag v x t) v x t) ())
-&gt; [Step t (StepInfo v x t)]
-&gt; State (Schedule (BusNetwork tag v x t) v x t) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Step t (StepInfo v x t) -&gt; Bool)
-&gt; [Step t (StepInfo v x t)] -&gt; [Step t (StepInfo v x t)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">Step t (StepInfo v x t) -&gt; Bool
forall {t1} {v} {x} {t2}. Step t1 (StepInfo v x t2) -&gt; Bool
</span><a href="NITTA.Utils.html#isIntermediate"><span class="hs-identifier hs-var">isIntermediate</span></a></span><span> </span><span class="annot"><span class="annottext">[Step t (StepInfo v x t)]
</span><a href="#local-6989586621680445808"><span class="hs-identifier hs-var">steps</span></a></span><span>
</span><span id="line-248"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Process t (StepInfo v x t)
</span><a href="#local-6989586621680445803"><span class="hs-identifier hs-var">wholeProcess</span></a></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>            </span><span id="local-6989586621680445805"><span class="annot"><span class="annottext">includeNestedProcess :: tag -&gt; u -&gt; m ()
</span><a href="#local-6989586621680445805"><span class="hs-identifier hs-var hs-var">includeNestedProcess</span></a></span></span><span> </span><span id="local-6989586621680445997"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445997"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680445998"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680445998"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span class="hs-special">{</span><span id="local-6989586621680445999"><span class="annot"><span class="annottext">[Step t (StepInfo v x t)]
steps :: forall t i. Process t i -&gt; [Step t i]
steps :: [Step t (StepInfo v x t)]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#steps"><span class="hs-identifier hs-var hs-var">steps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446000"><span class="annot"><span class="annottext">[Relation]
relations :: [Relation]
relations :: forall t i. Process t i -&gt; [Relation]
</span><a href="#local-6989586621680446000"><span class="hs-identifier hs-var hs-var">relations</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">u -&gt; Process t (StepInfo v x t)
forall u v x t.
ProcessorUnit u v x t =&gt;
u -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Model.ProcessorUnits.Types.html#process"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680445998"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-252"></span><span>                </span><span id="local-6989586621680446002"><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680446002"><span class="hs-identifier hs-var">pu2netKey</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-253"></span><span>                    </span><span class="annot"><span class="annottext">[(Int, Int)] -&gt; Map Int Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-254"></span><span>                        </span><span class="annot"><span class="annottext">([(Int, Int)] -&gt; Map Int Int) -&gt; m [(Int, Int)] -&gt; m (Map Int Int)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Step t (StepInfo v x t) -&gt; m (Int, Int))
-&gt; [Step t (StepInfo v x t)] -&gt; m [(Int, Int)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span>
</span><span id="line-255"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680446005"><span class="annot"><span class="annottext">step :: Step t (StepInfo v x t)
</span><a href="#local-6989586621680446005"><span class="hs-identifier hs-var">step</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446006"><span class="annot"><span class="annottext">Int
pID :: forall t i. Step t i -&gt; Int
pID :: Int
</span><a href="NITTA.Model.ProcessorUnits.Types.html#pID"><span class="hs-identifier hs-var hs-var">pID</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>                                </span><span id="local-6989586621680446007"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446007"><span class="hs-identifier hs-var">pID'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">tag -&gt; Step t (StepInfo v x t) -&gt; m Int
forall {m :: * -&gt; *} {pu} {v} {x} {t} {tag}.
(MonadState (Schedule pu v x t) m, UnitTag tag) =&gt;
tag -&gt; Step t (StepInfo v x t) -&gt; m Int
</span><a href="NITTA.Utils.ProcessDescription.html#scheduleNestedStep"><span class="hs-identifier hs-var">scheduleNestedStep</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680445997"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Step t (StepInfo v x t)
</span><a href="#local-6989586621680446005"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-257"></span><span>                                </span><span class="annot"><span class="annottext">(Int, Int) -&gt; m (Int, Int)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446006"><span class="hs-identifier hs-var">pID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446007"><span class="hs-identifier hs-var">pID'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>                            </span><span class="annot"><span class="annottext">[Step t (StepInfo v x t)]
</span><a href="#local-6989586621680445999"><span class="hs-identifier hs-var">steps</span></a></span><span>
</span><span id="line-260"></span><span>                </span><span class="annot"><span class="annottext">(Relation -&gt; m ()) -&gt; [Relation] -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span>
</span><span id="line-261"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-262"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Vertical"><span class="hs-identifier hs-type">Vertical</span></a></span><span> </span><span id="local-6989586621680446010"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446010"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680446011"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446011"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; m ()
forall {m :: * -&gt; *} {pu} {v} {x} {t}.
MonadState (Schedule pu v x t) m =&gt;
[Int] -&gt; [Int] -&gt; m ()
</span><a href="NITTA.Utils.ProcessDescription.html#establishVerticalRelations"><span class="hs-identifier hs-var">establishVerticalRelations</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680446002"><span class="hs-identifier hs-var">pu2netKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int -&gt; Int -&gt; Int
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446010"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680446002"><span class="hs-identifier hs-var">pu2netKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int -&gt; Int -&gt; Int
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446011"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-263"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Horizontal"><span class="hs-identifier hs-type">Horizontal</span></a></span><span> </span><span id="local-6989586621680446013"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446013"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621680446014"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446014"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; m ()
forall {m :: * -&gt; *} {pu} {v} {x} {t}.
MonadState (Schedule pu v x t) m =&gt;
[Int] -&gt; [Int] -&gt; m ()
</span><a href="NITTA.Utils.ProcessDescription.html#establishHorizontalRelations"><span class="hs-identifier hs-var">establishHorizontalRelations</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680446002"><span class="hs-identifier hs-var">pu2netKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int -&gt; Int -&gt; Int
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446013"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Map Int Int
</span><a href="#local-6989586621680446002"><span class="hs-identifier hs-var">pu2netKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Int -&gt; Int -&gt; Int
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446014"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-264"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                    </span><span class="annot"><span class="annottext">[Relation]
</span><a href="#local-6989586621680446000"><span class="hs-identifier hs-var">relations</span></a></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621680446018"><span class="annot"><span class="annottext">parallelismType :: BusNetwork tag v x t -&gt; ParallelismType
</span><a href="#local-6989586621680446018"><span class="hs-identifier hs-var hs-var hs-var hs-var">parallelismType</span></a></span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ParallelismType
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; not support parallelismType for BusNetwork&quot;</span></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621680446024"><span class="annot"><span class="annottext">puSize :: BusNetwork tag v x t -&gt; Float
</span><a href="#local-6989586621680446024"><span class="hs-identifier hs-var hs-var hs-var hs-var">puSize</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446026"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Float] -&gt; Float
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Float] -&gt; Float) -&gt; [Float] -&gt; Float
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PU v x t -&gt; Float) -&gt; [PU v x t] -&gt; [Float]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; Float
forall u v x t. ProcessorUnit u v x t =&gt; u -&gt; Float
</span><a href="NITTA.Model.ProcessorUnits.Types.html#puSize"><span class="hs-identifier hs-var">puSize</span></a></span><span> </span><span class="annot"><span class="annottext">([PU v x t] -&gt; [Float]) -&gt; [PU v x t] -&gt; [Float]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [PU v x t]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446026"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444776"><span id="local-6989586621680444777"><span id="local-6989586621680444778"><span id="local-6989586621680444779"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Controllable"><span class="hs-identifier hs-type">Controllable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444776"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444777"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444778"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444779"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-keyword">data</span><span> </span><span id="Instruction"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Instruction"><span class="hs-identifier hs-var">Instruction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444776"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444777"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444778"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444779"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="Transport"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#Transport"><span class="hs-identifier hs-var">Transport</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680444777"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444776"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444776"><span class="hs-identifier hs-type">tag</span></a></span><span>
</span><span id="line-274"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-keyword">data</span><span> </span><span id="Microcode"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Microcode"><span class="hs-identifier hs-var">Microcode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444776"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444777"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444778"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444779"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span id="BusNetworkMC"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetworkMC"><span class="hs-identifier hs-var">BusNetworkMC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#SignalTag"><span class="hs-identifier hs-type">SignalTag</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#SignalValue"><span class="hs-identifier hs-type">SignalValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-comment">-- Right now, BusNetwork don't have external control (exclude rst signal and some hacks). All</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-comment">-- signals starts and ends inside network unit.</span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621680446034"><span class="annot"><span class="annottext">zipSignalTagsAndValues :: Ports (BusNetwork tag v x t)
-&gt; Microcode (BusNetwork tag v x t) -&gt; [(SignalTag, SignalValue)]
</span><a href="#local-6989586621680446034"><span class="hs-identifier hs-var hs-var hs-var hs-var">zipSignalTagsAndValues</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ports (BusNetwork tag v x t)
R:PortsBusNetwork tag v x t
</span><a href="NITTA.Model.Networks.Bus.html#BusNetworkPorts"><span class="hs-identifier hs-var">BusNetworkPorts</span></a></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetworkMC"><span class="hs-identifier hs-type">BusNetworkMC</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621680446039"><span class="annot"><span class="annottext">usedPortTags :: Ports (BusNetwork tag v x t) -&gt; [SignalTag]
</span><a href="#local-6989586621680446039"><span class="hs-identifier hs-var hs-var hs-var hs-var">usedPortTags</span></a></span></span><span> </span><span class="annot"><span class="annottext">Ports (BusNetwork tag v x t)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [SignalTag]
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span>    </span><span id="local-6989586621680446043"><span class="annot"><span class="annottext">takePortTags :: [SignalTag] -&gt; BusNetwork tag v x t -&gt; Ports (BusNetwork tag v x t)
</span><a href="#local-6989586621680446043"><span class="hs-identifier hs-var hs-var hs-var hs-var">takePortTags</span></a></span></span><span> </span><span class="annot"><span class="annottext">[SignalTag]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Ports (BusNetwork tag v x t)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444584"><span id="local-6989586621680444585"><span id="local-6989586621680444586"><span id="local-6989586621680444587"><span id="local-6989586621680446048"><span id="local-6989586621680446052"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToString</span></span><span> </span><span class="annot"><a href="#local-6989586621680444584"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444585"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Instruction"><span class="hs-identifier hs-type">Instruction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444584"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444585"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444586"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444587"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621680446069"><span class="annot"><span class="annottext">show :: Instruction (BusNetwork tag v x t) -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#Transport"><span class="hs-identifier hs-type">Transport</span></a></span><span> </span><span id="local-6989586621680446070"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446070"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680446071"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446071"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621680446072"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446072"><span class="hs-identifier hs-var">trg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Transport &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446070"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446071"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446072"><span class="hs-identifier hs-var">trg</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPS</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span id="local-6989586621680444795"><span id="local-6989586621680444796"><span id="local-6989586621680444797"><span id="local-6989586621680444798"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#ByTime"><span class="hs-identifier hs-type">ByTime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444795"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444796"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444797"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444798"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444798"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621680446094"><span class="annot"><span class="annottext">microcodeAt :: BusNetwork tag v x t -&gt; t -&gt; Microcode (BusNetwork tag v x t)
</span><a href="#local-6989586621680446094"><span class="hs-identifier hs-var hs-var hs-var hs-var">microcodeAt</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446096"><span id="local-6989586621680446097"><span id="local-6989586621680446098"><span id="local-6989586621680446099"><span id="local-6989586621680446100"><span id="local-6989586621680446101"><span id="local-6989586621680446102"><span id="local-6989586621680446103"><span id="local-6989586621680446104"><span class="annot"><span class="annottext">tag
Int
[F v x]
Map tag [F v x]
Map tag (PUPrototype tag v x t)
Map tag (PU v x t)
Process t (StepInfo v x t)
UnitEnv (BusNetwork tag v x t)
IOSynchronization
bnName :: forall tag v x t. BusNetwork tag v x t -&gt; tag
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnSignalBusWidth :: forall tag v x t. BusNetwork tag v x t -&gt; Int
ioSync :: forall tag v x t. BusNetwork tag v x t -&gt; IOSynchronization
bnEnv :: forall tag v x t.
BusNetwork tag v x t -&gt; UnitEnv (BusNetwork tag v x t)
bnPUPrototypes :: forall tag v x t.
BusNetwork tag v x t -&gt; Map tag (PUPrototype tag v x t)
bnName :: tag
bnRemains :: [F v x]
bnBound :: Map tag [F v x]
bnProcess :: Process t (StepInfo v x t)
bnPus :: Map tag (PU v x t)
bnSignalBusWidth :: Int
ioSync :: IOSynchronization
bnEnv :: UnitEnv (BusNetwork tag v x t)
bnPUPrototypes :: Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnName"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680446105"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680446105"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>        </span><span class="annot"><span class="annottext">Map SignalTag SignalValue -&gt; Microcode (BusNetwork tag v x t)
forall tag v x t.
Map SignalTag SignalValue -&gt; Microcode (BusNetwork tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#BusNetworkMC"><span class="hs-identifier hs-var">BusNetworkMC</span></a></span><span> </span><span class="annot"><span class="annottext">(Map SignalTag SignalValue -&gt; Microcode (BusNetwork tag v x t))
-&gt; Map SignalTag SignalValue -&gt; Microcode (BusNetwork tag v x t)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Map SignalTag SignalValue
 -&gt; PU v x t -&gt; Map SignalTag SignalValue)
-&gt; Map SignalTag SignalValue
-&gt; [PU v x t]
-&gt; Map SignalTag SignalValue
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Map SignalTag SignalValue -&gt; PU v x t -&gt; Map SignalTag SignalValue
</span><a href="#local-6989586621680446106"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">Map SignalTag SignalValue
</span><a href="#local-6989586621680446107"><span class="hs-identifier hs-var">initSt</span></a></span><span> </span><span class="annot"><span class="annottext">([PU v x t] -&gt; Map SignalTag SignalValue)
-&gt; [PU v x t] -&gt; Map SignalTag SignalValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [PU v x t]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446100"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-294"></span><span>            </span><span id="local-6989586621680446107"><span class="annot"><span class="annottext">initSt :: Map SignalTag SignalValue
</span><a href="#local-6989586621680446107"><span class="hs-identifier hs-var hs-var">initSt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SignalTag, SignalValue)] -&gt; Map SignalTag SignalValue
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(SignalTag, SignalValue)] -&gt; Map SignalTag SignalValue)
-&gt; [(SignalTag, SignalValue)] -&gt; Map SignalTag SignalValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (SignalTag, SignalValue))
-&gt; [Int] -&gt; [(SignalTag, SignalValue)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680446108"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446108"><span class="hs-identifier hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SignalTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#SignalTag"><span class="hs-identifier hs-var">SignalTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SignalTag) -&gt; Text -&gt; SignalTag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall {final} {src}.
Interpolatable (IsCustomSink final) src final =&gt;
src -&gt; final
</span><a href="NITTA.Model.Networks.Bus.html#controlSignalLiteral"><span class="hs-identifier hs-var">controlSignalLiteral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446108"><span class="hs-identifier hs-var">ins</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SignalValue
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446101"><span class="hs-identifier hs-var">bnSignalBusWidth</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span>            </span><span id="local-6989586621680446106"><span class="annot"><span class="annottext">merge :: Map SignalTag SignalValue -&gt; PU v x t -&gt; Map SignalTag SignalValue
</span><a href="#local-6989586621680446106"><span class="hs-identifier hs-var hs-var">merge</span></a></span></span><span> </span><span id="local-6989586621680446110"><span class="annot"><span class="annottext">Map SignalTag SignalValue
</span><a href="#local-6989586621680446110"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PU"><span class="hs-identifier hs-type">PU</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446119"><span class="annot"><span class="annottext">pu
unit :: pu
unit :: ()
</span><a href="#local-6989586621680446119"><span class="hs-keyword hs-var hs-var">unit</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">uEnv :: ()
</span><a href="NITTA.Model.Networks.Types.html#uEnv"><span class="hs-identifier hs-var">uEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ctrlPorts :: forall m. UnitEnv m -&gt; Maybe (Ports m)
</span><a href="NITTA.Project.Types.html#ctrlPorts"><span class="hs-identifier hs-var">ctrlPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680446124"><span class="annot"><span class="annottext">Ports pu
</span><a href="#local-6989586621680446124"><span class="hs-identifier hs-var">ports</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>                </span><span class="annot"><span class="annottext">(Map SignalTag SignalValue
 -&gt; (SignalTag, SignalValue) -&gt; Map SignalTag SignalValue)
-&gt; Map SignalTag SignalValue
-&gt; [(SignalTag, SignalValue)]
-&gt; Map SignalTag SignalValue
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">Map SignalTag SignalValue
-&gt; (SignalTag, SignalValue) -&gt; Map SignalTag SignalValue
forall {k}.
Ord k =&gt;
Map k SignalValue -&gt; (k, SignalValue) -&gt; Map k SignalValue
</span><a href="#local-6989586621680446125"><span class="hs-identifier hs-var">merge'</span></a></span><span> </span><span class="annot"><span class="annottext">Map SignalTag SignalValue
</span><a href="#local-6989586621680446110"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">([(SignalTag, SignalValue)] -&gt; Map SignalTag SignalValue)
-&gt; [(SignalTag, SignalValue)] -&gt; Map SignalTag SignalValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ports pu -&gt; Microcode pu -&gt; [(SignalTag, SignalValue)]
forall pu.
Controllable pu =&gt;
Ports pu -&gt; Microcode pu -&gt; [(SignalTag, SignalValue)]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#zipSignalTagsAndValues"><span class="hs-identifier hs-var">zipSignalTagsAndValues</span></a></span><span> </span><span class="annot"><span class="annottext">Ports pu
</span><a href="#local-6989586621680446124"><span class="hs-identifier hs-var">ports</span></a></span><span> </span><span class="annot"><span class="annottext">(Microcode pu -&gt; [(SignalTag, SignalValue)])
-&gt; Microcode pu -&gt; [(SignalTag, SignalValue)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">pu -&gt; t -&gt; Microcode pu
forall pu t. ByTime pu t =&gt; pu -&gt; t -&gt; Microcode pu
</span><a href="NITTA.Model.ProcessorUnits.Types.html#microcodeAt"><span class="hs-identifier hs-var">microcodeAt</span></a></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680446119"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680446105"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-298"></span><span>            </span><span class="annot"><a href="#local-6989586621680446106"><span class="hs-identifier hs-var">merge</span></a></span><span> </span><span class="annot"><span class="annottext">Map SignalTag SignalValue
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Map SignalTag SignalValue
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span>            </span><span id="local-6989586621680446125"><span class="annot"><span class="annottext">merge' :: Map k SignalValue -&gt; (k, SignalValue) -&gt; Map k SignalValue
</span><a href="#local-6989586621680446125"><span class="hs-identifier hs-var hs-var">merge'</span></a></span></span><span> </span><span id="local-6989586621680446130"><span class="annot"><span class="annottext">Map k SignalValue
</span><a href="#local-6989586621680446130"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446131"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680446131"><span class="hs-identifier hs-var">signalTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446132"><span class="annot"><span class="annottext">SignalValue
</span><a href="#local-6989586621680446132"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SignalValue -&gt; SignalValue)
-&gt; k -&gt; Map k SignalValue -&gt; Map k SignalValue
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SignalValue -&gt; SignalValue -&gt; SignalValue
</span><a href="NITTA.Model.ProcessorUnits.Types.html#%2B%2B%2B"><span class="hs-operator hs-var">+++</span></a></span><span> </span><span class="annot"><span class="annottext">SignalValue
</span><a href="#local-6989586621680446132"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680446131"><span class="hs-identifier hs-var">signalTag</span></a></span><span> </span><span class="annot"><span class="annottext">Map k SignalValue
</span><a href="#local-6989586621680446130"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">----------------------------------------------------------------------</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span id="local-6989586621680444805"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#cartesianProduct"><span class="hs-identifier hs-type">cartesianProduct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680444805"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621680444805"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span></span><span>
</span><span id="line-305"></span><span id="cartesianProduct"><span class="annot"><span class="annottext">cartesianProduct :: forall a. [[a]] -&gt; [[a]]
</span><a href="NITTA.Model.Networks.Bus.html#cartesianProduct"><span class="hs-identifier hs-var hs-var">cartesianProduct</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-306"></span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#cartesianProduct"><span class="hs-identifier hs-var">cartesianProduct</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446135"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680446135"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680446136"><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621680446136"><span class="hs-identifier hs-var">xss</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446137"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680446138"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680446137"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446137"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680446135"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446138"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680446138"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[a]] -&gt; [[a]]
forall a. [[a]] -&gt; [[a]]
</span><a href="NITTA.Model.Networks.Bus.html#cartesianProduct"><span class="hs-identifier hs-var">cartesianProduct</span></a></span><span> </span><span class="annot"><span class="annottext">[[a]]
</span><a href="#local-6989586621680446136"><span class="hs-identifier hs-var">xss</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="annot"><span class="hs-comment">{- | Not all bindings can be applied to unit a the same time. E.g.:

- @b = reg(a)@
- @c = reg(b)@

Can't be bound to same unit because it require self sending of data.

In this case, we just throw away conflicted bindings.
-}</span></span><span>
</span><span id="line-317"></span><span id="local-6989586621680444807"><span id="local-6989586621680444808"><span id="local-6989586621680444809"><span id="local-6989586621680444810"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#fixGroupBinding"><span class="hs-identifier hs-type">fixGroupBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444807"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444808"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444809"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444810"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444807"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444808"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444809"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444810"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680444807"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444808"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444809"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680444807"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444808"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444809"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-318"></span><span id="fixGroupBinding"><span class="annot"><span class="annottext">fixGroupBinding :: forall tag v x t.
(UnitTag tag, VarValTime v x t) =&gt;
BusNetwork tag v x t -&gt; [(tag, F v x)] -&gt; [(tag, F v x)]
</span><a href="NITTA.Model.Networks.Bus.html#fixGroupBinding"><span class="hs-identifier hs-var hs-var">fixGroupBinding</span></a></span></span><span> </span><span id="local-6989586621680446151"><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446151"><span class="hs-identifier hs-var">_bn</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-319"></span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#fixGroupBinding"><span class="hs-identifier hs-var">fixGroupBinding</span></a></span><span> </span><span id="local-6989586621680446152"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446152"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446153"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446154"><span class="annot"><span class="annottext">b :: (tag, F v x)
</span><a href="#local-6989586621680446154"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621680446155"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446155"><span class="hs-identifier hs-var">uTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446156"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680446156"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680446157"><span class="annot"><span class="annottext">[(tag, F v x)]
</span><a href="#local-6989586621680446157"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">F v x -&gt; PU v x t -&gt; Either [Char] (PU v x t)
forall u v x t.
ProcessorUnit u v x t =&gt;
F v x -&gt; u -&gt; Either [Char] u
</span><a href="NITTA.Model.ProcessorUnits.Types.html#tryBind"><span class="hs-identifier hs-var">tryBind</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680446156"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446153"><span class="hs-identifier hs-var">bnPus</span></a></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; tag -&gt; PU v x t
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446155"><span class="hs-identifier hs-var">uTag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(tag, F v x)
</span><a href="#local-6989586621680446154"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(tag, F v x) -&gt; [(tag, F v x)] -&gt; [(tag, F v x)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; [(tag, F v x)] -&gt; [(tag, F v x)]
forall tag v x t.
(UnitTag tag, VarValTime v x t) =&gt;
BusNetwork tag v x t -&gt; [(tag, F v x)] -&gt; [(tag, F v x)]
</span><a href="NITTA.Model.Networks.Bus.html#fixGroupBinding"><span class="hs-identifier hs-var">fixGroupBinding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; Bind tag v x -&gt; BusNetwork tag v x t
forall u tag v x. BindProblem u tag v x =&gt; u -&gt; Bind tag v x -&gt; u
</span><a href="NITTA.Model.Problems.Bind.html#bindDecision"><span class="hs-identifier hs-var">bindDecision</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446152"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">(Bind tag v x -&gt; BusNetwork tag v x t)
-&gt; Bind tag v x -&gt; BusNetwork tag v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; F v x -&gt; Bind tag v x
forall tag v x. tag -&gt; F v x -&gt; Bind tag v x
</span><a href="NITTA.Model.Problems.Bind.html#SingleBind"><span class="hs-identifier hs-var">SingleBind</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446155"><span class="hs-identifier hs-var">uTag</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680446156"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)]
</span><a href="#local-6989586621680446157"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; [(tag, F v x)] -&gt; [(tag, F v x)]
forall tag v x t.
(UnitTag tag, VarValTime v x t) =&gt;
BusNetwork tag v x t -&gt; [(tag, F v x)] -&gt; [(tag, F v x)]
</span><a href="NITTA.Model.Networks.Bus.html#fixGroupBinding"><span class="hs-identifier hs-var">fixGroupBinding</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446152"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)]
</span><a href="#local-6989586621680446157"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span id="mergeFunctionWithSameType"><span class="annot"><span class="annottext">mergeFunctionWithSameType :: Bool
</span><a href="NITTA.Model.Networks.Bus.html#mergeFunctionWithSameType"><span class="hs-identifier hs-var hs-var">mergeFunctionWithSameType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="annot"><span class="hs-comment">{- | GroupBindHash required to find equal from task point of view bindings.
E.g. (we have 2 units and 3 functions with the same type):
@u1 &lt;- f1, f2, f3; u2 &lt;- _ === u1 &lt;- _; u2 &lt;-  f1, f2, f3@ because all
task will performing by one unit and it is not matter which one.

Corner cases:

- not all group binding are correct (e.g. self sending)

- we can't wait that unit is empty

- Combination like: `u1 &lt;- f1, f2; u2 &lt;- f3 !== u1 &lt;- f1, f3; u2 &lt;- f2` are not
  equal because we don't take into accout their place in DFG.
-}</span></span><span>
</span><span id="line-339"></span><span id="local-6989586621680444828"><span id="local-6989586621680444829"><span id="local-6989586621680444830"><span id="local-6989586621680444831"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bindsHash"><span class="hs-identifier hs-type">bindsHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444828"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444828"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444829"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444830"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444831"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680444828"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444829"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444830"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRep</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-340"></span><span id="bindsHash"><span class="annot"><span class="annottext">bindsHash :: forall k v x t.
UnitTag k =&gt;
BusNetwork k v x t
-&gt; [(k, F v x)] -&gt; Set (TypeRep, Int, Set [Char])
</span><a href="NITTA.Model.Networks.Bus.html#bindsHash"><span class="hs-identifier hs-var hs-var">bindsHash</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446192"><span class="annot"><span class="annottext">Map k (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map k (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446193"><span class="annot"><span class="annottext">Map k [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map k [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680446194"><span class="annot"><span class="annottext">[(k, F v x)]
</span><a href="#local-6989586621680446194"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680446195"><span class="annot"><span class="annottext">distribution :: Map k [F v x]
</span><a href="#local-6989586621680446195"><span class="hs-identifier hs-var hs-var">distribution</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(k, F v x)] -&gt; Map k [F v x]
forall tag v x. UnitTag tag =&gt; [(tag, F v x)] -&gt; Map tag [F v x]
</span><a href="NITTA.Model.Problems.Bind.html#binds2bindGroup"><span class="hs-identifier hs-var">binds2bindGroup</span></a></span><span> </span><span class="annot"><span class="annottext">[(k, F v x)]
</span><a href="#local-6989586621680446194"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-342"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(TypeRep, Int, Set [Char])] -&gt; Set (TypeRep, Int, Set [Char])
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><span class="annottext">([(TypeRep, Int, Set [Char])] -&gt; Set (TypeRep, Int, Set [Char]))
-&gt; [(TypeRep, Int, Set [Char])] -&gt; Set (TypeRep, Int, Set [Char])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((k, [F v x]) -&gt; (TypeRep, Int, Set [Char]))
-&gt; [(k, [F v x])] -&gt; [(TypeRep, Int, Set [Char])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-344"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680446198"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680446198"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446199"><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446199"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-345"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680446200"><span class="annot"><span class="annottext">u :: PU v x t
</span><a href="#local-6989586621680446200"><span class="hs-identifier hs-var hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map k (PU v x t)
</span><a href="#local-6989586621680446192"><span class="hs-identifier hs-var">bnPus</span></a></span><span> </span><span class="annot"><span class="annottext">Map k (PU v x t) -&gt; k -&gt; PU v x t
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680446198"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-346"></span><span>                        </span><span id="local-6989586621680446201"><span class="annot"><span class="annottext">bound :: Int
</span><a href="#local-6989586621680446201"><span class="hs-identifier hs-var hs-var">bound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ([F v x] -&gt; Int) -&gt; Maybe [F v x] -&gt; Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">[F v x] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [F v x] -&gt; Int) -&gt; Maybe [F v x] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map k [F v x]
</span><a href="#local-6989586621680446193"><span class="hs-identifier hs-var">bnBound</span></a></span><span> </span><span class="annot"><span class="annottext">Map k [F v x] -&gt; k -&gt; Maybe [F v x]
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; Maybe a
</span><span class="hs-operator hs-var">M.!?</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680446198"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-347"></span><span>                        </span><span id="local-6989586621680446203"><span class="annot"><span class="annottext">fs' :: Set [Char]
</span><a href="#local-6989586621680446203"><span class="hs-identifier hs-var hs-var">fs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>                            </span><span class="annot"><span class="annottext">[[Char]] -&gt; Set [Char]
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; Set [Char]) -&gt; [[Char]] -&gt; Set [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-349"></span><span>                                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="NITTA.Model.Networks.Bus.html#mergeFunctionWithSameType"><span class="hs-identifier hs-var">mergeFunctionWithSameType</span></a></span><span>
</span><span id="line-350"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- TODO: merge only functions without</span><span>
</span><span id="line-351"></span><span>                                    </span><span class="hs-comment">-- inputs, because they are equal from</span><span>
</span><span id="line-352"></span><span>                                    </span><span class="hs-comment">-- scheduling point of view</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span>                                        </span><span class="hs-comment">-- TODO: other way to reduce number of</span><span>
</span><span id="line-355"></span><span>                                        </span><span class="hs-comment">-- combinations</span><span>
</span><span id="line-356"></span><span>                                        </span><span class="annot"><span class="annottext">([TypeRep] -&gt; [Char]) -&gt; [[TypeRep]] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TypeRep, Int) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">((TypeRep, Int) -&gt; [Char])
-&gt; ([TypeRep] -&gt; (TypeRep, Int)) -&gt; [TypeRep] -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680446204"><span class="annot"><span class="annottext">[TypeRep]
</span><a href="#local-6989586621680446204"><span class="hs-identifier hs-var">lst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeRep] -&gt; TypeRep
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[TypeRep]
</span><a href="#local-6989586621680446204"><span class="hs-identifier hs-var">lst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TypeRep] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[TypeRep]
</span><a href="#local-6989586621680446204"><span class="hs-identifier hs-var">lst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TypeRep] -&gt; [[TypeRep]]
forall a. Eq a =&gt; [a] -&gt; [[a]]
</span><span class="hs-identifier hs-var">L.group</span></span><span> </span><span class="annot"><span class="annottext">([TypeRep] -&gt; [[TypeRep]]) -&gt; [TypeRep] -&gt; [[TypeRep]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(F v x -&gt; TypeRep) -&gt; [F v x] -&gt; [TypeRep]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; TypeRep
forall v x. F v x -&gt; TypeRep
</span><a href="NITTA.Intermediate.Types.html#functionType"><span class="hs-identifier hs-var">functionType</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446199"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(F v x -&gt; [Char]) -&gt; [F v x] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446199"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-358"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PU v x t -&gt; TypeRep
forall v x t. PU v x t -&gt; TypeRep
</span><a href="NITTA.Model.Networks.Types.html#unitType"><span class="hs-identifier hs-var">unitType</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446200"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446201"><span class="hs-identifier hs-var">bound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set [Char]
</span><a href="#local-6989586621680446203"><span class="hs-identifier hs-var">fs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>            </span><span class="annot"><span class="annottext">([(k, [F v x])] -&gt; [(TypeRep, Int, Set [Char])])
-&gt; [(k, [F v x])] -&gt; [(TypeRep, Int, Set [Char])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map k [F v x] -&gt; [(k, [F v x])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map k [F v x]
</span><a href="#local-6989586621680446195"><span class="hs-identifier hs-var">distribution</span></a></span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span id="local-6989586621680444856"><span id="local-6989586621680444857"><span id="local-6989586621680444858"><span id="local-6989586621680444859"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#nubNotObviousBinds"><span class="hs-identifier hs-type">nubNotObviousBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444856"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444856"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444857"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444858"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444859"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680444856"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444857"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444858"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680444856"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444857"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444858"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-363"></span><span id="nubNotObviousBinds"><span class="annot"><span class="annottext">nubNotObviousBinds :: forall k v x t.
UnitTag k =&gt;
BusNetwork k v x t -&gt; [[(k, F v x)]] -&gt; [[(k, F v x)]]
</span><a href="NITTA.Model.Networks.Bus.html#nubNotObviousBinds"><span class="hs-identifier hs-var hs-var">nubNotObviousBinds</span></a></span></span><span> </span><span id="local-6989586621680446219"><span class="annot"><span class="annottext">BusNetwork k v x t
</span><a href="#local-6989586621680446219"><span class="hs-identifier hs-var">bn</span></a></span></span><span> </span><span id="local-6989586621680446220"><span class="annot"><span class="annottext">[[(k, F v x)]]
</span><a href="#local-6989586621680446220"><span class="hs-identifier hs-var">bindss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680446221"><span class="annot"><span class="annottext">hashed :: [(Set (TypeRep, Int, Set [Char]), [(k, F v x)])]
</span><a href="#local-6989586621680446221"><span class="hs-identifier hs-var hs-var">hashed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(k, F v x)] -&gt; (Set (TypeRep, Int, Set [Char]), [(k, F v x)]))
-&gt; [[(k, F v x)]]
-&gt; [(Set (TypeRep, Int, Set [Char]), [(k, F v x)])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680446222"><span class="annot"><span class="annottext">[(k, F v x)]
</span><a href="#local-6989586621680446222"><span class="hs-identifier hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BusNetwork k v x t
-&gt; [(k, F v x)] -&gt; Set (TypeRep, Int, Set [Char])
forall k v x t.
UnitTag k =&gt;
BusNetwork k v x t
-&gt; [(k, F v x)] -&gt; Set (TypeRep, Int, Set [Char])
</span><a href="NITTA.Model.Networks.Bus.html#bindsHash"><span class="hs-identifier hs-var">bindsHash</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork k v x t
</span><a href="#local-6989586621680446219"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">[(k, F v x)]
</span><a href="#local-6989586621680446222"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(k, F v x)]
</span><a href="#local-6989586621680446222"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(k, F v x)]]
</span><a href="#local-6989586621680446220"><span class="hs-identifier hs-var">bindss</span></a></span><span>
</span><span id="line-365"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Map (Set (TypeRep, Int, Set [Char])) [(k, F v x)] -&gt; [[(k, F v x)]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map (Set (TypeRep, Int, Set [Char])) [(k, F v x)]
 -&gt; [[(k, F v x)]])
-&gt; Map (Set (TypeRep, Int, Set [Char])) [(k, F v x)]
-&gt; [[(k, F v x)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Set (TypeRep, Int, Set [Char]), [(k, F v x)])]
-&gt; Map (Set (TypeRep, Int, Set [Char])) [(k, F v x)]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Set (TypeRep, Int, Set [Char]), [(k, F v x)])]
</span><a href="#local-6989586621680446221"><span class="hs-identifier hs-var">hashed</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-368"></span><span>    </span><span id="local-6989586621680444816"><span id="local-6989586621680444817"><span id="local-6989586621680444818"><span id="local-6989586621680444819"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444816"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444817"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444818"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444819"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><a href="NITTA.Model.Problems.Bind.html#BindProblem"><span class="hs-identifier hs-type">BindProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444816"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444817"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444818"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444819"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444816"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444817"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444818"><span class="hs-identifier hs-type">x</span></a></span></span></span></span></span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621680446251"><span class="annot"><span class="annottext">bindOptions :: BusNetwork tag v x t -&gt; [Bind tag v x]
</span><a href="#local-6989586621680446251"><span class="hs-identifier hs-var hs-var hs-var hs-var">bindOptions</span></a></span></span><span> </span><span id="local-6989586621680446253"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446253"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446254"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446255"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680446256"><span class="annot"><span class="annottext">binds :: [[(tag, F v x)]]
</span><a href="#local-6989586621680446256"><span class="hs-identifier hs-var hs-var">binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(F v x -&gt; [(tag, F v x)]) -&gt; [F v x] -&gt; [[(tag, F v x)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; [(tag, F v x)]
</span><a href="#local-6989586621680446257"><span class="hs-identifier hs-var">optionsFor</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446254"><span class="hs-identifier hs-var">bnRemains</span></a></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>            </span><span class="hs-comment">-- obvious mean we have only one option to bind function</span><span>
</span><span id="line-375"></span><span>            </span><span id="local-6989586621680446258"><span class="annot"><span class="annottext">obviousBinds :: [(tag, F v x)]
</span><a href="#local-6989586621680446258"><span class="hs-identifier hs-var hs-var">obviousBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(tag, F v x)]] -&gt; [(tag, F v x)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(tag, F v x)]] -&gt; [(tag, F v x)])
-&gt; [[(tag, F v x)]] -&gt; [(tag, F v x)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([(tag, F v x)] -&gt; Bool) -&gt; [[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; ([(tag, F v x)] -&gt; Int) -&gt; [(tag, F v x)] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(tag, F v x)]]
</span><a href="#local-6989586621680446256"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-376"></span><span>            </span><span id="local-6989586621680446259"><span class="annot"><span class="annottext">singleAssingmentBinds :: [Bind tag v x]
</span><a href="#local-6989586621680446259"><span class="hs-identifier hs-var hs-var">singleAssingmentBinds</span></a></span></span><span>
</span><span id="line-377"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)]
</span><a href="#local-6989586621680446258"><span class="hs-identifier hs-var">obviousBinds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-378"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Bool -&gt; Map tag [F v x] -&gt; Bind tag v x
forall tag v x. Bool -&gt; Map tag [F v x] -&gt; Bind tag v x
</span><a href="NITTA.Model.Problems.Bind.html#GroupBind"><span class="hs-identifier hs-var">GroupBind</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(Map tag [F v x] -&gt; Bind tag v x)
-&gt; Map tag [F v x] -&gt; Bind tag v x
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)] -&gt; Map tag [F v x]
forall tag v x. UnitTag tag =&gt; [(tag, F v x)] -&gt; Map tag [F v x]
</span><a href="NITTA.Model.Problems.Bind.html#binds2bindGroup"><span class="hs-identifier hs-var">binds2bindGroup</span></a></span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)]
</span><a href="#local-6989586621680446258"><span class="hs-identifier hs-var">obviousBinds</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>            </span><span class="annot"><a href="#local-6989586621680446261"><span class="hs-identifier hs-type">notObviousBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680444816"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#F"><span class="hs-identifier hs-type">F</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444817"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444818"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-381"></span><span>            </span><span id="local-6989586621680446261"><span class="annot"><span class="annottext">notObviousBinds :: [[(tag, F v x)]]
</span><a href="#local-6989586621680446261"><span class="hs-identifier hs-var hs-var">notObviousBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(tag, F v x)] -&gt; Bool) -&gt; [[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; ([(tag, F v x)] -&gt; Int) -&gt; [(tag, F v x)] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(tag, F v x)]]
</span><a href="#local-6989586621680446256"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-382"></span><span>            </span><span class="hs-comment">-- TODO: split them on independent bindGroups. It should</span><span>
</span><span id="line-383"></span><span>            </span><span class="hs-comment">-- significantly reduce complexity.</span><span>
</span><span id="line-384"></span><span>            </span><span class="annot"><a href="#local-6989586621680446262"><span class="hs-identifier hs-type">multiBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.Model.Problems.Bind.html#Bind"><span class="hs-identifier hs-type">Bind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444816"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444817"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444818"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-385"></span><span>            </span><span id="local-6989586621680446262"><span class="annot"><span class="annottext">multiBinds :: [Bind tag v x]
</span><a href="#local-6989586621680446262"><span class="hs-identifier hs-var hs-var">multiBinds</span></a></span></span><span>
</span><span id="line-386"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[[(tag, F v x)]] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[[(tag, F v x)]]
</span><a href="#local-6989586621680446261"><span class="hs-identifier hs-var">notObviousBinds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-387"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-388"></span><span>                    </span><span class="annot"><span class="annottext">([(tag, F v x)] -&gt; Bind tag v x)
-&gt; [[(tag, F v x)]] -&gt; [Bind tag v x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Map tag [F v x] -&gt; Bind tag v x
forall tag v x. Bool -&gt; Map tag [F v x] -&gt; Bind tag v x
</span><a href="NITTA.Model.Problems.Bind.html#GroupBind"><span class="hs-identifier hs-var">GroupBind</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Map tag [F v x] -&gt; Bind tag v x)
-&gt; ([(tag, F v x)] -&gt; Map tag [F v x])
-&gt; [(tag, F v x)]
-&gt; Bind tag v x
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)] -&gt; Map tag [F v x]
forall tag v x. UnitTag tag =&gt; [(tag, F v x)] -&gt; Map tag [F v x]
</span><a href="NITTA.Model.Problems.Bind.html#binds2bindGroup"><span class="hs-identifier hs-var">binds2bindGroup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[(tag, F v x)]] -&gt; [Bind tag v x])
-&gt; [[(tag, F v x)]] -&gt; [Bind tag v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-389"></span><span>                        </span><span class="annot"><span class="annottext">([(tag, F v x)] -&gt; Bool) -&gt; [[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; ([(tag, F v x)] -&gt; Int) -&gt; [(tag, F v x)] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(tag, F v x)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[(tag, F v x)]] -&gt; [[(tag, F v x)]])
-&gt; [[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-390"></span><span>                            </span><span class="annot"><span class="annottext">([(tag, F v x)] -&gt; [(tag, F v x)])
-&gt; [[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; [(tag, F v x)] -&gt; [(tag, F v x)]
forall tag v x t.
(UnitTag tag, VarValTime v x t) =&gt;
BusNetwork tag v x t -&gt; [(tag, F v x)] -&gt; [(tag, F v x)]
</span><a href="NITTA.Model.Networks.Bus.html#fixGroupBinding"><span class="hs-identifier hs-var">fixGroupBinding</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446253"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[(tag, F v x)]] -&gt; [[(tag, F v x)]])
-&gt; [[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-391"></span><span>                                </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; [[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall k v x t.
UnitTag k =&gt;
BusNetwork k v x t -&gt; [[(k, F v x)]] -&gt; [[(k, F v x)]]
</span><a href="NITTA.Model.Networks.Bus.html#nubNotObviousBinds"><span class="hs-identifier hs-var">nubNotObviousBinds</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446253"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">([[(tag, F v x)]] -&gt; [[(tag, F v x)]])
-&gt; [[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-392"></span><span>                                    </span><span class="annot"><span class="annottext">[[(tag, F v x)]] -&gt; [[(tag, F v x)]]
forall a. [[a]] -&gt; [[a]]
</span><a href="NITTA.Model.Networks.Bus.html#cartesianProduct"><span class="hs-identifier hs-var">cartesianProduct</span></a></span><span> </span><span class="annot"><span class="annottext">[[(tag, F v x)]]
</span><a href="#local-6989586621680446261"><span class="hs-identifier hs-var">notObviousBinds</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span>            </span><span id="local-6989586621680446263"><span class="annot"><span class="annottext">simpleBinds :: [Bind tag v x]
</span><a href="#local-6989586621680446263"><span class="hs-identifier hs-var hs-var">simpleBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(tag, F v x)] -&gt; [Bind tag v x])
-&gt; [[(tag, F v x)]] -&gt; [Bind tag v x]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((tag, F v x) -&gt; Bind tag v x) -&gt; [(tag, F v x)] -&gt; [Bind tag v x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(((tag, F v x) -&gt; Bind tag v x)
 -&gt; [(tag, F v x)] -&gt; [Bind tag v x])
-&gt; ((tag, F v x) -&gt; Bind tag v x)
-&gt; [(tag, F v x)]
-&gt; [Bind tag v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(tag -&gt; F v x -&gt; Bind tag v x) -&gt; (tag, F v x) -&gt; Bind tag v x
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; F v x -&gt; Bind tag v x
forall tag v x. tag -&gt; F v x -&gt; Bind tag v x
</span><a href="NITTA.Model.Problems.Bind.html#SingleBind"><span class="hs-identifier hs-var">SingleBind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(tag, F v x)]]
</span><a href="#local-6989586621680446256"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-395"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Bind tag v x]
</span><a href="#local-6989586621680446259"><span class="hs-identifier hs-var">singleAssingmentBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[Bind tag v x] -&gt; [Bind tag v x] -&gt; [Bind tag v x]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Bind tag v x]
</span><a href="#local-6989586621680446262"><span class="hs-identifier hs-var">multiBinds</span></a></span><span> </span><span class="annot"><span class="annottext">[Bind tag v x] -&gt; [Bind tag v x] -&gt; [Bind tag v x]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Bind tag v x]
</span><a href="#local-6989586621680446263"><span class="hs-identifier hs-var">simpleBinds</span></a></span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-397"></span><span>            </span><span id="local-6989586621680446257"><span class="annot"><span class="annottext">optionsFor :: F v x -&gt; [(tag, F v x)]
</span><a href="#local-6989586621680446257"><span class="hs-identifier hs-var hs-var">optionsFor</span></a></span></span><span> </span><span id="local-6989586621680446264"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680446264"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-398"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446265"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680446264"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446265"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446265"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446266"><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446266"><span class="hs-identifier hs-var">pu</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446255"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-400"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">F v x -&gt; PU v x t -&gt; Bool
forall {b} {v} {x} {t}. ProcessorUnit b v x t =&gt; F v x -&gt; b -&gt; Bool
</span><a href="NITTA.Model.ProcessorUnits.Types.html#allowToProcess"><span class="hs-identifier hs-var">allowToProcess</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680446264"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446266"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-401"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621680446278"><span class="annot"><span class="annottext">bindDecision :: BusNetwork tag v x t -&gt; Bind tag v x -&gt; BusNetwork tag v x t
</span><a href="NITTA.Model.Problems.Bind.html#bindDecision"><span class="hs-identifier hs-var hs-var hs-var hs-var">bindDecision</span></a></span></span><span> </span><span id="local-6989586621680446279"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446279"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446280"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446281"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446282"><span class="annot"><span class="annottext">Map tag [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map tag [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446283"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Problems.Bind.html#SingleBind"><span class="hs-identifier hs-type">SingleBind</span></a></span><span> </span><span id="local-6989586621680446284"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446284"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680446285"><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680446285"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-404"></span><span>        </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446279"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-405"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var">bnPus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#bind"><span class="hs-identifier hs-type">bind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446285"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446284"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446281"><span class="hs-identifier hs-type">bnPus</span></a></span><span>
</span><span id="line-406"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var">bnBound</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#registerBinding"><span class="hs-identifier hs-type">registerBinding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446284"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446285"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446282"><span class="hs-identifier hs-type">bnBound</span></a></span><span>
</span><span id="line-407"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-type">execScheduleWithProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446279"><span class="hs-identifier hs-type">bn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446280"><span class="hs-identifier hs-type">bnProcess</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleFunctionBind"><span class="hs-identifier hs-type">scheduleFunctionBind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446285"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-408"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">/=</span></span><span> </span><span class="annot"><span class="hs-identifier">f</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446283"><span class="hs-identifier hs-type">bnRemains</span></a></span><span>
</span><span id="line-409"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-410"></span><span>    </span><span class="annot"><a href="NITTA.Model.Problems.Bind.html#bindDecision"><span class="hs-identifier hs-var">bindDecision</span></a></span><span> </span><span id="local-6989586621680446290"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446290"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Bind.html#GroupBind"><span class="hs-identifier hs-type">GroupBind</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446291"><span class="annot"><span class="annottext">Map tag [F v x]
bindGroup :: Map tag [F v x]
bindGroup :: forall tag v x. Bind tag v x -&gt; Map tag [F v x]
</span><a href="#local-6989586621680446291"><span class="hs-identifier hs-var hs-var">bindGroup</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>        </span><span class="annot"><span class="annottext">(BusNetwork tag v x t -&gt; Bind tag v x -&gt; BusNetwork tag v x t)
-&gt; BusNetwork tag v x t -&gt; [Bind tag v x] -&gt; BusNetwork tag v x t
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; Bind tag v x -&gt; BusNetwork tag v x t
forall u tag v x. BindProblem u tag v x =&gt; u -&gt; Bind tag v x -&gt; u
</span><a href="NITTA.Model.Problems.Bind.html#bindDecision"><span class="hs-identifier hs-var">bindDecision</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446290"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">([Bind tag v x] -&gt; BusNetwork tag v x t)
-&gt; [Bind tag v x] -&gt; BusNetwork tag v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, [F v x]) -&gt; [Bind tag v x])
-&gt; [(tag, [F v x])] -&gt; [Bind tag v x]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680446293"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446293"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446294"><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446294"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(F v x -&gt; Bind tag v x) -&gt; [F v x] -&gt; [Bind tag v x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag -&gt; F v x -&gt; Bind tag v x
forall tag v x. tag -&gt; F v x -&gt; Bind tag v x
</span><a href="NITTA.Model.Problems.Bind.html#SingleBind"><span class="hs-identifier hs-var">SingleBind</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446293"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446294"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(tag, [F v x])] -&gt; [Bind tag v x])
-&gt; [(tag, [F v x])] -&gt; [Bind tag v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x] -&gt; [(tag, [F v x])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x]
</span><a href="#local-6989586621680446291"><span class="hs-identifier hs-var">bindGroup</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444895"><span id="local-6989586621680444896"><span id="local-6989586621680444897"><span id="local-6989586621680444898"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444895"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444896"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444897"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444898"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.BreakLoop.html#BreakLoopProblem"><span class="hs-identifier hs-type">BreakLoopProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444895"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444896"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444897"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444898"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444896"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444897"><span class="hs-identifier hs-type">x</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621680446316"><span class="annot"><span class="annottext">breakLoopOptions :: BusNetwork tag v x t -&gt; [BreakLoop v x]
</span><a href="#local-6989586621680446316"><span class="hs-identifier hs-var hs-var hs-var hs-var">breakLoopOptions</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446318"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PU v x t -&gt; [BreakLoop v x]) -&gt; [PU v x t] -&gt; [BreakLoop v x]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; [BreakLoop v x]
forall u v x. BreakLoopProblem u v x =&gt; u -&gt; [BreakLoop v x]
</span><a href="NITTA.Model.Problems.Refactor.BreakLoop.html#breakLoopOptions"><span class="hs-identifier hs-var">breakLoopOptions</span></a></span><span> </span><span class="annot"><span class="annottext">([PU v x t] -&gt; [BreakLoop v x]) -&gt; [PU v x t] -&gt; [BreakLoop v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [PU v x t]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446318"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>    </span><span id="local-6989586621680446364"><span class="annot"><span class="annottext">breakLoopDecision :: BusNetwork tag v x t -&gt; BreakLoop v x -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680446364"><span class="hs-identifier hs-var hs-var hs-var hs-var">breakLoopDecision</span></a></span></span><span> </span><span id="local-6989586621680446366"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446366"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446367"><span class="annot"><span class="annottext">Map tag [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map tag [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446368"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680446369"><span class="annot"><span class="annottext">bl :: BreakLoop v x
</span><a href="#local-6989586621680446369"><span class="hs-identifier hs-var">bl</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Problems.Refactor.BreakLoop.html#BreakLoop"><span class="hs-identifier hs-type">BreakLoop</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-417"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446371"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446371"><span class="hs-identifier hs-var">puTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446372"><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446372"><span class="hs-identifier hs-var">boundToPU</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (tag, [F v x]) -&gt; (tag, [F v x])
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (tag, [F v x]) -&gt; (tag, [F v x]))
-&gt; Maybe (tag, [F v x]) -&gt; (tag, [F v x])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, [F v x]) -&gt; Bool)
-&gt; [(tag, [F v x])] -&gt; Maybe (tag, [F v x])
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">L.find</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">F v x -&gt; [F v x] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">elem</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BreakLoop v x -&gt; F v x
forall {v} {x}.
(Hashable v, Suffix v, ToString v, IsString v, Ord v, Show x,
 Typeable v, Typeable x, Eq x) =&gt;
BreakLoop v x -&gt; F v x
</span><a href="NITTA.Model.Problems.Refactor.BreakLoop.html#recLoop"><span class="hs-identifier hs-var">recLoop</span></a></span><span> </span><span class="annot"><span class="annottext">BreakLoop v x
</span><a href="#local-6989586621680446369"><span class="hs-identifier hs-var">bl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([F v x] -&gt; Bool)
-&gt; ((tag, [F v x]) -&gt; [F v x]) -&gt; (tag, [F v x]) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(tag, [F v x]) -&gt; [F v x]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(tag, [F v x])] -&gt; Maybe (tag, [F v x]))
-&gt; [(tag, [F v x])] -&gt; Maybe (tag, [F v x])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x] -&gt; [(tag, [F v x])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x]
</span><a href="#local-6989586621680446367"><span class="hs-identifier hs-var">bnBound</span></a></span><span>
</span><span id="line-418"></span><span>            </span><span id="local-6989586621680446377"><span class="annot"><span class="annottext">boundToPU' :: [F v x]
</span><a href="#local-6989586621680446377"><span class="hs-identifier hs-var hs-var">boundToPU'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BreakLoop v x -&gt; F v x
forall {v} {x}.
(Hashable v, Suffix v, ToString v, IsString v, Ord v, Show x,
 Typeable v, Typeable x, Eq x) =&gt;
BreakLoop v x -&gt; F v x
</span><a href="NITTA.Model.Problems.Refactor.BreakLoop.html#recLoopIn"><span class="hs-identifier hs-var">recLoopIn</span></a></span><span> </span><span class="annot"><span class="annottext">BreakLoop v x
</span><a href="#local-6989586621680446369"><span class="hs-identifier hs-var">bl</span></a></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; [F v x] -&gt; [F v x]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">BreakLoop v x -&gt; F v x
forall {v} {x}.
(Hashable v, Suffix v, ToString v, IsString v, Ord v, Show x,
 Typeable v, Typeable x, Eq x) =&gt;
BreakLoop v x -&gt; F v x
</span><a href="NITTA.Model.Problems.Refactor.BreakLoop.html#recLoopOut"><span class="hs-identifier hs-var">recLoopOut</span></a></span><span> </span><span class="annot"><span class="annottext">BreakLoop v x
</span><a href="#local-6989586621680446369"><span class="hs-identifier hs-var">bl</span></a></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; [F v x] -&gt; [F v x]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446372"><span class="hs-identifier hs-var">boundToPU</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x] -&gt; [F v x] -&gt; [F v x]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">L.\\</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BreakLoop v x -&gt; F v x
forall {v} {x}.
(Hashable v, Suffix v, ToString v, IsString v, Ord v, Show x,
 Typeable v, Typeable x, Eq x) =&gt;
BreakLoop v x -&gt; F v x
</span><a href="NITTA.Model.Problems.Refactor.BreakLoop.html#recLoop"><span class="hs-identifier hs-var">recLoop</span></a></span><span> </span><span class="annot"><span class="annottext">BreakLoop v x
</span><a href="#local-6989586621680446369"><span class="hs-identifier hs-var">bl</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446366"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-420"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var">bnPus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`breakLoopDecision`</span></span><span> </span><span class="annot"><span class="hs-identifier">bl</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446371"><span class="hs-identifier hs-type">puTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446368"><span class="hs-identifier hs-type">bnPus</span></a></span><span>
</span><span id="line-421"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var">bnBound</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.insert</span></span><span> </span><span class="annot"><a href="#local-6989586621680446371"><span class="hs-identifier hs-type">puTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446377"><span class="hs-identifier hs-type">boundToPU'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446367"><span class="hs-identifier hs-type">bnBound</span></a></span><span>
</span><span id="line-422"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444920"><span id="local-6989586621680444921"><span id="local-6989586621680444922"><span id="local-6989586621680444923"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444920"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444921"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444922"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444923"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.OptimizeAccum.html#OptimizeAccumProblem"><span class="hs-identifier hs-type">OptimizeAccumProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444920"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444921"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444922"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444923"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444921"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444922"><span class="hs-identifier hs-type">x</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621680446394"><span class="annot"><span class="annottext">optimizeAccumOptions :: BusNetwork tag v x t -&gt; [OptimizeAccum v x]
</span><a href="#local-6989586621680446394"><span class="hs-identifier hs-var hs-var hs-var hs-var">optimizeAccumOptions</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446396"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[F v x] -&gt; [OptimizeAccum v x]
forall u v x.
OptimizeAccumProblem u v x =&gt;
u -&gt; [OptimizeAccum v x]
</span><a href="NITTA.Model.Problems.Refactor.OptimizeAccum.html#optimizeAccumOptions"><span class="hs-identifier hs-var">optimizeAccumOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446396"><span class="hs-identifier hs-var">bnRemains</span></a></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>    </span><span id="local-6989586621680446410"><span class="annot"><span class="annottext">optimizeAccumDecision :: BusNetwork tag v x t -&gt; OptimizeAccum v x -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680446410"><span class="hs-identifier hs-var hs-var hs-var hs-var">optimizeAccumDecision</span></a></span></span><span> </span><span id="local-6989586621680446412"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446412"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446413"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446414"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680446415"><span class="annot"><span class="annottext">oa :: OptimizeAccum v x
</span><a href="#local-6989586621680446415"><span class="hs-identifier hs-var">oa</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Problems.Refactor.OptimizeAccum.html#OptimizeAccum"><span class="hs-identifier hs-type">OptimizeAccum</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-428"></span><span>        </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446412"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-429"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.OptimizeAccum.html#optimizeAccumDecision"><span class="hs-identifier hs-type">optimizeAccumDecision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446413"><span class="hs-identifier hs-type">bnRemains</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446415"><span class="hs-identifier hs-type">oa</span></a></span><span>
</span><span id="line-430"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-type">execScheduleWithProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446412"><span class="hs-identifier hs-type">bn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446414"><span class="hs-identifier hs-type">bnProcess</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-431"></span><span>                </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleRefactoring"><span class="hs-identifier hs-type">scheduleRefactoring</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I.singleton</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-type">nextTick</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446412"><span class="hs-identifier hs-type">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446415"><span class="hs-identifier hs-type">oa</span></a></span><span>
</span><span id="line-432"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444950"><span id="local-6989586621680444951"><span id="local-6989586621680444952"><span id="local-6989586621680444953"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444950"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444951"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444952"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444953"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.OptimizeLogicalUnit.html#OptimizeLogicalUnitProblem"><span class="hs-identifier hs-type">OptimizeLogicalUnitProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444950"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444951"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444952"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444953"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444951"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444952"><span class="hs-identifier hs-type">x</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621680446431"><span class="annot"><span class="annottext">optimizeLogicalUnitOptions :: BusNetwork tag v x t -&gt; [OptimizeLogicalUnit v x]
</span><a href="#local-6989586621680446431"><span class="hs-identifier hs-var hs-var hs-var hs-var">optimizeLogicalUnitOptions</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446433"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[F v x] -&gt; [OptimizeLogicalUnit v x]
forall u v x.
OptimizeLogicalUnitProblem u v x =&gt;
u -&gt; [OptimizeLogicalUnit v x]
</span><a href="NITTA.Model.Problems.Refactor.OptimizeLogicalUnit.html#optimizeLogicalUnitOptions"><span class="hs-identifier hs-var">optimizeLogicalUnitOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446433"><span class="hs-identifier hs-var">bnRemains</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621680446446"><span class="annot"><span class="annottext">optimizeLogicalUnitDecision :: BusNetwork tag v x t
-&gt; OptimizeLogicalUnit v x -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680446446"><span class="hs-identifier hs-var hs-var hs-var hs-var">optimizeLogicalUnitDecision</span></a></span></span><span> </span><span id="local-6989586621680446448"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446448"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446449"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446450"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680446451"><span class="annot"><span class="annottext">ol :: OptimizeLogicalUnit v x
</span><a href="#local-6989586621680446451"><span class="hs-identifier hs-var">ol</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Problems.Refactor.OptimizeLogicalUnit.html#OptimizeLogicalUnit"><span class="hs-identifier hs-type">OptimizeLogicalUnit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446448"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-439"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.OptimizeLogicalUnit.html#optimizeLogicalUnitDecision"><span class="hs-identifier hs-type">optimizeLogicalUnitDecision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446449"><span class="hs-identifier hs-type">bnRemains</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446451"><span class="hs-identifier hs-type">ol</span></a></span><span>
</span><span id="line-440"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-type">execScheduleWithProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446448"><span class="hs-identifier hs-type">bn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446450"><span class="hs-identifier hs-type">bnProcess</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-441"></span><span>                </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleRefactoring"><span class="hs-identifier hs-type">scheduleRefactoring</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I.singleton</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-type">nextTick</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446448"><span class="hs-identifier hs-type">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446451"><span class="hs-identifier hs-type">ol</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444969"><span id="local-6989586621680444970"><span id="local-6989586621680444971"><span id="local-6989586621680444972"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444969"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444970"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444971"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444972"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.ConstantFolding.html#ConstantFoldingProblem"><span class="hs-identifier hs-type">ConstantFoldingProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444969"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444970"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444971"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444972"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444970"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444971"><span class="hs-identifier hs-type">x</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-445"></span><span>    </span><span id="local-6989586621680446465"><span class="annot"><span class="annottext">constantFoldingOptions :: BusNetwork tag v x t -&gt; [ConstantFolding v x]
</span><a href="#local-6989586621680446465"><span class="hs-identifier hs-var hs-var hs-var hs-var">constantFoldingOptions</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446467"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[F v x] -&gt; [ConstantFolding v x]
forall u v x.
ConstantFoldingProblem u v x =&gt;
u -&gt; [ConstantFolding v x]
</span><a href="NITTA.Model.Problems.Refactor.ConstantFolding.html#constantFoldingOptions"><span class="hs-identifier hs-var">constantFoldingOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446467"><span class="hs-identifier hs-var">bnRemains</span></a></span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621680446480"><span class="annot"><span class="annottext">constantFoldingDecision :: BusNetwork tag v x t -&gt; ConstantFolding v x -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680446480"><span class="hs-identifier hs-var hs-var hs-var hs-var">constantFoldingDecision</span></a></span></span><span> </span><span id="local-6989586621680446482"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446482"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446483"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446484"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680446485"><span class="annot"><span class="annottext">cf :: ConstantFolding v x
</span><a href="#local-6989586621680446485"><span class="hs-identifier hs-var">cf</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Problems.Refactor.ConstantFolding.html#ConstantFolding"><span class="hs-identifier hs-type">ConstantFolding</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-448"></span><span>        </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446482"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-449"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.ConstantFolding.html#constantFoldingDecision"><span class="hs-identifier hs-type">constantFoldingDecision</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446483"><span class="hs-identifier hs-type">bnRemains</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446485"><span class="hs-identifier hs-type">cf</span></a></span><span>
</span><span id="line-450"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-type">execScheduleWithProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446482"><span class="hs-identifier hs-type">bn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446484"><span class="hs-identifier hs-type">bnProcess</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-451"></span><span>                </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleRefactoring"><span class="hs-identifier hs-type">scheduleRefactoring</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I.singleton</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-type">nextTick</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446482"><span class="hs-identifier hs-type">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446485"><span class="hs-identifier hs-type">cf</span></a></span><span>
</span><span id="line-452"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680444988"><span id="local-6989586621680444989"><span id="local-6989586621680444990"><span id="local-6989586621680444991"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444988"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444989"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444990"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444991"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Refactor.ResolveDeadlock.html#ResolveDeadlockProblem"><span class="hs-identifier hs-type">ResolveDeadlockProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444988"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444989"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444990"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444991"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680444989"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444990"><span class="hs-identifier hs-type">x</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-455"></span><span>    </span><span id="local-6989586621680446541"><span class="annot"><span class="annottext">resolveDeadlockOptions :: BusNetwork tag v x t -&gt; [ResolveDeadlock v x]
</span><a href="#local-6989586621680446541"><span class="hs-identifier hs-var hs-var hs-var hs-var">resolveDeadlockOptions</span></a></span></span><span> </span><span id="local-6989586621680446543"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446543"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446544"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446545"><span class="annot"><span class="annottext">Map tag [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map tag [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-456"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680446546"><span class="hs-identifier hs-type">prepareResolve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="#local-6989586621680444989"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.Model.Problems.Refactor.ResolveDeadlock.html#ResolveDeadlock"><span class="hs-identifier hs-type">ResolveDeadlock</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444989"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680444990"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>            </span><span id="local-6989586621680446546"><span class="annot"><span class="annottext">prepareResolve :: Set v -&gt; [ResolveDeadlock v x]
</span><a href="#local-6989586621680446546"><span class="hs-identifier hs-var hs-var">prepareResolve</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-458"></span><span>                </span><span class="annot"><span class="annottext">(Set v -&gt; ResolveDeadlock v x) -&gt; [Set v] -&gt; [ResolveDeadlock v x]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; ResolveDeadlock v x
forall v x. (Var v, Val x) =&gt; Set v -&gt; ResolveDeadlock v x
</span><a href="NITTA.Model.Problems.Refactor.ResolveDeadlock.html#resolveDeadlock"><span class="hs-identifier hs-var">resolveDeadlock</span></a></span><span>
</span><span id="line-459"></span><span>                    </span><span class="annot"><span class="annottext">([Set v] -&gt; [ResolveDeadlock v x])
-&gt; (Set v -&gt; [Set v]) -&gt; Set v -&gt; [ResolveDeadlock v x]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set (Set v) -&gt; [Set v]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.elems</span></span><span>
</span><span id="line-460"></span><span>                    </span><span class="annot"><span class="annottext">(Set (Set v) -&gt; [Set v])
-&gt; (Set v -&gt; Set (Set v)) -&gt; Set v -&gt; [Set v]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; Bool) -&gt; Set (Set v) -&gt; Set (Set v)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Set v -&gt; Bool) -&gt; Set v -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>                    </span><span class="annot"><span class="annottext">(Set (Set v) -&gt; Set (Set v))
-&gt; (Set v -&gt; Set (Set v)) -&gt; Set v -&gt; Set (Set v)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680446550"><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621680446550"><span class="hs-identifier hs-var">lockedVs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-462"></span><span>                            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set v -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">S.null</span></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621680446550"><span class="hs-identifier hs-var">lockedVs</span></a></span><span>
</span><span id="line-463"></span><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Set (Set v)
forall a. Set a
</span><span class="hs-identifier hs-var">S.empty</span></span><span>
</span><span id="line-464"></span><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; Bool) -&gt; Set (Set v) -&gt; Set (Set v)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Set v -&gt; Bool) -&gt; Set v -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621680446550"><span class="hs-identifier hs-var">lockedVs</span></a></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; Set v -&gt; Bool
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.disjoint`</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set (Set v) -&gt; Set (Set v)) -&gt; Set (Set v) -&gt; Set (Set v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; Set (Set v)
forall a. Set a -&gt; Set (Set a)
</span><span class="hs-identifier hs-var">S.powerSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map v (Set v)
</span><a href="#local-6989586621680446554"><span class="hs-identifier hs-var">var2endpointRole</span></a></span><span> </span><span class="annot"><span class="annottext">Map v (Set v) -&gt; v -&gt; Set v
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; v
forall {c}. Set c -&gt; c
</span><a href="NITTA.Utils.Base.html#oneOf"><span class="hs-identifier hs-var">oneOf</span></a></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621680446550"><span class="hs-identifier hs-var">lockedVs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>                      </span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                    </span><span class="annot"><span class="annottext">(Set v -&gt; Set (Set v)) -&gt; (Set v -&gt; Set v) -&gt; Set v -&gt; Set (Set v)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(v -&gt; Bool) -&gt; Set v -&gt; Set v
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; v -&gt; Bool
</span><a href="#local-6989586621680446555"><span class="hs-identifier hs-var">isBufferRepetionOK</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="NITTA.Model.Problems.Refactor.ResolveDeadlock.html#maxBufferStack"><span class="hs-identifier hs-var">maxBufferStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>            </span><span id="local-6989586621680446555"><span class="annot"><span class="annottext">isBufferRepetionOK :: Int -&gt; v -&gt; Bool
</span><a href="#local-6989586621680446555"><span class="hs-identifier hs-var hs-var">isBufferRepetionOK</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-469"></span><span>            </span><span class="annot"><a href="#local-6989586621680446555"><span class="hs-identifier hs-var">isBufferRepetionOK</span></a></span><span> </span><span id="local-6989586621680446557"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446557"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680446558"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446558"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-470"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">v -&gt; v
forall v. Suffix v =&gt; v -&gt; v
</span><a href="NITTA.Intermediate.Variable.html#bufferSuffix"><span class="hs-identifier hs-var">bufferSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446558"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; Set v -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.notMember`</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446543"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-471"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; v -&gt; Bool
</span><a href="#local-6989586621680446555"><span class="hs-identifier hs-var">isBufferRepetionOK</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680446557"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; v
forall v. Suffix v =&gt; v -&gt; v
</span><a href="NITTA.Intermediate.Variable.html#bufferSuffix"><span class="hs-identifier hs-var">bufferSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446558"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>            </span><span id="local-6989586621680446561"><span class="annot"><span class="annottext">selfSending :: [ResolveDeadlock v x]
</span><a href="#local-6989586621680446561"><span class="hs-identifier hs-var hs-var">selfSending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-474"></span><span>                </span><span class="annot"><span class="annottext">((tag, [F v x]) -&gt; [ResolveDeadlock v x])
-&gt; [(tag, [F v x])] -&gt; [ResolveDeadlock v x]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-475"></span><span>                    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680446562"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446562"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446563"><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446563"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set v -&gt; [ResolveDeadlock v x]
</span><a href="#local-6989586621680446546"><span class="hs-identifier hs-var">prepareResolve</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(F v x -&gt; Set v) -&gt; [F v x] -&gt; Set v
forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; Set v
forall f v. Function f v =&gt; f -&gt; Set v
</span><a href="NITTA.Intermediate.Types.html#inputs"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446563"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; Set v -&gt; Set v
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`S.intersection`</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; Set v
</span><a href="#local-6989586621680446566"><span class="hs-identifier hs-var">puOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446562"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>                    </span><span class="annot"><span class="annottext">([(tag, [F v x])] -&gt; [ResolveDeadlock v x])
-&gt; [(tag, [F v x])] -&gt; [ResolveDeadlock v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x] -&gt; [(tag, [F v x])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x]
</span><a href="#local-6989586621680446545"><span class="hs-identifier hs-var">bnBound</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span>            </span><span id="local-6989586621680446567"><span class="annot"><span class="annottext">allPULocks :: [(tag, [Lock v])]
</span><a href="#local-6989586621680446567"><span class="hs-identifier hs-var hs-var">allPULocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; (tag, [Lock v]))
-&gt; [(tag, PU v x t)] -&gt; [(tag, [Lock v])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PU v x t -&gt; [Lock v]) -&gt; (tag, PU v x t) -&gt; (tag, [Lock v])
forall b c a. (b -&gt; c) -&gt; (a, b) -&gt; (a, c)
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; [Lock v]
forall x v. Locks x v =&gt; x -&gt; [Lock v]
</span><a href="NITTA.Intermediate.Types.html#locks"><span class="hs-identifier hs-var">locks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(tag, PU v x t)] -&gt; [(tag, [Lock v])])
-&gt; [(tag, PU v x t)] -&gt; [(tag, [Lock v])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446544"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span>            </span><span id="local-6989586621680446569"><span class="annot"><span class="annottext">resolveLocks :: [ResolveDeadlock v x]
</span><a href="#local-6989586621680446569"><span class="hs-identifier hs-var hs-var">resolveLocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-481"></span><span>                </span><span class="annot"><span class="annottext">[[ResolveDeadlock v x]] -&gt; [ResolveDeadlock v x]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-482"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Set v -&gt; [ResolveDeadlock v x]
</span><a href="#local-6989586621680446546"><span class="hs-identifier hs-var">prepareResolve</span></a></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; [ResolveDeadlock v x]) -&gt; Set v -&gt; [ResolveDeadlock v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; Set v
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446571"><span class="hs-identifier hs-var">lockBy</span></a></span><span>
</span><span id="line-483"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446572"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446572"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446573"><span class="annot"><span class="annottext">[Lock v]
</span><a href="#local-6989586621680446573"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(tag, [Lock v])]
</span><a href="#local-6989586621680446567"><span class="hs-identifier hs-var">allPULocks</span></a></span><span>
</span><span id="line-484"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#Lock"><span class="hs-identifier hs-type">Lock</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446571"><span class="annot"><span class="annottext">v
lockBy :: v
lockBy :: forall v. Lock v -&gt; v
</span><a href="#local-6989586621680446571"><span class="hs-identifier hs-var hs-var">lockBy</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446576"><span class="annot"><span class="annottext">v
locked :: v
locked :: forall v. Lock v -&gt; v
</span><a href="#local-6989586621680446576"><span class="hs-identifier hs-var hs-var">locked</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Lock v]
</span><a href="#local-6989586621680446573"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-485"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446571"><span class="hs-identifier hs-var">lockBy</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; Set v -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`S.member`</span></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621680446579"><span class="hs-identifier hs-var">maybeSended</span></a></span><span>
</span><span id="line-486"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680446580"><span class="annot"><span class="annottext">reversedLock :: Lock v
</span><a href="#local-6989586621680446580"><span class="hs-identifier hs-var hs-var">reversedLock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#Lock"><span class="hs-identifier hs-type">Lock</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">lockBy :: v
</span><a href="NITTA.Intermediate.Types.html#lockBy"><span class="hs-identifier hs-var">lockBy</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446576"><span class="hs-identifier hs-var">locked</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">locked :: v
</span><a href="NITTA.Intermediate.Types.html#locked"><span class="hs-identifier hs-var">locked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446571"><span class="hs-identifier hs-var">lockBy</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-487"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((tag, [Lock v]) -&gt; Bool) -&gt; [(tag, [Lock v])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680446581"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446581"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446582"><span class="annot"><span class="annottext">[Lock v]
</span><a href="#local-6989586621680446582"><span class="hs-identifier hs-var">puLocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446572"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">tag -&gt; tag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446581"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Lock v
</span><a href="#local-6989586621680446580"><span class="hs-identifier hs-var">reversedLock</span></a></span><span> </span><span class="annot"><span class="annottext">Lock v -&gt; [Lock v] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Lock v]
</span><a href="#local-6989586621680446582"><span class="hs-identifier hs-var">puLocks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(tag, [Lock v])]
</span><a href="#local-6989586621680446567"><span class="hs-identifier hs-var">allPULocks</span></a></span><span>
</span><span id="line-488"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-489"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[ResolveDeadlock v x] -&gt; [ResolveDeadlock v x]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.nub</span></span><span> </span><span class="annot"><span class="annottext">([ResolveDeadlock v x] -&gt; [ResolveDeadlock v x])
-&gt; [ResolveDeadlock v x] -&gt; [ResolveDeadlock v x]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ResolveDeadlock v x]
</span><a href="#local-6989586621680446561"><span class="hs-identifier hs-var">selfSending</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolveDeadlock v x]
-&gt; [ResolveDeadlock v x] -&gt; [ResolveDeadlock v x]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[ResolveDeadlock v x]
</span><a href="#local-6989586621680446569"><span class="hs-identifier hs-var">resolveLocks</span></a></span><span>
</span><span id="line-490"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-491"></span><span>            </span><span id="local-6989586621680446585"><span class="annot"><span class="annottext">endPointRoles :: Map tag [EndpointRole v]
</span><a href="#local-6989586621680446585"><span class="hs-identifier hs-var hs-var">endPointRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PU v x t -&gt; [EndpointRole v])
-&gt; Map tag (PU v x t) -&gt; Map tag [EndpointRole v]
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680446587"><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446587"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(EndpointSt v (TimeConstraint t) -&gt; EndpointRole v)
-&gt; [EndpointSt v (TimeConstraint t)] -&gt; [EndpointRole v]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EndpointSt v (TimeConstraint t) -&gt; EndpointRole v
forall v tp. EndpointSt v tp -&gt; EndpointRole v
</span><a href="NITTA.Model.Problems.Endpoint.html#epRole"><span class="hs-identifier hs-var">epRole</span></a></span><span> </span><span class="annot"><span class="annottext">([EndpointSt v (TimeConstraint t)] -&gt; [EndpointRole v])
-&gt; [EndpointSt v (TimeConstraint t)] -&gt; [EndpointRole v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; [EndpointSt v (TimeConstraint t)]
forall u v t.
EndpointProblem u v t =&gt;
u -&gt; [EndpointSt v (TimeConstraint t)]
</span><a href="NITTA.Model.Problems.Endpoint.html#endpointOptions"><span class="hs-identifier hs-var">endpointOptions</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446587"><span class="hs-identifier hs-var">pu</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446544"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span>            </span><span id="local-6989586621680446566"><span class="annot"><span class="annottext">puOutputs :: tag -&gt; Set v
</span><a href="#local-6989586621680446566"><span class="hs-identifier hs-var hs-var">puOutputs</span></a></span></span><span> </span><span id="local-6989586621680446589"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446589"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-494"></span><span>                </span><span class="annot"><span class="annottext">(EndpointRole v -&gt; Set v) -&gt; [EndpointRole v] -&gt; Set v
forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointRole v -&gt; Set v
forall a v. Variables a v =&gt; a -&gt; Set v
</span><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-var">variables</span></a></span><span> </span><span class="annot"><span class="annottext">([EndpointRole v] -&gt; Set v) -&gt; [EndpointRole v] -&gt; Set v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-495"></span><span>                    </span><span class="annot"><span class="annottext">(EndpointRole v -&gt; Bool) -&gt; [EndpointRole v] -&gt; [EndpointRole v]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Endpoint.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">EndpointRole v
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([EndpointRole v] -&gt; [EndpointRole v])
-&gt; [EndpointRole v] -&gt; [EndpointRole v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-496"></span><span>                        </span><span class="annot"><span class="annottext">Map tag [EndpointRole v]
</span><a href="#local-6989586621680446585"><span class="hs-identifier hs-var">endPointRoles</span></a></span><span> </span><span class="annot"><span class="annottext">Map tag [EndpointRole v] -&gt; tag -&gt; [EndpointRole v]
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446589"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span>            </span><span id="local-6989586621680446554"><span class="annot"><span class="annottext">var2endpointRole :: Map v (Set v)
</span><a href="#local-6989586621680446554"><span class="hs-identifier hs-var hs-var">var2endpointRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-499"></span><span>                </span><span class="annot"><span class="annottext">[(v, Set v)] -&gt; Map v (Set v)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span>
</span><span id="line-500"></span><span>                    </span><span class="annot"><span class="annottext">([(v, Set v)] -&gt; Map v (Set v)) -&gt; [(v, Set v)] -&gt; Map v (Set v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EndpointRole v -&gt; [(v, Set v)])
-&gt; [EndpointRole v] -&gt; [(v, Set v)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-501"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-502"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Problems.Endpoint.html#Source"><span class="hs-identifier hs-type">Source</span></a></span><span> </span><span id="local-6989586621680446590"><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621680446590"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446591"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621680446590"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621680446591"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446591"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set v -&gt; [v]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.elems</span></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621680446590"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-503"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Problems.Endpoint.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span id="local-6989586621680446593"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446593"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446593"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">v -&gt; Set v
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">S.singleton</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680446593"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-504"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>                    </span><span class="annot"><span class="annottext">([EndpointRole v] -&gt; [(v, Set v)])
-&gt; [EndpointRole v] -&gt; [(v, Set v)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[EndpointRole v]] -&gt; [EndpointRole v]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-506"></span><span>                    </span><span class="annot"><span class="annottext">([[EndpointRole v]] -&gt; [EndpointRole v])
-&gt; [[EndpointRole v]] -&gt; [EndpointRole v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag [EndpointRole v] -&gt; [[EndpointRole v]]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">Map tag [EndpointRole v]
</span><a href="#local-6989586621680446585"><span class="hs-identifier hs-var">endPointRoles</span></a></span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span>            </span><span id="local-6989586621680446579"><span class="annot"><span class="annottext">maybeSended :: Set v
</span><a href="#local-6989586621680446579"><span class="hs-identifier hs-var hs-var">maybeSended</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map v (Set v) -&gt; Set v
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">M.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map v (Set v)
</span><a href="#local-6989586621680446554"><span class="hs-identifier hs-var">var2endpointRole</span></a></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>    </span><span id="local-6989586621680446621"><span class="annot"><span class="annottext">resolveDeadlockDecision :: BusNetwork tag v x t -&gt; ResolveDeadlock v x -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680446621"><span class="hs-identifier hs-var hs-var hs-var hs-var">resolveDeadlockDecision</span></a></span></span><span>
</span><span id="line-511"></span><span>        </span><span id="local-6989586621680446623"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446623"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446624"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446625"><span class="annot"><span class="annottext">Map tag [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnBound :: Map tag [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var hs-var">bnBound</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446626"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446627"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-512"></span><span>        </span><span id="local-6989586621680446628"><span class="annot"><span class="annottext">ref :: ResolveDeadlock v x
</span><a href="#local-6989586621680446628"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Problems.Refactor.ResolveDeadlock.html#ResolveDeadlock"><span class="hs-identifier hs-type">ResolveDeadlock</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446630"><span class="annot"><span class="annottext">F v x
newBuffer :: F v x
newBuffer :: forall v x. ResolveDeadlock v x -&gt; F v x
</span><a href="#local-6989586621680446630"><span class="hs-identifier hs-var hs-var">newBuffer</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446632"><span class="annot"><span class="annottext">Changeset v
changeset :: Changeset v
changeset :: forall v x. ResolveDeadlock v x -&gt; Changeset v
</span><a href="#local-6989586621680446632"><span class="hs-identifier hs-var hs-var">changeset</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-513"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446634"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446634"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-514"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (tag, [F v x]) -&gt; (tag, [F v x])
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span>
</span><span id="line-515"></span><span>                        </span><span class="annot"><span class="annottext">(Maybe (tag, [F v x]) -&gt; (tag, [F v x]))
-&gt; Maybe (tag, [F v x]) -&gt; (tag, [F v x])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, [F v x]) -&gt; Bool)
-&gt; [(tag, [F v x])] -&gt; Maybe (tag, [F v x])
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">L.find</span></span><span>
</span><span id="line-516"></span><span>                            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446635"><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446635"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; Bool
forall a. Set a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; Bool) -&gt; Set v -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; Set v -&gt; Set v
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.intersection</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">F v x -&gt; Set v
forall f v. Function f v =&gt; f -&gt; Set v
</span><a href="NITTA.Intermediate.Types.html#outputs"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="annot"><span class="annottext">F v x
</span><a href="#local-6989586621680446630"><span class="hs-identifier hs-var">newBuffer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; Set v) -&gt; Set v -&gt; Set v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(F v x -&gt; Set v) -&gt; [F v x] -&gt; Set v
forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">F v x -&gt; Set v
forall f v. Function f v =&gt; f -&gt; Set v
</span><a href="NITTA.Intermediate.Types.html#outputs"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446635"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>                        </span><span class="annot"><span class="annottext">([(tag, [F v x])] -&gt; Maybe (tag, [F v x]))
-&gt; [(tag, [F v x])] -&gt; Maybe (tag, [F v x])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x] -&gt; [(tag, [F v x])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag [F v x]
</span><a href="#local-6989586621680446625"><span class="hs-identifier hs-var">bnBound</span></a></span><span>
</span><span id="line-518"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446623"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-519"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var">bnRemains</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680446630"><span class="hs-identifier hs-type">newBuffer</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="NITTA.Intermediate.Types.html#patch"><span class="hs-identifier hs-type">patch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446632"><span class="hs-identifier hs-type">changeset</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446624"><span class="hs-identifier hs-type">bnRemains</span></a></span><span>
</span><span id="line-520"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var">bnPus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Intermediate.Types.html#patch"><span class="hs-identifier hs-type">patch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446632"><span class="hs-identifier hs-type">changeset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446634"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446626"><span class="hs-identifier hs-type">bnPus</span></a></span><span>
</span><span id="line-521"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnBound"><span class="hs-identifier hs-var">bnBound</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Intermediate.Types.html#patch"><span class="hs-identifier hs-type">patch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446632"><span class="hs-identifier hs-type">changeset</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446625"><span class="hs-identifier hs-type">bnBound</span></a></span><span>
</span><span id="line-522"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-type">execScheduleWithProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446623"><span class="hs-identifier hs-type">bn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446627"><span class="hs-identifier hs-type">bnProcess</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-523"></span><span>                        </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleRefactoring"><span class="hs-identifier hs-type">scheduleRefactoring</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">I.singleton</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-type">nextTick</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446623"><span class="hs-identifier hs-type">bn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680446628"><span class="hs-identifier hs-type">ref</span></a></span><span>
</span><span id="line-524"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680445052"><span id="local-6989586621680445053"><span id="local-6989586621680445054"><span id="local-6989586621680445055"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445052"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Problems.Allocation.html#AllocationProblem"><span class="hs-identifier hs-type">AllocationProblem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445052"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445053"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445054"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445055"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680445052"><span class="hs-identifier hs-type">tag</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-527"></span><span>    </span><span id="local-6989586621680446649"><span class="annot"><span class="annottext">allocationOptions :: BusNetwork tag v x t -&gt; [Allocation tag]
</span><a href="#local-6989586621680446649"><span class="hs-identifier hs-var hs-var hs-var hs-var">allocationOptions</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446651"><span class="annot"><span class="annottext">tag
bnName :: forall tag v x t. BusNetwork tag v x t -&gt; tag
bnName :: tag
</span><a href="NITTA.Model.Networks.Bus.html#bnName"><span class="hs-identifier hs-var hs-var">bnName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446652"><span class="annot"><span class="annottext">[F v x]
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnRemains :: [F v x]
</span><a href="NITTA.Model.Networks.Bus.html#bnRemains"><span class="hs-identifier hs-var hs-var">bnRemains</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446653"><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
bnPUPrototypes :: forall tag v x t.
BusNetwork tag v x t -&gt; Map tag (PUPrototype tag v x t)
bnPUPrototypes :: Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPUPrototypes"><span class="hs-identifier hs-var hs-var">bnPUPrototypes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-528"></span><span>        </span><span class="annot"><span class="annottext">(tag -&gt; Allocation tag) -&gt; [tag] -&gt; [Allocation tag]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; Allocation tag
</span><a href="#local-6989586621680446654"><span class="hs-identifier hs-var">toOptions</span></a></span><span> </span><span class="annot"><span class="annottext">([tag] -&gt; [Allocation tag]) -&gt; [tag] -&gt; [Allocation tag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t) -&gt; [tag]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">M.keys</span></span><span> </span><span class="annot"><span class="annottext">(Map tag (PUPrototype tag v x t) -&gt; [tag])
-&gt; Map tag (PUPrototype tag v x t) -&gt; [tag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PUPrototype tag v x t -&gt; Bool)
-&gt; Map tag (PUPrototype tag v x t)
-&gt; Map tag (PUPrototype tag v x t)
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUPrototype"><span class="hs-identifier hs-type">PUPrototype</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446662"><span class="annot"><span class="annottext">pu
pProto :: ()
pProto :: pu
</span><a href="NITTA.Model.Networks.Types.html#pProto"><span class="hs-identifier hs-var hs-var">pProto</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(F v x -&gt; Bool) -&gt; [F v x] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">F v x -&gt; pu -&gt; Bool
forall {b} {v} {x} {t}. ProcessorUnit b v x t =&gt; F v x -&gt; b -&gt; Bool
</span><a href="NITTA.Model.ProcessorUnits.Types.html#allowToProcess"><span class="hs-operator hs-var">`allowToProcess`</span></a></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680446662"><span class="hs-identifier hs-var">pProto</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[F v x]
</span><a href="#local-6989586621680446652"><span class="hs-identifier hs-var">bnRemains</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
</span><a href="#local-6989586621680446653"><span class="hs-identifier hs-var">bnPUPrototypes</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-530"></span><span>            </span><span id="local-6989586621680446654"><span class="annot"><span class="annottext">toOptions :: tag -&gt; Allocation tag
</span><a href="#local-6989586621680446654"><span class="hs-identifier hs-var hs-var">toOptions</span></a></span></span><span> </span><span id="local-6989586621680446663"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446663"><span class="hs-identifier hs-var">processUnitTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-531"></span><span>                </span><span class="annot"><a href="NITTA.Model.Problems.Allocation.html#Allocation"><span class="hs-identifier hs-type">Allocation</span></a></span><span>
</span><span id="line-532"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">networkTag :: tag
</span><a href="NITTA.Model.Problems.Allocation.html#networkTag"><span class="hs-identifier hs-var">networkTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446651"><span class="hs-identifier hs-var">bnName</span></a></span><span>
</span><span id="line-533"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tag
processUnitTag :: tag
processUnitTag :: tag
</span><a href="#local-6989586621680446663"><span class="hs-identifier hs-var hs-var">processUnitTag</span></a></span><span>
</span><span id="line-534"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-535"></span><span>
</span><span id="line-536"></span><span>    </span><span id="local-6989586621680446694"><span class="annot"><span class="annottext">allocationDecision :: BusNetwork tag v x t -&gt; Allocation tag -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680446694"><span class="hs-identifier hs-var hs-var hs-var hs-var">allocationDecision</span></a></span></span><span> </span><span id="local-6989586621680446696"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446696"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446697"><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
bnPUPrototypes :: forall tag v x t.
BusNetwork tag v x t -&gt; Map tag (PUPrototype tag v x t)
bnPUPrototypes :: Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPUPrototypes"><span class="hs-identifier hs-var hs-var">bnPUPrototypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446698"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446699"><span class="annot"><span class="annottext">Process t (StepInfo v x t)
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnProcess :: Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var hs-var">bnProcess</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680446700"><span class="annot"><span class="annottext">alloc :: Allocation tag
</span><a href="#local-6989586621680446700"><span class="hs-identifier hs-var">alloc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Problems.Allocation.html#Allocation"><span class="hs-identifier hs-type">Allocation</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446701"><span class="annot"><span class="annottext">tag
networkTag :: forall tag. Allocation tag -&gt; tag
networkTag :: tag
</span><a href="NITTA.Model.Problems.Allocation.html#networkTag"><span class="hs-identifier hs-var hs-var">networkTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446702"><span class="annot"><span class="annottext">tag
processUnitTag :: forall tag. Allocation tag -&gt; tag
processUnitTag :: tag
</span><a href="NITTA.Model.Problems.Allocation.html#processUnitTag"><span class="hs-identifier hs-var hs-var">processUnitTag</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-537"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680446703"><span class="annot"><span class="annottext">tag :: tag
</span><a href="#local-6989586621680446703"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446701"><span class="hs-identifier hs-var">networkTag</span></a></span><span> </span><span class="annot"><span class="annottext">tag -&gt; tag -&gt; tag
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><span class="hs-string">&quot;_&quot;</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; tag -&gt; tag
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; [Char] -&gt; tag
forall tag. UnitTag tag =&gt; tag -&gt; [Char] -&gt; tag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#fromTemplate"><span class="hs-identifier hs-var">fromTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446702"><span class="hs-identifier hs-var">processUnitTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; Int
forall a. Map tag a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446698"><span class="hs-identifier hs-var">bnPus</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>            </span><span id="local-6989586621680446705"><span class="annot"><span class="annottext">prototype :: PUPrototype tag v x t
</span><a href="#local-6989586621680446705"><span class="hs-identifier hs-var hs-var">prototype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-539"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">tag -&gt; Map tag (PUPrototype tag v x t) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">M.member</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446702"><span class="hs-identifier hs-var">processUnitTag</span></a></span><span> </span><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
</span><a href="#local-6989586621680446697"><span class="hs-identifier hs-var">bnPUPrototypes</span></a></span><span>
</span><span id="line-540"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
</span><a href="#local-6989586621680446697"><span class="hs-identifier hs-var">bnPUPrototypes</span></a></span><span> </span><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t) -&gt; tag -&gt; PUPrototype tag v x t
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446702"><span class="hs-identifier hs-var">processUnitTag</span></a></span><span>
</span><span id="line-541"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PUPrototype tag v x t
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; PUPrototype tag v x t)
-&gt; [Char] -&gt; PUPrototype tag v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;No suitable prototype for the tag (&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446702"><span class="hs-identifier hs-var">processUnitTag</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-542"></span><span>            </span><span id="local-6989586621680446706"><span class="annot"><span class="annottext">addPU :: tag -&gt; PUPrototype tag v x t -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680446706"><span class="hs-identifier hs-var hs-var">addPU</span></a></span></span><span> </span><span id="local-6989586621680446707"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446707"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUPrototype"><span class="hs-identifier hs-type">PUPrototype</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446713"><span class="annot"><span class="annottext">pu
pProto :: ()
pProto :: pu
</span><a href="NITTA.Model.Networks.Types.html#pProto"><span class="hs-identifier hs-var hs-var">pProto</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446714"><span class="annot"><span class="annottext">IOPorts pu
pIOPorts :: IOPorts pu
pIOPorts :: ()
</span><a href="#local-6989586621680446714"><span class="hs-identifier hs-var hs-var">pIOPorts</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
-&gt; State (BuilderSt tag v x t) () -&gt; BusNetwork tag v x t
forall k v x t a.
BusNetwork k v x t
-&gt; State (BuilderSt k v x t) a -&gt; BusNetwork k v x t
</span><a href="NITTA.Model.Networks.Bus.html#modifyNetwork"><span class="hs-identifier hs-var">modifyNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446696"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">(State (BuilderSt tag v x t) () -&gt; BusNetwork tag v x t)
-&gt; State (BuilderSt tag v x t) () -&gt; BusNetwork tag v x t
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">tag -&gt; pu -&gt; IOPorts pu -&gt; State (BuilderSt tag v x t) ()
forall tag v x t (m :: * -&gt; *) pu.
(MonadState (BuilderSt tag v x t) m, PUClasses pu v x t,
 UnitTag tag) =&gt;
tag -&gt; pu -&gt; IOPorts pu -&gt; m ()
</span><a href="NITTA.Model.Networks.Bus.html#addCustom"><span class="hs-identifier hs-var">addCustom</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446707"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680446713"><span class="hs-identifier hs-var">pProto</span></a></span><span> </span><span class="annot"><span class="annottext">IOPorts pu
</span><a href="#local-6989586621680446714"><span class="hs-identifier hs-var">pIOPorts</span></a></span><span>
</span><span id="line-543"></span><span>            </span><span id="local-6989586621680446716"><span class="annot"><span class="annottext">nBn :: BusNetwork tag v x t
</span><a href="#local-6989586621680446716"><span class="hs-identifier hs-var hs-var">nBn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tag -&gt; PUPrototype tag v x t -&gt; BusNetwork tag v x t
</span><a href="#local-6989586621680446706"><span class="hs-identifier hs-var">addPU</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446703"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">PUPrototype tag v x t
</span><a href="#local-6989586621680446705"><span class="hs-identifier hs-var">prototype</span></a></span><span>
</span><span id="line-544"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446716"><span class="hs-identifier hs-var">nBn</span></a></span><span>
</span><span id="line-545"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#execScheduleWithProcess"><span class="hs-identifier hs-type">execScheduleWithProcess</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446696"><span class="hs-identifier hs-type">bn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446699"><span class="hs-identifier hs-type">bnProcess</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="NITTA.Utils.ProcessDescription.html#scheduleAllocation"><span class="hs-identifier hs-type">scheduleAllocation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446700"><span class="hs-identifier hs-type">alloc</span></a></span><span>
</span><span id="line-546"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnPUPrototypes"><span class="hs-identifier hs-var">bnPUPrototypes</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-547"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#isTemplate"><span class="hs-identifier hs-type">isTemplate</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446702"><span class="hs-identifier hs-type">processUnitTag</span></a></span><span>
</span><span id="line-548"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><a href="#local-6989586621680446697"><span class="hs-identifier hs-type">bnPUPrototypes</span></a></span><span>
</span><span id="line-549"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.delete</span></span><span> </span><span class="annot"><a href="#local-6989586621680446702"><span class="hs-identifier hs-type">processUnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680446697"><span class="hs-identifier hs-type">bnPUPrototypes</span></a></span><span>
</span><span id="line-550"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="hs-comment">--------------------------------------------------------------------------</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span id="controlSignalLiteral"><span class="annot"><span class="annottext">controlSignalLiteral :: src -&gt; final
</span><a href="NITTA.Model.Networks.Bus.html#controlSignalLiteral"><span class="hs-identifier hs-var hs-var">controlSignalLiteral</span></a></span></span><span> </span><span id="local-6989586621680446735"><span class="annot"><span class="annottext">src
</span><a href="#local-6989586621680446735"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[i|control_bus[#{ ix }]|]</span></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span class="annot"><span class="hs-comment">-- | Add binding to Map tag [F v x] dict</span></span><span>
</span><span id="line-557"></span><span id="registerBinding"><span class="annot"><span class="annottext">registerBinding :: k -&gt; a -&gt; Map k [a] -&gt; Map k [a]
</span><a href="NITTA.Model.Networks.Bus.html#registerBinding"><span class="hs-identifier hs-var hs-var">registerBinding</span></a></span></span><span> </span><span id="local-6989586621680446741"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680446741"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680446742"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446742"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680446743"><span class="annot"><span class="annottext">Map k [a]
</span><a href="#local-6989586621680446743"><span class="hs-identifier hs-var">dict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-558"></span><span>    </span><span class="annot"><span class="annottext">(Maybe [a] -&gt; Maybe [a]) -&gt; k -&gt; Map k [a] -&gt; Map k [a]
forall k a.
Ord k =&gt;
(Maybe a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.alter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [a] -&gt; ([a] -&gt; Maybe [a]) -&gt; Maybe [a] -&gt; Maybe [a]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446742"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; Maybe [a]) -&gt; ([a] -&gt; [a]) -&gt; [a] -&gt; Maybe [a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446742"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680446741"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Map k [a]
</span><a href="#local-6989586621680446743"><span class="hs-identifier hs-var">dict</span></a></span><span>
</span><span id="line-559"></span><span>
</span><span id="line-560"></span><span id="programTicks"><span class="annot"><span class="annottext">programTicks :: u -&gt; [a]
</span><a href="NITTA.Model.Networks.Bus.html#programTicks"><span class="hs-identifier hs-var hs-var">programTicks</span></a></span></span><span> </span><span id="local-6989586621680446752"><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680446752"><span class="hs-identifier hs-var">bn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">u -&gt; a
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">u
</span><a href="#local-6989586621680446752"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span id="bnExternalPorts"><span class="annot"><span class="annottext">bnExternalPorts :: Map k (PU v x t) -&gt; [(k, ([Text], [Text], [Text]))]
</span><a href="NITTA.Model.Networks.Bus.html#bnExternalPorts"><span class="hs-identifier hs-var hs-var">bnExternalPorts</span></a></span></span><span> </span><span id="local-6989586621680446754"><span class="annot"><span class="annottext">Map k (PU v x t)
</span><a href="#local-6989586621680446754"><span class="hs-identifier hs-var">pus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-563"></span><span>    </span><span class="annot"><span class="annottext">Map k ([Text], [Text], [Text]) -&gt; [(k, ([Text], [Text], [Text]))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">(Map k ([Text], [Text], [Text]) -&gt; [(k, ([Text], [Text], [Text]))])
-&gt; Map k ([Text], [Text], [Text])
-&gt; [(k, ([Text], [Text], [Text]))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-564"></span><span>        </span><span class="annot"><span class="annottext">(PU v x t -&gt; ([Text], [Text], [Text]))
-&gt; Map k (PU v x t) -&gt; Map k ([Text], [Text], [Text])
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">M.map</span></span><span>
</span><span id="line-565"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680446755"><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446755"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-566"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(InputPortTag -&gt; Text) -&gt; [InputPortTag] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">InputPortTag -&gt; Text
</span><a href="NITTA.Model.ProcessorUnits.Types.html#inputPortTag"><span class="hs-identifier hs-var">inputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">([InputPortTag] -&gt; [Text]) -&gt; [InputPortTag] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set InputPortTag -&gt; [InputPortTag]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set InputPortTag -&gt; [InputPortTag])
-&gt; Set InputPortTag -&gt; [InputPortTag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; Set InputPortTag
forall {v} {x} {t}. PU v x t -&gt; Set InputPortTag
</span><a href="NITTA.Model.Networks.Types.html#puInputPorts"><span class="hs-identifier hs-var">puInputPorts</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446755"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-567"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(OutputPortTag -&gt; Text) -&gt; [OutputPortTag] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">OutputPortTag -&gt; Text
</span><a href="NITTA.Model.ProcessorUnits.Types.html#outputPortTag"><span class="hs-identifier hs-var">outputPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">([OutputPortTag] -&gt; [Text]) -&gt; [OutputPortTag] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set OutputPortTag -&gt; [OutputPortTag]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set OutputPortTag -&gt; [OutputPortTag])
-&gt; Set OutputPortTag -&gt; [OutputPortTag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; Set OutputPortTag
forall {v} {x} {t}. PU v x t -&gt; Set OutputPortTag
</span><a href="NITTA.Model.Networks.Types.html#puOutputPorts"><span class="hs-identifier hs-var">puOutputPorts</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446755"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-568"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(InoutPortTag -&gt; Text) -&gt; [InoutPortTag] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">InoutPortTag -&gt; Text
</span><a href="NITTA.Model.ProcessorUnits.Types.html#inoutPortTag"><span class="hs-identifier hs-var">inoutPortTag</span></a></span><span> </span><span class="annot"><span class="annottext">([InoutPortTag] -&gt; [Text]) -&gt; [InoutPortTag] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set InoutPortTag -&gt; [InoutPortTag]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set InoutPortTag -&gt; [InoutPortTag])
-&gt; Set InoutPortTag -&gt; [InoutPortTag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; Set InoutPortTag
forall {v} {x} {t}. PU v x t -&gt; Set InoutPortTag
</span><a href="NITTA.Model.Networks.Types.html#puInOutPorts"><span class="hs-identifier hs-var">puInOutPorts</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><a href="#local-6989586621680446755"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-569"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>            </span><span class="annot"><span class="annottext">Map k (PU v x t)
</span><a href="#local-6989586621680446754"><span class="hs-identifier hs-var">pus</span></a></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span id="externalPortsDecl"><span class="annot"><span class="annottext">externalPortsDecl :: t (a, ([Text], [Text], [Text])) -&gt; [Text]
</span><a href="NITTA.Model.Networks.Bus.html#externalPortsDecl"><span class="hs-identifier hs-var hs-var">externalPortsDecl</span></a></span></span><span> </span><span id="local-6989586621680446778"><span class="annot"><span class="annottext">t (a, ([Text], [Text], [Text]))
</span><a href="#local-6989586621680446778"><span class="hs-identifier hs-var">ports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><span class="annottext">((a, ([Text], [Text], [Text])) -&gt; [Text])
-&gt; t (a, ([Text], [Text], [Text])) -&gt; [Text]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680446779"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446779"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446780"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680446780"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446781"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680446781"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446782"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680446782"><span class="hs-identifier hs-var">ios</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-576"></span><span>            </span><span class="annot"><span class="annottext">[[Text]] -&gt; [Text]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-577"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;// external ports for: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446779"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-578"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, input &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680446780"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-579"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, output &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680446781"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-580"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, inout &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680446782"><span class="hs-identifier hs-var">ios</span></a></span><span>
</span><span id="line-581"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-582"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>        </span><span class="annot"><span class="annottext">t (a, ([Text], [Text], [Text]))
</span><a href="#local-6989586621680446778"><span class="hs-identifier hs-var">ports</span></a></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680445116"><span id="local-6989586621680445117"><span id="local-6989586621680445118"><span id="local-6989586621680445119"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445116"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445117"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445118"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445119"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#TargetSystemComponent"><span class="hs-identifier hs-type">TargetSystemComponent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445116"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445117"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445118"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445119"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-586"></span><span>    </span><span id="local-6989586621680446799"><span class="annot"><span class="annottext">moduleName :: Text -&gt; BusNetwork tag v x t -&gt; Text
</span><a href="#local-6989586621680446799"><span class="hs-identifier hs-var hs-var hs-var hs-var">moduleName</span></a></span></span><span> </span><span id="local-6989586621680446801"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446801"><span class="hs-identifier hs-var">_tag</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446802"><span class="annot"><span class="annottext">tag
bnName :: forall tag v x t. BusNetwork tag v x t -&gt; tag
bnName :: tag
</span><a href="NITTA.Model.Networks.Bus.html#bnName"><span class="hs-identifier hs-var hs-var">bnName</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tag -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680446802"><span class="hs-identifier hs-var">bnName</span></a></span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span>    </span><span id="local-6989586621680446887"><span class="annot"><span class="annottext">hardware :: Text -&gt; BusNetwork tag v x t -&gt; Implementation
</span><a href="#local-6989586621680446887"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardware</span></a></span></span><span> </span><span id="local-6989586621680446889"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446889"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680446890"><span class="annot"><span class="annottext">pu :: BusNetwork tag v x t
</span><a href="#local-6989586621680446890"><span class="hs-identifier hs-var">pu</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446891"><span id="local-6989586621680446892"><span id="local-6989586621680446893"><span id="local-6989586621680446894"><span id="local-6989586621680446895"><span id="local-6989586621680446896"><span id="local-6989586621680446897"><span id="local-6989586621680446898"><span id="local-6989586621680446899"><span class="annot"><span class="annottext">tag
Int
[F v x]
Map tag [F v x]
Map tag (PUPrototype tag v x t)
Map tag (PU v x t)
Process t (StepInfo v x t)
UnitEnv (BusNetwork tag v x t)
IOSynchronization
bnName :: forall tag v x t. BusNetwork tag v x t -&gt; tag
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnSignalBusWidth :: forall tag v x t. BusNetwork tag v x t -&gt; Int
ioSync :: forall tag v x t. BusNetwork tag v x t -&gt; IOSynchronization
bnEnv :: forall tag v x t.
BusNetwork tag v x t -&gt; UnitEnv (BusNetwork tag v x t)
bnPUPrototypes :: forall tag v x t.
BusNetwork tag v x t -&gt; Map tag (PUPrototype tag v x t)
bnName :: tag
bnRemains :: [F v x]
bnBound :: Map tag [F v x]
bnProcess :: Process t (StepInfo v x t)
bnPus :: Map tag (PU v x t)
bnSignalBusWidth :: Int
ioSync :: IOSynchronization
bnEnv :: UnitEnv (BusNetwork tag v x t)
bnPUPrototypes :: Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnName"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-589"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680446900"><span class="annot"><span class="annottext">[Verilog]
</span><a href="#local-6989586621680446900"><span class="hs-identifier hs-var">instances</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446901"><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621680446901"><span class="hs-identifier hs-var">valuesRegs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Verilog]
-&gt; [(Text, Text)]
-&gt; [(tag, PU v x t)]
-&gt; ([Verilog], [(Text, Text)])
forall {a} {v} {x} {t}.
ToString a =&gt;
[Verilog]
-&gt; [(Text, Text)] -&gt; [(a, PU v x t)] -&gt; ([Verilog], [(Text, Text)])
</span><a href="#local-6989586621680446902"><span class="hs-identifier hs-var">renderInstance</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([(tag, PU v x t)] -&gt; ([Verilog], [(Text, Text)]))
-&gt; [(tag, PU v x t)] -&gt; ([Verilog], [(Text, Text)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446895"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-590"></span><span>            </span><span id="local-6989586621680446903"><span class="annot"><span class="annottext">mn :: Text
</span><a href="#local-6989586621680446903"><span class="hs-identifier hs-var hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; BusNetwork tag v x t -&gt; Text
forall pu. TargetSystemComponent pu =&gt; Text -&gt; pu -&gt; Text
</span><a href="NITTA.Project.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446889"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446890"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-591"></span><span>            </span><span id="local-6989586621680446904"><span class="annot"><span class="annottext">iml :: Text
</span><a href="#local-6989586621680446904"><span class="hs-identifier hs-var hs-var">iml</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-592"></span><span>                </span><span class="annot"><span class="">[__i|
                    module #{ mn } \#
                            ( parameter DATA_WIDTH = #{ dataWidth (def :: x) }
                            , parameter ATTR_WIDTH = #{ attrWidth (def :: x) }
                            )
                        ( input                     clk
                        , input                     rst
                        , input                     is_drop_allow
                        , output                    flag_cycle_begin
                        , output                    flag_in_cycle
                        , output                    flag_cycle_end
                        #{ nest 4 $ vsep $ map pretty $ externalPortsDecl $ bnExternalPorts bnPus }
                        , output              [7:0] debug_status
                        , output              [7:0] debug_bus1
                        , output              [7:0] debug_bus2
                        );

                    parameter MICROCODE_WIDTH = #{ bnSignalBusWidth };

                    wire start, stop;

                    wire [MICROCODE_WIDTH-1:0] control_bus;
                    wire [DATA_WIDTH-1:0] data_bus;
                    wire [ATTR_WIDTH-1:0] attr_bus;

                    // Debug
                    assign debug_status = { flag_cycle_begin, flag_in_cycle, flag_cycle_end, data_bus[4:0] };
                    assign debug_bus1 = data_bus[7:0];
                    assign debug_bus2 = data_bus[31:24] | data_bus[23:16] | data_bus[15:8] | data_bus[7:0];


                    // Sub module instances

                    pu_simple_control \#
                            ( .MICROCODE_WIDTH( MICROCODE_WIDTH )
                            , .PROGRAM_DUMP( &quot;{{ impl.paths.nest }}/#{ mn }.dump&quot; )
                            , .MEMORY_SIZE( #{ length $ programTicks pu } ) // 0 - address for nop microcode
                            ) control_unit
                        ( .clk( clk )
                        , .rst( rst )

                        , .signal_cycle_start( #{ isDrowAllowSignal ioSync } || stop )

                        , .signals_out( control_bus )

                        , .flag_cycle_begin( flag_cycle_begin )
                        , .flag_in_cycle( flag_in_cycle )
                        , .flag_cycle_end( flag_cycle_end )
                        );

                    #{ vsep $ punctuate &quot;\n\n&quot; instances }

                    assign data_bus = #{ T.intercalate &quot; | &quot; $ map snd valuesRegs };
                    assign attr_bus = #{ T.intercalate &quot; | &quot; $ map fst valuesRegs };

                    endmodule
                    |]</span></span><span>
</span><span id="line-649"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Implementation] -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Aggregate"><span class="hs-identifier hs-var">Aggregate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Maybe [Char]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Maybe [Char]) -&gt; [Char] -&gt; Maybe [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446903"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Implementation] -&gt; Implementation)
-&gt; [Implementation] -&gt; Implementation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-650"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Immediate"><span class="hs-identifier hs-var">Immediate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Char]) -&gt; Text -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446903"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.v&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446904"><span class="hs-identifier hs-var">iml</span></a></span><span>
</span><span id="line-651"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Implementation
</span><a href="NITTA.Project.Types.html#FromLibrary"><span class="hs-identifier hs-var">FromLibrary</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;pu_simple_control.v&quot;</span></span><span>
</span><span id="line-652"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-653"></span><span>                    </span><span class="annot"><span class="annottext">[Implementation] -&gt; [Implementation] -&gt; [Implementation]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; Implementation)
-&gt; [(tag, PU v x t)] -&gt; [Implementation]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; PU v x t -&gt; Implementation)
-&gt; (Text, PU v x t) -&gt; Implementation
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PU v x t -&gt; Implementation
forall pu. TargetSystemComponent pu =&gt; Text -&gt; pu -&gt; Implementation
</span><a href="NITTA.Project.Types.html#hardware"><span class="hs-identifier hs-var">hardware</span></a></span><span> </span><span class="annot"><span class="annottext">((Text, PU v x t) -&gt; Implementation)
-&gt; ((tag, PU v x t) -&gt; (Text, PU v x t))
-&gt; (tag, PU v x t)
-&gt; Implementation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(tag -&gt; Text) -&gt; (tag, PU v x t) -&gt; (Text, PU v x t)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446895"><span class="hs-identifier hs-var">bnPus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-655"></span><span>            </span><span id="local-6989586621680446935"><span class="annot"><span class="annottext">regInstance :: src -&gt; final
</span><a href="#local-6989586621680446935"><span class="hs-identifier hs-var hs-var">regInstance</span></a></span></span><span> </span><span id="local-6989586621680446936"><span class="annot"><span class="annottext">src
</span><a href="#local-6989586621680446936"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-656"></span><span>                </span><span class="annot"><span class="">[__i|
                    wire [DATA_WIDTH-1:0] #{ t }_data_out;
                    wire [ATTR_WIDTH-1:0] #{ t }_attr_out;
                |]</span></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span>            </span><span id="local-6989586621680446902"><span class="annot"><span class="annottext">renderInstance :: [Verilog]
-&gt; [(Text, Text)] -&gt; [(a, PU v x t)] -&gt; ([Verilog], [(Text, Text)])
</span><a href="#local-6989586621680446902"><span class="hs-identifier hs-var hs-var">renderInstance</span></a></span></span><span> </span><span id="local-6989586621680446939"><span class="annot"><span class="annottext">[Verilog]
</span><a href="#local-6989586621680446939"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span id="local-6989586621680446940"><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621680446940"><span class="hs-identifier hs-var">regs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Verilog] -&gt; [Verilog]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[Verilog]
</span><a href="#local-6989586621680446939"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Text, Text)] -&gt; [(Text, Text)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621680446940"><span class="hs-identifier hs-var">regs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>            </span><span class="annot"><a href="#local-6989586621680446902"><span class="hs-identifier hs-var">renderInstance</span></a></span><span> </span><span id="local-6989586621680446942"><span class="annot"><span class="annottext">[Verilog]
</span><a href="#local-6989586621680446942"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span id="local-6989586621680446943"><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621680446943"><span class="hs-identifier hs-var">regs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621680446944"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446944"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PU"><span class="hs-identifier hs-type">PU</span></a></span><span class="hs-special">{</span><span id="local-6989586621680446961"><span class="annot"><span class="annottext">pu
unit :: ()
unit :: pu
</span><a href="NITTA.Model.Networks.Types.html#unit"><span class="hs-keyword hs-var hs-var">unit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446962"><span class="annot"><span class="annottext">UnitEnv pu
uEnv :: ()
uEnv :: UnitEnv pu
</span><a href="NITTA.Model.Networks.Types.html#uEnv"><span class="hs-identifier hs-var hs-var">uEnv</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621680446963"><span class="annot"><span class="annottext">[(a, PU v x t)]
</span><a href="#local-6989586621680446963"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-663"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680446964"><span class="annot"><span class="annottext">inst :: Verilog
</span><a href="#local-6989586621680446964"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; pu -&gt; UnitEnv pu -&gt; Verilog
forall pu.
TargetSystemComponent pu =&gt;
Text -&gt; pu -&gt; UnitEnv pu -&gt; Verilog
</span><a href="NITTA.Project.Types.html#hardwareInstance"><span class="hs-identifier hs-var">hardwareInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446944"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680446961"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv pu
</span><a href="#local-6989586621680446962"><span class="hs-identifier hs-var">uEnv</span></a></span><span>
</span><span id="line-664"></span><span>                    </span><span id="local-6989586621680446966"><span class="annot"><span class="annottext">insts' :: [Verilog]
</span><a href="#local-6989586621680446966"><span class="hs-identifier hs-var hs-var">insts'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Verilog
</span><a href="#local-6989586621680446964"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; [Verilog] -&gt; [Verilog]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Verilog
forall {final} {src}.
Interpolatable (IsCustomSink final) src final =&gt;
src -&gt; final
</span><a href="#local-6989586621680446935"><span class="hs-identifier hs-var">regInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446944"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Verilog -&gt; [Verilog] -&gt; [Verilog]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Verilog]
</span><a href="#local-6989586621680446942"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-665"></span><span>                    </span><span id="local-6989586621680446967"><span class="annot"><span class="annottext">regs' :: [(Text, Text)]
</span><a href="#local-6989586621680446967"><span class="hs-identifier hs-var hs-var">regs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446944"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_attr_out&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680446944"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_data_out&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text, Text) -&gt; [(Text, Text)] -&gt; [(Text, Text)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621680446943"><span class="hs-identifier hs-var">regs</span></a></span><span>
</span><span id="line-666"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Verilog]
-&gt; [(Text, Text)] -&gt; [(a, PU v x t)] -&gt; ([Verilog], [(Text, Text)])
</span><a href="#local-6989586621680446902"><span class="hs-identifier hs-var">renderInstance</span></a></span><span> </span><span class="annot"><span class="annottext">[Verilog]
</span><a href="#local-6989586621680446966"><span class="hs-identifier hs-var">insts'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621680446967"><span class="hs-identifier hs-var">regs'</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, PU v x t)]
</span><a href="#local-6989586621680446963"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span>    </span><span id="local-6989586621680446984"><span class="annot"><span class="annottext">software :: Text -&gt; BusNetwork tag v x t -&gt; Implementation
</span><a href="#local-6989586621680446984"><span class="hs-identifier hs-var hs-var hs-var hs-var">software</span></a></span></span><span> </span><span id="local-6989586621680446986"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446986"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680446987"><span class="annot"><span class="annottext">pu :: BusNetwork tag v x t
</span><a href="#local-6989586621680446987"><span class="hs-identifier hs-var">pu</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bnProcess :: forall tag v x t.
BusNetwork tag v x t -&gt; Process t (StepInfo v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnProcess"><span class="hs-identifier hs-var">bnProcess</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Process"><span class="hs-identifier hs-type">Process</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680446988"><span id="local-6989586621680446989"><span id="local-6989586621680446990"><span id="local-6989586621680446991"><span id="local-6989586621680446992"><span id="local-6989586621680446993"><span id="local-6989586621680446994"><span id="local-6989586621680446995"><span class="annot"><span class="annottext">tag
Int
[F v x]
Map tag [F v x]
Map tag (PUPrototype tag v x t)
Map tag (PU v x t)
UnitEnv (BusNetwork tag v x t)
IOSynchronization
bnName :: forall tag v x t. BusNetwork tag v x t -&gt; tag
bnRemains :: forall tag v x t. BusNetwork tag v x t -&gt; [F v x]
bnBound :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag [F v x]
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnSignalBusWidth :: forall tag v x t. BusNetwork tag v x t -&gt; Int
ioSync :: forall tag v x t. BusNetwork tag v x t -&gt; IOSynchronization
bnEnv :: forall tag v x t.
BusNetwork tag v x t -&gt; UnitEnv (BusNetwork tag v x t)
bnPUPrototypes :: forall tag v x t.
BusNetwork tag v x t -&gt; Map tag (PUPrototype tag v x t)
bnName :: tag
bnRemains :: [F v x]
bnBound :: Map tag [F v x]
bnPus :: Map tag (PU v x t)
bnSignalBusWidth :: Int
ioSync :: IOSynchronization
bnEnv :: UnitEnv (BusNetwork tag v x t)
bnPUPrototypes :: Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnName"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-669"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680446996"><span class="annot"><span class="annottext">subSW :: [Implementation]
</span><a href="#local-6989586621680446996"><span class="hs-identifier hs-var hs-var">subSW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; Implementation)
-&gt; [(tag, PU v x t)] -&gt; [Implementation]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; PU v x t -&gt; Implementation)
-&gt; (Text, PU v x t) -&gt; Implementation
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PU v x t -&gt; Implementation
forall pu. TargetSystemComponent pu =&gt; Text -&gt; pu -&gt; Implementation
</span><a href="NITTA.Project.Types.html#software"><span class="hs-identifier hs-var">software</span></a></span><span> </span><span class="annot"><span class="annottext">((Text, PU v x t) -&gt; Implementation)
-&gt; ((tag, PU v x t) -&gt; (Text, PU v x t))
-&gt; (tag, PU v x t)
-&gt; Implementation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(tag -&gt; Text) -&gt; (tag, PU v x t) -&gt; (Text, PU v x t)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(tag, PU v x t)] -&gt; [Implementation])
-&gt; [(tag, PU v x t)] -&gt; [Implementation]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680446991"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-670"></span><span>            </span><span id="local-6989586621680446997"><span class="annot"><span class="annottext">sw :: [Implementation]
</span><a href="#local-6989586621680446997"><span class="hs-identifier hs-var hs-var">sw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Char] -&gt; Text -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Immediate"><span class="hs-identifier hs-var">Immediate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Char]) -&gt; Text -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446998"><span class="hs-identifier hs-var">mn</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.dump&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Implementation) -&gt; Text -&gt; Implementation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680447000"><span class="hs-identifier hs-var">memoryDump</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-671"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Implementation] -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Aggregate"><span class="hs-identifier hs-var">Aggregate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Maybe [Char]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Maybe [Char]) -&gt; [Char] -&gt; Maybe [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446998"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Implementation] -&gt; Implementation)
-&gt; [Implementation] -&gt; Implementation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Implementation]
</span><a href="#local-6989586621680446996"><span class="hs-identifier hs-var">subSW</span></a></span><span> </span><span class="annot"><span class="annottext">[Implementation] -&gt; [Implementation] -&gt; [Implementation]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Implementation]
</span><a href="#local-6989586621680446997"><span class="hs-identifier hs-var">sw</span></a></span><span>
</span><span id="line-672"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-673"></span><span>            </span><span id="local-6989586621680446998"><span class="annot"><span class="annottext">mn :: Text
</span><a href="#local-6989586621680446998"><span class="hs-identifier hs-var hs-var">mn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; BusNetwork tag v x t -&gt; Text
forall pu. TargetSystemComponent pu =&gt; Text -&gt; pu -&gt; Text
</span><a href="NITTA.Project.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680446986"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446987"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-674"></span><span>            </span><span class="hs-comment">-- Nop operation sets for all processor units at address 0. It is a</span><span>
</span><span id="line-675"></span><span>            </span><span class="hs-comment">-- safe state of the processor which is selected when rst signal is</span><span>
</span><span id="line-676"></span><span>            </span><span class="hs-comment">-- active.</span><span>
</span><span id="line-677"></span><span>            </span><span id="local-6989586621680447000"><span class="annot"><span class="annottext">memoryDump :: [Char]
</span><a href="#local-6989586621680447000"><span class="hs-identifier hs-var hs-var">memoryDump</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; [Char]) -&gt; [[Char]] -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(t -&gt; [Char]) -&gt; [t] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SignalValue] -&gt; [Char]
forall {t :: * -&gt; *} {a}. (Foldable t, Show a) =&gt; t a -&gt; [Char]
</span><a href="NITTA.Utils.html#values2dump"><span class="hs-identifier hs-var">values2dump</span></a></span><span> </span><span class="annot"><span class="annottext">([SignalValue] -&gt; [Char]) -&gt; (t -&gt; [SignalValue]) -&gt; t -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Microcode (BusNetwork tag v x t) -&gt; [SignalValue]
forall {tag} {v} {x} {t}.
Microcode (BusNetwork tag v x t) -&gt; [SignalValue]
</span><a href="#local-6989586621680447003"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="annot"><span class="annottext">(Microcode (BusNetwork tag v x t) -&gt; [SignalValue])
-&gt; (t -&gt; Microcode (BusNetwork tag v x t)) -&gt; t -&gt; [SignalValue]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; t -&gt; Microcode (BusNetwork tag v x t)
forall pu t. ByTime pu t =&gt; pu -&gt; t -&gt; Microcode pu
</span><a href="NITTA.Model.ProcessorUnits.Types.html#microcodeAt"><span class="hs-identifier hs-var">microcodeAt</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446987"><span class="hs-identifier hs-var">pu</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([t] -&gt; [[Char]]) -&gt; [t] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; [t]
forall {a} {u}. (Num a, NextTick u a, Enum a) =&gt; u -&gt; [a]
</span><a href="NITTA.Model.Networks.Bus.html#programTicks"><span class="hs-identifier hs-var">programTicks</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680446987"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-678"></span><span>            </span><span id="local-6989586621680447003"><span class="annot"><span class="annottext">values :: Microcode (BusNetwork tag v x t) -&gt; [SignalValue]
</span><a href="#local-6989586621680447003"><span class="hs-identifier hs-var hs-var">values</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetworkMC"><span class="hs-identifier hs-type">BusNetworkMC</span></a></span><span> </span><span id="local-6989586621680447011"><span class="annot"><span class="annottext">Map SignalTag SignalValue
</span><a href="#local-6989586621680447011"><span class="hs-identifier hs-var">arr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-679"></span><span>                </span><span class="annot"><span class="annottext">[SignalValue] -&gt; [SignalValue]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">([SignalValue] -&gt; [SignalValue]) -&gt; [SignalValue] -&gt; [SignalValue]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-680"></span><span>                    </span><span class="annot"><span class="annottext">((SignalTag, SignalValue) -&gt; SignalValue)
-&gt; [(SignalTag, SignalValue)] -&gt; [SignalValue]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(SignalTag, SignalValue) -&gt; SignalValue
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(SignalTag, SignalValue)] -&gt; [SignalValue])
-&gt; [(SignalTag, SignalValue)] -&gt; [SignalValue]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-681"></span><span>                        </span><span class="annot"><span class="annottext">((SignalTag, SignalValue) -&gt; Int)
-&gt; [(SignalTag, SignalValue)] -&gt; [(SignalTag, SignalValue)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680447012"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680447012"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int
forall a. Read a =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621680447012"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Int)
-&gt; ((SignalTag, SignalValue) -&gt; [Char])
-&gt; (SignalTag, SignalValue)
-&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; [Char])
-&gt; ((SignalTag, SignalValue) -&gt; [[Char]])
-&gt; (SignalTag, SignalValue)
-&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Maybe [[Char]] -&gt; [[Char]]
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">(Maybe [[Char]] -&gt; [[Char]])
-&gt; ((SignalTag, SignalValue) -&gt; Maybe [[Char]])
-&gt; (SignalTag, SignalValue)
-&gt; [[Char]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Regex -&gt; [Char] -&gt; Maybe [[Char]]
</span><span class="hs-identifier hs-var">matchRegex</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Regex
</span><span class="hs-identifier hs-var">mkRegex</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;([[:digit:]]+)&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Maybe [[Char]])
-&gt; ((SignalTag, SignalValue) -&gt; [Char])
-&gt; (SignalTag, SignalValue)
-&gt; Maybe [[Char]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Char])
-&gt; ((SignalTag, SignalValue) -&gt; Text)
-&gt; (SignalTag, SignalValue)
-&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SignalTag -&gt; Text
</span><a href="NITTA.Model.ProcessorUnits.Types.html#signalTag"><span class="hs-identifier hs-var">signalTag</span></a></span><span> </span><span class="annot"><span class="annottext">(SignalTag -&gt; Text)
-&gt; ((SignalTag, SignalValue) -&gt; SignalTag)
-&gt; (SignalTag, SignalValue)
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SignalTag, SignalValue) -&gt; SignalTag
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(SignalTag, SignalValue)] -&gt; [(SignalTag, SignalValue)])
-&gt; [(SignalTag, SignalValue)] -&gt; [(SignalTag, SignalValue)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-682"></span><span>                            </span><span class="annot"><span class="annottext">Map SignalTag SignalValue -&gt; [(SignalTag, SignalValue)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map SignalTag SignalValue
</span><a href="#local-6989586621680447011"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>    </span><span id="local-6989586621680447085"><span class="annot"><span class="annottext">hardwareInstance :: Text
-&gt; BusNetwork tag v x t
-&gt; UnitEnv (BusNetwork tag v x t)
-&gt; Verilog
</span><a href="NITTA.Project.Types.html#hardwareInstance"><span class="hs-identifier hs-var hs-var hs-var hs-var">hardwareInstance</span></a></span></span><span> </span><span id="local-6989586621680447086"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680447086"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#UnitEnv"><span class="hs-identifier hs-type">UnitEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621680447087"><span class="annot"><span class="annottext">Text
sigRst :: Text
sigRst :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680447087"><span class="hs-identifier hs-var hs-var">sigRst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447089"><span class="annot"><span class="annottext">Text
sigClk :: Text
sigClk :: forall m. UnitEnv m -&gt; Text
</span><a href="#local-6989586621680447089"><span class="hs-identifier hs-var hs-var">sigClk</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ioPorts :: forall m. UnitEnv m -&gt; Maybe (IOPorts m)
</span><a href="NITTA.Project.Types.html#ioPorts"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680447092"><span class="annot"><span class="annottext">IOPorts (BusNetwork tag v x t)
</span><a href="#local-6989586621680447092"><span class="hs-identifier hs-var">ioPorts</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680447111"><span class="annot"><span class="annottext">io2v :: src -&gt; final
</span><a href="#local-6989586621680447111"><span class="hs-identifier hs-var hs-var">io2v</span></a></span></span><span> </span><span id="local-6989586621680447112"><span class="annot"><span class="annottext">src
</span><a href="#local-6989586621680447112"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[i|, .#{ n }( #{ n } )|]</span></span><span>
</span><span id="line-686"></span><span>              </span><span id="local-6989586621680447114"><span class="annot"><span class="annottext">is :: [Doc Any]
</span><a href="#local-6989586621680447114"><span class="hs-identifier hs-var hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InputPortTag -&gt; Doc Any) -&gt; [InputPortTag] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Doc Any
forall {final} {src}.
Interpolatable (IsCustomSink final) src final =&gt;
src -&gt; final
</span><a href="#local-6989586621680447111"><span class="hs-identifier hs-var">io2v</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Doc Any)
-&gt; (InputPortTag -&gt; Text) -&gt; InputPortTag -&gt; Doc Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InputPortTag -&gt; Text
</span><a href="NITTA.Model.ProcessorUnits.Types.html#inputPortTag"><span class="hs-identifier hs-var">inputPortTag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([InputPortTag] -&gt; [Doc Any]) -&gt; [InputPortTag] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set InputPortTag -&gt; [InputPortTag]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set InputPortTag -&gt; [InputPortTag])
-&gt; Set InputPortTag -&gt; [InputPortTag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IOPorts (BusNetwork tag v x t) -&gt; Set InputPortTag
forall pu. IOConnected pu =&gt; IOPorts pu -&gt; Set InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#inputPorts"><span class="hs-identifier hs-var">inputPorts</span></a></span><span> </span><span class="annot"><span class="annottext">IOPorts (BusNetwork tag v x t)
</span><a href="#local-6989586621680447092"><span class="hs-identifier hs-var">ioPorts</span></a></span><span>
</span><span id="line-687"></span><span>              </span><span id="local-6989586621680447116"><span class="annot"><span class="annottext">os :: [Doc Any]
</span><a href="#local-6989586621680447116"><span class="hs-identifier hs-var hs-var">os</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OutputPortTag -&gt; Doc Any) -&gt; [OutputPortTag] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Doc Any
forall {final} {src}.
Interpolatable (IsCustomSink final) src final =&gt;
src -&gt; final
</span><a href="#local-6989586621680447111"><span class="hs-identifier hs-var">io2v</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Doc Any)
-&gt; (OutputPortTag -&gt; Text) -&gt; OutputPortTag -&gt; Doc Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OutputPortTag -&gt; Text
</span><a href="NITTA.Model.ProcessorUnits.Types.html#outputPortTag"><span class="hs-identifier hs-var">outputPortTag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([OutputPortTag] -&gt; [Doc Any]) -&gt; [OutputPortTag] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set OutputPortTag -&gt; [OutputPortTag]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set OutputPortTag -&gt; [OutputPortTag])
-&gt; Set OutputPortTag -&gt; [OutputPortTag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IOPorts (BusNetwork tag v x t) -&gt; Set OutputPortTag
forall pu. IOConnected pu =&gt; IOPorts pu -&gt; Set OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#outputPorts"><span class="hs-identifier hs-var">outputPorts</span></a></span><span> </span><span class="annot"><span class="annottext">IOPorts (BusNetwork tag v x t)
</span><a href="#local-6989586621680447092"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-688"></span><span>            </span><span class="annot"><span class="">[__i|
                    #{ tag } \#
                            ( .DATA_WIDTH( #{ dataWidth (def :: x) } )
                            , .ATTR_WIDTH( #{ attrWidth (def :: x) } )
                            ) net
                        ( .rst( #{ sigRst } )
                        , .clk( #{ sigClk } )
                        // inputs:
                        #{ nest 4 $ vsep is }
                        // outputs:
                        #{ nest 4 $ vsep os }
                        , .debug_status( debug_status ) // FIXME:
                        , .debug_bus1( debug_bus1 )     // FIXME:
                        , .debug_bus2( debug_bus2 )     // FIXME:
                        , .is_drop_allow( rendezvous )  // FIXME:
                        );
                |]</span></span><span>
</span><span id="line-705"></span><span>    </span><span class="annot"><a href="NITTA.Project.Types.html#hardwareInstance"><span class="hs-identifier hs-var">hardwareInstance</span></a></span><span> </span><span id="local-6989586621680447119"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680447119"><span class="hs-identifier hs-var">_title</span></a></span></span><span> </span><span id="local-6989586621680447120"><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680447120"><span class="hs-identifier hs-var">_bn</span></a></span></span><span> </span><span id="local-6989586621680447121"><span class="annot"><span class="annottext">UnitEnv (BusNetwork tag v x t)
</span><a href="#local-6989586621680447121"><span class="hs-identifier hs-var">_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-706"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Verilog
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;BusNetwork should be NetworkEnv&quot;</span></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680445167"><span id="local-6989586621680445168"><span id="local-6989586621680445169"><span id="local-6989586621680445170"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Connected"><span class="hs-identifier hs-type">Connected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445167"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445168"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445169"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445170"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-709"></span><span>    </span><span class="hs-keyword">data</span><span> </span><span id="Ports"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#Ports"><span class="hs-identifier hs-var">Ports</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445167"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445168"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445169"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445170"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BusNetworkPorts"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetworkPorts"><span class="hs-identifier hs-var">BusNetworkPorts</span></a></span></span><span>
</span><span id="line-710"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680447125"><span id="local-6989586621680447127"><span id="local-6989586621680447131"><span class="annot"><span class="annottext">Int -&gt; Ports (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char]
[Ports (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char]
Ports (BusNetwork tag v x t) -&gt; [Char]
(Int -&gt; Ports (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char])
-&gt; (Ports (BusNetwork tag v x t) -&gt; [Char])
-&gt; ([Ports (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char])
-&gt; Show (Ports (BusNetwork tag v x t))
forall a.
(Int -&gt; a -&gt; [Char] -&gt; [Char])
-&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; [Char] -&gt; [Char]) -&gt; Show a
forall tag v x t.
Int -&gt; Ports (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char]
forall tag v x t.
[Ports (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char]
forall tag v x t. Ports (BusNetwork tag v x t) -&gt; [Char]
$cshowsPrec :: forall tag v x t.
Int -&gt; Ports (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char]
showsPrec :: Int -&gt; Ports (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char]
$cshow :: forall tag v x t. Ports (BusNetwork tag v x t) -&gt; [Char]
show :: Ports (BusNetwork tag v x t) -&gt; [Char]
$cshowList :: forall tag v x t.
[Ports (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char]
showList :: [Ports (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>
</span><span id="line-712"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680445152"><span id="local-6989586621680445153"><span id="local-6989586621680445154"><span id="local-6989586621680445155"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOConnected"><span class="hs-identifier hs-type">IOConnected</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445152"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445153"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445154"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445155"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-713"></span><span>    </span><span class="hs-keyword">data</span><span> </span><span id="IOPorts"><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier hs-var">IOPorts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445152"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445153"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445154"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445155"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BusNetworkIO"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetworkIO"><span class="hs-identifier hs-var">BusNetworkIO</span></a></span></span><span>
</span><span id="line-714"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="extInputs"><span class="annot"><span class="annottext">forall tag v x t.
IOPorts (BusNetwork tag v x t) -&gt; Set InputPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extInputs"><span class="hs-identifier hs-var hs-var">extInputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InputPortTag"><span class="hs-identifier hs-type">InputPortTag</span></a></span><span>
</span><span id="line-715"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="extOutputs"><span class="annot"><span class="annottext">forall tag v x t.
IOPorts (BusNetwork tag v x t) -&gt; Set OutputPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extOutputs"><span class="hs-identifier hs-var hs-var">extOutputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#OutputPortTag"><span class="hs-identifier hs-type">OutputPortTag</span></a></span><span>
</span><span id="line-716"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="extInOuts"><span class="annot"><span class="annottext">forall tag v x t.
IOPorts (BusNetwork tag v x t) -&gt; Set InoutPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extInOuts"><span class="hs-identifier hs-var hs-var">extInOuts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#InoutPortTag"><span class="hs-identifier hs-type">InoutPortTag</span></a></span><span>
</span><span id="line-717"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-718"></span><span>        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680447142"><span id="local-6989586621680447152"><span id="local-6989586621680447156"><span class="annot"><span class="annottext">Int -&gt; IOPorts (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char]
[IOPorts (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char]
IOPorts (BusNetwork tag v x t) -&gt; [Char]
(Int -&gt; IOPorts (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char])
-&gt; (IOPorts (BusNetwork tag v x t) -&gt; [Char])
-&gt; ([IOPorts (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char])
-&gt; Show (IOPorts (BusNetwork tag v x t))
forall a.
(Int -&gt; a -&gt; [Char] -&gt; [Char])
-&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; [Char] -&gt; [Char]) -&gt; Show a
forall tag v x t.
Int -&gt; IOPorts (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char]
forall tag v x t.
[IOPorts (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char]
forall tag v x t. IOPorts (BusNetwork tag v x t) -&gt; [Char]
$cshowsPrec :: forall tag v x t.
Int -&gt; IOPorts (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char]
showsPrec :: Int -&gt; IOPorts (BusNetwork tag v x t) -&gt; [Char] -&gt; [Char]
$cshow :: forall tag v x t. IOPorts (BusNetwork tag v x t) -&gt; [Char]
show :: IOPorts (BusNetwork tag v x t) -&gt; [Char]
$cshowList :: forall tag v x t.
[IOPorts (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char]
showList :: [IOPorts (BusNetwork tag v x t)] -&gt; [Char] -&gt; [Char]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-719"></span><span>    </span><span id="local-6989586621680447161"><span class="annot"><span class="annottext">inputPorts :: IOPorts (BusNetwork tag v x t) -&gt; Set InputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#inputPorts"><span class="hs-identifier hs-var hs-var hs-var hs-var">inputPorts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOPorts (BusNetwork tag v x t) -&gt; Set InputPortTag
forall tag v x t.
IOPorts (BusNetwork tag v x t) -&gt; Set InputPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extInputs"><span class="hs-identifier hs-var">extInputs</span></a></span><span>
</span><span id="line-720"></span><span>    </span><span id="local-6989586621680447162"><span class="annot"><span class="annottext">outputPorts :: IOPorts (BusNetwork tag v x t) -&gt; Set OutputPortTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#outputPorts"><span class="hs-identifier hs-var hs-var hs-var hs-var">outputPorts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOPorts (BusNetwork tag v x t) -&gt; Set OutputPortTag
forall tag v x t.
IOPorts (BusNetwork tag v x t) -&gt; Set OutputPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extOutputs"><span class="hs-identifier hs-var">extOutputs</span></a></span><span>
</span><span id="line-721"></span><span>    </span><span id="local-6989586621680447163"><span class="annot"><span class="annottext">inoutPorts :: IOPorts (BusNetwork tag v x t) -&gt; Set InoutPortTag
</span><a href="#local-6989586621680447163"><span class="hs-identifier hs-var hs-var hs-var hs-var">inoutPorts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOPorts (BusNetwork tag v x t) -&gt; Set InoutPortTag
forall tag v x t.
IOPorts (BusNetwork tag v x t) -&gt; Set InoutPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extInOuts"><span class="hs-identifier hs-var">extInOuts</span></a></span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680445214"><span id="local-6989586621680445215"><span id="local-6989586621680445216"><span id="local-6989586621680445217"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445214"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTime"><span class="hs-identifier hs-type">VarValTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445215"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445216"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445217"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NITTA.Project.TestBench.html#Testable"><span class="hs-identifier hs-type">Testable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445214"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445215"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445216"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445217"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680445215"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445216"><span class="hs-identifier hs-type">x</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-724"></span><span>    </span><span id="local-6989586621680447557"><span class="annot"><span class="annottext">testBenchImplementation :: Project (BusNetwork tag v x t) v x -&gt; Implementation
</span><a href="#local-6989586621680447557"><span class="hs-identifier hs-var hs-var hs-var hs-var">testBenchImplementation</span></a></span></span><span>
</span><span id="line-725"></span><span>        </span><span class="annot"><a href="NITTA.Project.Types.html#Project"><span class="hs-identifier hs-type">Project</span></a></span><span>
</span><span id="line-726"></span><span>            </span><span class="hs-special">{</span><span> </span><span id="local-6989586621680447560"><span class="annot"><span class="annottext">Text
pName :: Text
pName :: forall m v x. Project m v x -&gt; Text
</span><a href="#local-6989586621680447560"><span class="hs-identifier hs-var hs-var">pName</span></a></span></span><span>
</span><span id="line-727"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pUnit :: forall m v x. Project m v x -&gt; m
</span><a href="NITTA.Project.Types.html#pUnit"><span class="hs-identifier hs-var">pUnit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680447563"><span class="annot"><span class="annottext">bn :: BusNetwork tag v x t
</span><a href="#local-6989586621680447563"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680447564"><span class="annot"><span class="annottext">Map tag (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447565"><span class="annot"><span class="annottext">IOSynchronization
ioSync :: forall tag v x t. BusNetwork tag v x t -&gt; IOSynchronization
ioSync :: IOSynchronization
</span><a href="NITTA.Model.Networks.Bus.html#ioSync"><span class="hs-identifier hs-var hs-var">ioSync</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447566"><span class="annot"><span class="annottext">tag
bnName :: forall tag v x t. BusNetwork tag v x t -&gt; tag
bnName :: tag
</span><a href="NITTA.Model.Networks.Bus.html#bnName"><span class="hs-identifier hs-var hs-var">bnName</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-728"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pTestCntx :: forall m v x. Project m v x -&gt; Cntx v x
</span><a href="NITTA.Project.Types.html#pTestCntx"><span class="hs-identifier hs-var">pTestCntx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621680447568"><span class="annot"><span class="annottext">pTestCntx :: Cntx v x
</span><a href="#local-6989586621680447568"><span class="hs-identifier hs-var">pTestCntx</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Intermediate.Types.html#Cntx"><span class="hs-identifier hs-type">Cntx</span></a></span><span class="hs-special">{</span><span id="local-6989586621680447570"><span class="annot"><span class="annottext">[CycleCntx v x]
cntxProcess :: [CycleCntx v x]
cntxProcess :: forall v x. Cntx v x -&gt; [CycleCntx v x]
</span><a href="#local-6989586621680447570"><span class="hs-identifier hs-var hs-var">cntxProcess</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447572"><span class="annot"><span class="annottext">Int
cntxCycleNumber :: Int
cntxCycleNumber :: forall v x. Cntx v x -&gt; Int
</span><a href="#local-6989586621680447572"><span class="hs-identifier hs-var hs-var">cntxCycleNumber</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-729"></span><span>            </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-730"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680447574"><span class="annot"><span class="annottext">testEnv :: Verilog
</span><a href="#local-6989586621680447574"><span class="hs-identifier hs-var hs-var">testEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-731"></span><span>                    </span><span class="annot"><span class="annottext">[Verilog] -&gt; Verilog
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span>
</span><span id="line-732"></span><span>                        </span><span class="annot"><span class="annottext">([Verilog] -&gt; Verilog) -&gt; [Verilog] -&gt; Verilog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; Maybe Verilog)
-&gt; [(tag, PU v x t)] -&gt; [Verilog]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-733"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680447575"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680447575"><span class="hs-identifier hs-var">tag</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PU"><span class="hs-identifier hs-type">PU</span></a></span><span class="hs-special">{</span><span id="local-6989586621680447583"><span class="annot"><span class="annottext">pu
unit :: ()
unit :: pu
</span><a href="NITTA.Model.Networks.Types.html#unit"><span class="hs-keyword hs-var hs-var">unit</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447584"><span class="annot"><span class="annottext">UnitEnv pu
uEnv :: ()
uEnv :: UnitEnv pu
</span><a href="NITTA.Model.Networks.Types.html#uEnv"><span class="hs-identifier hs-var hs-var">uEnv</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-734"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680447585"><span class="annot"><span class="annottext">tEnv :: TestEnvironment v x
</span><a href="#local-6989586621680447585"><span class="hs-identifier hs-var hs-var">tEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-735"></span><span>                                        </span><span class="annot"><a href="NITTA.Project.TestBench.html#TestEnvironment"><span class="hs-identifier hs-type">TestEnvironment</span></a></span><span>
</span><span id="line-736"></span><span>                                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">teCntx :: Cntx v x
</span><a href="#local-6989586621680447587"><span class="hs-identifier hs-var">teCntx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cntx v x
</span><a href="#local-6989586621680447568"><span class="hs-identifier hs-var">pTestCntx</span></a></span><span>
</span><span id="line-737"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">teComputationDuration :: Int
</span><a href="#local-6989586621680447588"><span class="hs-identifier hs-var">teComputationDuration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">(t -&gt; Int) -&gt; t -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; t
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680447563"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-738"></span><span>                                            </span><span class="hs-special">}</span><span>
</span><span id="line-739"></span><span>                                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Text -&gt; pu -&gt; UnitEnv pu -&gt; TestEnvironment v x -&gt; Maybe Verilog
forall pu v x.
IOTestBench pu v x =&gt;
Text -&gt; pu -&gt; UnitEnv pu -&gt; TestEnvironment v x -&gt; Maybe Verilog
</span><a href="NITTA.Project.TestBench.html#testEnvironment"><span class="hs-identifier hs-var">testEnvironment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tag -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680447575"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680447583"><span class="hs-keyword hs-var">unit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitEnv pu
</span><a href="#local-6989586621680447584"><span class="hs-identifier hs-var">uEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TestEnvironment v x
</span><a href="#local-6989586621680447585"><span class="hs-identifier hs-var">tEnv</span></a></span><span>
</span><span id="line-740"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>                        </span><span class="annot"><span class="annottext">([(tag, PU v x t)] -&gt; [Verilog]) -&gt; [(tag, PU v x t)] -&gt; [Verilog]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680447564"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-742"></span><span>
</span><span id="line-743"></span><span>                </span><span id="local-6989586621680447591"><span class="annot"><span class="annottext">externalPortNames :: [Doc Any]
</span><a href="#local-6989586621680447591"><span class="hs-identifier hs-var hs-var">externalPortNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Doc Any) -&gt; [Text] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc Any
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Doc Any]) -&gt; [Text] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, ([Text], [Text], [Text])) -&gt; [Text])
-&gt; [(tag, ([Text], [Text], [Text]))] -&gt; [Text]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680447592"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680447592"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447593"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680447593"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447594"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680447594"><span class="hs-identifier hs-var">ios</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680447592"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680447593"><span class="hs-identifier hs-var">os</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621680447594"><span class="hs-identifier hs-var">ios</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Text], [Text], [Text]) -&gt; [Text])
-&gt; ((tag, ([Text], [Text], [Text])) -&gt; ([Text], [Text], [Text]))
-&gt; (tag, ([Text], [Text], [Text]))
-&gt; [Text]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(tag, ([Text], [Text], [Text])) -&gt; ([Text], [Text], [Text])
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(tag, ([Text], [Text], [Text]))] -&gt; [Text])
-&gt; [(tag, ([Text], [Text], [Text]))] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, ([Text], [Text], [Text]))]
forall {k} {v} {x} {t}.
Map k (PU v x t) -&gt; [(k, ([Text], [Text], [Text]))]
</span><a href="NITTA.Model.Networks.Bus.html#bnExternalPorts"><span class="hs-identifier hs-var">bnExternalPorts</span></a></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680447564"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-744"></span><span>                </span><span id="local-6989586621680447595"><span class="annot"><span class="annottext">externalIO :: Doc Any
</span><a href="#local-6989586621680447595"><span class="hs-identifier hs-var hs-var">externalIO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Doc Any] -&gt; Doc Any
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span> </span><span class="annot"><span class="annottext">([Doc Any] -&gt; Doc Any) -&gt; [Doc Any] -&gt; Doc Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; [Doc Any] -&gt; [Doc Any]
forall ann. Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
</span><span class="hs-identifier hs-var">punctuate</span></span><span> </span><span class="annot"><span class="annottext">Doc Any
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc Any
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; [Doc Any] -&gt; [Doc Any]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(Doc Any -&gt; Doc Any) -&gt; [Doc Any] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680447596"><span class="annot"><span class="annottext">Doc Any
</span><a href="#local-6989586621680447596"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="">[i|.#{ p }( #{ p } )|]</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Doc Any]
</span><a href="#local-6989586621680447591"><span class="hs-identifier hs-var">externalPortNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>
</span><span id="line-746"></span><span>                </span><span id="local-6989586621680447598"><span class="annot"><span class="annottext">envInitFlags :: [Doc Any]
</span><a href="#local-6989586621680447598"><span class="hs-identifier hs-var hs-var">envInitFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Doc Any) -&gt; [Text] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Doc Any
forall ann. Text -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Doc Any]) -&gt; [Text] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((tag, PU v x t) -&gt; Maybe Text) -&gt; [(tag, PU v x t)] -&gt; [Text]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; PU v x t -&gt; Maybe Text) -&gt; (Text, PU v x t) -&gt; Maybe Text
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; PU v x t -&gt; Maybe Text
forall pu v x. IOTestBench pu v x =&gt; Text -&gt; pu -&gt; Maybe Text
</span><a href="NITTA.Project.TestBench.html#testEnvironmentInitFlag"><span class="hs-identifier hs-var">testEnvironmentInitFlag</span></a></span><span> </span><span class="annot"><span class="annottext">((Text, PU v x t) -&gt; Maybe Text)
-&gt; ((tag, PU v x t) -&gt; (Text, PU v x t))
-&gt; (tag, PU v x t)
-&gt; Maybe Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(tag -&gt; Text) -&gt; (tag, PU v x t) -&gt; (Text, PU v x t)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">tag -&gt; Text
forall {a}. ToString a =&gt; a -&gt; Text
</span><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-var">toText</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(tag, PU v x t)] -&gt; [Text]) -&gt; [(tag, PU v x t)] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t) -&gt; [(tag, PU v x t)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.assocs</span></span><span> </span><span class="annot"><span class="annottext">Map tag (PU v x t)
</span><a href="#local-6989586621680447564"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span>                </span><span id="local-6989586621680447600"><span class="annot"><span class="annottext">tickWithTransfers :: [[(Int, t, Maybe (v, x))]]
</span><a href="#local-6989586621680447600"><span class="hs-identifier hs-var hs-var">tickWithTransfers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-749"></span><span>                    </span><span class="annot"><span class="annottext">((Int, CycleCntx v x) -&gt; [(Int, t, Maybe (v, x))])
-&gt; [(Int, CycleCntx v x)] -&gt; [[(Int, t, Maybe (v, x))]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-750"></span><span>                        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680447601"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680447601"><span class="hs-identifier hs-var">cycleI</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447602"><span class="annot"><span class="annottext">CycleCntx v x
</span><a href="#local-6989586621680447602"><span class="hs-identifier hs-var">cycleCntx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-751"></span><span>                            </span><span class="annot"><span class="annottext">(t -&gt; (Int, t, Maybe (v, x))) -&gt; [t] -&gt; [(Int, t, Maybe (v, x))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span>
</span><span id="line-752"></span><span>                                </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680447603"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680447603"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680447601"><span class="hs-identifier hs-var">cycleI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680447603"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CycleCntx v x -&gt; t -&gt; Maybe (v, x)
</span><a href="#local-6989586621680447604"><span class="hs-identifier hs-var">cntxToTransfer</span></a></span><span> </span><span class="annot"><span class="annottext">CycleCntx v x
</span><a href="#local-6989586621680447602"><span class="hs-identifier hs-var">cycleCntx</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680447603"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>                                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; t
forall u t. NextTick u t =&gt; u -&gt; t
</span><a href="NITTA.Model.ProcessorUnits.Types.html#nextTick"><span class="hs-identifier hs-var">nextTick</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680447563"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-754"></span><span>                        </span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>                        </span><span class="annot"><span class="annottext">([(Int, CycleCntx v x)] -&gt; [[(Int, t, Maybe (v, x))]])
-&gt; [(Int, CycleCntx v x)] -&gt; [[(Int, t, Maybe (v, x))]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [CycleCntx v x] -&gt; [(Int, CycleCntx v x)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-756"></span><span>                        </span><span class="annot"><span class="annottext">([CycleCntx v x] -&gt; [(Int, CycleCntx v x)])
-&gt; [CycleCntx v x] -&gt; [(Int, CycleCntx v x)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [CycleCntx v x] -&gt; [CycleCntx v x]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680447572"><span class="hs-identifier hs-var">cntxCycleNumber</span></a></span><span> </span><span class="annot"><span class="annottext">[CycleCntx v x]
</span><a href="#local-6989586621680447570"><span class="hs-identifier hs-var">cntxProcess</span></a></span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>                </span><span id="local-6989586621680447606"><span class="annot"><span class="annottext">assertions :: Doc Any
</span><a href="#local-6989586621680447606"><span class="hs-identifier hs-var hs-var">assertions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Doc Any] -&gt; Doc Any
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span> </span><span class="annot"><span class="annottext">([Doc Any] -&gt; Doc Any) -&gt; [Doc Any] -&gt; Doc Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([(Int, t, Maybe (v, x))] -&gt; Doc Any)
-&gt; [[(Int, t, Maybe (v, x))]] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680447607"><span class="annot"><span class="annottext">[(Int, t, Maybe (v, x))]
</span><a href="#local-6989586621680447607"><span class="hs-identifier hs-var">cycleTickTransfer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc Any
</span><a href="#local-6989586621680447608"><span class="hs-identifier hs-var">posedgeCycle</span></a></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; Doc Any -&gt; Doc Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc Any
forall ann. Doc ann
</span><span class="hs-identifier hs-var">line</span></span><span> </span><span class="annot"><span class="annottext">Doc Any -&gt; Doc Any -&gt; Doc Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Doc Any] -&gt; Doc Any
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Int, t, Maybe (v, x)) -&gt; Doc Any)
-&gt; [(Int, t, Maybe (v, x))] -&gt; [Doc Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, t, Maybe (v, x)) -&gt; Doc Any
</span><a href="#local-6989586621680447610"><span class="hs-identifier hs-var">assertion</span></a></span><span> </span><span class="annot"><span class="annottext">[(Int, t, Maybe (v, x))]
</span><a href="#local-6989586621680447607"><span class="hs-identifier hs-var">cycleTickTransfer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(Int, t, Maybe (v, x))]]
</span><a href="#local-6989586621680447600"><span class="hs-identifier hs-var">tickWithTransfers</span></a></span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span>                </span><span id="local-6989586621680447610"><span class="annot"><span class="annottext">assertion :: (Int, t, Maybe (v, x)) -&gt; Doc Any
</span><a href="#local-6989586621680447610"><span class="hs-identifier hs-var hs-var">assertion</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680447611"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680447611"><span class="hs-identifier hs-var">cycleI</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447612"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680447612"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (v, x)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-761"></span><span>                    </span><span class="annot"><span class="">[i|@(posedge clk); traceWithAttr(#{ cycleI }, #{ t }, #{ toString bnName }.data_bus, #{ toString bnName }.attr_bus);|]</span></span><span>
</span><span id="line-762"></span><span>                </span><span class="annot"><a href="#local-6989586621680447610"><span class="hs-identifier hs-var">assertion</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680447614"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680447614"><span class="hs-identifier hs-var">cycleI</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447615"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680447615"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680447616"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680447616"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447617"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680447617"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-763"></span><span>                    </span><span class="annot"><span class="">[i|@(posedge clk); assertWithAttr(#{ cycleI }, #{ t }, #{ toString bnName }.data_bus, #{ toString bnName }.attr_bus, #{ dataLiteral x }, #{ attrLiteral x }, &quot;#{ toString v }&quot;);|]</span></span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span>                </span><span id="local-6989586621680447621"><span class="annot"><span class="annottext">tbName :: Text
</span><a href="#local-6989586621680447621"><span class="hs-identifier hs-var hs-var">tbName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; BusNetwork tag v x t -&gt; Text
forall pu. TargetSystemComponent pu =&gt; Text -&gt; pu -&gt; Text
</span><a href="NITTA.Project.Types.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680447560"><span class="hs-identifier hs-var">pName</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680447563"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;_tb&quot;</span></span><span>
</span><span id="line-766"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe [Char] -&gt; [Implementation] -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Aggregate"><span class="hs-identifier hs-var">Aggregate</span></a></span><span>
</span><span id="line-767"></span><span>                    </span><span class="annot"><span class="annottext">Maybe [Char]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-768"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Immediate"><span class="hs-identifier hs-var">Immediate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Char]) -&gt; Text -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680447621"><span class="hs-identifier hs-var">tbName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.v&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Implementation) -&gt; Text -&gt; Implementation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-769"></span><span>                        </span><span class="annot"><span class="annottext">Verilog -&gt; Text
</span><a href="NITTA.Utils.html#doc2text"><span class="hs-identifier hs-var">doc2text</span></a></span><span>
</span><span id="line-770"></span><span>                            </span><span class="annot"><span class="">[__i|
                        `timescale 1 ps / 1 ps
                        module #{ tbName }();

                        /*
                        Functions:
                        #{ indent 4 $ vsep $ map viaShow $ functions bn }
                        */

                        /*
                        Steps:
                        #{ indent 4 $ vsep $ map viaShow $ reverse $ steps $ process bn }
                        */

                        // system signals
                        reg clk, rst;
                        wire cycle;

                        // clk and rst generator
                        #{ snippetClkGen }

                        // vcd dump
                        #{ snippetDumpFile $ moduleName pName bn }


                        ////////////////////////////////////////////////////////////
                        // test environment

                        // external ports (IO)
                        #{ if null externalPortNames then &quot;&quot; else &quot;wire &quot; &lt;&gt; hsep (punctuate &quot;, &quot; externalPortNames) &lt;&gt; &quot;;&quot; }

                        // initialization flags
                        #{ if null envInitFlags then &quot;&quot; else &quot;reg &quot; &lt;&gt; hsep (punctuate &quot;, &quot; envInitFlags) &lt;&gt; &quot;;&quot; }
                        assign env_init_flag = #{ hsep $ defEnvInitFlag envInitFlags ioSync };

                        #{ testEnv }


                        ////////////////////////////////////////////////////////////
                        // unit under test

                        #{ moduleName pName bn } \#
                                ( .DATA_WIDTH( #{ dataWidth (def :: x) } )
                                , .ATTR_WIDTH( #{ attrWidth (def :: x) } )
                                ) #{ toString bnName }
                            ( .clk( clk )
                            , .rst( rst )
                            , .flag_cycle_begin( cycle )
                            #{ nest 4 externalIO }
                            // if 1 - The process cycle are indipendent from a SPI.
                            // else - The process cycle are wait for the SPI.
                            , .is_drop_allow( #{ isDrowAllowSignal ioSync } )
                            );

                        // internal unit under test checks
                        initial
                            begin
                                // microcode when rst == 1 -&gt; program[0], and must be nop for all PUs
                                @(negedge rst); // Turn mUnit on.
                                // Start computational cycle from program[1] to program[n] and repeat.
                                // Signals effect to mUnit state after first clk posedge.
                                @(posedge clk);
                                while (!env_init_flag) @(posedge clk);
                                #{ nest 8 assertions }
                                repeat ( #{ 2 * nextTick bn } ) @(posedge clk);
                                $finish;
                            end

                        // TIMEOUT
                        initial
                            begin
                                repeat (100000) @(posedge clk);
                                $display(&quot;FAIL too long simulation process&quot;);
                                $finish;
                            end

                        ////////////////////////////////////////////////////////////
                        // Utils
                        #{ verilogHelper (def :: x) }

                        endmodule
                        |]</span></span><span>
</span><span id="line-852"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Text -&gt; Implementation
</span><a href="NITTA.Project.Types.html#Immediate"><span class="hs-identifier hs-var">Immediate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Char]
forall a. ToString a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Char]) -&gt; Text -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680447621"><span class="hs-identifier hs-var">tbName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.gtkw&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Implementation) -&gt; Text -&gt; Implementation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-853"></span><span>                        </span><span class="annot"><span class="annottext">[Char] -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span>
</span><span id="line-854"></span><span>                            </span><span class="annot"><span class="">[__i|
                                [*]
                                [*] GTKWave Analyzer v3.3.107 (w)1999-2020 BSI
                                [*] Fri Mar 12 11:37:55 2021
                                [*]
                                [dumpfile] &quot;{{ nitta.paths.abs_nitta }}/#{ tbName }.vcd&quot;
                                [timestart] 0
                                *-6.864726 0 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
                                [treeopen] #{ tbName }.
                                [treeopen] #{ tbName }.#{ toString bnName }.
                                [sst_width] 193
                                [signals_width] 203
                                [sst_expanded] 1
                                [sst_vpaned_height] 167
                                @28
                                #{ tbName }.clk
                                #{ tbName }.rst
                                #{ tbName }.cycle
                                @24
                                #{ tbName }.#{ toString bnName }.control_unit.pc[5:0]
                                @28
                                #{ tbName }.#{ toString bnName }.control_unit.flag_cycle_begin
                                #{ tbName }.#{ toString bnName }.control_unit.flag_cycle_end
                                @25
                                #{ tbName }.#{ toString bnName }.data_bus[31:0]
                                @22
                                #{ tbName }.#{ toString bnName }.attr_bus[3:0]
                                [pattern_trace] 1
                                [pattern_trace] 0
                                |]</span></span><span>
</span><span id="line-884"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-885"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-886"></span><span>                </span><span id="local-6989586621680447623"><span class="annot"><span class="annottext">defEnvInitFlag :: [Doc ann] -&gt; IOSynchronization -&gt; [Doc ann]
</span><a href="#local-6989586621680447623"><span class="hs-identifier hs-var hs-var">defEnvInitFlag</span></a></span></span><span> </span><span id="local-6989586621680447639"><span class="annot"><span class="annottext">[Doc ann]
</span><a href="#local-6989586621680447639"><span class="hs-identifier hs-var">flags</span></a></span></span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="NITTA.Model.Networks.Types.html#Sync"><span class="hs-identifier hs-var">Sync</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
forall ann. Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
</span><span class="hs-identifier hs-var">punctuate</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; &amp;&amp; &quot;</span></span><span> </span><span class="annot"><span class="annottext">([Doc ann] -&gt; [Doc ann]) -&gt; [Doc ann] -&gt; [Doc ann]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;1'b1&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Doc ann]
</span><a href="#local-6989586621680447639"><span class="hs-identifier hs-var">flags</span></a></span><span>
</span><span id="line-887"></span><span>                </span><span class="annot"><a href="#local-6989586621680447623"><span class="hs-identifier hs-var">defEnvInitFlag</span></a></span><span> </span><span id="local-6989586621680447641"><span class="annot"><span class="annottext">[Doc ann]
</span><a href="#local-6989586621680447641"><span class="hs-identifier hs-var">flags</span></a></span></span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="NITTA.Model.Networks.Types.html#ASync"><span class="hs-identifier hs-var">ASync</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
forall ann. Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
</span><span class="hs-identifier hs-var">punctuate</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot; || &quot;</span></span><span> </span><span class="annot"><span class="annottext">([Doc ann] -&gt; [Doc ann]) -&gt; [Doc ann] -&gt; [Doc ann]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;1'b1&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Doc ann]
</span><a href="#local-6989586621680447641"><span class="hs-identifier hs-var">flags</span></a></span><span>
</span><span id="line-888"></span><span>                </span><span class="annot"><a href="#local-6989586621680447623"><span class="hs-identifier hs-var">defEnvInitFlag</span></a></span><span> </span><span id="local-6989586621680447642"><span class="annot"><span class="annottext">[Doc ann]
</span><a href="#local-6989586621680447642"><span class="hs-identifier hs-var">_flags</span></a></span></span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="NITTA.Model.Networks.Types.html#OnBoard"><span class="hs-identifier hs-var">OnBoard</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Doc ann]
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;can't generate testbench without specific IOSynchronization&quot;</span></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>                </span><span id="local-6989586621680447604"><span class="annot"><span class="annottext">cntxToTransfer :: CycleCntx v x -&gt; t -&gt; Maybe (v, x)
</span><a href="#local-6989586621680447604"><span class="hs-identifier hs-var hs-var">cntxToTransfer</span></a></span></span><span> </span><span id="local-6989586621680447644"><span class="annot"><span class="annottext">CycleCntx v x
</span><a href="#local-6989586621680447644"><span class="hs-identifier hs-var">cycleCntx</span></a></span></span><span> </span><span id="local-6989586621680447645"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680447645"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-891"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t -&gt; t -&gt; [Instruction (BusNetwork tag v x t)]
forall {u} {v} {x} {t}.
(ProcessorUnit u v x t, Typeable u) =&gt;
u -&gt; t -&gt; [Instruction u]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#extractInstructionAt"><span class="hs-identifier hs-var">extractInstructionAt</span></a></span><span> </span><span class="annot"><span class="annottext">BusNetwork tag v x t
</span><a href="#local-6989586621680447563"><span class="hs-identifier hs-var">bn</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680447645"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-892"></span><span>                        </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#Transport"><span class="hs-identifier hs-type">Transport</span></a></span><span> </span><span id="local-6989586621680447647"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680447647"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="annot"><span class="annottext">tag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">tag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Instruction (BusNetwork tag v x t)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(v, x) -&gt; Maybe (v, x)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680447647"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CycleCntx v x -&gt; v -&gt; x
forall {a} {v}. (Hashable a, ToString a) =&gt; CycleCntx a v -&gt; a -&gt; v
</span><a href="NITTA.Intermediate.Types.html#getCntx"><span class="hs-identifier hs-var">getCntx</span></a></span><span> </span><span class="annot"><span class="annottext">CycleCntx v x
</span><a href="#local-6989586621680447644"><span class="hs-identifier hs-var">cycleCntx</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621680447647"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span>                        </span><span class="annot"><span class="annottext">[Instruction (BusNetwork tag v x t)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (v, x)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span>                </span><span id="local-6989586621680447608"><span class="annot"><span class="annottext">posedgeCycle :: Doc Any
</span><a href="#local-6989586621680447608"><span class="hs-identifier hs-var hs-var">posedgeCycle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-896"></span><span>                    </span><span class="annot"><span class="">[__i|
                        //-----------------------------------------------------------------
                        @(posedge cycle);
                    |]</span></span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span id="isDrowAllowSignal"><span class="annot"><span class="annottext">isDrowAllowSignal :: IOSynchronization -&gt; Text
</span><a href="NITTA.Model.Networks.Bus.html#isDrowAllowSignal"><span class="hs-identifier hs-var hs-var">isDrowAllowSignal</span></a></span></span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="NITTA.Model.Networks.Types.html#Sync"><span class="hs-identifier hs-var">Sync</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="NITTA.Utils.html#bool2verilog"><span class="hs-identifier hs-var">bool2verilog</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-902"></span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#isDrowAllowSignal"><span class="hs-identifier hs-var">isDrowAllowSignal</span></a></span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="NITTA.Model.Networks.Types.html#ASync"><span class="hs-identifier hs-var">ASync</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
</span><a href="NITTA.Utils.html#bool2verilog"><span class="hs-identifier hs-var">bool2verilog</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-903"></span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#isDrowAllowSignal"><span class="hs-identifier hs-var">isDrowAllowSignal</span></a></span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="NITTA.Model.Networks.Types.html#OnBoard"><span class="hs-identifier hs-var">OnBoard</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;is_drop_allow&quot;</span></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span class="annot"><span class="hs-comment">-- * Builder</span></span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span class="hs-keyword">data</span><span> </span><span id="BuilderSt"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-var">BuilderSt</span></a></span></span><span> </span><span id="local-6989586621680445263"><span class="annot"><a href="#local-6989586621680445263"><span class="hs-identifier hs-type">tag</span></a></span></span><span> </span><span id="local-6989586621680445264"><span class="annot"><a href="#local-6989586621680445264"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680445265"><span class="annot"><a href="#local-6989586621680445265"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680445266"><span class="annot"><a href="#local-6989586621680445266"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BuilderSt"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-var">BuilderSt</span></a></span></span><span>
</span><span id="line-908"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="signalBusWidth"><span class="annot"><span class="annottext">forall tag v x t. BuilderSt tag v x t -&gt; Int
</span><a href="NITTA.Model.Networks.Bus.html#signalBusWidth"><span class="hs-identifier hs-var hs-var">signalBusWidth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-909"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="availSignals"><span class="annot"><span class="annottext">forall tag v x t. BuilderSt tag v x t -&gt; [SignalTag]
</span><a href="NITTA.Model.Networks.Bus.html#availSignals"><span class="hs-identifier hs-var hs-var">availSignals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#SignalTag"><span class="hs-identifier hs-type">SignalTag</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-910"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="pus"><span class="annot"><span class="annottext">forall tag v x t. BuilderSt tag v x t -&gt; Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#pus"><span class="hs-identifier hs-var hs-var">pus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680445263"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PU"><span class="hs-identifier hs-type">PU</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445264"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445265"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445266"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="prototypes"><span class="annot"><span class="annottext">forall tag v x t.
BuilderSt tag v x t -&gt; Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#prototypes"><span class="hs-identifier hs-var hs-var">prototypes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.Map</span></span><span> </span><span class="annot"><a href="#local-6989586621680445263"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUPrototype"><span class="hs-identifier hs-type">PUPrototype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445263"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445264"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445265"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445266"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-912"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span id="local-6989586621680445068"><span id="local-6989586621680445069"><span id="local-6989586621680445070"><span id="local-6989586621680445071"><span id="local-6989586621680445072"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#modifyNetwork"><span class="hs-identifier hs-type">modifyNetwork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445068"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445069"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445070"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445071"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445068"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445069"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445070"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445071"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680445072"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445068"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445069"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445070"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445071"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span></span><span>
</span><span id="line-915"></span><span id="modifyNetwork"><span class="annot"><span class="annottext">modifyNetwork :: forall k v x t a.
BusNetwork k v x t
-&gt; State (BuilderSt k v x t) a -&gt; BusNetwork k v x t
</span><a href="NITTA.Model.Networks.Bus.html#modifyNetwork"><span class="hs-identifier hs-var hs-var">modifyNetwork</span></a></span></span><span> </span><span id="local-6989586621680447667"><span class="annot"><span class="annottext">net :: BusNetwork k v x t
</span><a href="#local-6989586621680447667"><span class="hs-identifier hs-var">net</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621680447668"><span class="annot"><span class="annottext">Map k (PU v x t)
bnPus :: forall tag v x t. BusNetwork tag v x t -&gt; Map tag (PU v x t)
bnPus :: Map k (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var hs-var">bnPus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447669"><span class="annot"><span class="annottext">Map k (PUPrototype k v x t)
bnPUPrototypes :: forall tag v x t.
BusNetwork tag v x t -&gt; Map tag (PUPrototype tag v x t)
bnPUPrototypes :: Map k (PUPrototype k v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnPUPrototypes"><span class="hs-identifier hs-var hs-var">bnPUPrototypes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447670"><span class="annot"><span class="annottext">Int
bnSignalBusWidth :: forall tag v x t. BusNetwork tag v x t -&gt; Int
bnSignalBusWidth :: Int
</span><a href="NITTA.Model.Networks.Bus.html#bnSignalBusWidth"><span class="hs-identifier hs-var hs-var">bnSignalBusWidth</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447671"><span class="annot"><span class="annottext">UnitEnv (BusNetwork k v x t)
bnEnv :: forall tag v x t.
BusNetwork tag v x t -&gt; UnitEnv (BusNetwork tag v x t)
bnEnv :: UnitEnv (BusNetwork k v x t)
</span><a href="NITTA.Model.Networks.Bus.html#bnEnv"><span class="hs-identifier hs-var hs-var">bnEnv</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680447672"><span class="annot"><span class="annottext">State (BuilderSt k v x t) a
</span><a href="#local-6989586621680447672"><span class="hs-identifier hs-var">builder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-916"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680447673"><span class="annot"><span class="annottext">st0 :: BuilderSt k v x t
</span><a href="#local-6989586621680447673"><span class="hs-identifier hs-var hs-var">st0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-917"></span><span>            </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span>
</span><span id="line-918"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">signalBusWidth :: Int
</span><a href="NITTA.Model.Networks.Bus.html#signalBusWidth"><span class="hs-identifier hs-var">signalBusWidth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680447670"><span class="hs-identifier hs-var">bnSignalBusWidth</span></a></span><span>
</span><span id="line-919"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">availSignals :: [SignalTag]
</span><a href="NITTA.Model.Networks.Bus.html#availSignals"><span class="hs-identifier hs-var">availSignals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; SignalTag) -&gt; [Int] -&gt; [SignalTag]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SignalTag
</span><a href="NITTA.Model.ProcessorUnits.Types.html#SignalTag"><span class="hs-identifier hs-var">SignalTag</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SignalTag) -&gt; (Int -&gt; Text) -&gt; Int -&gt; SignalTag
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall {final} {src}.
Interpolatable (IsCustomSink final) src final =&gt;
src -&gt; final
</span><a href="NITTA.Model.Networks.Bus.html#controlSignalLiteral"><span class="hs-identifier hs-var">controlSignalLiteral</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621680447670"><span class="hs-identifier hs-var">bnSignalBusWidth</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-920"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pus :: Map k (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#pus"><span class="hs-identifier hs-var">pus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map k (PU v x t)
</span><a href="#local-6989586621680447668"><span class="hs-identifier hs-var">bnPus</span></a></span><span>
</span><span id="line-921"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">prototypes :: Map k (PUPrototype k v x t)
</span><a href="NITTA.Model.Networks.Bus.html#prototypes"><span class="hs-identifier hs-var">prototypes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map k (PUPrototype k v x t)
</span><a href="#local-6989586621680447669"><span class="hs-identifier hs-var">bnPUPrototypes</span></a></span><span>
</span><span id="line-922"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-923"></span><span>        </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span class="hs-special">{</span><span id="local-6989586621680447674"><span class="annot"><span class="annottext">Int
signalBusWidth :: forall tag v x t. BuilderSt tag v x t -&gt; Int
signalBusWidth :: Int
</span><a href="NITTA.Model.Networks.Bus.html#signalBusWidth"><span class="hs-identifier hs-var hs-var">signalBusWidth</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447675"><span class="annot"><span class="annottext">Map k (PU v x t)
pus :: forall tag v x t. BuilderSt tag v x t -&gt; Map tag (PU v x t)
pus :: Map k (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#pus"><span class="hs-identifier hs-var hs-var">pus</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447676"><span class="annot"><span class="annottext">Map k (PUPrototype k v x t)
prototypes :: forall tag v x t.
BuilderSt tag v x t -&gt; Map tag (PUPrototype tag v x t)
prototypes :: Map k (PUPrototype k v x t)
</span><a href="NITTA.Model.Networks.Bus.html#prototypes"><span class="hs-identifier hs-var hs-var">prototypes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State (BuilderSt k v x t) a
-&gt; BuilderSt k v x t -&gt; BuilderSt k v x t
forall s a. State s a -&gt; s -&gt; s
</span><span class="hs-identifier hs-var">execState</span></span><span> </span><span class="annot"><span class="annottext">State (BuilderSt k v x t) a
</span><a href="#local-6989586621680447672"><span class="hs-identifier hs-var">builder</span></a></span><span> </span><span class="annot"><span class="annottext">BuilderSt k v x t
</span><a href="#local-6989586621680447673"><span class="hs-identifier hs-var">st0</span></a></span><span>
</span><span id="line-924"></span><span>        </span><span id="local-6989586621680447684"><span class="annot"><span class="annottext">netIOPorts :: [PU v x t] -&gt; IOPorts (BusNetwork tag v x t)
</span><a href="#local-6989586621680447684"><span class="hs-identifier hs-var hs-var">netIOPorts</span></a></span></span><span> </span><span id="local-6989586621680447685"><span class="annot"><span class="annottext">[PU v x t]
</span><a href="#local-6989586621680447685"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-925"></span><span>            </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetworkIO"><span class="hs-identifier hs-type">BusNetworkIO</span></a></span><span>
</span><span id="line-926"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">extInputs :: Set InputPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extInputs"><span class="hs-identifier hs-var">extInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PU v x t -&gt; Set InputPortTag) -&gt; [PU v x t] -&gt; Set InputPortTag
forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; Set InputPortTag
forall {v} {x} {t}. PU v x t -&gt; Set InputPortTag
</span><a href="NITTA.Model.Networks.Types.html#puInputPorts"><span class="hs-identifier hs-var">puInputPorts</span></a></span><span> </span><span class="annot"><span class="annottext">[PU v x t]
</span><a href="#local-6989586621680447685"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-927"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">extOutputs :: Set OutputPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extOutputs"><span class="hs-identifier hs-var">extOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PU v x t -&gt; Set OutputPortTag) -&gt; [PU v x t] -&gt; Set OutputPortTag
forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; Set OutputPortTag
forall {v} {x} {t}. PU v x t -&gt; Set OutputPortTag
</span><a href="NITTA.Model.Networks.Types.html#puOutputPorts"><span class="hs-identifier hs-var">puOutputPorts</span></a></span><span> </span><span class="annot"><span class="annottext">[PU v x t]
</span><a href="#local-6989586621680447685"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-928"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">extInOuts :: Set InoutPortTag
</span><a href="NITTA.Model.Networks.Bus.html#extInOuts"><span class="hs-identifier hs-var">extInOuts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PU v x t -&gt; Set InoutPortTag) -&gt; [PU v x t] -&gt; Set InoutPortTag
forall {a1} {a2}. Ord a1 =&gt; (a2 -&gt; Set a1) -&gt; [a2] -&gt; Set a1
</span><a href="NITTA.Utils.Base.html#unionsMap"><span class="hs-identifier hs-var">unionsMap</span></a></span><span> </span><span class="annot"><span class="annottext">PU v x t -&gt; Set InoutPortTag
forall {v} {x} {t}. PU v x t -&gt; Set InoutPortTag
</span><a href="NITTA.Model.Networks.Types.html#puInOutPorts"><span class="hs-identifier hs-var">puInOutPorts</span></a></span><span> </span><span class="annot"><span class="annottext">[PU v x t]
</span><a href="#local-6989586621680447685"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-929"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-930"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BusNetwork k v x t
</span><a href="#local-6989586621680447667"><span class="hs-identifier hs-var">net</span></a></span><span>
</span><span id="line-931"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnPus"><span class="hs-identifier hs-var">bnPus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680447675"><span class="hs-identifier hs-type">pus</span></a></span><span>
</span><span id="line-932"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnSignalBusWidth"><span class="hs-identifier hs-var">bnSignalBusWidth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680447674"><span class="hs-identifier hs-type">signalBusWidth</span></a></span><span>
</span><span id="line-933"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnEnv"><span class="hs-identifier hs-var">bnEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680447671"><span class="hs-identifier hs-type">bnEnv</span></a></span><span class="hs-special">{</span><span class="annot"><a href="NITTA.Project.Types.html#ioPorts"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621680447684"><span class="hs-identifier hs-type">netIOPorts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.elems</span></span><span> </span><span class="annot"><a href="#local-6989586621680447675"><span class="hs-identifier hs-type">pus</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-934"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#bnPUPrototypes"><span class="hs-identifier hs-var">bnPUPrototypes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680447676"><span class="hs-identifier hs-type">prototypes</span></a></span><span>
</span><span id="line-935"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-936"></span><span>
</span><span id="line-937"></span><span id="local-6989586621680445297"><span id="local-6989586621680445298"><span id="local-6989586621680445299"><span id="local-6989586621680445300"><span id="local-6989586621680445301"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#defineNetwork"><span class="hs-identifier hs-type">defineNetwork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="#local-6989586621680445297"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680445298"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#IOSynchronization"><span class="hs-identifier hs-type">IOSynchronization</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445298"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445299"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445300"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445297"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680445301"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BusNetwork"><span class="hs-identifier hs-type">BusNetwork</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445298"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445299"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445300"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445297"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span></span><span>
</span><span id="line-938"></span><span id="defineNetwork"><span class="annot"><span class="annottext">defineNetwork :: forall t k v x a.
Default t =&gt;
k
-&gt; IOSynchronization
-&gt; State (BuilderSt k v x t) a
-&gt; BusNetwork k v x t
</span><a href="NITTA.Model.Networks.Bus.html#defineNetwork"><span class="hs-identifier hs-var hs-var">defineNetwork</span></a></span></span><span> </span><span id="local-6989586621680447688"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680447688"><span class="hs-identifier hs-var">bnName</span></a></span></span><span> </span><span id="local-6989586621680447689"><span class="annot"><span class="annottext">IOSynchronization
</span><a href="#local-6989586621680447689"><span class="hs-identifier hs-var">ioSync</span></a></span></span><span> </span><span id="local-6989586621680447690"><span class="annot"><span class="annottext">State (BuilderSt k v x t) a
</span><a href="#local-6989586621680447690"><span class="hs-identifier hs-var">builder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BusNetwork k v x t
-&gt; State (BuilderSt k v x t) a -&gt; BusNetwork k v x t
forall k v x t a.
BusNetwork k v x t
-&gt; State (BuilderSt k v x t) a -&gt; BusNetwork k v x t
</span><a href="NITTA.Model.Networks.Bus.html#modifyNetwork"><span class="hs-identifier hs-var">modifyNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">k -&gt; IOSynchronization -&gt; BusNetwork k v x t
forall {t} {tag} {v} {x}.
Default t =&gt;
tag -&gt; IOSynchronization -&gt; BusNetwork tag v x t
</span><a href="NITTA.Model.Networks.Bus.html#busNetwork"><span class="hs-identifier hs-var">busNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621680447688"><span class="hs-identifier hs-var">bnName</span></a></span><span> </span><span class="annot"><span class="annottext">IOSynchronization
</span><a href="#local-6989586621680447689"><span class="hs-identifier hs-var">ioSync</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State (BuilderSt k v x t) a
</span><a href="#local-6989586621680447690"><span class="hs-identifier hs-var">builder</span></a></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#addCustom"><span class="hs-identifier hs-type">addCustom</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680445073"><span class="annot"><a href="#local-6989586621680445073"><span class="hs-identifier hs-type">tag</span></a></span></span><span> </span><span id="local-6989586621680445074"><span class="annot"><a href="#local-6989586621680445074"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680445075"><span class="annot"><a href="#local-6989586621680445075"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680445076"><span class="annot"><a href="#local-6989586621680445076"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680445077"><span class="annot"><a href="#local-6989586621680445077"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680445078"><span class="annot"><a href="#local-6989586621680445078"><span class="hs-identifier hs-type">pu</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-942"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445073"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445074"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445075"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445076"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680445077"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUClasses"><span class="hs-identifier hs-type">PUClasses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445078"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445074"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445075"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445076"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445073"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-943"></span><span>    </span><span class="annot"><a href="#local-6989586621680445073"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-944"></span><span>    </span><span class="annot"><a href="#local-6989586621680445078"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-945"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier hs-type">IOPorts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445078"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-946"></span><span>    </span><span class="annot"><a href="#local-6989586621680445077"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span id="addCustom"><span class="annot"><span class="annottext">addCustom :: forall tag v x t (m :: * -&gt; *) pu.
(MonadState (BuilderSt tag v x t) m, PUClasses pu v x t,
 UnitTag tag) =&gt;
tag -&gt; pu -&gt; IOPorts pu -&gt; m ()
</span><a href="NITTA.Model.Networks.Bus.html#addCustom"><span class="hs-identifier hs-var hs-var">addCustom</span></a></span></span><span> </span><span id="local-6989586621680447720"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680447720"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680447721"><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680447721"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span id="local-6989586621680447722"><span class="annot"><span class="annottext">IOPorts pu
</span><a href="#local-6989586621680447722"><span class="hs-identifier hs-var">ioPorts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-948"></span><span>    </span><span id="local-6989586621680447723"><span class="annot"><span class="annottext">st :: BuilderSt tag v x t
</span><a href="#local-6989586621680447723"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span class="hs-special">{</span><span id="local-6989586621680447724"><span class="annot"><span class="annottext">Int
signalBusWidth :: forall tag v x t. BuilderSt tag v x t -&gt; Int
signalBusWidth :: Int
</span><a href="NITTA.Model.Networks.Bus.html#signalBusWidth"><span class="hs-identifier hs-var hs-var">signalBusWidth</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447725"><span class="annot"><span class="annottext">[SignalTag]
availSignals :: forall tag v x t. BuilderSt tag v x t -&gt; [SignalTag]
availSignals :: [SignalTag]
</span><a href="NITTA.Model.Networks.Bus.html#availSignals"><span class="hs-identifier hs-var hs-var">availSignals</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680447726"><span class="annot"><span class="annottext">Map tag (PU v x t)
pus :: forall tag v x t. BuilderSt tag v x t -&gt; Map tag (PU v x t)
pus :: Map tag (PU v x t)
</span><a href="NITTA.Model.Networks.Bus.html#pus"><span class="hs-identifier hs-var hs-var">pus</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (BuilderSt tag v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-949"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680447728"><span class="annot"><span class="annottext">ctrlPorts :: Ports pu
</span><a href="#local-6989586621680447728"><span class="hs-identifier hs-var hs-var">ctrlPorts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SignalTag] -&gt; pu -&gt; Ports pu
forall pu. Controllable pu =&gt; [SignalTag] -&gt; pu -&gt; Ports pu
</span><a href="NITTA.Model.ProcessorUnits.Types.html#takePortTags"><span class="hs-identifier hs-var">takePortTags</span></a></span><span> </span><span class="annot"><span class="annottext">[SignalTag]
</span><a href="#local-6989586621680447725"><span class="hs-identifier hs-var">availSignals</span></a></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680447721"><span class="hs-identifier hs-var">pu</span></a></span><span>
</span><span id="line-950"></span><span>        </span><span id="local-6989586621680447729"><span class="annot"><span class="annottext">puEnv :: UnitEnv pu
</span><a href="#local-6989586621680447729"><span class="hs-identifier hs-var hs-var">puEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-951"></span><span>            </span><span class="annot"><span class="annottext">UnitEnv Any
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-952"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#ctrlPorts"><span class="hs-identifier hs-var">ctrlPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621680447728"><span class="hs-identifier hs-type">ctrlPorts</span></a></span><span>
</span><span id="line-953"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#ioPorts"><span class="hs-identifier hs-var">ioPorts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621680447722"><span class="hs-identifier hs-type">ioPorts</span></a></span><span>
</span><span id="line-954"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#valueIn"><span class="hs-identifier hs-var">valueIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;data_bus&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;attr_bus&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Project.Types.html#valueOut"><span class="hs-identifier hs-var">valueOut</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-type">toText</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447720"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;_data_out&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Utils.Base.html#toText"><span class="hs-identifier hs-type">toText</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447720"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;_attr_out&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-956"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-957"></span><span>        </span><span id="local-6989586621680447732"><span class="annot"><span class="annottext">pu' :: PU v x t
</span><a href="#local-6989586621680447732"><span class="hs-identifier hs-var hs-var">pu'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">pu -&gt; Changeset v -&gt; UnitEnv pu -&gt; PU v x t
forall pu v x t.
PUClasses pu v x t =&gt;
pu -&gt; Changeset v -&gt; UnitEnv pu -&gt; PU v x t
</span><a href="NITTA.Model.Networks.Types.html#PU"><span class="hs-identifier hs-var">PU</span></a></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680447721"><span class="hs-identifier hs-var">pu</span></a></span><span> </span><span class="annot"><span class="annottext">Changeset v
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">UnitEnv pu
</span><a href="#local-6989586621680447729"><span class="hs-identifier hs-var">puEnv</span></a></span><span>
</span><span id="line-958"></span><span>        </span><span id="local-6989586621680447733"><span class="annot"><span class="annottext">usedPortsLen :: Int
</span><a href="#local-6989586621680447733"><span class="hs-identifier hs-var hs-var">usedPortsLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SignalTag] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([SignalTag] -&gt; Int) -&gt; [SignalTag] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ports pu -&gt; [SignalTag]
forall pu. Controllable pu =&gt; Ports pu -&gt; [SignalTag]
</span><a href="NITTA.Model.ProcessorUnits.Types.html#usedPortTags"><span class="hs-identifier hs-var">usedPortTags</span></a></span><span> </span><span class="annot"><span class="annottext">Ports pu
</span><a href="#local-6989586621680447728"><span class="hs-identifier hs-var">ctrlPorts</span></a></span><span>
</span><span id="line-959"></span><span>    </span><span class="annot"><span class="annottext">BuilderSt tag v x t -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-960"></span><span>        </span><span class="annot"><span class="annottext">BuilderSt tag v x t
</span><a href="#local-6989586621680447723"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-961"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#signalBusWidth"><span class="hs-identifier hs-var">signalBusWidth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621680447724"><span class="hs-identifier hs-type">signalBusWidth</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><a href="#local-6989586621680447733"><span class="hs-identifier hs-type">usedPortsLen</span></a></span><span>
</span><span id="line-962"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#availSignals"><span class="hs-identifier hs-var">availSignals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">drop</span></span><span> </span><span class="annot"><a href="#local-6989586621680447733"><span class="hs-identifier hs-type">usedPortsLen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447725"><span class="hs-identifier hs-type">availSignals</span></a></span><span>
</span><span id="line-963"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#pus"><span class="hs-identifier hs-var">pus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.insertWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">PU v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PU v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PU v x t
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;every PU must has uniq tag&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680447720"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447732"><span class="hs-identifier hs-type">pu'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447726"><span class="hs-identifier hs-type">pus</span></a></span><span>
</span><span id="line-964"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-965"></span><span>
</span><span id="line-966"></span><span class="annot"><span class="hs-comment">-- | Add PU with the default initial state. Type specify by IOPorts.</span></span><span>
</span><span id="line-967"></span><span id="local-6989586621680445320"><span id="local-6989586621680445321"><span id="local-6989586621680445322"><span id="local-6989586621680445323"><span id="local-6989586621680445324"><span id="local-6989586621680445325"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#add"><span class="hs-identifier hs-type">add</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-968"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445320"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445321"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445322"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445323"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680445324"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUClasses"><span class="hs-identifier hs-type">PUClasses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445325"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445321"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445322"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445323"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="#local-6989586621680445325"><span class="hs-identifier hs-type">pu</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445320"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-969"></span><span>    </span><span class="annot"><a href="#local-6989586621680445320"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-970"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier hs-type">IOPorts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680445325"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-971"></span><span>    </span><span class="annot"><a href="#local-6989586621680445324"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-972"></span><span id="add"><span class="annot"><span class="annottext">add :: forall tag v x t (m :: * -&gt; *) pu.
(MonadState (BuilderSt tag v x t) m, PUClasses pu v x t,
 Default pu, UnitTag tag) =&gt;
tag -&gt; IOPorts pu -&gt; m ()
</span><a href="NITTA.Model.Networks.Bus.html#add"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span id="local-6989586621680447745"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680447745"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680447746"><span class="annot"><span class="annottext">IOPorts pu
</span><a href="#local-6989586621680447746"><span class="hs-identifier hs-var">ioport</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tag -&gt; pu -&gt; IOPorts pu -&gt; m ()
forall tag v x t (m :: * -&gt; *) pu.
(MonadState (BuilderSt tag v x t) m, PUClasses pu v x t,
 UnitTag tag) =&gt;
tag -&gt; pu -&gt; IOPorts pu -&gt; m ()
</span><a href="NITTA.Model.Networks.Bus.html#addCustom"><span class="hs-identifier hs-var">addCustom</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680447745"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">pu
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">IOPorts pu
</span><a href="#local-6989586621680447746"><span class="hs-identifier hs-var">ioport</span></a></span><span>
</span><span id="line-973"></span><span>
</span><span id="line-974"></span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#addCustomPrototype"><span class="hs-identifier hs-type">addCustomPrototype</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-975"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680447747"><span class="annot"><a href="#local-6989586621680447747"><span class="hs-identifier hs-type">tag</span></a></span></span><span> </span><span id="local-6989586621680447748"><span class="annot"><a href="#local-6989586621680447748"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680447749"><span class="annot"><a href="#local-6989586621680447749"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680447750"><span class="annot"><a href="#local-6989586621680447750"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621680447751"><span class="annot"><a href="#local-6989586621680447751"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621680447752"><span class="annot"><a href="#local-6989586621680447752"><span class="hs-identifier hs-type">pu</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-976"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447747"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447748"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447749"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447750"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680447751"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUClasses"><span class="hs-identifier hs-type">PUClasses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447752"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447748"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447749"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447750"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447747"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-977"></span><span>    </span><span class="annot"><a href="#local-6989586621680447747"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-978"></span><span>    </span><span class="annot"><a href="#local-6989586621680447752"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-979"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier hs-type">IOPorts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447752"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-980"></span><span>    </span><span class="annot"><a href="#local-6989586621680447751"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span id="addCustomPrototype"><span class="annot"><span class="annottext">addCustomPrototype :: forall tag v x t (m :: * -&gt; *) pu.
(MonadState (BuilderSt tag v x t) m, PUClasses pu v x t,
 UnitTag tag) =&gt;
tag -&gt; pu -&gt; IOPorts pu -&gt; m ()
</span><a href="NITTA.Model.Networks.Bus.html#addCustomPrototype"><span class="hs-identifier hs-var hs-var">addCustomPrototype</span></a></span></span><span> </span><span id="local-6989586621680447785"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680447785"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680447786"><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680447786"><span class="hs-identifier hs-var">pu</span></a></span></span><span> </span><span id="local-6989586621680447787"><span class="annot"><span class="annottext">IOPorts pu
</span><a href="#local-6989586621680447787"><span class="hs-identifier hs-var">ioports</span></a></span></span><span>
</span><span id="line-982"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">pu -&gt; TypeRep
forall a. Typeable a =&gt; a -&gt; TypeRep
</span><span class="hs-identifier hs-var">typeOf</span></span><span> </span><span class="annot"><span class="annottext">pu
</span><a href="#local-6989586621680447786"><span class="hs-identifier hs-var">pu</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep -&gt; TypeRep -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Proxy (SPI v x t) -&gt; TypeRep
forall {k} (proxy :: k -&gt; *) (a :: k).
Typeable a =&gt;
proxy a -&gt; TypeRep
</span><span class="hs-identifier hs-var">typeRep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (SPI v x t)
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.ProcessorUnits.IO.SPI.html#SPI"><span class="hs-identifier hs-type">SPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447748"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447749"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447750"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-983"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; m ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Adding SPI prototype are not supported due to https://github.com/ryukzak/nitta/issues/194&quot;</span></span><span>
</span><span id="line-984"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-985"></span><span>        </span><span id="local-6989586621680447791"><span class="annot"><span class="annottext">st :: BuilderSt tag v x t
</span><a href="#local-6989586621680447791"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span class="hs-special">{</span><span id="local-6989586621680447792"><span class="annot"><span class="annottext">Map tag (PUPrototype tag v x t)
prototypes :: forall tag v x t.
BuilderSt tag v x t -&gt; Map tag (PUPrototype tag v x t)
prototypes :: Map tag (PUPrototype tag v x t)
</span><a href="NITTA.Model.Networks.Bus.html#prototypes"><span class="hs-identifier hs-var hs-var">prototypes</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (BuilderSt tag v x t)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-986"></span><span>        </span><span class="annot"><span class="annottext">BuilderSt tag v x t -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span>
</span><span id="line-987"></span><span>            </span><span class="annot"><span class="annottext">BuilderSt tag v x t
</span><a href="#local-6989586621680447791"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-988"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#prototypes"><span class="hs-identifier hs-var">prototypes</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-989"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">M.insertWith</span></span><span>
</span><span id="line-990"></span><span>                        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">PUPrototype tag v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PUPrototype tag v x t
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; PUPrototype tag v x t
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;every prototype must has uniq tag&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>                        </span><span class="annot"><a href="#local-6989586621680447785"><span class="hs-identifier hs-type">tag</span></a></span><span>
</span><span id="line-992"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUPrototype"><span class="hs-identifier hs-type">PUPrototype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447785"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447786"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447787"><span class="hs-identifier hs-type">ioports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>                        </span><span class="annot"><a href="#local-6989586621680447792"><span class="hs-identifier hs-type">prototypes</span></a></span><span>
</span><span id="line-994"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span class="annot"><span class="hs-comment">-- | Add PU to prototypes with the default initial state. Type specify by IOPorts.</span></span><span>
</span><span id="line-997"></span><span id="local-6989586621680447793"><span id="local-6989586621680447794"><span id="local-6989586621680447795"><span id="local-6989586621680447796"><span id="local-6989586621680447797"><span id="local-6989586621680447798"><span class="annot"><a href="NITTA.Model.Networks.Bus.html#addPrototype"><span class="hs-identifier hs-type">addPrototype</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-998"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Networks.Bus.html#BuilderSt"><span class="hs-identifier hs-type">BuilderSt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447793"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447794"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447795"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447796"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680447797"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Networks.Types.html#PUClasses"><span class="hs-identifier hs-type">PUClasses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447798"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447794"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447795"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447796"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="annot"><a href="#local-6989586621680447798"><span class="hs-identifier hs-type">pu</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#UnitTag"><span class="hs-identifier hs-type">UnitTag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447793"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-999"></span><span>    </span><span class="annot"><a href="#local-6989586621680447793"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1000"></span><span>    </span><span class="annot"><a href="NITTA.Model.ProcessorUnits.Types.html#IOPorts"><span class="hs-identifier hs-type">IOPorts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680447798"><span class="hs-identifier hs-type">pu</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1001"></span><span>    </span><span class="annot"><a href="#local-6989586621680447797"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-1002"></span><span id="addPrototype"><span class="annot"><span class="annottext">addPrototype :: forall tag v x t (m :: * -&gt; *) pu.
(MonadState (BuilderSt tag v x t) m, PUClasses pu v x t,
 Default pu, UnitTag tag) =&gt;
tag -&gt; IOPorts pu -&gt; m ()
</span><a href="NITTA.Model.Networks.Bus.html#addPrototype"><span class="hs-identifier hs-var hs-var">addPrototype</span></a></span></span><span> </span><span id="local-6989586621680447807"><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680447807"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680447808"><span class="annot"><span class="annottext">IOPorts pu
</span><a href="#local-6989586621680447808"><span class="hs-identifier hs-var">ioports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tag -&gt; pu -&gt; IOPorts pu -&gt; m ()
forall tag v x t (m :: * -&gt; *) pu.
(MonadState (BuilderSt tag v x t) m, PUClasses pu v x t,
 UnitTag tag) =&gt;
tag -&gt; pu -&gt; IOPorts pu -&gt; m ()
</span><a href="NITTA.Model.Networks.Bus.html#addCustomPrototype"><span class="hs-identifier hs-var">addCustomPrototype</span></a></span><span> </span><span class="annot"><span class="annottext">tag
</span><a href="#local-6989586621680447807"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">pu
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">IOPorts pu
</span><a href="#local-6989586621680447808"><span class="hs-identifier hs-var">ioports</span></a></span><span>
</span><span id="line-1003"></span></pre></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE InstanceSigs #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">{- |
Module      : NITTA.Synthesis.MlBackend.Api
Description : ML backend API client (DTOs, request wrappers)
Copyright   : (c) Ilya Burakov, 2023
License     : BSD3
Maintainer  : aleksandr.penskoi@gmail.com
Stability   : experimental
-}</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Synthesis.MlBackend.Client</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringInput"><span class="hs-identifier">ScoringInput</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTarget"><span class="hs-identifier">ScoringTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#predictScoresIO"><span class="hs-identifier">predictScoresIO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String.ToString</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html"><span class="hs-identifier">NITTA.Synthesis.Types</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.Types.html#scores"><span class="hs-identifier">scores</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NITTA.UIBackend.ViewHelper.html"><span class="hs-identifier">NITTA.UIBackend.ViewHelper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.UIBackend.ViewHelper.html#NodeView"><span class="hs-identifier">NodeView</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Model.Time.html#VarValTimeJSON"><span class="hs-identifier">VarValTimeJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Client.Conduit</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Network.HTTP.Simple</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">data</span><span> </span><span id="ScoringTarget"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTarget"><span class="hs-identifier hs-var">ScoringTarget</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ScoringTargetSid"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTargetSid"><span class="hs-identifier hs-var">ScoringTargetSid</span></a></span></span><span> </span><span class="annot"><a href="NITTA.Synthesis.Types.html#Sid"><span class="hs-identifier hs-type">Sid</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="ScoringTargetAll"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTargetAll"><span class="hs-identifier hs-var">ScoringTargetAll</span></a></span></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680276387"><span id="local-6989586621680276389"><span id="local-6989586621680276391"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTarget"><span class="hs-identifier hs-type">ScoringTarget</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-30"></span><span>    </span><span id="local-6989586621680276380"><span class="annot"><span class="annottext">toJSON :: ScoringTarget -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTargetSid"><span class="hs-identifier hs-type">ScoringTargetSid</span></a></span><span> </span><span id="local-6989586621680276378"><span class="annot"><span class="annottext">Sid
</span><a href="#local-6989586621680276378"><span class="hs-identifier hs-var">sid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">Sid
</span><a href="#local-6989586621680276378"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="annot"><span class="annottext">ScoringTarget
</span><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTargetAll"><span class="hs-identifier hs-var">ScoringTargetAll</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">toJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;all&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span id="local-6989586621680276376"><span id="local-6989586621680276377"></span></span><span class="hs-keyword">data</span><span> </span><span id="ScoringInput"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringInput"><span class="hs-identifier hs-var">ScoringInput</span></a></span></span><span> </span><span id="local-6989586621680276794"><span class="annot"><a href="#local-6989586621680276794"><span class="hs-identifier hs-type">tag</span></a></span></span><span> </span><span id="local-6989586621680276793"><span class="annot"><a href="#local-6989586621680276793"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680276792"><span class="annot"><a href="#local-6989586621680276792"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680276791"><span class="annot"><a href="#local-6989586621680276791"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ScoringInput"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringInput"><span class="hs-identifier hs-var">ScoringInput</span></a></span></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="scoringTarget"><span class="annot"><span class="annottext">forall tag v x t. ScoringInput tag v x t -&gt; ScoringTarget
</span><a href="NITTA.Synthesis.MlBackend.Client.html#scoringTarget"><span class="hs-identifier hs-var hs-var">scoringTarget</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringTarget"><span class="hs-identifier hs-type">ScoringTarget</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="nodes"><span class="annot"><span class="annottext">forall tag v x t. ScoringInput tag v x t -&gt; [NodeView tag v x t]
</span><a href="NITTA.Synthesis.MlBackend.Client.html#nodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.UIBackend.ViewHelper.html#NodeView"><span class="hs-identifier hs-type">NodeView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276794"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276793"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276792"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276791"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tag v x t x.
Rep (ScoringInput tag v x t) x -&gt; ScoringInput tag v x t
forall tag v x t x.
ScoringInput tag v x t -&gt; Rep (ScoringInput tag v x t) x
$cto :: forall tag v x t x.
Rep (ScoringInput tag v x t) x -&gt; ScoringInput tag v x t
$cfrom :: forall tag v x t x.
ScoringInput tag v x t -&gt; Rep (ScoringInput tag v x t) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680276362"><span id="local-6989586621680276364"><span id="local-6989586621680276366"><span id="local-6989586621680276368"><span id="local-6989586621680276778"><span id="local-6989586621680276779"><span id="local-6989586621680276780"><span id="local-6989586621680276781"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Time.html#VarValTimeJSON"><span class="hs-identifier hs-type">VarValTimeJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276781"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276780"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276779"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680276778"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringInput"><span class="hs-identifier hs-type">ScoringInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276778"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276781"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276780"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276779"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span id="local-6989586621680276360"><span id="local-6989586621680276361"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="PostScoreRequestBody"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#PostScoreRequestBody"><span class="hs-identifier hs-var">PostScoreRequestBody</span></a></span></span><span> </span><span id="local-6989586621680276773"><span class="annot"><a href="#local-6989586621680276773"><span class="hs-identifier hs-type">tag</span></a></span></span><span> </span><span id="local-6989586621680276772"><span class="annot"><a href="#local-6989586621680276772"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621680276771"><span class="annot"><a href="#local-6989586621680276771"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span id="local-6989586621680276770"><span class="annot"><a href="#local-6989586621680276770"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PostScoreRequestBody"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#PostScoreRequestBody"><span class="hs-identifier hs-var">PostScoreRequestBody</span></a></span></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="inputs"><span class="annot"><span class="annottext">forall tag v x t.
PostScoreRequestBody tag v x t -&gt; [ScoringInput tag v x t]
</span><a href="NITTA.Synthesis.MlBackend.Client.html#inputs"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#ScoringInput"><span class="hs-identifier hs-type">ScoringInput</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276773"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276772"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276771"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276770"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tag v x t x.
Rep (PostScoreRequestBody tag v x t) x
-&gt; PostScoreRequestBody tag v x t
forall tag v x t x.
PostScoreRequestBody tag v x t
-&gt; Rep (PostScoreRequestBody tag v x t) x
$cto :: forall tag v x t x.
Rep (PostScoreRequestBody tag v x t) x
-&gt; PostScoreRequestBody tag v x t
$cfrom :: forall tag v x t x.
PostScoreRequestBody tag v x t
-&gt; Rep (PostScoreRequestBody tag v x t) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680276348"><span id="local-6989586621680276350"><span id="local-6989586621680276352"><span id="local-6989586621680276354"><span id="local-6989586621680276762"><span id="local-6989586621680276763"><span id="local-6989586621680276764"><span id="local-6989586621680276765"><span class="hs-special">(</span><span class="annot"><a href="NITTA.Model.Time.html#VarValTimeJSON"><span class="hs-identifier hs-type">VarValTimeJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276765"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276764"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276763"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680276762"><span class="hs-identifier hs-type">tag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#PostScoreRequestBody"><span class="hs-identifier hs-type">PostScoreRequestBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276762"><span class="hs-identifier hs-type">tag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276765"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276764"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276763"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span id="local-6989586621680276346"><span id="local-6989586621680276347"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="MlBackendResponse"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#MlBackendResponse"><span class="hs-identifier hs-var">MlBackendResponse</span></a></span></span><span> </span><span id="local-6989586621680276760"><span class="annot"><a href="#local-6989586621680276760"><span class="hs-identifier hs-type">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MlBackendResponse"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#MlBackendResponse"><span class="hs-identifier hs-var">MlBackendResponse</span></a></span></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="responseData"><span class="annot"><span class="annottext">forall d. MlBackendResponse d -&gt; d
</span><a href="NITTA.Synthesis.MlBackend.Client.html#responseData"><span class="hs-identifier hs-var hs-var">responseData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680276760"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680276335"><span id="local-6989586621680276337"><span id="local-6989586621680276342"><span class="annot"><span class="annottext">Int -&gt; MlBackendResponse d -&gt; ShowS
forall d. Show d =&gt; Int -&gt; MlBackendResponse d -&gt; ShowS
forall d. Show d =&gt; [MlBackendResponse d] -&gt; ShowS
forall d. Show d =&gt; MlBackendResponse d -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MlBackendResponse d] -&gt; ShowS
$cshowList :: forall d. Show d =&gt; [MlBackendResponse d] -&gt; ShowS
show :: MlBackendResponse d -&gt; String
$cshow :: forall d. Show d =&gt; MlBackendResponse d -&gt; String
showsPrec :: Int -&gt; MlBackendResponse d -&gt; ShowS
$cshowsPrec :: forall d. Show d =&gt; Int -&gt; MlBackendResponse d -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall d x. Rep (MlBackendResponse d) x -&gt; MlBackendResponse d
forall d x. MlBackendResponse d -&gt; Rep (MlBackendResponse d) x
$cto :: forall d x. Rep (MlBackendResponse d) x -&gt; MlBackendResponse d
$cfrom :: forall d x. MlBackendResponse d -&gt; Rep (MlBackendResponse d) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680276328"><span id="local-6989586621680276754"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680276754"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#MlBackendResponse"><span class="hs-identifier hs-type">MlBackendResponse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276754"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>    </span><span id="local-6989586621680276321"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser (MlBackendResponse d)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;MlBackendResponse&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680276318"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680276318"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-55"></span><span>        </span><span class="annot"><span class="annottext">forall d. d -&gt; MlBackendResponse d
</span><a href="NITTA.Synthesis.MlBackend.Client.html#MlBackendResponse"><span class="hs-identifier hs-var">MlBackendResponse</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621680276318"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;data&quot;</span></span><span> </span><span class="hs-comment">-- we are using the parameter's FromJSON</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680276309"><span id="local-6989586621680276311"><span id="local-6989586621680276313"><span id="local-6989586621680276743"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680276743"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#MlBackendResponse"><span class="hs-identifier hs-type">MlBackendResponse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276743"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">toJSON</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#MlBackendResponse"><span class="hs-identifier hs-type">MlBackendResponse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680276743"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621680276304"><span class="annot"><span class="annottext">toJSON :: MlBackendResponse d -&gt; Value
</span><a href="#local-6989586621680276304"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#MlBackendResponse"><span class="hs-identifier hs-type">MlBackendResponse</span></a></span><span class="hs-special">{</span><span id="local-6989586621680276303"><span class="annot"><span class="annottext">d
responseData :: d
responseData :: forall d. MlBackendResponse d -&gt; d
</span><a href="#local-6989586621680276303"><span class="hs-identifier hs-var hs-var">responseData</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;data&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621680276303"><span class="hs-identifier hs-var">responseData</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span id="local-6989586621680276299"><span id="local-6989586621680276300"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="PostScoreResponseData"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#PostScoreResponseData"><span class="hs-identifier hs-var">PostScoreResponseData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PostScoreResponseData"><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#PostScoreResponseData"><span class="hs-identifier hs-var">PostScoreResponseData</span></a></span></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">{</span><span id="scores"><span class="annot"><span class="annottext">PostScoreResponseData -&gt; [[Float]]
</span><a href="NITTA.Synthesis.MlBackend.Client.html#scores"><span class="hs-identifier hs-var hs-var">scores</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680276287"><span id="local-6989586621680276289"><span id="local-6989586621680276295"><span class="annot"><span class="annottext">Int -&gt; PostScoreResponseData -&gt; ShowS
[PostScoreResponseData] -&gt; ShowS
PostScoreResponseData -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PostScoreResponseData] -&gt; ShowS
$cshowList :: [PostScoreResponseData] -&gt; ShowS
show :: PostScoreResponseData -&gt; String
$cshow :: PostScoreResponseData -&gt; String
showsPrec :: Int -&gt; PostScoreResponseData -&gt; ShowS
$cshowsPrec :: Int -&gt; PostScoreResponseData -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall x. Rep PostScoreResponseData x -&gt; PostScoreResponseData
forall x. PostScoreResponseData -&gt; Rep PostScoreResponseData x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep PostScoreResponseData x -&gt; PostScoreResponseData
$cfrom :: forall x. PostScoreResponseData -&gt; Rep PostScoreResponseData x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- TODO: GeneralizedNewtypeDeriving vs DeriveAnyClass conflict? declaring instance manually for now</span><span>
</span><span id="line-66"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680276275"><span id="local-6989586621680276277"><span id="local-6989586621680276279"><span id="local-6989586621680276281"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#PostScoreResponseData"><span class="hs-identifier hs-type">PostScoreResponseData</span></a></span></span></span></span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680276271"><span id="local-6989586621680276273"><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#PostScoreResponseData"><span class="hs-identifier hs-type">PostScoreResponseData</span></a></span></span></span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span id="getDefaultRequestIO"><span class="annot"><span class="annottext">getDefaultRequestIO :: a -&gt; m Request
</span><a href="NITTA.Synthesis.MlBackend.Client.html#getDefaultRequestIO"><span class="hs-identifier hs-var hs-var">getDefaultRequestIO</span></a></span></span><span> </span><span id="local-6989586621680276265"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680276265"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadThrow m =&gt; String -&gt; m Request
</span><span class="hs-identifier hs-var">parseRequest</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. ToString a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">toString</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680276265"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span id="getScoreRequestIO"><span class="annot"><span class="annottext">getScoreRequestIO :: a -&gt; Text -&gt; [ScoringInput tag v x t] -&gt; f Request
</span><a href="NITTA.Synthesis.MlBackend.Client.html#getScoreRequestIO"><span class="hs-identifier hs-var hs-var">getScoreRequestIO</span></a></span></span><span> </span><span id="local-6989586621680276197"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680276197"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span id="local-6989586621680276196"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680276196"><span class="hs-identifier hs-var">modelName</span></a></span></span><span> </span><span id="local-6989586621680276195"><span class="annot"><span class="annottext">[ScoringInput tag v x t]
</span><a href="#local-6989586621680276195"><span class="hs-identifier hs-var">scoringInputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680276188"><span class="annot"><span class="annottext">path :: ByteString
</span><a href="#local-6989586621680276188"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">T.encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/models/&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680276196"><span class="hs-identifier hs-var">modelName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/score&quot;</span></span><span>
</span><span id="line-74"></span><span>        </span><span id="local-6989586621680276186"><span class="annot"><span class="annottext">body :: PostScoreRequestBody tag v x t
</span><a href="#local-6989586621680276186"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NITTA.Synthesis.MlBackend.Client.html#PostScoreRequestBody"><span class="hs-identifier hs-type">PostScoreRequestBody</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">inputs :: [ScoringInput tag v x t]
</span><a href="NITTA.Synthesis.MlBackend.Client.html#inputs"><span class="hs-identifier hs-var">inputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ScoringInput tag v x t]
</span><a href="#local-6989586621680276195"><span class="hs-identifier hs-var">scoringInputs</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-75"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>            </span><span class="annot"><span class="annottext">ByteString -&gt; Request -&gt; Request
</span><span class="hs-identifier hs-var">setRequestMethod</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;POST&quot;</span></span><span>
</span><span id="line-77"></span><span>                </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Request -&gt; Request
</span><span class="hs-identifier hs-var">setRequestPath</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680276188"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-78"></span><span>                </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. ToJSON a =&gt; a -&gt; Request -&gt; Request
</span><span class="hs-identifier hs-var">setRequestBodyJSON</span></span><span> </span><span class="annot"><span class="annottext">PostScoreRequestBody tag v x t
</span><a href="#local-6989586621680276186"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-79"></span><span>                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall {m :: * -&gt; *} {a}.
(MonadThrow m, ToString a) =&gt;
a -&gt; m Request
</span><a href="NITTA.Synthesis.MlBackend.Client.html#getDefaultRequestIO"><span class="hs-identifier hs-var">getDefaultRequestIO</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680276197"><span class="hs-identifier hs-var">baseUrl</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span id="predictScoresIO"><span class="annot"><span class="annottext">predictScoresIO :: Text -&gt; a -&gt; [ScoringInput tag v x t] -&gt; m [[Float]]
</span><a href="NITTA.Synthesis.MlBackend.Client.html#predictScoresIO"><span class="hs-identifier hs-var hs-var">predictScoresIO</span></a></span></span><span> </span><span id="local-6989586621680276137"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680276137"><span class="hs-identifier hs-var">modelName</span></a></span></span><span> </span><span id="local-6989586621680276136"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680276136"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span id="local-6989586621680276135"><span class="annot"><span class="annottext">[ScoringInput tag v x t]
</span><a href="#local-6989586621680276135"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621680276134"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621680276134"><span class="hs-identifier hs-var">request</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall {f :: * -&gt; *} {v} {x} {t} {tag} {a}.
(IsString v, Suffix v, Hashable v, Val x, Bounded t, ToJSONKey v,
 ToJSON v, ToJSON t, ToJSON tag, MonadThrow f, ToString v,
 ToString a, Typeable v, Typeable t, Show t, Default t, Integral t,
 Ord v) =&gt;
a -&gt; Text -&gt; [ScoringInput tag v x t] -&gt; f Request
</span><a href="NITTA.Synthesis.MlBackend.Client.html#getScoreRequestIO"><span class="hs-identifier hs-var">getScoreRequestIO</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680276136"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680276137"><span class="hs-identifier hs-var">modelName</span></a></span><span> </span><span class="annot"><span class="annottext">[ScoringInput tag v x t]
</span><a href="#local-6989586621680276135"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621680276133"><span class="annot"><span class="annottext">Response (MlBackendResponse PostScoreResponseData)
</span><a href="#local-6989586621680276133"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadIO m, FromJSON a) =&gt;
Request -&gt; m (Response a)
</span><span class="hs-identifier hs-var">httpJSON</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621680276134"><span class="hs-identifier hs-var">request</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PostScoreResponseData -&gt; [[Float]]
</span><a href="NITTA.Synthesis.MlBackend.Client.html#scores"><span class="hs-identifier hs-var">scores</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall d. MlBackendResponse d -&gt; d
</span><a href="NITTA.Synthesis.MlBackend.Client.html#responseData"><span class="hs-identifier hs-var">responseData</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Response a -&gt; a
</span><span class="hs-identifier hs-var">getResponseBody</span></span><span> </span><span class="annot"><span class="annottext">Response (MlBackendResponse PostScoreResponseData)
</span><a href="#local-6989586621680276133"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-85"></span></pre></body></html>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">{- |
Module      : NITTA.Intermediate.Variable
Description : Types for variable representation
Copyright   : (c) Aleksandr Penskoi, 2021
License     : BSD3
Maintainer  : aleksandr.penskoi@gmail.com
Stability   : experimental
-}</span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NITTA.Intermediate.Variable</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#Var"><span class="hs-identifier">Var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#Variables"><span class="hs-identifier">Variables</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#Suffix"><span class="hs-identifier">Suffix</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">stripPrefix</span></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String.ToString</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">-- | Variable identifier. Used for simplify type description.</span><span>
</span><span id="line-30"></span><span class="hs-keyword">type</span><span> </span><span id="Var"><span class="annot"><a href="NITTA.Intermediate.Variable.html#Var"><span class="hs-identifier hs-var">Var</span></a></span></span><span> </span><span id="local-6989586621680371072"><span class="annot"><a href="#local-6989586621680371072"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621680371072"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621680371072"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621680371072"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToString</span></span><span> </span><span class="annot"><a href="#local-6989586621680371072"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680371072"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621680371072"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- | Type class of something, which is related to variables.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">class</span><span> </span><span id="Variables"><span class="annot"><a href="NITTA.Intermediate.Variable.html#Variables"><span class="hs-identifier hs-var">Variables</span></a></span></span><span> </span><span id="local-6989586621680371069"><span class="annot"><a href="#local-6989586621680371069"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680371068"><span class="annot"><a href="#local-6989586621680371068"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621680371069"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680371068"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-comment">-- | Get all related variables.</span><span>
</span><span id="line-35"></span><span>    </span><span id="variables"><span class="annot"><a href="NITTA.Intermediate.Variable.html#variables"><span class="hs-identifier hs-type">variables</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680371069"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="annot"><a href="#local-6989586621680371068"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">-- | The type class for variable identifier modifications.</span><span>
</span><span id="line-38"></span><span class="hs-keyword">class</span><span> </span><span id="Suffix"><span class="annot"><a href="NITTA.Intermediate.Variable.html#Suffix"><span class="hs-identifier hs-var">Suffix</span></a></span></span><span> </span><span id="local-6989586621680371088"><span class="annot"><a href="#local-6989586621680371088"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-comment">-- | Make a buffered version of the variable. For example: @&quot;v&quot; -&gt; &quot;v@buf&quot;@</span><span>
</span><span id="line-40"></span><span>    </span><span id="bufferSuffix"><span class="annot"><a href="NITTA.Intermediate.Variable.html#bufferSuffix"><span class="hs-identifier hs-type">bufferSuffix</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680371088"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680371088"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-comment">-- | Buffer sequence length of a variable (@&quot;v&quot; -&gt; 0; &quot;v@buf&quot; -&gt; 1; &quot;b@buf@buf&quot; -&gt; 2@)</span><span>
</span><span id="line-43"></span><span>    </span><span id="countSuffix"><span class="annot"><a href="NITTA.Intermediate.Variable.html#countSuffix"><span class="hs-identifier hs-type">countSuffix</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680371088"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">-- FIXME: unsafe, because can create duplicate variable. Solution options:</span><span>
</span><span id="line-46"></span><span class="hs-comment">--</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- - unsafeIO and counter;</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- - restriction on user's variable names + checking collision for each variable generation.</span><span>
</span><span id="line-49"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-50"></span><span>    </span><span id="local-6989586621680371056"><span class="annot"><span class="annottext">bufferSuffix :: String -&gt; String
</span><a href="#local-6989586621680371056"><span class="hs-identifier hs-var hs-var hs-var hs-var">bufferSuffix</span></a></span></span><span> </span><span id="local-6989586621680371055"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680371055"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680371055"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;@buf&quot;</span></span><span>
</span><span id="line-51"></span><span>    </span><span id="local-6989586621680371045"><span class="annot"><span class="annottext">countSuffix :: String -&gt; Int
</span><a href="#local-6989586621680371045"><span class="hs-identifier hs-var hs-var hs-var hs-var">countSuffix</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#countSuffix"><span class="hs-identifier hs-var">countSuffix</span></a></span><span> </span><span id="local-6989586621680371044"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680371044"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-53"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680371043"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680371043"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Maybe [a]
</span><span class="hs-identifier hs-var">stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;@buf&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680371044"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">forall v. Suffix v =&gt; v -&gt; Int
</span><a href="NITTA.Intermediate.Variable.html#countSuffix"><span class="hs-identifier hs-var">countSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680371043"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-54"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Suffix v =&gt; v -&gt; Int
</span><a href="NITTA.Intermediate.Variable.html#countSuffix"><span class="hs-identifier hs-var">countSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680371044"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621680371033"><span class="annot"><span class="annottext">bufferSuffix :: Text -&gt; Text
</span><a href="#local-6989586621680371033"><span class="hs-identifier hs-var hs-var hs-var hs-var">bufferSuffix</span></a></span></span><span> </span><span id="local-6989586621680371032"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371032"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371032"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;@buf&quot;</span></span><span>
</span><span id="line-58"></span><span>    </span><span id="local-6989586621680371024"><span class="annot"><span class="annottext">countSuffix :: Text -&gt; Int
</span><a href="#local-6989586621680371024"><span class="hs-identifier hs-var hs-var hs-var hs-var">countSuffix</span></a></span></span><span> </span><span id="local-6989586621680371023"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371023"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371023"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier hs-var">T.empty</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="NITTA.Intermediate.Variable.html#countSuffix"><span class="hs-identifier hs-var">countSuffix</span></a></span><span> </span><span id="local-6989586621680371021"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371021"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-60"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621680371020"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371020"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Maybe Text
</span><span class="hs-identifier hs-var">T.stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;@buf&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371021"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">forall v. Suffix v =&gt; v -&gt; Int
</span><a href="NITTA.Intermediate.Variable.html#countSuffix"><span class="hs-identifier hs-var">countSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371020"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall v. Suffix v =&gt; v -&gt; Int
</span><a href="NITTA.Intermediate.Variable.html#countSuffix"><span class="hs-identifier hs-var">countSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621680371021"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-62"></span></pre></body></html>